{% extends "base.html" %}
{% block title %}Driver Information Form{% endblock %}
{% block head %}
<style>
  body {
    background-color: var(--bg-primary);
    padding: 30px 20px;
  }
  
  h1 {
    text-align: center;
    color: var(--text-primary);
    margin-bottom: 2rem;
  }
  
  form {
    max-width: 500px;
    margin: auto;
    padding: 2rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 12px;
    box-shadow: 0 4px 20px var(--shadow);
  }
  
  [data-theme="dark"] form {
    border-color: var(--accent-border);
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  label {
    display: block;
    margin-top: 15px;
    margin-bottom: 0.5rem;
    font-weight: 500;
    color: var(--text-primary);
  }
  
  input, select {
    width: 100%;
    padding: 0.75rem;
    margin-top: 5px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: var(--bg-input);
    color: var(--text-primary);
    font-size: 1rem;
    box-sizing: border-box;
  }
  
  input:focus, select:focus {
    outline: none;
    border-color: var(--accent-border);
    box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
  }
  
  input::placeholder {
    color: var(--text-muted);
  }
  
  button {
    margin-top: 20px;
    width: 100%;
    padding: 0.75rem;
    background: var(--accent);
    border: 1px solid var(--accent-border);
    color: var(--text-inverse);
    font-size: 1rem;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  button:hover:not(:disabled) {
    background: var(--accent-hover);
    border-color: var(--accent-hover);
    transform: translateY(-1px);
  }
  
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .password-rules {
    font-size: 0.9em;
    margin-top: 0.5rem;
    color: var(--text-secondary);
    padding-left: 0;
    list-style: none;
  }
  
  .password-rules li {
    margin-bottom: 0.25rem;
    transition: color 0.2s ease;
  }
  
  .valid {
    color: var(--success);
  }
  
  .invalid {
    color: var(--error);
  }
  
  .alert-container {
    max-width: 600px;
    margin: 0 auto 1rem auto;
  }
  
  .alert {
    padding: 0.75rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
  }
  
  .alert.error {
    background: rgba(239, 68, 68, 0.1);
    color: var(--error);
    border: 1px solid var(--error);
  }
  
  .alert.success {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success);
    border: 1px solid var(--success);
  }
</style>
{% endblock %}
{% block content %}
<h1>Driver Information</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="alert-container">
      {% for category, message in messages %}
        <div class="alert {{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<form action="/driver" method="POST">
    <input type="hidden" name="csrf_token" value="{{ form.csrf_token._value() if form and form.csrf_token else '' }}"/>
    <label for="Username">Username:</label>
    <input type="text" id="name" name="Username" placeholder="Enter username" min="1" max="100" required value="{{ request.form.get('Username','') }}">

    <label for="Email">Email Address:</label>
    <input type="text" id="email" name="Email" placeholder="validemail@example.com" min="1" max="255" required value="{{ request.form.get('Email','') }}">

    <label for="Password">Password:</label>
    <input type="password" id="password" name="Password" placeholder="Password" required>

    <ul class="password-rules">
        <li id="rule-length" class="invalid">❌ At least 8 characters</li>
        <li id="rule-upper" class="invalid">❌ Contains an uppercase letter</li>
        <li id="rule-lower" class="invalid">❌ Contains a lowercase letter</li>
        <li id="rule-number" class="invalid">❌ Contains a number</li>
        <li id="rule-special" class="invalid">❌ Contains a special character (!@#$%^&* etc.)</li>
    </ul>

    <label for="Phone">Phone Number:</label>
    <input type="text" id="phone" name="Phone" placeholder="555-555-5555" min="10" max="20" value="{{ request.form.get('Phone','') }}">

    <label for="FirstName">First Name:</label>
    <input type="text" id="FirstName" name="FirstName" placeholder="First Name" min="1" max="100" required value="{{ request.form.get('FirstName','') }}">

    <label for="LastName">Last Name:</label>
    <input type="text" id="LastName" name="LastName" placeholder="Last Name" min="1" max="100" required value="{{ request.form.get('LastName','') }}">

    <label for="LicenseNumber">License Number:</label>
    <input type="text" id="licenseNumber" name="LicenseNumber" placeholder="License Number" min="1" max="50" required value="{{ request.form.get('LicenseNumber','') }}">

    <label for="LicenseIssueDate">License Issue Date:</label>
    <input type="date" id="LicenseIssueDate" name="LicenseIssueDate" required value="{{ request.form.get('LicenseIssueDate','') }}">

    <label for="LicenseExpirationDate">License Expiration Date:</label>
    <input type="date" id="LicenseExpirationDate" name="LicenseExpirationDate" required value="{{ request.form.get('LicenseExpirationDate','') }}">

    <button type="submit" id="submit-btn" disabled>Submit</button>
</form>

<script>
const passwordInput = document.getElementById("password");
const submitBtn = document.getElementById("submit-btn");

const rules = {
    length: document.getElementById("rule-length"),
    upper: document.getElementById("rule-upper"),
    lower: document.getElementById("rule-lower"),
    number: document.getElementById("rule-number"),
    special: document.getElementById("rule-special")
};

passwordInput.addEventListener("input", () => {
    const val = passwordInput.value;

    const tests = {
        length: val.length >= 8,
        upper: /[A-Z]/.test(val),
        lower: /[a-z]/.test(val),
        number: /[0-9]/.test(val),
        special: /[^A-Za-z0-9]/.test(val)
    };

    let allValid = true;
    for (const key in tests) {
        if (tests[key]) {
            rules[key].classList.add("valid");
            rules[key].classList.remove("invalid");
            rules[key].textContent = "✅ " + rules[key].textContent.replace(/^❌ |✅ /, "");
        } else {
            rules[key].classList.add("invalid");
            rules[key].classList.remove("valid");
            rules[key].textContent = "❌ " + rules[key].textContent.replace(/^❌ |✅ /, "");
            allValid = false;
        }
    }

    submitBtn.disabled = !allValid;
});
</script>
{% endblock %}
