{% extends "base.html" %}
{% block title %}Bulk Import Errors{% endblock %}
{% block content %}
<style>
  .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
  h1 { margin: 0 0 12px; }
  .toolbar { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:20px; }
  .btn { padding:8px 12px; border:1px solid #ddd; border-radius:8px; background:#f9fafb; cursor:pointer; text-decoration:none; color:#111; }
  .btn:hover { background:#f3f4f6; }
  .card { background:#fff; border:1px solid #eee; border-radius:12px; padding:20px; margin-bottom:20px; }
  .card h3 { margin-top:0; color:#374151; }
  .summary { display:grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap:16px; margin-bottom:20px; }
  .summary-item { text-align:center; padding:12px; background:#f9fafb; border-radius:8px; }
  .summary-item .label { font-size:12px; color:#6b7280; text-transform:uppercase; margin-bottom:4px; }
  .summary-item .value { font-size:24px; font-weight:600; color:#111; }
  .error-badge { color:#dc2626; background:#fef2f2; }
  .success-badge { color:#059669; background:#ecfdf5; }
  table { width:100%; border-collapse: collapse; }
  thead th { text-align:left; font-weight:600; color:#374151; background:#fafafa; padding:10px 12px; border-bottom:1px solid #eee; }
  tbody td { padding:12px; border-bottom:1px solid #f2f2f2; vertical-align:top; }
  .muted { color:#6b7280; }
  .error-msg { color:#dc2626; font-family:monospace; font-size:13px; }
  .csv-data { font-family:monospace; font-size:12px; background:#f9fafb; padding:4px 8px; border-radius:4px; }
</style>

<div class="wrap">
  <div class="toolbar">
    <h1>{{ company_name }} Bulk Import Errors</h1>
    <a class="btn" href="{{ url_for('sponsor.bulk_import_audit_log') }}">‚Üê Back to Logs</a>
  </div>

  <div class="card">
    <h3>Import Summary</h3>
    <div class="summary">
      <div class="summary-item">
        <div class="label">File Name</div>
        <div class="value" style="font-size:14px; word-break:break-all;">{{ bulk_log.FileName }}</div>
      </div>
      <div class="summary-item">
        <div class="label">Imported At</div>
        <div class="value" style="font-size:14px;">{{ bulk_log.ImportedAt.strftime('%Y-%m-%d %H:%M') }}</div>
      </div>
      <div class="summary-item">
        <div class="label">Total Rows</div>
        <div class="value">{{ bulk_log.TotalRows }}</div>
      </div>
      <div class="summary-item success-badge">
        <div class="label">Success</div>
        <div class="value">{{ bulk_log.SuccessCount }}</div>
      </div>
      <div class="summary-item error-badge">
        <div class="label">Errors</div>
        <div class="value">{{ bulk_log.ErrorCount }}</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h3>Error Details ({{ errors|length }} total)</h3>
    {% if errors %}
    <div style="overflow-x:auto;">
      <table>
        <thead>
          <tr>
            <th>Row #</th>
            <th>CSV Data</th>
            <th>Error Message</th>
          </tr>
        </thead>
        <tbody>
          {% for error in errors %}
          <tr>
            <td>
              <div style="font-weight:600;">{{ error.RowNumber }}</div>
            </td>
            <td>
              <div class="csv-data">{{ error.CSVRowData }}</div>
            </td>
            <td>
              <div class="error-msg">{{ error.ErrorMessage }}</div>
              <div class="muted" style="font-size:11px; margin-top:4px;">{{ error.ErroredAt.strftime('%Y-%m-%d %H:%M:%S') }}</div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <p class="muted">No errors found for this import.</p>
    {% endif %}
  </div>
</div>
{% endblock %}

