# Mobile Application Files



===== mobileApplication/app/src/main/java/com/example/driverrewards/LoginActivity.kt =====

```kotlin
package com.example.driverrewards

import android.content.Intent
import android.os.Bundle
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import androidx.appcompat.app.AppCompatActivity
import androidx.appcompat.app.AppCompatDelegate
import androidx.lifecycle.lifecycleScope
import com.example.driverrewards.databinding.ActivityLoginBinding
import com.example.driverrewards.network.AuthService
import com.example.driverrewards.utils.BiometricHelper
import com.example.driverrewards.utils.CredentialManager
import com.example.driverrewards.utils.SessionManager
import kotlinx.coroutines.launch
import kotlinx.coroutines.Dispatchers

class LoginActivity : AppCompatActivity() {
    
    private lateinit var binding: ActivityLoginBinding
    private lateinit var authService: AuthService
    private lateinit var sessionManager: SessionManager
    private lateinit var credentialManager: CredentialManager
    private lateinit var biometricHelper: BiometricHelper
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        
        binding = ActivityLoginBinding.inflate(layoutInflater)
        setContentView(binding.root)
        
        authService = AuthService()
        sessionManager = SessionManager(this)
        credentialManager = CredentialManager(this)
        biometricHelper = BiometricHelper(this)
        
        // Initialize NetworkClient with context
        com.example.driverrewards.network.NetworkClient.initialize(this)
        
        // Apply dark mode setting
        applyDarkModeSetting()
        
        // Check if user is already logged in with valid session
        if (sessionManager.validateSession()) {
            navigateToMain()
            return
        }
        
        setupLoginButton()
        setupBiometricLogin()
    }
    
    private fun applyDarkModeSetting() {
        val isDarkMode = sessionManager.isDarkModeEnabled()
        val mode = if (isDarkMode) {
            AppCompatDelegate.MODE_NIGHT_YES
        } else {
            AppCompatDelegate.MODE_NIGHT_NO
        }
        AppCompatDelegate.setDefaultNightMode(mode)
    }
    
    private fun setupLoginButton() {
        binding.loginButton.setOnClickListener {
            val email = binding.emailEditText.text.toString().trim()
            val password = binding.passwordEditText.text.toString()
            
            if (email.isEmpty() || password.isEmpty()) {
                Toast.makeText(this, "Please enter both email and password", Toast.LENGTH_SHORT).show()
                return@setOnClickListener
            }
            
            login(email, password, shouldStoreCredentials = true)
        }
    }
    
    private fun setupBiometricLogin() {
        // Check if biometric is available and credentials are stored
        val hasBiometric = biometricHelper.isBiometricAvailable()
        val hasCredentials = credentialManager.hasStoredCredentials()
        
        if (hasBiometric && hasCredentials) {
            binding.fingerprintButton?.visibility = android.view.View.VISIBLE
            binding.fingerprintButton?.setOnClickListener {
                authenticateWithFingerprint()
            }
        } else {
            binding.fingerprintButton?.visibility = android.view.View.GONE
        }
    }
    
    private fun authenticateWithFingerprint() {
        val credentials = credentialManager.getStoredCredentials()
        if (credentials == null) {
            Toast.makeText(this, "No stored credentials found", Toast.LENGTH_SHORT).show()
            binding.fingerprintButton?.visibility = android.view.View.GONE
            return
        }
        
        val (email, password) = credentials
        
        biometricHelper.authenticate(
            title = "Sign in with Fingerprint",
            subtitle = "Use your fingerprint to sign in to your account",
            negativeButtonText = "Cancel",
            onSuccess = {
                // Fingerprint authentication successful, proceed with login
                login(email, password, shouldStoreCredentials = false)
            },
            onError = { errorMessage ->
                Toast.makeText(this, "Fingerprint authentication failed: $errorMessage", Toast.LENGTH_LONG).show()
            },
            onCancel = {
                // User canceled, do nothing
            }
        )
    }
    
    private fun login(email: String, password: String, shouldStoreCredentials: Boolean = false) {
        binding.loginButton.isEnabled = false
        binding.progressBar.visibility = android.view.View.VISIBLE
        
        println("DEBUG: Starting login process for email: $email")
        
        lifecycleScope.launch(Dispatchers.IO) {
            try {
                val result = authService.login(email, password)
                
                println("DEBUG: Login result: success=${result.success}, message=${result.message}")
                
                if (result.success) {
                    // Save session data
                    sessionManager.saveSession(
                        accountId = result.accountId ?: "",
                        driverId = result.driverId ?: "",
                        email = result.email ?: email, // Use email from API response, fallback to input email
                        username = result.username ?: ""
                    )
                    
                    println("DEBUG: Session saved successfully")
                    
                    // If this is a regular login (not fingerprint), ask user if they want to store credentials
                    if (shouldStoreCredentials && biometricHelper.isBiometricAvailable() && !credentialManager.hasStoredCredentials()) {
                        runOnUiThread {
                            askToStoreCredentials(email, password)
                        }
                    } else {
                        runOnUiThread {
                            Toast.makeText(this@LoginActivity, "Login successful!", Toast.LENGTH_SHORT).show()
                            navigateToMain()
                        }
                    }
                } else if (result.mfaRequired == true) {
                    // MFA required - show code entry dialog
                    // Store credentials temporarily for MFA flow
                    runOnUiThread {
                        showMfaDialog(email, password, shouldStoreCredentials)
                    }
                } else {
                    val errorMessage = result.message ?: "Login failed"
                    println("DEBUG: Login failed with message: $errorMessage")
                    runOnUiThread {
                        Toast.makeText(this@LoginActivity, errorMessage, Toast.LENGTH_LONG).show()
                    }
                }
            } catch (e: Exception) {
                println("DEBUG: Exception in login: ${e.javaClass.simpleName} - ${e.message}")
                runOnUiThread {
                    Toast.makeText(this@LoginActivity, "Unexpected error: ${e.message}", Toast.LENGTH_LONG).show()
                }
            } finally {
                runOnUiThread {
                    binding.loginButton.isEnabled = true
                    binding.progressBar.visibility = android.view.View.GONE
                }
            }
        }
    }
    
    private fun askToStoreCredentials(email: String, password: String) {
        AlertDialog.Builder(this)
            .setTitle("Enable Fingerprint Login?")
            .setMessage("Would you like to enable fingerprint login for faster access? Your credentials will be securely stored on this device.")
            .setPositiveButton("Yes") { _, _ ->
                if (credentialManager.storeCredentials(email, password)) {
                    Toast.makeText(this, "Fingerprint login enabled", Toast.LENGTH_SHORT).show()
                    setupBiometricLogin() // Update UI to show fingerprint button and indicator
                } else {
                    Toast.makeText(this, "Failed to store credentials", Toast.LENGTH_SHORT).show()
                }
                navigateToMain()
            }
            .setNegativeButton("No") { _, _ ->
                navigateToMain()
            }
            .setCancelable(false)
            .show()
    }
    
    private fun showMfaDialog(email: String, password: String? = null, shouldStoreCredentials: Boolean = false) {
        val dialogView = layoutInflater.inflate(R.layout.dialog_mfa_code, null)
        val dialog = android.app.AlertDialog.Builder(this)
            .setView(dialogView)
            .setCancelable(false)
            .create()
        
        val mfaCodeEditText = dialogView.findViewById<com.google.android.material.textfield.TextInputEditText>(R.id.mfaCodeEditText)
        val mfaProgressBar = dialogView.findViewById<android.widget.ProgressBar>(R.id.mfaProgressBar)
        val mfaErrorMessage = dialogView.findViewById<android.widget.TextView>(R.id.mfaErrorMessage)
        val verifyButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.mfaVerifyButton)
        val cancelButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.mfaCancelButton)
        
        verifyButton.setOnClickListener {
            val code = mfaCodeEditText?.text?.toString()?.trim() ?: ""
            if (code.isEmpty()) {
                mfaErrorMessage?.text = "Please enter the MFA code"
                mfaErrorMessage?.visibility = android.view.View.VISIBLE
                return@setOnClickListener
            }
            
            // Disable button and show progress
            verifyButton.isEnabled = false
            mfaProgressBar?.visibility = android.view.View.VISIBLE
            mfaErrorMessage?.visibility = android.view.View.GONE
            
            // Verify MFA code
            lifecycleScope.launch(Dispatchers.IO) {
                try {
                    val result = authService.verifyMfa(code)
                    runOnUiThread {
                        mfaProgressBar?.visibility = android.view.View.GONE
                        verifyButton.isEnabled = true
                        
                        if (result.success) {
                            // Save session data
                            sessionManager.saveSession(
                                accountId = result.accountId ?: "",
                                driverId = result.driverId ?: "",
                                email = result.email ?: email,
                                username = result.username ?: ""
                            )
                            
                            dialog.dismiss()
                            
                            // If this was a regular login with password, ask to store credentials
                            if (shouldStoreCredentials && password != null && 
                                biometricHelper.isBiometricAvailable() && 
                                !credentialManager.hasStoredCredentials()) {
                                askToStoreCredentials(email, password)
                            } else {
                                Toast.makeText(this@LoginActivity, "Login successful!", Toast.LENGTH_SHORT).show()
                                navigateToMain()
                            }
                        } else {
                            val errorMessage = result.message ?: "MFA verification failed"
                            mfaErrorMessage?.text = errorMessage
                            mfaErrorMessage?.visibility = android.view.View.VISIBLE
                        }
                    }
                } catch (e: Exception) {
                    runOnUiThread {
                        mfaProgressBar?.visibility = android.view.View.GONE
                        verifyButton.isEnabled = true
                        mfaErrorMessage?.text = "Unexpected error: ${e.message}"
                        mfaErrorMessage?.visibility = android.view.View.VISIBLE
                    }
                }
            }
        }
        
        cancelButton.setOnClickListener {
            dialog.dismiss()
            // Re-enable login button
            binding.loginButton.isEnabled = true
            binding.progressBar.visibility = android.view.View.GONE
        }
        
        dialog.show()
    }
    
    private fun navigateToMain() {
        val intent = Intent(this, MainActivity::class.java)
        intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK
        startActivity(intent)
        finish()
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/MainActivity.kt =====

```kotlin
package com.example.driverrewards

import android.animation.ObjectAnimator
import android.content.Intent
import android.os.Bundle
import android.view.Menu
import android.view.MenuItem
import android.view.View
import android.view.ViewGroup
import android.view.animation.AccelerateDecelerateInterpolator
import android.view.inputmethod.InputMethodManager
import android.widget.Button
import android.widget.CheckBox
import android.widget.EditText
import android.widget.ImageButton
import android.widget.LinearLayout
import android.widget.RadioGroup
import android.widget.TextView
import android.widget.Toast
import androidx.appcompat.widget.SearchView
import androidx.drawerlayout.widget.DrawerLayout
import androidx.appcompat.app.AppCompatDelegate
import androidx.lifecycle.lifecycleScope
import com.google.android.material.bottomnavigation.BottomNavigationView
import androidx.appcompat.app.AppCompatActivity
import androidx.navigation.findNavController
import androidx.navigation.ui.AppBarConfiguration
import androidx.navigation.ui.setupActionBarWithNavController
import androidx.navigation.ui.setupWithNavController
import com.example.driverrewards.R
import com.example.driverrewards.databinding.ActivityMainBinding
import com.example.driverrewards.network.ProfileService
import com.example.driverrewards.ui.profile.ProfileViewModel
import com.example.driverrewards.ui.catalog.CatalogViewModel
import com.example.driverrewards.utils.SessionManager
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.Observer
import kotlinx.coroutines.launch
import kotlinx.coroutines.Dispatchers

class MainActivity : AppCompatActivity() {

    private lateinit var binding: ActivityMainBinding
    private lateinit var sessionManager: SessionManager
    private lateinit var profileService: ProfileService
    private lateinit var profileViewModel: ProfileViewModel
    private lateinit var catalogViewModel: CatalogViewModel
    private var pointsDisplayView: View? = null
    private var filterDrawer: View? = null
    private var drawerLayout: DrawerLayout? = null

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)

        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)

        sessionManager = SessionManager(this)
        profileService = ProfileService()
        profileViewModel = ViewModelProvider(this)[ProfileViewModel::class.java]
        catalogViewModel = ViewModelProvider(this)[CatalogViewModel::class.java]
        
        // Initialize NetworkClient with context
        com.example.driverrewards.network.NetworkClient.initialize(this)
        
        // Observe profile data for points updates
        profileViewModel.profileData.observe(this, Observer { profileData ->
            profileData?.let {
                updatePointsDisplay(it.pointsBalance.toString())
            }
        })
        
        // Load profile data if not already cached
        profileViewModel.loadProfile()
        
        // Apply dark mode setting
        applyDarkModeSetting()
        
        // Check if user is logged in with valid session
        if (!sessionManager.validateSession()) {
            navigateToLogin()
            return
        }

        val navView: BottomNavigationView = binding.navView

        val navController = findNavController(R.id.nav_host_fragment_activity_main)
        // Passing each menu ID as a set of Ids because each
        // menu should be considered as top level destinations.
        val appBarConfiguration = AppBarConfiguration(
            setOf(
                R.id.navigation_catalog, R.id.navigation_cart, R.id.navigation_orders, R.id.navigation_profile
            )
        )
        setupActionBarWithNavController(navController, appBarConfiguration)
        navView.setupWithNavController(navController)
        
        // Add navigation listener to handle profile tab clicks when on detail page
        navView.setOnItemSelectedListener { item ->
            when (item.itemId) {
                R.id.navigation_profile -> {
                    // If we're on profile detail page, navigate back to profile
                    if (navController.currentDestination?.id == R.id.navigation_profile_detail) {
                        navController.navigate(R.id.action_profile_detail_to_profile)
                    } else {
                        // Normal navigation handled by setupWithNavController
                        navController.navigate(item.itemId)
                    }
                    true
                }
                R.id.navigation_catalog -> {
                    val currentDestination = navController.currentDestination?.id
                    // If we're already on product detail page, pop back stack to navigate away
                    if (currentDestination == R.id.navigation_product_detail) {
                        // Pop back stack to navigate away from product detail
                        if (navController.popBackStack()) {
                            // After popping, navigate to catalog if not already there
                            binding.root.post {
                                if (navController.currentDestination?.id != R.id.navigation_catalog) {
                                    navController.navigate(R.id.navigation_catalog)
                                }
                            }
                        }
                        true
                    } else {
                        // Check if there's a saved product detail to restore
                        val currentProductId = catalogViewModel.getCurrentProductItemId()
                        if (currentProductId != null) {
                            // Navigate to catalog first (if not already there), then to product detail
                            // This ensures catalog is in the back stack before product detail
                            if (currentDestination != R.id.navigation_catalog) {
                                navController.navigate(R.id.navigation_catalog)
                            }
                            // Use post to navigate to product detail after catalog navigation completes
                            binding.root.post {
                                val bundle = Bundle().apply {
                                    putString("itemId", currentProductId)
                                }
                                navController.navigate(R.id.action_catalog_to_product_detail, bundle)
                            }
                            true
                        } else {
                            // Normal navigation to catalog
                            navController.navigate(item.itemId)
                            true
                        }
                    }
                }
                R.id.navigation_favorites -> {
                    val currentDestination = navController.currentDestination?.id
                    // If we're already on product detail page, pop back stack to navigate away
                    if (currentDestination == R.id.navigation_product_detail) {
                        // Pop back stack to navigate away from product detail
                        if (navController.popBackStack()) {
                            // After popping, navigate to favorites if not already there
                            binding.root.post {
                                if (navController.currentDestination?.id != R.id.navigation_favorites) {
                                    navController.navigate(R.id.navigation_favorites)
                                }
                            }
                        }
                        true
                    } else {
                        // Check if there's a saved product detail to restore
                        val currentProductId = catalogViewModel.getCurrentProductItemId()
                        if (currentProductId != null) {
                            // Navigate to favorites first (if not already there), then to product detail
                            if (currentDestination != R.id.navigation_favorites) {
                                navController.navigate(R.id.navigation_favorites)
                            }
                            // Use post to navigate to product detail after favorites navigation completes
                            binding.root.post {
                                val bundle = Bundle().apply {
                                    putString("itemId", currentProductId)
                                }
                                navController.navigate(R.id.action_favorites_to_product_detail, bundle)
                            }
                            true
                        } else {
                            // Normal navigation to favorites
                            navController.navigate(item.itemId)
                            true
                        }
                    }
                }
                else -> {
                    // Let the default handler take care of other tabs
                    navController.navigate(item.itemId)
                    true
                }
            }
        }
        
        // Add destination change listener for menu visibility and points display
        navController.addOnDestinationChangedListener { _, _, _ ->
            invalidateOptionsMenu()
        }
    }
    
    private fun applyDarkModeSetting() {
        val isDarkMode = sessionManager.isDarkModeEnabled()
        val mode = if (isDarkMode) {
            AppCompatDelegate.MODE_NIGHT_YES
        } else {
            AppCompatDelegate.MODE_NIGHT_NO
        }
        AppCompatDelegate.setDefaultNightMode(mode)
    }
    
    override fun onCreateOptionsMenu(menu: Menu): Boolean {
        menuInflater.inflate(R.menu.top_menu, menu)
        
        // Only show logout menu item when on profile page
        val navController = findNavController(R.id.nav_host_fragment_activity_main)
        val currentDestination = navController.currentDestination
        val isOnProfilePage = currentDestination?.id == R.id.navigation_profile
        val isOnProfileDetailPage = currentDestination?.id == R.id.navigation_profile_detail
        val isOnCatalogPage = currentDestination?.id == R.id.navigation_catalog
        
        val logoutItem = menu.findItem(R.id.action_logout)
        logoutItem?.isVisible = isOnProfilePage
        
        // Set up points display for non-profile pages
        if (!isOnProfilePage && !isOnProfileDetailPage) {
            if (isOnCatalogPage) {
                // For catalog page, set up custom action bar with search and points
                setupCatalogActionBar()
            } else {
                // For other pages, just show points
                setupPointsDisplay()
            }
        } else {
            // Hide points display on profile page and profile detail page
            pointsDisplayView?.let { view ->
                supportActionBar?.customView = null
                supportActionBar?.setDisplayShowCustomEnabled(false)
                supportActionBar?.setDisplayShowTitleEnabled(true)
            }
        }
        
        // Hide the default search menu item since we're using custom layout
        val searchItem = menu.findItem(R.id.action_search)
        searchItem?.isVisible = false
        
        return true
    }
    
    private fun setupCatalogActionBar() {
        // Create a custom layout for the catalog action bar
        val customView = layoutInflater.inflate(R.layout.catalog_action_bar, null)
        
        // Set up the search view in the custom layout
        val searchView = customView.findViewById<SearchView>(R.id.catalog_search_view)
        searchView?.let { sv ->
            sv.queryHint = "Search products..."
            sv.setOnQueryTextListener(object : SearchView.OnQueryTextListener {
                override fun onQueryTextSubmit(query: String?): Boolean {
                    sendSearchQueryToFragment(query)
                    // Hide the keyboard after search is submitted
                    hideKeyboard()
                    return true
                }
                
                override fun onQueryTextChange(newText: String?): Boolean {
                    return false
                }
            })
        }
        
        // Set up the filter button
        val filterButton = customView.findViewById<ImageButton>(R.id.filter_button)
        filterButton?.setOnClickListener {
            showFilterDrawer()
        }
        
        // Set up the points display in the custom layout
        val pointsValueView = customView.findViewById<TextView>(R.id.catalog_points_value)
        pointsValueView?.setOnClickListener {
            // Navigate to points detail page
            try {
                val navController = findNavController(R.id.nav_host_fragment_activity_main)
                navController.navigate(R.id.navigation_points_detail)
            } catch (e: Exception) {
                android.util.Log.e("MainActivity", "Error navigating to points detail: ${e.message}", e)
            }
        }
        // Make the entire points container clickable
        val pointsContainer = customView.findViewById<View>(R.id.points_container)
        pointsContainer?.setOnClickListener {
            // Navigate to points detail page
            try {
                val navController = findNavController(R.id.nav_host_fragment_activity_main)
                navController.navigate(R.id.navigation_points_detail)
            } catch (e: Exception) {
                android.util.Log.e("MainActivity", "Error navigating to points detail: ${e.message}", e)
            }
        }
        pointsDisplayView = customView
        
        // Set the custom view as the action bar
        supportActionBar?.let { actionBar ->
            actionBar.setDisplayShowCustomEnabled(true)
            actionBar.setDisplayShowTitleEnabled(false)
            actionBar.customView = customView
        }
        
        // Fetch and display points
        fetchAndDisplayPoints()
    }
    
    private fun sendSearchQueryToFragment(query: String?) {
        // Find the current CatalogFragment and send the search query
        val navController = findNavController(R.id.nav_host_fragment_activity_main)
        if (navController.currentDestination?.id == R.id.navigation_catalog) {
            // Get the current fragment and cast it to CatalogFragment
            val fragment = supportFragmentManager.findFragmentById(R.id.nav_host_fragment_activity_main)
            if (fragment is androidx.navigation.fragment.NavHostFragment) {
                val catalogFragment = fragment.childFragmentManager.fragments.firstOrNull()
                if (catalogFragment is com.example.driverrewards.ui.catalog.CatalogFragment) {
                    catalogFragment.performSearch(query)
                }
            }
        }
    }
    
    override fun onSupportNavigateUp(): Boolean {
        val navController = findNavController(R.id.nav_host_fragment_activity_main)
        return when (navController.currentDestination?.id) {
            R.id.navigation_profile_detail -> {
                // Navigate back to profile page from detail page
                navController.navigate(R.id.action_profile_detail_to_profile)
                true
            }
            R.id.navigation_product_detail -> {
                // When navigating back from product detail, clear the saved product ID
                // so it doesn't auto-restore when clicking catalog tab
                catalogViewModel.setCurrentProductItemId(null)
                navController.navigateUp() || super.onSupportNavigateUp()
            }
            else -> navController.navigateUp() || super.onSupportNavigateUp()
        }
    }
    
    override fun onOptionsItemSelected(item: MenuItem): Boolean {
        return when (item.itemId) {
            R.id.action_logout -> {
                logout()
                true
            }
            else -> super.onOptionsItemSelected(item)
        }
    }
    
    private fun logout() {
        // Clear session cookies from NetworkClient
        com.example.driverrewards.network.NetworkClient.clearSessionCookies()
        
        // Clear session data from SessionManager
        sessionManager.logout()
        
        navigateToLogin()
    }
    
    private fun navigateToLogin() {
        val intent = Intent(this, LoginActivity::class.java)
        intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK
        startActivity(intent)
        finish()
    }
    
    private fun setupPointsDisplay() {
        // Remove existing points display if any
        pointsDisplayView?.let { view ->
            supportActionBar?.customView = null
        }
        
        // Create new points display view
        pointsDisplayView = layoutInflater.inflate(R.layout.points_display, null)
        supportActionBar?.customView = pointsDisplayView
        supportActionBar?.setDisplayShowCustomEnabled(true)
        supportActionBar?.setDisplayShowTitleEnabled(false)
        
        // Fetch and display points
        fetchAndDisplayPoints()
    }
    
    private fun updatePointsDisplay(points: String) {
        // Update points display for regular action bar
        val pointsValue = pointsDisplayView?.findViewById<TextView>(R.id.points_value)
        pointsValue?.text = points
        
        // Update points display for catalog action bar
        val catalogPointsValue = pointsDisplayView?.findViewById<TextView>(R.id.catalog_points_value)
        catalogPointsValue?.text = points
    }
    
    private fun hideKeyboard() {
        val inputMethodManager = getSystemService(INPUT_METHOD_SERVICE) as InputMethodManager
        val currentFocus = currentFocus
        if (currentFocus != null) {
            inputMethodManager.hideSoftInputFromWindow(currentFocus.windowToken, 0)
        }
    }
    
    private fun showFilterDrawer() {
        if (filterDrawer == null) {
            // Create the filter drawer view
            filterDrawer = layoutInflater.inflate(R.layout.filter_drawer, null)
            setupFilterDrawer()
            
            // Add the drawer to the main layout
            val rootLayout = findViewById<ViewGroup>(android.R.id.content)
            rootLayout.addView(filterDrawer)
            
            // Initially hide the drawer off-screen
            filterDrawer?.findViewById<LinearLayout>(R.id.filter_content)?.translationX = -280f
        }
        
        // Show the drawer with animation
        animateFilterDrawer(true)
    }
    
    private fun setupFilterDrawer() {
        filterDrawer?.let { drawer ->
            // Set up close button
            val closeButton = drawer.findViewById<ImageButton>(R.id.close_filter_drawer)
            closeButton?.setOnClickListener {
                hideFilterDrawer()
            }
            
            // Set up apply button
            val applyButton = drawer.findViewById<Button>(R.id.apply_filters)
            applyButton?.setOnClickListener {
                applyFilters()
            }
            
            // Set up "Show Only Affordable" button
            val showAffordableButton = drawer.findViewById<Button>(R.id.show_affordable)
            showAffordableButton?.setOnClickListener {
                showOnlyAffordableItems()
            }
            
            // Set up overlay background click to close drawer
            val overlayBackground = drawer.findViewById<View>(R.id.overlay_background)
            overlayBackground?.setOnClickListener {
                hideFilterDrawer()
            }
        }
    }
    
    private fun animateFilterDrawer(show: Boolean) {
        filterDrawer?.let { drawer ->
            val filterContent = drawer.findViewById<LinearLayout>(R.id.filter_content)
            if (filterContent != null) {
                val targetX = if (show) 0f else -filterContent.width.toFloat()
                
                val animator = ObjectAnimator.ofFloat(filterContent, "translationX", filterContent.translationX, targetX)
                animator.duration = 300
                animator.interpolator = AccelerateDecelerateInterpolator()
                
                if (!show) {
                    // Animate overlay background fade out
                    val overlayBackground = drawer.findViewById<View>(R.id.overlay_background)
                    val overlayAnimator = ObjectAnimator.ofFloat(overlayBackground, "alpha", 0.5f, 0f)
                    overlayAnimator.duration = 300
                    overlayAnimator.start()
                    
                    animator.addListener(object : android.animation.AnimatorListenerAdapter() {
                        override fun onAnimationEnd(animation: android.animation.Animator) {
                            // Hide the drawer completely when animation ends
                            drawer.visibility = View.GONE
                        }
                    })
                } else {
                    drawer.visibility = View.VISIBLE
                    // Animate overlay background fade in
                    val overlayBackground = drawer.findViewById<View>(R.id.overlay_background)
                    val overlayAnimator = ObjectAnimator.ofFloat(overlayBackground, "alpha", 0f, 0.5f)
                    overlayAnimator.duration = 300
                    overlayAnimator.start()
                }
                
                animator.start()
            }
        }
    }
    
    private fun hideFilterDrawer() {
        // Hide the filter drawer with animation
        animateFilterDrawer(false)
    }
    
    private fun applyFilters() {
        filterDrawer?.let { drawer ->
            // Get filter values
            val sortRadioGroup = drawer.findViewById<RadioGroup>(R.id.sort_radio_group)
            val minPoints = drawer.findViewById<EditText>(R.id.min_points)?.text?.toString()
            val maxPoints = drawer.findViewById<EditText>(R.id.max_points)?.text?.toString()
            val favoritesOnly = drawer.findViewById<CheckBox>(R.id.favorites_only)?.isChecked ?: false
            
            // Get availability filters
            val availabilityAvailable = drawer.findViewById<CheckBox>(R.id.availability_available)?.isChecked ?: false
            val availabilityLowStock = drawer.findViewById<CheckBox>(R.id.availability_low_stock)?.isChecked ?: false
            val availabilityUnavailable = drawer.findViewById<CheckBox>(R.id.availability_unavailable)?.isChecked ?: false
            
            // Get selected sort option
            val selectedSortId = sortRadioGroup?.checkedRadioButtonId
            val sortOption = when (selectedSortId) {
                R.id.sort_price_low -> "price_asc"
                R.id.sort_price_high -> "price_desc"
                else -> "best_match"
            }
            
            android.util.Log.d("MainActivity", "===== APPLYING FILTERS =====")
            android.util.Log.d("MainActivity", "minPoints (raw): '$minPoints'")
            android.util.Log.d("MainActivity", "maxPoints (raw): '$maxPoints'")
            android.util.Log.d("MainActivity", "sortOption: $sortOption")
            android.util.Log.d("MainActivity", "favoritesOnly: $favoritesOnly")
            
            // Send filters to CatalogFragment
            sendFiltersToFragment(sortOption, minPoints, maxPoints, favoritesOnly, availabilityAvailable, availabilityLowStock, availabilityUnavailable)
            
            hideFilterDrawer()
        }
    }
    
    private fun sendFiltersToFragment(sort: String, minPoints: String?, maxPoints: String?, favoritesOnly: Boolean, availabilityAvailable: Boolean, availabilityLowStock: Boolean, availabilityUnavailable: Boolean) {
        // Find the current CatalogFragment and send the filter parameters
        val navController = findNavController(R.id.nav_host_fragment_activity_main)
        if (navController.currentDestination?.id == R.id.navigation_catalog) {
            val fragment = supportFragmentManager.findFragmentById(R.id.nav_host_fragment_activity_main)
            if (fragment is androidx.navigation.fragment.NavHostFragment) {
                val catalogFragment = fragment.childFragmentManager.fragments.firstOrNull()
                if (catalogFragment is com.example.driverrewards.ui.catalog.CatalogFragment) {
                    catalogFragment.applyFilters(sort, minPoints, maxPoints, favoritesOnly, availabilityAvailable, availabilityLowStock, availabilityUnavailable)
                }
            }
        }
    }
    
    private fun showOnlyAffordableItems() {
        // Use cached profile data from ViewModel
        val cachedProfile = profileViewModel.profileData.value
        if (cachedProfile != null) {
            val pointsBalance = cachedProfile.pointsBalance
            
            // Set max points to user's balance
            filterDrawer?.let { drawer ->
                val maxPointsField = drawer.findViewById<EditText>(R.id.max_points)
                maxPointsField?.setText(pointsBalance.toString())
            }
            
            // Apply the filter immediately
            applyFilters()
        } else {
            // If not cached, trigger load and try again
            profileViewModel.loadProfile()
            Toast.makeText(this, "Loading points balance...", Toast.LENGTH_SHORT).show()
        }
    }
    
    private fun fetchAndDisplayPoints() {
        // Only fetch points if we have valid session data
        if (!sessionManager.hasValidSessionData()) {
            updatePointsDisplay("0")
            return
        }
        
        // Use cached profile data from ViewModel
        val cachedProfile = profileViewModel.profileData.value
        if (cachedProfile != null) {
            updatePointsDisplay(cachedProfile.pointsBalance.toString())
        } else {
            // If not cached, trigger load (observer will update display)
            profileViewModel.loadProfile()
            // Show 0 as fallback until data loads
            updatePointsDisplay("0")
        }
    }
    
    fun refreshPointsDisplay() {
        // Force refresh of profile data to get updated points
        profileViewModel.refreshProfile()
    }
}
```


===== mobileApplication/app/src/main/java/com/example/driverrewards/network/AuthService.kt =====

```kotlin
package com.example.driverrewards.network

import android.util.Log
import com.google.gson.Gson
import com.google.gson.annotations.SerializedName
import okhttp3.*
import okhttp3.MediaType.Companion.toMediaType
import okhttp3.RequestBody.Companion.asRequestBody
import okhttp3.RequestBody.Companion.toRequestBody
import okhttp3.ResponseBody.Companion.toResponseBody
import okhttp3.logging.HttpLoggingInterceptor
import java.io.IOException
import java.util.concurrent.TimeUnit

data class LoginRequest(
    val email: String,
    val password: String
)

data class LoginResponse(
    val success: Boolean,
    val message: String?,
    val accountId: String?,
    val driverId: String?,
    val username: String?,
    val email: String?,
    @SerializedName("mfa_required") val mfaRequired: Boolean? = false
)

data class ProfileData(
    @SerializedName("accountId") val accountId: String,
    @SerializedName("driverId") val driverId: String,
    @SerializedName("email") val email: String,
    @SerializedName("username") val username: String,
    @SerializedName("firstName") val firstName: String?,
    @SerializedName("lastName") val lastName: String?,
    @SerializedName("wholeName") val wholeName: String?,
    @SerializedName("pointsBalance") val pointsBalance: Int,
    @SerializedName("memberSince") val memberSince: String?,
    @SerializedName("shippingAddress") val shippingAddress: String?,
    @SerializedName("licenseNumber") val licenseNumber: String?,
    @SerializedName("licenseIssueDate") val licenseIssueDate: String?,
    @SerializedName("licenseExpirationDate") val licenseExpirationDate: String?,
    @SerializedName("sponsorCompany") val sponsorCompany: String?,
    @SerializedName("status") val status: String?,
    @SerializedName("age") val age: Int?,
    @SerializedName("gender") val gender: String?,
    @SerializedName("profileImageURL") val profileImageURL: String?
)

data class ProfileResponse(
    @SerializedName("success") val success: Boolean,
    @SerializedName("message") val message: String?,
    @SerializedName("profile") val profile: ProfileData?
)

data class UpdateProfileRequest(
    @SerializedName("firstName") val firstName: String?,
    @SerializedName("lastName") val lastName: String?,
    @SerializedName("wholeName") val wholeName: String?,
    @SerializedName("shippingAddress") val shippingAddress: String?,
    @SerializedName("licenseNumber") val licenseNumber: String?,
    @SerializedName("licenseIssueDate") val licenseIssueDate: String?,
    @SerializedName("licenseExpirationDate") val licenseExpirationDate: String?
)

data class ChangePasswordRequest(
    @SerializedName("currentPassword") val currentPassword: String,
    @SerializedName("newPassword") val newPassword: String
)

data class ApiResponse(
    @SerializedName("success") val success: Boolean,
    @SerializedName("message") val message: String?
)

data class UploadProfilePictureResponse(
    @SerializedName("success") val success: Boolean,
    @SerializedName("message") val message: String?,
    @SerializedName("profileImageURL") val profileImageURL: String?
)

// Singleton HTTP client that maintains cookies across requests
object NetworkClient {
    private const val TAG = "NetworkClient"
    
    // We'll initialize this with context when needed
    private var sessionManager: com.example.driverrewards.utils.SessionManager? = null
    
    fun initialize(context: android.content.Context) {
        sessionManager = com.example.driverrewards.utils.SessionManager(context)
    }
    
    val client: OkHttpClient by lazy {
        // Custom logging interceptor that sanitizes passwords
        val loggingInterceptor = object : HttpLoggingInterceptor.Logger {
            override fun log(message: String) {
                // Sanitize password fields in JSON logs
                val sanitizedMessage = if (message.contains("\"password\"") || message.contains("\"currentPassword\"") || message.contains("\"newPassword\"")) {
                    message.replace(Regex("\"(password|currentPassword|newPassword)\":\\s*\"[^\"]*\"")) {
                        "${it.groupValues[1]}=\"••••••••\""
                    }
                } else {
                    message
                }
                Log.d(TAG, sanitizedMessage)
            }
        }
        
        val interceptor = HttpLoggingInterceptor(loggingInterceptor)
        interceptor.level = HttpLoggingInterceptor.Level.BODY
        
        OkHttpClient.Builder()
            .connectTimeout(30, TimeUnit.SECONDS)
            .readTimeout(30, TimeUnit.SECONDS)
            .writeTimeout(30, TimeUnit.SECONDS)
            // Limit redirects to prevent infinite loops (default is 20, we'll set to 5 for API endpoints)
            .followRedirects(true)
            .followSslRedirects(true)
            .addInterceptor(interceptor)
            .addInterceptor { chain ->
                val request = chain.request()
                Log.d(TAG, "Making request to: ${request.url}")
                Log.d(TAG, "Request headers: ${request.headers}")
                
                try {
                    val response = chain.proceed(request)
                    Log.d(TAG, "Response code: ${response.code}")
                    Log.d(TAG, "Response headers: ${response.headers}")
                    
                    // Extract and merge cookies from response for all API endpoints
                    // This ensures we always have the latest csrf_token and session cookies
                    if (request.url.toString().contains("/api/mobile/")) {
                        updateCookiesFromResponse(response)
                    }
                    
                    // If we get a redirect (3xx) for an API endpoint, don't follow it
                    // This prevents redirect loops when sessions expire
                    if (response.code in 300..399 && request.url.toString().contains("/api/mobile/")) {
                        val location = response.header("Location")
                        Log.w(TAG, "Redirect detected for API endpoint: $location - stopping redirect loop")
                        // Convert redirect to 401 Unauthorized for API endpoints
                        return@addInterceptor response.newBuilder()
                            .code(401)
                            .message("Unauthorized - Session expired")
                            .body("""{"success":false,"message":"Not authenticated"}""".toResponseBody("application/json".toMediaType()))
                            .removeHeader("Location")
                            .build()
                    }
                    
                    response
                } catch (e: java.net.ProtocolException) {
                    // Catch redirect loop exceptions
                    if (e.message?.contains("Too many follow-up requests") == true) {
                        Log.e(TAG, "Redirect loop detected: ${e.message}")
                        // Return a 401 response instead of throwing
                        return@addInterceptor Response.Builder()
                            .request(request)
                            .protocol(Protocol.HTTP_1_1)
                            .code(401)
                            .message("Unauthorized - Session expired")
                            .body("""{"success":false,"message":"Not authenticated - Session expired"}""".toResponseBody("application/json".toMediaType()))
                            .build()
                    }
                    throw e
                }
            }
            .addInterceptor { chain ->
                val originalRequest = chain.request()
                val sessionCookies = getSessionCookies()
                
                val newRequest = if (sessionCookies != null && sessionCookies.isNotEmpty()) {
                    originalRequest.newBuilder()
                        .addHeader("Cookie", sessionCookies)
                        .build()
                } else {
                    originalRequest
                }
                
                chain.proceed(newRequest)
            }
            .build()
    }
    
    val gson: Gson by lazy { Gson() }
    
    // Update this URL to match your Flask server
    // Use 10.0.2.2 to access localhost from Android emulator
    const val baseUrl = "http://10.0.2.2:5000" // For Android emulator
    
    fun setSessionCookies(cookies: String?) {
        sessionManager?.saveSessionCookies(cookies)
        Log.d(TAG, "Session cookies set: $cookies")
    }
    
    fun getSessionCookies(): String? {
        val cookies = sessionManager?.getSessionCookies()
        Log.d(TAG, "Getting session cookies: $cookies")
        return cookies
    }
    
    fun clearSessionCookies() {
        sessionManager?.clearSessionCookies()
        Log.d(TAG, "Clearing session cookies")
    }
    
    /**
     * Updates stored cookies by merging new cookies from response Set-Cookie headers
     * with existing cookies. This ensures we always have the latest csrf_token and session.
     */
    private fun updateCookiesFromResponse(response: Response) {
        val setCookieHeaders = response.headers.values("Set-Cookie")
        if (setCookieHeaders.isEmpty()) {
            return
        }
        
        // Parse Set-Cookie headers to extract only name=value pairs
        val newCookies = setCookieHeaders.mapNotNull { cookieHeader ->
            cookieHeader.split(";").firstOrNull()?.trim()
        }.filter { it.isNotEmpty() }
        
        if (newCookies.isEmpty()) {
            return
        }
        
        // Get existing cookies
        val existingCookiesStr = getSessionCookies()
        val cookieMap = mutableMapOf<String, String>()
        
        // Parse existing cookies into a map
        existingCookiesStr?.split(";")?.forEach { cookie ->
            val parts = cookie.trim().split("=", limit = 2)
            if (parts.size == 2) {
                cookieMap[parts[0].trim()] = parts[1].trim()
            }
        }
        
        // Merge new cookies (new values override existing ones)
        newCookies.forEach { cookie ->
            val parts = cookie.split("=", limit = 2)
            if (parts.size == 2) {
                cookieMap[parts[0].trim()] = parts[1].trim()
            }
        }
        
        // Rebuild cookie string
        val mergedCookies = cookieMap.map { "${it.key}=${it.value}" }.joinToString("; ")
        
        if (mergedCookies.isNotEmpty()) {
            setSessionCookies(mergedCookies)
            Log.d(TAG, "Updated cookies from response: ${cookieMap.keys.joinToString(", ")}")
        }
    }
}

class AuthService {
    private val TAG = "AuthService"
    
    suspend fun login(email: String, password: String): LoginResponse {
        Log.d(TAG, "Starting login process for email: $email")
        return try {
            val requestBody = LoginRequest(email, password)
            val json = NetworkClient.gson.toJson(requestBody)
            
            Log.d(TAG, "Login request URL: ${NetworkClient.baseUrl}/api/mobile/login")
            // Don't log the actual password - just log that a request body was created
            Log.d(TAG, "Login request body created (password hidden)")
            
            val request = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/login")
                .post(json.toRequestBody("application/json".toMediaType()))
                .addHeader("Content-Type", "application/json")
                .build()
            
            Log.d(TAG, "Executing login request...")
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "Login response code: ${response.code}")
            Log.d(TAG, "Login response body: $responseBody")
            Log.d(TAG, "Login response headers: ${response.headers}")
            
            // Extract session cookies from response headers
            val setCookieHeaders = response.headers.values("Set-Cookie")
            Log.d(TAG, "Set-Cookie headers: $setCookieHeaders")
            if (setCookieHeaders.isNotEmpty()) {
                // Parse Set-Cookie headers to extract only name=value pairs (ignore attributes like Path, SameSite, etc.)
                val cookiePairs = setCookieHeaders.mapNotNull { cookieHeader ->
                    // Extract the name=value part (before first semicolon)
                    cookieHeader.split(";").firstOrNull()?.trim()
                }.filter { it.isNotEmpty() }
                
                val cookies = cookiePairs.joinToString("; ")
                NetworkClient.setSessionCookies(cookies)
                Log.d(TAG, "Stored session cookies: $cookies")
            } else {
                Log.w(TAG, "No Set-Cookie headers found in login response")
            }
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    // Parse the actual response from the Flask API
                    val loginResponse = NetworkClient.gson.fromJson(responseBody, LoginResponse::class.java)
                    Log.d(TAG, "Parsed login response: $loginResponse")
                    loginResponse
                } catch (e: Exception) {
                    Log.e(TAG, "JSON parsing error: ${e.message}", e)
                    LoginResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}",
                        accountId = null,
                        driverId = null,
                        username = null,
                        email = null,
                        mfaRequired = false
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    400 -> "Bad request - check your credentials format"
                    401 -> "Invalid credentials"
                    403 -> "Access denied - driver account required"
                    404 -> "Server endpoint not found"
                    500 -> "Server error"
                    else -> "HTTP ${response.code}: ${response.message}"
                }
                Log.e(TAG, "Login failed with HTTP error: $errorMessage")
                LoginResponse(
                    success = false,
                    message = errorMessage,
                    accountId = null,
                    driverId = null,
                    username = null,
                    email = null,
                    mfaRequired = false
                )
            }
        } catch (e: java.net.UnknownHostException) {
            Log.e(TAG, "Unknown host error: ${e.message}", e)
            LoginResponse(
                success = false,
                message = "Cannot connect to server. Check your network connection.",
                accountId = null,
                driverId = null,
                username = null,
                email = null,
                mfaRequired = false
            )
        } catch (e: java.net.ConnectException) {
            Log.e(TAG, "Connection error: ${e.message}", e)
            LoginResponse(
                success = false,
                message = "Connection refused. Is the server running?",
                accountId = null,
                driverId = null,
                username = null,
                email = null,
                mfaRequired = false
            )
        } catch (e: java.net.SocketTimeoutException) {
            Log.e(TAG, "Timeout error: ${e.message}", e)
            LoginResponse(
                success = false,
                message = "Request timed out. Server may be slow.",
                accountId = null,
                driverId = null,
                username = null,
                email = null,
                mfaRequired = false
            )
        } catch (e: Exception) {
            Log.e(TAG, "General error: ${e.javaClass.simpleName} - ${e.message}", e)
            LoginResponse(
                success = false,
                message = "Network error: ${e.javaClass.simpleName} - ${e.message}",
                accountId = null,
                driverId = null,
                username = null,
                email = null,
                mfaRequired = false
            )
        }
    }
    
data class MfaVerifyRequest(
    val code: String
)

data class MfaStatusResponse(
    val success: Boolean,
    @SerializedName("mfa_enabled") val mfaEnabled: Boolean?
)

data class MfaEnableResponse(
    val success: Boolean,
    val message: String?,
    @SerializedName("qr_uri") val qrUri: String?,
    val secret: String?
)

data class MfaConfirmResponse(
    val success: Boolean,
    val message: String?,
    @SerializedName("recovery_codes") val recoveryCodes: List<String>?
)

data class MfaPasswordRequest(
    val password: String
)

data class MfaConfirmRequest(
    val code: String
)
    
    suspend fun verifyMfa(code: String): LoginResponse {
        Log.d(TAG, "Verifying MFA code")
        return try {
            val requestBody = MfaVerifyRequest(code)
            val json = NetworkClient.gson.toJson(requestBody)
            
            val request = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/mfa/verify")
                .post(json.toRequestBody("application/json".toMediaType()))
                .build()
            
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "MFA verify response code: ${response.code}")
            Log.d(TAG, "MFA verify response body: $responseBody")
            Log.d(TAG, "MFA verify response headers: ${response.headers}")
            
            // Extract session cookies from response headers (same as login)
            val setCookieHeaders = response.headers.values("Set-Cookie")
            Log.d(TAG, "Set-Cookie headers: $setCookieHeaders")
            if (setCookieHeaders.isNotEmpty()) {
                // Parse Set-Cookie headers to extract only name=value pairs (ignore attributes like Path, SameSite, etc.)
                val cookiePairs = setCookieHeaders.mapNotNull { cookieHeader ->
                    // Extract the name=value part (before first semicolon)
                    cookieHeader.split(";").firstOrNull()?.trim()
                }.filter { it.isNotEmpty() }
                
                val cookies = cookiePairs.joinToString("; ")
                NetworkClient.setSessionCookies(cookies)
                Log.d(TAG, "Stored session cookies from MFA verify: $cookies")
            } else {
                Log.w(TAG, "No Set-Cookie headers found in MFA verify response")
            }
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    NetworkClient.gson.fromJson(responseBody, LoginResponse::class.java)
                } catch (e: Exception) {
                    Log.e(TAG, "JSON parsing error: ${e.message}", e)
                    LoginResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}",
                        accountId = null,
                        driverId = null,
                        username = null,
                        email = null,
                        mfaRequired = false
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    400 -> "Invalid MFA code format"
                    401 -> "Invalid MFA or recovery code"
                    404 -> "MFA verification session expired. Please log in again."
                    else -> "MFA verification failed: HTTP ${response.code}"
                }
                LoginResponse(
                    success = false,
                    message = errorMessage,
                    accountId = null,
                    driverId = null,
                    username = null,
                    email = null,
                    mfaRequired = false
                )
            }
        } catch (e: java.net.ProtocolException) {
            if (e.message?.contains("Too many follow-up requests") == true) {
                NetworkClient.clearSessionCookies()
                LoginResponse(
                    success = false,
                    message = "Session expired. Please log in again.",
                    accountId = null,
                    driverId = null,
                    username = null,
                    email = null,
                    mfaRequired = false
                )
            } else {
                LoginResponse(
                    success = false,
                    message = "Network protocol error: ${e.message}",
                    accountId = null,
                    driverId = null,
                    username = null,
                    email = null,
                    mfaRequired = false
                )
            }
        } catch (e: Exception) {
            Log.e(TAG, "MFA verify error: ${e.javaClass.simpleName} - ${e.message}", e)
            LoginResponse(
                success = false,
                message = "Network error: ${e.javaClass.simpleName} - ${e.message}",
                accountId = null,
                driverId = null,
                username = null,
                email = null,
                mfaRequired = false
            )
        }
    }
    
    suspend fun getMfaStatus(): MfaStatusResponse {
        Log.d(TAG, "Getting MFA status")
        return try {
            val request = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/mfa/status")
                .get()
                .build()
            
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "MFA status response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    NetworkClient.gson.fromJson(responseBody, MfaStatusResponse::class.java)
                } catch (e: Exception) {
                    Log.e(TAG, "JSON parsing error: ${e.message}", e)
                    MfaStatusResponse(success = false, mfaEnabled = null)
                }
            } else {
                MfaStatusResponse(success = false, mfaEnabled = null)
            }
        } catch (e: Exception) {
            Log.e(TAG, "MFA status error: ${e.message}", e)
            MfaStatusResponse(success = false, mfaEnabled = null)
        }
    }
    
    suspend fun enableMfa(password: String): MfaEnableResponse {
        Log.d(TAG, "Enabling MFA")
        return try {
            val requestBody = MfaPasswordRequest(password)
            val json = NetworkClient.gson.toJson(requestBody)
            
            val request = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/mfa/enable")
                .post(json.toRequestBody("application/json".toMediaType()))
                .build()
            
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "MFA enable response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    NetworkClient.gson.fromJson(responseBody, MfaEnableResponse::class.java)
                } catch (e: Exception) {
                    Log.e(TAG, "JSON parsing error: ${e.message}", e)
                    MfaEnableResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}",
                        qrUri = null,
                        secret = null
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    401 -> "Incorrect password"
                    400 -> "Bad request"
                    else -> "MFA enable failed: HTTP ${response.code}"
                }
                MfaEnableResponse(
                    success = false,
                    message = errorMessage,
                    qrUri = null,
                    secret = null
                )
            }
        } catch (e: Exception) {
            Log.e(TAG, "MFA enable error: ${e.message}", e)
            MfaEnableResponse(
                success = false,
                message = "Network error: ${e.message}",
                qrUri = null,
                secret = null
            )
        }
    }
    
    suspend fun confirmMfa(code: String): MfaConfirmResponse {
        Log.d(TAG, "Confirming MFA")
        return try {
            val requestBody = MfaConfirmRequest(code)
            val json = NetworkClient.gson.toJson(requestBody)
            
            val request = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/mfa/confirm")
                .post(json.toRequestBody("application/json".toMediaType()))
                .build()
            
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "MFA confirm response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    NetworkClient.gson.fromJson(responseBody, MfaConfirmResponse::class.java)
                } catch (e: Exception) {
                    Log.e(TAG, "JSON parsing error: ${e.message}", e)
                    MfaConfirmResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}",
                        recoveryCodes = null
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    401 -> "Invalid code. Try again."
                    400 -> "Bad request"
                    else -> "MFA confirm failed: HTTP ${response.code}"
                }
                MfaConfirmResponse(
                    success = false,
                    message = errorMessage,
                    recoveryCodes = null
                )
            }
        } catch (e: Exception) {
            Log.e(TAG, "MFA confirm error: ${e.message}", e)
            MfaConfirmResponse(
                success = false,
                message = "Network error: ${e.message}",
                recoveryCodes = null
            )
        }
    }
    
    suspend fun disableMfa(password: String): ApiResponse {
        Log.d(TAG, "Disabling MFA")
        return try {
            val requestBody = MfaPasswordRequest(password)
            val json = NetworkClient.gson.toJson(requestBody)
            
            val request = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/mfa/disable")
                .post(json.toRequestBody("application/json".toMediaType()))
                .build()
            
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "MFA disable response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    NetworkClient.gson.fromJson(responseBody, ApiResponse::class.java)
                } catch (e: Exception) {
                    Log.e(TAG, "JSON parsing error: ${e.message}", e)
                    ApiResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}"
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    401 -> "Incorrect password"
                    400 -> "Bad request"
                    else -> "MFA disable failed: HTTP ${response.code}"
                }
                ApiResponse(
                    success = false,
                    message = errorMessage
                )
            }
        } catch (e: Exception) {
            Log.e(TAG, "MFA disable error: ${e.message}", e)
            ApiResponse(
                success = false,
                message = "Network error: ${e.message}"
            )
        }
    }
    
    suspend fun testConnection(): String {
        Log.d(TAG, "Testing connection to: ${NetworkClient.baseUrl}/api/mobile/login")
        return try {
            val requestBody = LoginRequest("test@example.com", "testpass")
            val json = NetworkClient.gson.toJson(requestBody)
            
            val request = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/login")
                .post(json.toRequestBody("application/json".toMediaType()))
                .addHeader("Content-Type", "application/json")
                .build()
            
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "Test response code: ${response.code}")
            Log.d(TAG, "Test response body: $responseBody")
            
            if (response.isSuccessful && responseBody != null) {
                "Connection successful: Server is responding"
            } else if (response.code == 401) {
                "Connection successful: Server is responding (401 expected with test credentials)"
            } else {
                "Connection failed: HTTP ${response.code} - ${response.message}"
            }
        } catch (e: Exception) {
            Log.e(TAG, "Test connection error: ${e.javaClass.simpleName} - ${e.message}", e)
            "Connection error: ${e.javaClass.simpleName} - ${e.message}"
        }
    }
    
    suspend fun logout(): Boolean {
        Log.d(TAG, "Starting logout process")
        return try {
            val requestBuilder = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/logout")
                .post("".toRequestBody(null))
            
            // Include session cookies in logout request
            NetworkClient.getSessionCookies()?.let { cookies ->
                requestBuilder.addHeader("Cookie", cookies)
                Log.d(TAG, "Including cookies in logout request: $cookies")
            } ?: run {
                Log.w(TAG, "No session cookies available for logout request")
            }
            
            val request = requestBuilder.build()
            val response = NetworkClient.client.newCall(request).execute()
            
            Log.d(TAG, "Logout response code: ${response.code}")
            
            // Clear session cookies after logout
            NetworkClient.clearSessionCookies()
            
            response.isSuccessful
        } catch (e: Exception) {
            Log.e(TAG, "Logout error: ${e.message}", e)
            false
        }
    }
}

class ProfileService {
    private val TAG = "ProfileService"
    
    suspend fun getProfile(): ProfileResponse {
        Log.d(TAG, "Starting getProfile request")
        return try {
            val requestBuilder = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/profile")
                .get()
                .addHeader("Content-Type", "application/json")
            
            // Include session cookies in profile request
            NetworkClient.getSessionCookies()?.let { cookies ->
                requestBuilder.addHeader("Cookie", cookies)
                Log.d(TAG, "Sending profile request with cookies: $cookies")
            } ?: run {
                Log.w(TAG, "No session cookies available for profile request")
            }
            
            val request = requestBuilder.build()
            Log.d(TAG, "Profile request URL: ${request.url}")
            Log.d(TAG, "Profile request headers: ${request.headers}")
            
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "Profile response code: ${response.code}")
            Log.d(TAG, "Profile response body: $responseBody")
            Log.d(TAG, "Profile response headers: ${response.headers}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    val profileResponse = NetworkClient.gson.fromJson(responseBody, ProfileResponse::class.java)
                    Log.d(TAG, "Parsed profile response: $profileResponse")
                    Log.d(TAG, "Profile age: ${profileResponse.profile?.age} (type: ${profileResponse.profile?.age?.javaClass?.simpleName})")
                    Log.d(TAG, "Profile gender: \"${profileResponse.profile?.gender}\" (type: ${profileResponse.profile?.gender?.javaClass?.simpleName})")
                    profileResponse
                } catch (e: Exception) {
                    Log.e(TAG, "Failed to parse profile response: ${e.message}", e)
                    ProfileResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}",
                        profile = null
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    401 -> "Not authenticated"
                    404 -> "Profile not found"
                    500 -> "Server error"
                    else -> "HTTP ${response.code}: ${response.message}"
                }
                Log.e(TAG, "Profile request failed: $errorMessage")
                ProfileResponse(
                    success = false,
                    message = errorMessage,
                    profile = null
                )
            }
        } catch (e: java.net.ProtocolException) {
            // Handle redirect loops - typically happens when session expires
            if (e.message?.contains("Too many follow-up requests") == true) {
                Log.e(TAG, "Redirect loop detected - session likely expired: ${e.message}")
                // Clear invalid session cookies
                NetworkClient.clearSessionCookies()
                ProfileResponse(
                    success = false,
                    message = "Session expired. Please log in again.",
                    profile = null
                )
            } else {
                Log.e(TAG, "Protocol error: ${e.message}", e)
                ProfileResponse(
                    success = false,
                    message = "Network protocol error: ${e.message}",
                    profile = null
                )
            }
        } catch (e: Exception) {
            Log.e(TAG, "Profile request exception: ${e.javaClass.simpleName} - ${e.message}", e)
            ProfileResponse(
                success = false,
                message = "Network error: ${e.javaClass.simpleName} - ${e.message}",
                profile = null
            )
        }
    }
    
    suspend fun updateProfile(updateRequest: UpdateProfileRequest): ApiResponse {
        Log.d(TAG, "Starting updateProfile request")
        return try {
            val json = NetworkClient.gson.toJson(updateRequest)
            
            val requestBuilder = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/profile")
                .put(json.toRequestBody("application/json".toMediaType()))
                .addHeader("Content-Type", "application/json")
            
            // Include session cookies
            NetworkClient.getSessionCookies()?.let { cookies ->
                requestBuilder.addHeader("Cookie", cookies)
            }
            
            val request = requestBuilder.build()
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    NetworkClient.gson.fromJson(responseBody, ApiResponse::class.java)
                } catch (e: Exception) {
                    ApiResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}"
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    400 -> "Bad request"
                    401 -> "Not authenticated"
                    404 -> "Profile not found"
                    500 -> "Server error"
                    else -> "HTTP ${response.code}: ${response.message}"
                }
                ApiResponse(
                    success = false,
                    message = errorMessage
                )
            }
        } catch (e: java.net.ProtocolException) {
            if (e.message?.contains("Too many follow-up requests") == true) {
                NetworkClient.clearSessionCookies()
                ApiResponse(
                    success = false,
                    message = "Session expired. Please log in again."
                )
            } else {
                ApiResponse(
                    success = false,
                    message = "Network protocol error: ${e.message}"
                )
            }
        } catch (e: Exception) {
            ApiResponse(
                success = false,
                message = "Network error: ${e.message}"
            )
        }
    }
    
    suspend fun changePassword(changePasswordRequest: ChangePasswordRequest): ApiResponse {
        Log.d(TAG, "Starting changePassword request")
        return try {
            val json = NetworkClient.gson.toJson(changePasswordRequest)
            
            val requestBuilder = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/change-password")
                .put(json.toRequestBody("application/json".toMediaType()))
                .addHeader("Content-Type", "application/json")
            
            // Include session cookies
            NetworkClient.getSessionCookies()?.let { cookies ->
                requestBuilder.addHeader("Cookie", cookies)
            }
            
            val request = requestBuilder.build()
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    NetworkClient.gson.fromJson(responseBody, ApiResponse::class.java)
                } catch (e: Exception) {
                    ApiResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}"
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    400 -> "Bad request - check password requirements"
                    401 -> "Not authenticated or current password incorrect"
                    500 -> "Server error"
                    else -> "HTTP ${response.code}: ${response.message}"
                }
                ApiResponse(
                    success = false,
                    message = errorMessage
                )
            }
        } catch (e: java.net.ProtocolException) {
            if (e.message?.contains("Too many follow-up requests") == true) {
                NetworkClient.clearSessionCookies()
                ApiResponse(
                    success = false,
                    message = "Session expired. Please log in again."
                )
            } else {
                ApiResponse(
                    success = false,
                    message = "Network protocol error: ${e.message}"
                )
            }
        } catch (e: Exception) {
            ApiResponse(
                success = false,
                message = "Network error: ${e.message}"
            )
        }
    }
    
    suspend fun uploadProfilePicture(imageFile: java.io.File): UploadProfilePictureResponse {
        Log.d(TAG, "Starting uploadProfilePicture request")
        return try {
            // Create multipart request body
            val requestBody = MultipartBody.Builder()
                .setType(MultipartBody.FORM)
                .addFormDataPart(
                    "profile_image",
                    imageFile.name,
                    imageFile.asRequestBody("image/*".toMediaType())
                )
                .build()
            
            val requestBuilder = Request.Builder()
                .url("${NetworkClient.baseUrl}/api/mobile/profile/upload-picture")
                .post(requestBody)
            
            // Include session cookies
            NetworkClient.getSessionCookies()?.let { cookies ->
                requestBuilder.addHeader("Cookie", cookies)
            }
            
            val request = requestBuilder.build()
            Log.d(TAG, "Upload profile picture request URL: ${request.url}")
            
            val response = NetworkClient.client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            Log.d(TAG, "Upload profile picture response code: ${response.code}")
            Log.d(TAG, "Upload profile picture response body: $responseBody")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    val uploadResponse = NetworkClient.gson.fromJson(responseBody, UploadProfilePictureResponse::class.java)
                    Log.d(TAG, "Parsed upload response: $uploadResponse")
                    uploadResponse
                } catch (e: Exception) {
                    Log.e(TAG, "Failed to parse upload response: ${e.message}", e)
                    UploadProfilePictureResponse(
                        success = false,
                        message = "Failed to parse server response: ${e.message}",
                        profileImageURL = null
                    )
                }
            } else {
                val errorMessage = when (response.code) {
                    400 -> "Invalid file type or size"
                    401 -> "Not authenticated"
                    500 -> "Server error"
                    else -> "HTTP ${response.code}: ${response.message}"
                }
                Log.e(TAG, "Upload profile picture failed: $errorMessage")
                UploadProfilePictureResponse(
                    success = false,
                    message = errorMessage,
                    profileImageURL = null
                )
            }
        } catch (e: java.net.ProtocolException) {
            if (e.message?.contains("Too many follow-up requests") == true) {
                NetworkClient.clearSessionCookies()
                UploadProfilePictureResponse(
                    success = false,
                    message = "Session expired. Please log in again.",
                    profileImageURL = null
                )
            } else {
                UploadProfilePictureResponse(
                    success = false,
                    message = "Network protocol error: ${e.message}",
                    profileImageURL = null
                )
            }
        } catch (e: Exception) {
            Log.e(TAG, "Upload profile picture exception: ${e.javaClass.simpleName} - ${e.message}", e)
            UploadProfilePictureResponse(
                success = false,
                message = "Network error: ${e.javaClass.simpleName} - ${e.message}",
                profileImageURL = null
            )
        }
    }
}
```


===== mobileApplication/app/src/main/java/com/example/driverrewards/network/CartService.kt =====

```kotlin
package com.example.driverrewards.network

import com.example.driverrewards.network.NetworkClient.gson
import com.example.driverrewards.network.NetworkClient.client
import com.example.driverrewards.network.NetworkClient.baseUrl
import okhttp3.Request
import okhttp3.RequestBody.Companion.toRequestBody
import okhttp3.MediaType.Companion.toMediaType
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

data class CartResponse(
    val success: Boolean,
    val message: String?,
    val cart: CartData?
)

data class CartData(
    @com.google.gson.annotations.SerializedName("cart_id") val cartId: String?,
    @com.google.gson.annotations.SerializedName("total_points") val totalPoints: Int,
    @com.google.gson.annotations.SerializedName("item_count") val itemCount: Int,
    @com.google.gson.annotations.SerializedName("driver_points") val driverPoints: Int,
    val items: List<CartItem>
)

data class CartItem(
    @com.google.gson.annotations.SerializedName("cart_item_id") val cartItemId: String?,
    @com.google.gson.annotations.SerializedName("external_item_id") val externalItemId: String?,
    @com.google.gson.annotations.SerializedName("item_title") val itemTitle: String?,
    @com.google.gson.annotations.SerializedName("item_image_url") val itemImageUrl: String?,
    @com.google.gson.annotations.SerializedName("item_url") val itemUrl: String?,
    @com.google.gson.annotations.SerializedName("points_per_unit") val pointsPerUnit: Int,
    val quantity: Int,
    @com.google.gson.annotations.SerializedName("line_total_points") val lineTotalPoints: Int
)

data class CartSummaryResponse(
    val success: Boolean,
    @com.google.gson.annotations.SerializedName("cart_total") val cartTotal: Int,
    @com.google.gson.annotations.SerializedName("item_count") val itemCount: Int,
    @com.google.gson.annotations.SerializedName("driver_points") val driverPoints: Int
)

data class CartApiResponse(
    val success: Boolean,
    val message: String?,
    @com.google.gson.annotations.SerializedName("cart_total") val cartTotal: Int?,
    @com.google.gson.annotations.SerializedName("item_count") val itemCount: Int?
)

class CartService {

    suspend fun getCart(): CartResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/cart"
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            android.util.Log.d("CartService", "Fetching cart from: $url")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            android.util.Log.d("CartService", "Cart response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CartResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("CartService", "Failed to parse cart response: ${e.message}", e)
                    CartResponse(
                        success = false,
                        message = "Failed to parse cart response: ${e.message}",
                        cart = null
                    )
                }
            } else {
                CartResponse(
                    success = false,
                    message = "Failed to fetch cart: HTTP ${response.code}",
                    cart = null
                )
            }
        }
    }

    suspend fun addToCart(
        itemId: String,
        title: String,
        imageUrl: String,
        itemUrl: String,
        points: Int,
        quantity: Int = 1
    ): CartApiResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/cart/add"
            val requestBody = mapOf(
                "external_item_id" to itemId,
                "item_title" to title,
                "item_image_url" to imageUrl,
                "item_url" to itemUrl,
                "points_per_unit" to points,
                "quantity" to quantity
            )
            val json = gson.toJson(requestBody)
            val body = json.toRequestBody("application/json".toMediaType())
            
            val request = Request.Builder()
                .url(url)
                .post(body)
                .build()
            
            android.util.Log.d("CartService", "Adding item to cart: $itemId")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CartApiResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("CartService", "Failed to parse add to cart response: ${e.message}", e)
                    CartApiResponse(
                        success = false,
                        message = "Failed to parse response: ${e.message}",
                        cartTotal = null,
                        itemCount = null
                    )
                }
            } else {
                CartApiResponse(
                    success = false,
                    message = "Failed to add to cart: HTTP ${response.code}",
                    cartTotal = null,
                    itemCount = null
                )
            }
        }
    }

    suspend fun updateCartItem(cartItemId: String, quantity: Int): CartApiResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/cart/update"
            val requestBody = mapOf(
                "cart_item_id" to cartItemId,
                "quantity" to quantity
            )
            val json = gson.toJson(requestBody)
            val body = json.toRequestBody("application/json".toMediaType())
            
            val request = Request.Builder()
                .url(url)
                .post(body)
                .build()
            
            android.util.Log.d("CartService", "Updating cart item: $cartItemId, quantity: $quantity")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CartApiResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("CartService", "Failed to parse update cart response: ${e.message}", e)
                    CartApiResponse(
                        success = false,
                        message = "Failed to parse response: ${e.message}",
                        cartTotal = null,
                        itemCount = null
                    )
                }
            } else {
                CartApiResponse(
                    success = false,
                    message = "Failed to update cart: HTTP ${response.code}",
                    cartTotal = null,
                    itemCount = null
                )
            }
        }
    }

    suspend fun removeCartItem(cartItemId: String): CartApiResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/cart/remove"
            val requestBody = mapOf("cart_item_id" to cartItemId)
            val json = gson.toJson(requestBody)
            val body = json.toRequestBody("application/json".toMediaType())
            
            val request = Request.Builder()
                .url(url)
                .post(body)
                .build()
            
            android.util.Log.d("CartService", "Removing cart item: $cartItemId")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CartApiResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("CartService", "Failed to parse remove cart response: ${e.message}", e)
                    CartApiResponse(
                        success = false,
                        message = "Failed to parse response: ${e.message}",
                        cartTotal = null,
                        itemCount = null
                    )
                }
            } else {
                CartApiResponse(
                    success = false,
                    message = "Failed to remove from cart: HTTP ${response.code}",
                    cartTotal = null,
                    itemCount = null
                )
            }
        }
    }

    suspend fun clearCart(): CartApiResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/cart/clear"
            val request = Request.Builder()
                .url(url)
                .post("".toRequestBody("application/json".toMediaType()))
                .build()
            
            android.util.Log.d("CartService", "Clearing cart")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CartApiResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("CartService", "Failed to parse clear cart response: ${e.message}", e)
                    CartApiResponse(
                        success = false,
                        message = "Failed to parse response: ${e.message}",
                        cartTotal = null,
                        itemCount = null
                    )
                }
            } else {
                CartApiResponse(
                    success = false,
                    message = "Failed to clear cart: HTTP ${response.code}",
                    cartTotal = null,
                    itemCount = null
                )
            }
        }
    }

    suspend fun getCartSummary(): CartSummaryResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/cart/summary"
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            android.util.Log.d("CartService", "Fetching cart summary")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CartSummaryResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("CartService", "Failed to parse cart summary response: ${e.message}", e)
                    CartSummaryResponse(
                        success = false,
                        cartTotal = 0,
                        itemCount = 0,
                        driverPoints = 0
                    )
                }
            } else {
                CartSummaryResponse(
                    success = false,
                    cartTotal = 0,
                    itemCount = 0,
                    driverPoints = 0
                )
            }
        }
    }

    suspend fun processCheckout(checkoutData: CheckoutRequest): CheckoutResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/checkout/process"
            val json = gson.toJson(checkoutData)
            val body = json.toRequestBody("application/json".toMediaType())
            
            val request = Request.Builder()
                .url(url)
                .post(body)
                .build()
            
            android.util.Log.d("CartService", "Processing checkout")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CheckoutResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("CartService", "Failed to parse checkout response: ${e.message}", e)
                    CheckoutResponse(
                        success = false,
                        message = "Failed to parse response: ${e.message}",
                        orderId = null,
                        orderNumber = null
                    )
                }
            } else {
                CheckoutResponse(
                    success = false,
                    message = "Failed to process checkout: HTTP ${response.code}",
                    orderId = null,
                    orderNumber = null
                )
            }
        }
    }
}

data class CheckoutRequest(
    @com.google.gson.annotations.SerializedName("first_name") val firstName: String,
    @com.google.gson.annotations.SerializedName("last_name") val lastName: String,
    val email: String,
    @com.google.gson.annotations.SerializedName("shipping_street") val shippingStreet: String,
    @com.google.gson.annotations.SerializedName("shipping_city") val shippingCity: String,
    @com.google.gson.annotations.SerializedName("shipping_state") val shippingState: String,
    @com.google.gson.annotations.SerializedName("shipping_postal") val shippingPostal: String,
    @com.google.gson.annotations.SerializedName("shipping_country") val shippingCountry: String,
    @com.google.gson.annotations.SerializedName("shipping_cost_points") val shippingCostPoints: Int = 0
)

data class CheckoutResponse(
    val success: Boolean,
    val message: String?,
    @com.google.gson.annotations.SerializedName("order_id") val orderId: String?,
    @com.google.gson.annotations.SerializedName("order_number") val orderNumber: String?
)


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/network/CatalogService.kt =====

```kotlin
package com.example.driverrewards.network

import com.example.driverrewards.network.NetworkClient.gson
import com.example.driverrewards.network.NetworkClient.client
import com.example.driverrewards.network.NetworkClient.baseUrl
import okhttp3.HttpUrl.Companion.toHttpUrlOrNull
import okhttp3.Request
import okhttp3.RequestBody.Companion.toRequestBody
import okhttp3.MediaType.Companion.toMediaType
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext
import java.net.URLEncoder

data class CatalogResponse(
    val success: Boolean,
    val message: String?,
    val items: List<CatalogItem>,
    val page: Int,
    val page_size: Int,
    val total: Int,
    val has_more: Boolean
)

data class CatalogItem(
    val id: String?,
    val title: String?,
    val points: Double?,
    val image: String?,
    val availability: String?,
    @com.google.gson.annotations.SerializedName("is_favorite") val isFavorite: Boolean?,
    @com.google.gson.annotations.SerializedName("is_pinned") val isPinned: Boolean?
)

data class FavoriteResponse(
    val success: Boolean,
    val message: String?
)

data class ProductDetailResponse(
    val success: Boolean,
    val message: String?,
    val product: ProductDetail?,
    val related_items: List<RelatedProduct>?
)

data class ProductDetail(
    val id: String?,
    val title: String?,
    val subtitle: String?,
    val points: Double?,
    val display_points: String?,
    val price: Double?,
    val image: String?,
    val additional_images: List<String>?,
    val availability: String?,
    val availability_threshold: String?,
    val estimated_quantity: Int?,
    val stock_qty: Int?,
    val low_stock: Boolean?,
    val no_stock: Boolean?,
    val available: Boolean?,
    val condition: String?,
    val brand: String?,
    val description: String?,
    val item_specifics: Map<String, String>?,
    val variants: Map<String, List<String>>?,
    val variation_details: List<VariationDetail>?,
    val url: String?,
    val is_favorite: Boolean?,
    val seller: Map<String, Any>?
)

data class VariationDetail(
    val variants: Map<String, String>?,
    val price: Double?,
    val image: String?,
    val additional_images: List<String>?,
    val availability_threshold: String?,
    val estimated_quantity: Int?,
    val stock_qty: Int?,
    val low_stock: Boolean?,
    val no_stock: Boolean?,
    val available: Boolean?
)

data class RelatedProduct(
    val id: String?,
    val title: String?,
    val points: Double?,
    val image: String?,
    val availability: String?,
    val low_stock: Boolean?,
    val no_stock: Boolean?,
    val available: Boolean?,
    val stock_qty: Int?
)

class CatalogService {

    suspend fun testConnectivity(): CatalogResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/catalog/test"
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            android.util.Log.d("CatalogService", "Testing connectivity to: $url")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            android.util.Log.d("CatalogService", "Test response code: ${response.code}, Body: $responseBody")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CatalogResponse::class.java)
                } catch (e: Exception) {
                    CatalogResponse(
                        success = false,
                        message = "Failed to parse test response: ${e.message}",
                        items = emptyList(),
                        page = 1,
                        page_size = 1,
                        total = 0,
                        has_more = false
                    )
                }
            } else {
                CatalogResponse(
                    success = false,
                    message = "Test request failed: HTTP ${response.code} - ${response.message}",
                    items = emptyList(),
                    page = 1,
                    page_size = 1,
                    total = 0,
                    has_more = false
                )
            }
        }
    }

    suspend fun getCatalogData(
        page: Int = 1,
        pageSize: Int = 48,
        searchQuery: String? = null,
        sort: String = "best_match",
        categories: List<String>? = null,
        minPoints: Float? = null,
        maxPoints: Float? = null,
        favoritesOnly: Boolean = false
    ): CatalogResponse {
        return withContext(Dispatchers.IO) {
        
        android.util.Log.d("CatalogService", "===== getCatalogData() STARTING =====")
        android.util.Log.d("CatalogService", "Parameters received: minPoints=$minPoints, maxPoints=$maxPoints")
        
        val urlBuilder = "$baseUrl/api/mobile/catalog".toHttpUrlOrNull()?.newBuilder()
            ?: throw Exception("Invalid base URL: $baseUrl")
        
        urlBuilder.addQueryParameter("page", page.toString())
        urlBuilder.addQueryParameter("page_size", pageSize.toString())
        urlBuilder.addQueryParameter("sort", sort)
        
        searchQuery?.let { urlBuilder.addQueryParameter("q", it) }
        minPoints?.let { 
            val value = it.toString()
            android.util.Log.d("CatalogService", "Adding min_points parameter: $value")
            urlBuilder.addQueryParameter("min_points", value)
        }
        maxPoints?.let { 
            val value = it.toString()
            android.util.Log.d("CatalogService", "Adding max_points parameter: $value")
            urlBuilder.addQueryParameter("max_points", value)
        }
        if (favoritesOnly) urlBuilder.addQueryParameter("favorites_only", "true")
        
        categories?.forEach { category ->
            urlBuilder.addQueryParameter("cat[]", category)
        }
        
        val url = urlBuilder.build()
        val request = Request.Builder()
            .url(url)
            .get()
            .build()
        
            android.util.Log.d("CatalogService", "===== REQUEST URL =====")
            android.util.Log.d("CatalogService", "Full URL: ${url.toString()}")
            android.util.Log.d("CatalogService", "URL parameters manually logged:")
            for (name in url.queryParameterNames) {
                val values = url.queryParameterValues(name)
                android.util.Log.d("CatalogService", "  $name = ${values.joinToString(", ")}")
            }
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            android.util.Log.d("CatalogService", "Response code: ${response.code}, Body: $responseBody")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CatalogResponse::class.java)
                } catch (e: Exception) {
                    CatalogResponse(
                        success = false,
                        message = "Failed to parse catalog response: ${e.message}",
                        items = emptyList(),
                        page = page,
                        page_size = pageSize,
                        total = 0,
                        has_more = false
                    )
                }
            } else {
                CatalogResponse(
                    success = false,
                    message = "Failed to fetch catalog data: HTTP ${response.code} - ${response.message}",
                    items = emptyList(),
                    page = page,
                    page_size = pageSize,
                    total = 0,
                    has_more = false
                )
            }
        }
    }
    
    suspend fun addFavorite(itemId: String): FavoriteResponse {
        return withContext(Dispatchers.IO) {
        val url = "$baseUrl/api/mobile/favorites"
        val json = gson.toJson(mapOf("item_id" to itemId))
        val requestBody = json.toRequestBody("application/json".toMediaType())
        
        val request = Request.Builder()
            .url(url)
            .post(requestBody)
            .build()
        
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                gson.fromJson(responseBody, FavoriteResponse::class.java)
            } else {
                FavoriteResponse(
                    success = false,
                    message = "Failed to add favorite: ${response.code}"
                )
            }
        }
    }
    
    suspend fun removeFavorite(itemId: String): FavoriteResponse {
        return withContext(Dispatchers.IO) {
        val url = "$baseUrl/api/mobile/favorites/$itemId"
        
        val request = Request.Builder()
            .url(url)
            .delete()
            .build()
        
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                gson.fromJson(responseBody, FavoriteResponse::class.java)
            } else {
                FavoriteResponse(
                    success = false,
                    message = "Failed to remove favorite: ${response.code}"
                )
            }
        }
    }
    
    suspend fun getProductDetail(itemId: String): ProductDetailResponse {
        return withContext(Dispatchers.IO) {
            // URL encode the item ID to handle special characters like pipes
            val encodedItemId = URLEncoder.encode(itemId, "UTF-8")
                .replace("+", "%20")  // Replace + with %20 for spaces
            
            val url = "$baseUrl/api/mobile/product/$encodedItemId"
            
            android.util.Log.d("CatalogService", "Fetching product detail for itemId: $itemId")
            android.util.Log.d("CatalogService", "Encoded URL: $url")
            
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            android.util.Log.d("CatalogService", "Product detail response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, ProductDetailResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("CatalogService", "Failed to parse product detail response: ${e.message}", e)
                    ProductDetailResponse(
                        success = false,
                        message = "Failed to parse product detail response: ${e.message}",
                        product = null,
                        related_items = null
                    )
                }
            } else {
                android.util.Log.e("CatalogService", "Failed to fetch product detail: HTTP ${response.code} - ${response.message}")
                ProductDetailResponse(
                    success = false,
                    message = "Failed to fetch product detail: HTTP ${response.code}",
                    product = null,
                    related_items = null
                )
            }
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/network/OrdersService.kt =====

```kotlin
package com.example.driverrewards.network

import com.example.driverrewards.network.NetworkClient.gson
import com.example.driverrewards.network.NetworkClient.client
import com.example.driverrewards.network.NetworkClient.baseUrl
import okhttp3.HttpUrl.Companion.toHttpUrlOrNull
import okhttp3.Request
import okhttp3.RequestBody.Companion.toRequestBody
import okhttp3.MediaType.Companion.toMediaType
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext
import com.example.driverrewards.network.CheckoutResponse

data class OrdersResponse(
    val success: Boolean,
    val message: String?,
    val orders: List<OrderData>,
    val page: Int,
    @com.google.gson.annotations.SerializedName("page_size") val pageSize: Int,
    val total: Int,
    @com.google.gson.annotations.SerializedName("has_more") val hasMore: Boolean
)

data class OrderData(
    @com.google.gson.annotations.SerializedName("order_id") val orderId: String?,
    @com.google.gson.annotations.SerializedName("order_number") val orderNumber: String?,
    @com.google.gson.annotations.SerializedName("total_points") val totalPoints: Int,
    val status: String?,
    @com.google.gson.annotations.SerializedName("created_at") val createdAt: String?,
    @com.google.gson.annotations.SerializedName("can_refund") val canRefund: Boolean,
    @com.google.gson.annotations.SerializedName("refund_time_remaining") val refundTimeRemaining: Int,
    @com.google.gson.annotations.SerializedName("order_items") val orderItems: List<OrderItem>
)

data class OrderItem(
    val title: String?,
    @com.google.gson.annotations.SerializedName("unit_points") val unitPoints: Int,
    val quantity: Int,
    @com.google.gson.annotations.SerializedName("line_total_points") val lineTotalPoints: Int,
    @com.google.gson.annotations.SerializedName("created_at") val createdAt: String?,
    @com.google.gson.annotations.SerializedName("external_item_id") val externalItemId: String?,
    @com.google.gson.annotations.SerializedName("variation_info") val variationInfo: String?
)

data class OrderDetailResponse(
    val success: Boolean,
    val message: String?,
    val order: OrderData?
)

data class RefundResponse(
    val success: Boolean,
    val message: String?,
    @com.google.gson.annotations.SerializedName("points_refunded") val pointsRefunded: Int?,
    @com.google.gson.annotations.SerializedName("balance_after") val balanceAfter: Int?
)

data class CancelResponse(
    val success: Boolean,
    val message: String?,
    @com.google.gson.annotations.SerializedName("points_refunded") val pointsRefunded: Int?,
    @com.google.gson.annotations.SerializedName("balance_after") val balanceAfter: Int?
)

class OrdersService {

    suspend fun getOrders(page: Int = 1, pageSize: Int = 20): OrdersResponse {
        return withContext(Dispatchers.IO) {
            val urlBuilder = "$baseUrl/api/mobile/orders".toHttpUrlOrNull()?.newBuilder()
                ?: throw Exception("Invalid base URL: $baseUrl")
            
            urlBuilder.addQueryParameter("page", page.toString())
            urlBuilder.addQueryParameter("page_size", pageSize.toString())
            
            val url = urlBuilder.build()
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            android.util.Log.d("OrdersService", "Fetching orders: page=$page, pageSize=$pageSize")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, OrdersResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("OrdersService", "Failed to parse orders response: ${e.message}", e)
                    OrdersResponse(
                        success = false,
                        message = "Failed to parse orders response: ${e.message}",
                        orders = emptyList(),
                        page = page,
                        pageSize = pageSize,
                        total = 0,
                        hasMore = false
                    )
                }
            } else {
                OrdersResponse(
                    success = false,
                    message = "Failed to fetch orders: HTTP ${response.code}",
                    orders = emptyList(),
                    page = page,
                    pageSize = pageSize,
                    total = 0,
                    hasMore = false
                )
            }
        }
    }

    suspend fun getOrderDetail(orderId: String): OrderDetailResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/orders/$orderId"
            
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            android.util.Log.d("OrdersService", "Fetching order detail: $orderId")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, OrderDetailResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("OrdersService", "Failed to parse order detail response: ${e.message}", e)
                    OrderDetailResponse(
                        success = false,
                        message = "Failed to parse order detail response: ${e.message}",
                        order = null
                    )
                }
            } else {
                OrderDetailResponse(
                    success = false,
                    message = "Failed to fetch order detail: HTTP ${response.code}",
                    order = null
                )
            }
        }
    }

    suspend fun refundOrder(orderId: String): RefundResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/orders/$orderId/refund"
            
            val request = Request.Builder()
                .url(url)
                .post("".toRequestBody("application/json".toMediaType()))
                .build()
            
            android.util.Log.d("OrdersService", "Refunding order: $orderId")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, RefundResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("OrdersService", "Failed to parse refund response: ${e.message}", e)
                    RefundResponse(
                        success = false,
                        message = "Failed to parse refund response: ${e.message}",
                        pointsRefunded = null,
                        balanceAfter = null
                    )
                }
            } else {
                RefundResponse(
                    success = false,
                    message = "Failed to refund order: HTTP ${response.code}",
                    pointsRefunded = null,
                    balanceAfter = null
                )
            }
        }
    }

    suspend fun cancelOrder(orderId: String): CancelResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/orders/$orderId/cancel"
            
            val request = Request.Builder()
                .url(url)
                .post("".toRequestBody("application/json".toMediaType()))
                .build()
            
            android.util.Log.d("OrdersService", "Cancelling order: $orderId")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CancelResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("OrdersService", "Failed to parse cancel response: ${e.message}", e)
                    CancelResponse(
                        success = false,
                        message = "Failed to parse cancel response: ${e.message}",
                        pointsRefunded = null,
                        balanceAfter = null
                    )
                }
            } else {
                CancelResponse(
                    success = false,
                    message = "Failed to cancel order: HTTP ${response.code}",
                    pointsRefunded = null,
                    balanceAfter = null
                )
            }
        }
    }

    suspend fun reorderCheckout(orderId: String, request: ReorderCheckoutRequest): CheckoutResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/orders/$orderId/reorder"
            
            val json = gson.toJson(request)
            val requestBody = json.toRequestBody("application/json".toMediaType())
            
            val httpRequest = Request.Builder()
                .url(url)
                .post(requestBody)
                .build()
            
            android.util.Log.d("OrdersService", "Re-ordering checkout for order: $orderId")
            val response = client.newCall(httpRequest).execute()
            val responseBody = response.body?.string()
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, CheckoutResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("OrdersService", "Failed to parse reorder checkout response: ${e.message}", e)
                    CheckoutResponse(
                        success = false,
                        message = "Failed to parse reorder checkout response: ${e.message}",
                        orderId = null,
                        orderNumber = null
                    )
                }
            } else {
                CheckoutResponse(
                    success = false,
                    message = "Failed to process reorder checkout: HTTP ${response.code}",
                    orderId = null,
                    orderNumber = null
                )
            }
        }
    }
}

data class ReorderCheckoutRequest(
    @com.google.gson.annotations.SerializedName("first_name") val firstName: String,
    @com.google.gson.annotations.SerializedName("last_name") val lastName: String,
    val email: String,
    @com.google.gson.annotations.SerializedName("shipping_street") val shippingStreet: String,
    @com.google.gson.annotations.SerializedName("shipping_city") val shippingCity: String,
    @com.google.gson.annotations.SerializedName("shipping_state") val shippingState: String,
    @com.google.gson.annotations.SerializedName("shipping_postal") val shippingPostal: String,
    @com.google.gson.annotations.SerializedName("shipping_country") val shippingCountry: String,
    @com.google.gson.annotations.SerializedName("shipping_cost_points") val shippingCostPoints: Int = 0
)


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/network/PointsService.kt =====

```kotlin
package com.example.driverrewards.network

import com.example.driverrewards.network.NetworkClient.gson
import com.example.driverrewards.network.NetworkClient.client
import com.example.driverrewards.network.NetworkClient.baseUrl
import okhttp3.Request
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

data class PointsHistoryResponse(
    val success: Boolean,
    val message: String?,
    val transactions: List<PointsTransaction>,
    @com.google.gson.annotations.SerializedName("total_count") val totalCount: Int
)

data class PointsTransaction(
    @com.google.gson.annotations.SerializedName("point_change_id") val pointChangeId: String,
    @com.google.gson.annotations.SerializedName("delta_points") val deltaPoints: Int,
    @com.google.gson.annotations.SerializedName("balance_after") val balanceAfter: Int,
    val reason: String,
    @com.google.gson.annotations.SerializedName("created_at") val createdAt: String?,
    @com.google.gson.annotations.SerializedName("transaction_id") val transactionId: String?
)

data class PointsDetailsResponse(
    val success: Boolean,
    val message: String?,
    @com.google.gson.annotations.SerializedName("current_balance") val currentBalance: Int,
    @com.google.gson.annotations.SerializedName("conversion_rate") val conversionRate: Double,
    @com.google.gson.annotations.SerializedName("dollar_value") val dollarValue: Double,
    @com.google.gson.annotations.SerializedName("sponsor_company") val sponsorCompany: String?,
    @com.google.gson.annotations.SerializedName("member_since") val memberSince: String?,
    @com.google.gson.annotations.SerializedName("total_earned") val totalEarned: Int,
    @com.google.gson.annotations.SerializedName("total_spent") val totalSpent: Int
)

data class PointsGraphResponse(
    val success: Boolean,
    val message: String?,
    @com.google.gson.annotations.SerializedName("data_points") val dataPoints: List<PointsGraphDataPoint>
)

data class PointsGraphDataPoint(
    val date: String,
    val balance: Int,
    val delta: Int
)

class PointsService {

    suspend fun getPointsHistory(
        startDate: String? = null,
        endDate: String? = null,
        limit: Int? = null,
        sort: String? = null
    ): PointsHistoryResponse {
        return withContext(Dispatchers.IO) {
            val urlBuilder = StringBuilder("$baseUrl/api/mobile/points/history")
            val params = mutableListOf<String>()
            
            startDate?.let { params.add("start_date=$it") }
            endDate?.let { params.add("end_date=$it") }
            limit?.let { params.add("limit=$it") }
            sort?.let { params.add("sort=$it") }
            
            if (params.isNotEmpty()) {
                urlBuilder.append("?").append(params.joinToString("&"))
            }
            
            val url = urlBuilder.toString()
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            android.util.Log.d("PointsService", "Fetching points history from: $url")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            android.util.Log.d("PointsService", "Points history response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, PointsHistoryResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("PointsService", "Failed to parse points history response: ${e.message}", e)
                    PointsHistoryResponse(
                        success = false,
                        message = "Failed to parse response: ${e.message}",
                        transactions = emptyList(),
                        totalCount = 0
                    )
                }
            } else {
                PointsHistoryResponse(
                    success = false,
                    message = "Failed to fetch points history: HTTP ${response.code}",
                    transactions = emptyList(),
                    totalCount = 0
                )
            }
        }
    }

    suspend fun getPointsDetails(): PointsDetailsResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/points/details"
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            android.util.Log.d("PointsService", "Fetching points details from: $url")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            android.util.Log.d("PointsService", "Points details response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, PointsDetailsResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("PointsService", "Failed to parse points details response: ${e.message}", e)
                    PointsDetailsResponse(
                        success = false,
                        message = "Failed to parse response: ${e.message}",
                        currentBalance = 0,
                        conversionRate = 0.01,
                        dollarValue = 0.0,
                        sponsorCompany = null,
                        memberSince = null,
                        totalEarned = 0,
                        totalSpent = 0
                    )
                }
            } else {
                PointsDetailsResponse(
                    success = false,
                    message = "Failed to fetch points details: HTTP ${response.code}",
                    currentBalance = 0,
                    conversionRate = 0.01,
                    dollarValue = 0.0,
                    sponsorCompany = null,
                    memberSince = null,
                    totalEarned = 0,
                    totalSpent = 0
                )
            }
        }
    }

    suspend fun getPointsGraph(
        period: String = "30d",
        granularity: String = "day"
    ): PointsGraphResponse {
        return withContext(Dispatchers.IO) {
            val url = "$baseUrl/api/mobile/points/graph?period=$period&granularity=$granularity"
            val request = Request.Builder()
                .url(url)
                .get()
                .build()
            
            android.util.Log.d("PointsService", "Fetching points graph from: $url")
            val response = client.newCall(request).execute()
            val responseBody = response.body?.string()
            android.util.Log.d("PointsService", "Points graph response code: ${response.code}")
            
            if (response.isSuccessful && responseBody != null) {
                try {
                    gson.fromJson(responseBody, PointsGraphResponse::class.java)
                } catch (e: Exception) {
                    android.util.Log.e("PointsService", "Failed to parse points graph response: ${e.message}", e)
                    PointsGraphResponse(
                        success = false,
                        message = "Failed to parse response: ${e.message}",
                        dataPoints = emptyList()
                    )
                }
            } else {
                PointsGraphResponse(
                    success = false,
                    message = "Failed to fetch points graph: HTTP ${response.code}",
                    dataPoints = emptyList()
                )
            }
        }
    }
}



```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/cart/CartAdapter.kt =====

```kotlin
package com.example.driverrewards.ui.cart

import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.ImageButton
import android.widget.ImageView
import android.widget.TextView
import android.widget.Toast
import androidx.recyclerview.widget.RecyclerView
import com.bumptech.glide.Glide
import com.example.driverrewards.R
import com.example.driverrewards.network.CartItem
import com.google.android.material.button.MaterialButton

class CartAdapter(
    private val items: List<CartItem>,
    private val onQuantityChanged: (String, Int) -> Unit,
    private val onRemove: (String) -> Unit,
    private val onItemClick: (String) -> Unit
) : RecyclerView.Adapter<CartAdapter.ViewHolder>() {

    class ViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        val itemImage: ImageView = itemView.findViewById(R.id.item_image)
        val itemTitle: TextView = itemView.findViewById(R.id.item_title)
        val variationDetails: TextView = itemView.findViewById(R.id.variation_details)
        val pointsPerUnit: TextView = itemView.findViewById(R.id.points_per_unit)
        val quantity: TextView = itemView.findViewById(R.id.quantity)
        val lineTotal: TextView = itemView.findViewById(R.id.line_total)
        val quantityDecrease: ImageButton = itemView.findViewById(R.id.quantity_decrease)
        val quantityIncrease: ImageButton = itemView.findViewById(R.id.quantity_increase)
        val removeButton: ImageButton = itemView.findViewById(R.id.remove_button)
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_cart, parent, false)
        return ViewHolder(view)
    }

    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        val item = items[position]
        
        // Load image
        holder.itemImage.setImageResource(android.R.drawable.ic_menu_gallery) // Set placeholder first
        if (!item.itemImageUrl.isNullOrEmpty()) {
            try {
                Glide.with(holder.itemView.context)
                    .load(item.itemImageUrl)
                    .placeholder(android.R.drawable.ic_menu_gallery)
                    .error(android.R.drawable.ic_menu_gallery)
                    .into(holder.itemImage)
            } catch (e: Exception) {
                android.util.Log.e("CartAdapter", "Error loading image for ${item.itemTitle}: ${e.message}", e)
                holder.itemImage.setImageResource(android.R.drawable.ic_menu_gallery)
            }
        }
        
        holder.itemTitle.text = item.itemTitle ?: "Unknown Item"
        
        // Extract and display variation details from external_item_id
        val externalItemId = item.externalItemId ?: ""
        if (externalItemId.contains("::")) {
            val variationPart = externalItemId.substringAfter("::")
            val variationMap = variationPart.split("|").associate { part ->
                val (key, value) = part.split(":", limit = 2)
                key to value
            }
            if (variationMap.isNotEmpty()) {
                val variationText = variationMap.entries.joinToString(", ") { "${it.key}: ${it.value}" }
                holder.variationDetails.text = variationText
                holder.variationDetails.visibility = View.VISIBLE
            } else {
                holder.variationDetails.visibility = View.GONE
            }
        } else {
            holder.variationDetails.visibility = View.GONE
        }
        
        holder.pointsPerUnit.text = "${item.pointsPerUnit} pts each"
        holder.quantity.text = item.quantity.toString()
        holder.lineTotal.text = "${item.lineTotalPoints} pts"
        
        // Remove button - set clickable and prevent card click
        holder.removeButton.setOnClickListener { 
            android.util.Log.d("CartAdapter", "Remove button clicked for item: ${item.cartItemId}")
            onRemove(item.cartItemId ?: "")
        }
        holder.removeButton.isClickable = true
        
        // Quantity buttons
        holder.quantityDecrease.setOnClickListener {
            if (item.quantity > 1) {
                onQuantityChanged(item.cartItemId ?: "", item.quantity - 1)
            }
        }
        
        holder.quantityIncrease.setOnClickListener {
            onQuantityChanged(item.cartItemId ?: "", item.quantity + 1)
        }
        
        // Make card clickable to navigate to product detail (but not when clicking buttons)
        holder.itemView.setOnClickListener { view ->
            // Only trigger if the click wasn't on a button
            if (view == holder.itemView || !holder.removeButton.isPressed && !holder.quantityDecrease.isPressed && !holder.quantityIncrease.isPressed) {
                item.externalItemId?.let { itemId ->
                    android.util.Log.d("CartAdapter", "Card clicked with externalItemId: '$itemId'")
                    onItemClick(itemId)
                }
            }
        }
        
    }

    override fun getItemCount() = items.size
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/cart/CartFragment.kt =====

```kotlin
package com.example.driverrewards.ui.cart

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.Observer
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.LinearLayoutManager
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentCartBinding

class CartFragment : Fragment() {

    private var _binding: FragmentCartBinding? = null
    private val binding get() = _binding!!
    private lateinit var cartViewModel: CartViewModel
    private lateinit var cartAdapter: CartAdapter

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        cartViewModel = ViewModelProvider(requireActivity())[CartViewModel::class.java]
        _binding = FragmentCartBinding.inflate(inflater, container, false)
        val root: View = binding.root

        setupRecyclerView()
        setupObservers()
        setupClickListeners()

        // Load cart data
        cartViewModel.loadCart()

        return root
    }

    private fun setupRecyclerView() {
        cartAdapter = CartAdapter(
            items = emptyList(),
            onQuantityChanged = { itemId, newQuantity ->
                cartViewModel.updateQuantity(itemId, newQuantity)
            },
            onRemove = { itemId ->
                cartViewModel.removeItem(itemId)
            },
            onItemClick = { externalItemId ->
                // Use the exact same logic as OrderDetailFragment.handleOrderItemClick()
                if (externalItemId.isEmpty()) {
                    Toast.makeText(requireContext(), "Unable to open product details", Toast.LENGTH_SHORT).show()
                    return@CartAdapter
                }
                
                // Extract base item ID (before ::) and variation info
                val baseItemId = if (externalItemId.contains("::")) {
                    externalItemId.substringBefore("::")
                } else {
                    externalItemId
                }
                
                // Get variation info if present
                val variationInfo = if (externalItemId.contains("::")) {
                    externalItemId.substringAfter("::")
                } else {
                    null
                }
                
                android.util.Log.d("CartFragment", "=== NAVIGATING TO PRODUCT DETAIL ===")
                android.util.Log.d("CartFragment", "  ExternalItemId: $externalItemId")
                android.util.Log.d("CartFragment", "  BaseItemId: $baseItemId")
                android.util.Log.d("CartFragment", "  VariationInfo: $variationInfo")
                
                // Navigate to product detail with variation info
                val bundle = Bundle().apply {
                    putString("itemId", baseItemId)
                    android.util.Log.d("CartFragment", "  Bundle itemId set to: $baseItemId")
                    variationInfo?.let {
                        android.util.Log.d("CartFragment", "  Adding variationInfo to bundle: $it")
                        putString("variationInfo", it)
                        android.util.Log.d("CartFragment", "  Bundle variationInfo set to: $it")
                    } ?: run {
                        android.util.Log.w("CartFragment", "  No variationInfo to add to bundle")
                    }
                }
                
                android.util.Log.d("CartFragment", "  Bundle contents - itemId: '${bundle.getString("itemId")}', variationInfo: '${bundle.getString("variationInfo")}'")
                
                try {
                    android.util.Log.d("CartFragment", "  Calling navigate with action_cart_to_product_detail")
                    findNavController().navigate(R.id.action_cart_to_product_detail, bundle)
                } catch (e: Exception) {
                    android.util.Log.e("CartFragment", "Error navigating to product detail: ${e.message}", e)
                    Toast.makeText(requireContext(), "Error opening product details", Toast.LENGTH_SHORT).show()
                }
            }
        )
        val layoutManager = LinearLayoutManager(requireContext())
        binding.recyclerView.layoutManager = layoutManager
        binding.recyclerView.adapter = cartAdapter
        
        // Restore scroll position after data loads
        binding.recyclerView.post {
            val scrollPos = cartViewModel.getScrollPosition()
            if (scrollPos > 0 && layoutManager.itemCount > scrollPos) {
                layoutManager.scrollToPosition(scrollPos)
            }
        }
        
        // Save scroll position when scrolling
        binding.recyclerView.addOnScrollListener(object : androidx.recyclerview.widget.RecyclerView.OnScrollListener() {
            override fun onScrolled(recyclerView: androidx.recyclerview.widget.RecyclerView, dx: Int, dy: Int) {
                super.onScrolled(recyclerView, dx, dy)
                val layoutManager = recyclerView.layoutManager as? LinearLayoutManager ?: return
                val firstVisible = layoutManager.findFirstVisibleItemPosition()
                if (firstVisible >= 0) {
                    cartViewModel.setScrollPosition(firstVisible)
                }
            }
        })
    }

    private fun setupObservers() {
        cartViewModel.cartItems.observe(viewLifecycleOwner, Observer { items ->
            cartAdapter = CartAdapter(
                items = items,
                onQuantityChanged = { itemId, newQuantity ->
                    cartViewModel.updateQuantity(itemId, newQuantity)
                },
                onRemove = { itemId ->
                    cartViewModel.removeItem(itemId)
                },
                onItemClick = { externalItemId ->
                    // Navigate to product detail
                    val bundle = Bundle().apply {
                        putString("itemId", externalItemId)
                    }
                    findNavController().navigate(R.id.action_cart_to_product_detail, bundle)
                }
            )
            binding.recyclerView.adapter = cartAdapter
            
            // Restore scroll position after adapter update
            binding.recyclerView.post {
                val layoutManager = binding.recyclerView.layoutManager as? LinearLayoutManager ?: return@post
                val scrollPos = cartViewModel.getScrollPosition()
                if (scrollPos > 0 && layoutManager.itemCount > scrollPos) {
                    layoutManager.scrollToPosition(scrollPos)
                }
            }
            
            // Show/hide empty message
            if (items.isEmpty()) {
                binding.emptyCartMessage.visibility = View.VISIBLE
                binding.recyclerView.visibility = View.GONE
            } else {
                binding.emptyCartMessage.visibility = View.GONE
                binding.recyclerView.visibility = View.VISIBLE
            }
        })

        cartViewModel.totalPoints.observe(viewLifecycleOwner, Observer { total ->
            binding.totalPoints.text = "Total: $total pts"
        })

        cartViewModel.itemCount.observe(viewLifecycleOwner, Observer { count ->
            binding.checkoutButton.isEnabled = count > 0
        })
        
        // Check balance for checkout button
        cartViewModel.totalPoints.observe(viewLifecycleOwner, Observer { total ->
            cartViewModel.driverPoints.observe(viewLifecycleOwner, Observer { balance ->
                val hasItems = cartViewModel.itemCount.value ?: 0 > 0
                binding.checkoutButton.isEnabled = hasItems && total <= balance
            })
        })

        cartViewModel.isLoading.observe(viewLifecycleOwner, Observer { isLoading ->
            binding.progressBar.visibility = if (isLoading) View.VISIBLE else View.GONE
        })

        cartViewModel.errorMessage.observe(viewLifecycleOwner, Observer { error ->
            error?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_SHORT).show()
            }
        })
    }

    private fun setupClickListeners() {
        binding.checkoutButton.setOnClickListener {
            val totalPoints = cartViewModel.totalPoints.value ?: 0
            val itemCount = cartViewModel.itemCount.value ?: 0
            
            // Navigate to checkout fragment
            val bundle = Bundle().apply {
                putInt("totalPoints", totalPoints)
                putInt("itemCount", itemCount)
            }
            findNavController().navigate(R.id.action_cart_to_checkout, bundle)
        }

        binding.clearButton.setOnClickListener {
            cartViewModel.clearCart()
        }
    }

    override fun onResume() {
        super.onResume()
        cartViewModel.loadCart()
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/cart/CartViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.cart

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.example.driverrewards.network.CartService
import com.example.driverrewards.network.CartItem as NetworkCartItem
import kotlinx.coroutines.launch

class CartViewModel : ViewModel() {

    private val cartService = CartService()
    
    // Cart caching
    private var cachedCartItems: List<NetworkCartItem>? = null
    private var isCartCached: Boolean = false
    
    // Scroll position saving
    private var savedScrollPosition: Int = 0
    
    private val _cartItems = MutableLiveData<List<NetworkCartItem>>()
    val cartItems: LiveData<List<NetworkCartItem>> = _cartItems
    
    private val _totalPoints = MutableLiveData<Int>(0)
    val totalPoints: LiveData<Int> = _totalPoints
    
    private val _itemCount = MutableLiveData<Int>(0)
    val itemCount: LiveData<Int> = _itemCount
    
    private val _driverPoints = MutableLiveData<Int>(0)
    val driverPoints: LiveData<Int> = _driverPoints
    
    private val _isLoading = MutableLiveData<Boolean>(false)
    val isLoading: LiveData<Boolean> = _isLoading
    
    private val _errorMessage = MutableLiveData<String?>()
    val errorMessage: LiveData<String?> = _errorMessage
    
    private val _addToCartSuccess = MutableLiveData<Boolean?>()
    val addToCartSuccess: LiveData<Boolean?> = _addToCartSuccess
    
    fun loadCart() {
        // Return cached data immediately if available
        if (isCartCached && cachedCartItems != null) {
            _cartItems.value = cachedCartItems!!
            return
        }
        
        viewModelScope.launch {
            try {
                _isLoading.value = true
                _errorMessage.value = null
                
                val response = cartService.getCart()
                
                if (response.success && response.cart != null) {
                    // Cache the cart items
                    cachedCartItems = response.cart.items
                    isCartCached = true
                    
                    _cartItems.value = response.cart.items
                    _totalPoints.value = response.cart.totalPoints
                    _itemCount.value = response.cart.itemCount
                    _driverPoints.value = response.cart.driverPoints
                } else {
                    _errorMessage.value = response.message ?: "Failed to load cart"
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error loading cart: ${e.message}"
            } finally {
                _isLoading.value = false
            }
        }
    }
    
    fun addToCart(
        itemId: String,
        title: String,
        imageUrl: String,
        itemUrl: String,
        points: Int,
        quantity: Int = 1
    ) {
        viewModelScope.launch {
            try {
                _errorMessage.value = null
                
                val response = cartService.addToCart(itemId, title, imageUrl, itemUrl, points, quantity)
                
                if (response.success) {
                    _addToCartSuccess.value = true
                    _totalPoints.value = response.cartTotal ?: 0
                    _itemCount.value = response.itemCount ?: 0
                    // Invalidate cache and reload cart
                    isCartCached = false
                    cachedCartItems = null
                    loadCart()
                } else {
                    _errorMessage.value = response.message ?: "Failed to add to cart"
                    _addToCartSuccess.value = false
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error adding to cart: ${e.message}"
                _addToCartSuccess.value = false
            }
        }
    }
    
    fun updateQuantity(cartItemId: String, quantity: Int) {
        viewModelScope.launch {
            try {
                _errorMessage.value = null
                
                val response = cartService.updateCartItem(cartItemId, quantity)
                
                if (response.success) {
                    _totalPoints.value = response.cartTotal ?: 0
                    _itemCount.value = response.itemCount ?: 0
                    // Invalidate cache and reload
                    isCartCached = false
                    cachedCartItems = null
                    loadCart()
                } else {
                    _errorMessage.value = response.message ?: "Failed to update cart"
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error updating cart: ${e.message}"
            }
        }
    }
    
    fun removeItem(cartItemId: String) {
        viewModelScope.launch {
            try {
                _errorMessage.value = null
                
                val response = cartService.removeCartItem(cartItemId)
                
                if (response.success) {
                    _totalPoints.value = response.cartTotal ?: 0
                    _itemCount.value = response.itemCount ?: 0
                    // Invalidate cache and reload
                    isCartCached = false
                    cachedCartItems = null
                    loadCart()
                } else {
                    _errorMessage.value = response.message ?: "Failed to remove item"
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error removing item: ${e.message}"
            }
        }
    }
    
    fun clearCart() {
        viewModelScope.launch {
            try {
                _errorMessage.value = null
                
                val response = cartService.clearCart()
                
                if (response.success) {
                    // Clear cache
                    cachedCartItems = emptyList()
                    isCartCached = true
                    _cartItems.value = emptyList()
                    _totalPoints.value = 0
                    _itemCount.value = 0
                } else {
                    _errorMessage.value = response.message ?: "Failed to clear cart"
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error clearing cart: ${e.message}"
            }
        }
    }
    
    fun refreshCart() {
        // Invalidate cache on refresh
        isCartCached = false
        cachedCartItems = null
        loadCart()
    }
    
    fun setScrollPosition(position: Int) {
        savedScrollPosition = position
    }
    
    fun getScrollPosition(): Int = savedScrollPosition
    
    fun clearError() {
        _errorMessage.value = null
    }
    
    fun clearAddToCartSuccess() {
        _addToCartSuccess.value = null
    }
    
    private val _checkoutSuccess = MutableLiveData<CheckoutResult?>()
    val checkoutSuccess: LiveData<CheckoutResult?> = _checkoutSuccess
    
    data class CheckoutResult(
        val orderId: String,
        val orderNumber: String
    )
    
    fun processCheckout(
        firstName: String,
        lastName: String,
        email: String,
        shippingStreet: String,
        shippingCity: String,
        shippingState: String,
        shippingPostal: String,
        shippingCountry: String,
        shippingCostPoints: Int = 0
    ) {
        // Check balance before processing
        val totalCost = _totalPoints.value ?: 0
        val balance = _driverPoints.value ?: 0
        if (totalCost > balance) {
            _errorMessage.value = "Insufficient points. You have $balance pts but need $totalCost pts."
            return
        }
        
        viewModelScope.launch {
            try {
                _isLoading.value = true
                _errorMessage.value = null
                
                val response = cartService.processCheckout(
                    com.example.driverrewards.network.CheckoutRequest(
                        firstName = firstName,
                        lastName = lastName,
                        email = email,
                        shippingStreet = shippingStreet,
                        shippingCity = shippingCity,
                        shippingState = shippingState,
                        shippingPostal = shippingPostal,
                        shippingCountry = shippingCountry,
                        shippingCostPoints = shippingCostPoints
                    )
                )
                
                if (response.success) {
                    val orderId = response.orderId ?: ""
                    val orderNumber = response.orderNumber ?: ""
                    _checkoutSuccess.value = CheckoutResult(orderId, orderNumber)
                    // Clear cart after successful checkout
                    cachedCartItems = emptyList()
                    isCartCached = true
                    _cartItems.value = emptyList()
                    _totalPoints.value = 0
                    _itemCount.value = 0
                    // Refresh to get updated driver points
                    isCartCached = false
                    cachedCartItems = null
                    loadCart()
                } else {
                    _errorMessage.value = response.message ?: "Failed to process checkout"
                    _checkoutSuccess.value = null
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error processing checkout: ${e.message}"
                _checkoutSuccess.value = null
            } finally {
                _isLoading.value = false
            }
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/cart/CheckoutDialog.kt =====

```kotlin
package com.example.driverrewards.ui.cart

import android.os.Bundle
import android.text.TextUtils
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.DialogFragment
import com.example.driverrewards.databinding.DialogCheckoutBinding

class CheckoutDialog : DialogFragment() {
    
    private var _binding: DialogCheckoutBinding? = null
    private val binding get() = _binding!!
    
    private var totalPoints: Int = 0
    private var itemCount: Int = 0
    private var driverPoints: Int = 0
    private var onCheckoutSuccessListener: ((String, String) -> Unit)? = null
    
    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        _binding = DialogCheckoutBinding.inflate(inflater, container, false)
        return binding.root
    }
    
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        
        // Set order summary
        binding.orderItemsSummary.text = "Items: $itemCount"
        binding.orderTotalPoints.text = "Total: $totalPoints pts"
        binding.orderDriverPoints.text = "Balance: $driverPoints pts"
        
        setupClickListeners()
    }
    
    private fun setupClickListeners() {
        binding.cancelButton.setOnClickListener {
            dismiss()
        }
        
        binding.checkoutButton.setOnClickListener {
            processCheckout()
        }
    }
    
    private fun processCheckout() {
        val firstName = binding.firstNameText.text?.toString()?.trim() ?: ""
        val lastName = binding.lastNameText.text?.toString()?.trim() ?: ""
        val email = binding.emailText.text?.toString()?.trim() ?: ""
        val shippingStreet = binding.shippingStreetText.text?.toString()?.trim() ?: ""
        val shippingCity = binding.shippingCityText.text?.toString()?.trim() ?: ""
        val shippingState = binding.shippingStateText.text?.toString()?.trim() ?: ""
        val shippingPostal = binding.shippingPostalText.text?.toString()?.trim() ?: ""
        val shippingCountry = binding.shippingCountryText.text?.toString()?.trim() ?: ""
        
        // Validate inputs
        if (!validateInputs(firstName, lastName, email, shippingStreet, shippingCity, shippingState, shippingPostal, shippingCountry)) {
            return
        }
        
        // Check terms agreement
        if (!binding.termsCheckbox.isChecked) {
            Toast.makeText(requireContext(), "Please agree to the terms and conditions", Toast.LENGTH_SHORT).show()
            return
        }
        
        // Show loading state
        binding.checkoutButton.isEnabled = false
        binding.checkoutButton.text = "Processing..."
        
        // Get CartViewModel and process checkout
        val cartViewModel = androidx.lifecycle.ViewModelProvider(requireActivity())[CartViewModel::class.java]
        cartViewModel.processCheckout(
            firstName = firstName,
            lastName = lastName,
            email = email,
            shippingStreet = shippingStreet,
            shippingCity = shippingCity,
            shippingState = shippingState,
            shippingPostal = shippingPostal,
            shippingCountry = shippingCountry,
            shippingCostPoints = 0 // Default shipping cost, can be calculated if needed
        )
        
        // Observe checkout success
        cartViewModel.checkoutSuccess.observe(viewLifecycleOwner, androidx.lifecycle.Observer { result ->
            result?.let {
                Toast.makeText(requireContext(), "Order placed successfully! Order #${it.orderNumber}", Toast.LENGTH_LONG).show()
                onCheckoutSuccessListener?.invoke(it.orderId, it.orderNumber)
                dismiss()
            }
        })
        
        // Observe errors
        cartViewModel.errorMessage.observe(viewLifecycleOwner, androidx.lifecycle.Observer { error ->
            error?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_LONG).show()
                binding.checkoutButton.isEnabled = true
                binding.checkoutButton.text = "Place Order"
                cartViewModel.clearError()
            }
        })
        
        // Observe loading state
        cartViewModel.isLoading.observe(viewLifecycleOwner, androidx.lifecycle.Observer { isLoading ->
            if (!isLoading && binding.checkoutButton.text == "Processing...") {
                binding.checkoutButton.isEnabled = true
                binding.checkoutButton.text = "Place Order"
            }
        })
    }
    
    private fun validateInputs(
        firstName: String,
        lastName: String,
        email: String,
        shippingStreet: String,
        shippingCity: String,
        shippingState: String,
        shippingPostal: String,
        shippingCountry: String
    ): Boolean {
        var isValid = true
        
        // Clear previous errors
        binding.firstNameLayout.error = null
        binding.lastNameLayout.error = null
        binding.emailLayout.error = null
        binding.shippingStreetLayout.error = null
        binding.shippingCityLayout.error = null
        binding.shippingStateLayout.error = null
        binding.shippingPostalLayout.error = null
        binding.shippingCountryLayout.error = null
        
        // Validate first name
        if (TextUtils.isEmpty(firstName)) {
            binding.firstNameLayout.error = "First name is required"
            isValid = false
        }
        
        // Validate last name
        if (TextUtils.isEmpty(lastName)) {
            binding.lastNameLayout.error = "Last name is required"
            isValid = false
        }
        
        // Validate email
        if (TextUtils.isEmpty(email)) {
            binding.emailLayout.error = "Email is required"
            isValid = false
        } else if (!android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches()) {
            binding.emailLayout.error = "Invalid email address"
            isValid = false
        }
        
        // Validate street address
        if (TextUtils.isEmpty(shippingStreet)) {
            binding.shippingStreetLayout.error = "Street address is required"
            isValid = false
        }
        
        // Validate city
        if (TextUtils.isEmpty(shippingCity)) {
            binding.shippingCityLayout.error = "City is required"
            isValid = false
        }
        
        // Validate state
        if (TextUtils.isEmpty(shippingState)) {
            binding.shippingStateLayout.error = "State/Province is required"
            isValid = false
        }
        
        // Validate postal code
        if (TextUtils.isEmpty(shippingPostal)) {
            binding.shippingPostalLayout.error = "Postal code is required"
            isValid = false
        }
        
        // Validate country
        if (TextUtils.isEmpty(shippingCountry)) {
            binding.shippingCountryLayout.error = "Country is required"
            isValid = false
        }
        
        return isValid
    }
    
    fun setOrderSummary(totalPoints: Int, itemCount: Int, driverPoints: Int) {
        this.totalPoints = totalPoints
        this.itemCount = itemCount
        this.driverPoints = driverPoints
    }
    
    fun setOnCheckoutSuccessListener(listener: (String, String) -> Unit) {
        onCheckoutSuccessListener = listener
    }
    
    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
    
    companion object {
        fun newInstance(totalPoints: Int, itemCount: Int, driverPoints: Int): CheckoutDialog {
            val dialog = CheckoutDialog()
            dialog.setOrderSummary(totalPoints, itemCount, driverPoints)
            return dialog
        }
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/cart/CheckoutFragment.kt =====

```kotlin
package com.example.driverrewards.ui.cart

import android.os.Bundle
import android.text.TextUtils
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.Observer
import androidx.navigation.fragment.findNavController
import com.example.driverrewards.databinding.FragmentCheckoutBinding
import com.example.driverrewards.ui.profile.ProfileViewModel
import com.example.driverrewards.network.OrdersService
import com.example.driverrewards.network.ReorderCheckoutRequest
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch

class CheckoutFragment : Fragment() {
    
    private var _binding: FragmentCheckoutBinding? = null
    private val binding get() = _binding!!
    
    private lateinit var cartViewModel: CartViewModel
    private lateinit var profileViewModel: ProfileViewModel
    private val ordersService = OrdersService()
    
    private var totalPoints: Int = 0
    private var itemCount: Int = 0
    private var orderId: String? = null // If present, this is a re-order checkout
    
    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        cartViewModel = ViewModelProvider(requireActivity())[CartViewModel::class.java]
        profileViewModel = ViewModelProvider(requireActivity())[ProfileViewModel::class.java]
        
        _binding = FragmentCheckoutBinding.inflate(inflater, container, false)
        
        // Get cart summary from arguments or ViewModel
        totalPoints = arguments?.getInt("totalPoints") ?: (cartViewModel.totalPoints.value ?: 0)
        itemCount = arguments?.getInt("itemCount") ?: (cartViewModel.itemCount.value ?: 0)
        orderId = arguments?.getString("orderId")
        
        return binding.root
    }
    
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        
        // Set order summary
        binding.orderItemsSummary.text = "Items: $itemCount"
        binding.orderTotalPoints.text = "Total: $totalPoints pts"
        
        // Check balance and disable checkout button if insufficient
        cartViewModel.driverPoints.observe(viewLifecycleOwner, Observer { balance ->
            if (totalPoints > balance) {
                binding.checkoutButton.isEnabled = false
                binding.checkoutButton.text = "Insufficient Points"
            } else {
                binding.checkoutButton.isEnabled = true
                binding.checkoutButton.text = "Place Order"
            }
        })
        
        setupClickListeners()
        setupObservers()
        autofillFromProfile()
    }
    
    private fun autofillFromProfile() {
        profileViewModel.profileData.observe(viewLifecycleOwner, Observer { profileData ->
            profileData?.let {
                // Fill in name
                it.firstName?.let { firstName ->
                    binding.firstNameText.setText(firstName)
                }
                it.lastName?.let { lastName ->
                    binding.lastNameText.setText(lastName)
                }
                
                
                // Parse and fill shipping address
                it.shippingAddress?.let { address ->
                    parseAndFillAddress(address)
                }
            }
        })
        
        // Load profile if not already loaded
        if (profileViewModel.profileData.value == null) {
            profileViewModel.loadProfile()
        } else {
            // If profile is already cached, use it immediately
            profileViewModel.profileData.value?.let { profileData ->
                profileData.firstName?.let { binding.firstNameText.setText(it) }
                profileData.lastName?.let { binding.lastNameText.setText(it) }
                profileData.shippingAddress?.let { parseAndFillAddress(it) }
            }
        }
    }
    
    private fun parseAndFillAddress(address: String) {
        // Try to parse address - format is typically "Street, City, State, Postal, Country"
        val parts = address.split(",").map { it.trim() }
        
        when (parts.size) {
            1 -> {
                if (parts[0].isNotEmpty()) {
                    binding.shippingStreetText.setText(parts[0])
                }
            }
            2 -> {
                binding.shippingStreetText.setText(parts[0])
                binding.shippingCityText.setText(parts[1])
            }
            3 -> {
                binding.shippingStreetText.setText(parts[0])
                binding.shippingCityText.setText(parts[1])
                binding.shippingStateText.setText(parts[2])
            }
            4 -> {
                binding.shippingStreetText.setText(parts[0])
                binding.shippingCityText.setText(parts[1])
                binding.shippingStateText.setText(parts[2])
                binding.shippingPostalText.setText(parts[3])
            }
            else -> {
                if (parts.size >= 1) binding.shippingStreetText.setText(parts[0])
                if (parts.size >= 2) binding.shippingCityText.setText(parts[1])
                if (parts.size >= 3) binding.shippingStateText.setText(parts[2])
                if (parts.size >= 4) binding.shippingPostalText.setText(parts[3])
                if (parts.size >= 5) binding.shippingCountryText.setText(parts[4])
            }
        }
    }
    
    private fun setupClickListeners() {
        binding.cancelButton.setOnClickListener {
            findNavController().navigateUp()
        }
        
        binding.checkoutButton.setOnClickListener {
            processCheckout()
        }
    }
    
    private fun setupObservers() {
        cartViewModel.checkoutSuccess.observe(viewLifecycleOwner, Observer { result ->
            result?.let {
                Toast.makeText(requireContext(), "Order placed successfully! Order #${it.orderNumber}", Toast.LENGTH_LONG).show()
                // Refresh points display in MainActivity
                (requireActivity() as? com.example.driverrewards.MainActivity)?.refreshPointsDisplay()
                // Refresh profile if on profile page
                profileViewModel.refreshProfile()
                // Navigate back to cart or orders
                findNavController().navigateUp()
            }
        })
        
        cartViewModel.errorMessage.observe(viewLifecycleOwner, Observer { error ->
            error?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_LONG).show()
                cartViewModel.clearError()
            }
        })
        
        cartViewModel.isLoading.observe(viewLifecycleOwner, Observer { isLoading ->
            binding.checkoutButton.isEnabled = !isLoading
            binding.checkoutButton.text = if (isLoading) "Processing..." else "Place Order"
        })
    }
    
    private fun processCheckout() {
        val firstName = binding.firstNameText.text?.toString()?.trim() ?: ""
        val lastName = binding.lastNameText.text?.toString()?.trim() ?: ""
        // Get email from profile
        val email = profileViewModel.profileData.value?.email ?: ""
        val shippingStreet = binding.shippingStreetText.text?.toString()?.trim() ?: ""
        val shippingCity = binding.shippingCityText.text?.toString()?.trim() ?: ""
        val shippingState = binding.shippingStateText.text?.toString()?.trim() ?: ""
        val shippingPostal = binding.shippingPostalText.text?.toString()?.trim() ?: ""
        val shippingCountry = binding.shippingCountryText.text?.toString()?.trim() ?: ""
        
        // Validate inputs
        if (!validateInputs(firstName, lastName, shippingStreet, shippingCity, shippingState, shippingPostal, shippingCountry)) {
            return
        }
        
        // Check terms agreement
        if (!binding.termsCheckbox.isChecked) {
            Toast.makeText(requireContext(), "Please agree to the terms and conditions", Toast.LENGTH_SHORT).show()
            return
        }
        
        // If orderId is present, this is a re-order checkout (don't touch cart)
        if (!orderId.isNullOrEmpty()) {
            processReorderCheckout(firstName, lastName, email, shippingStreet, shippingCity, shippingState, shippingPostal, shippingCountry)
        } else {
            // Normal checkout from cart
            cartViewModel.processCheckout(
                firstName = firstName,
                lastName = lastName,
                email = email,
                shippingStreet = shippingStreet,
                shippingCity = shippingCity,
                shippingState = shippingState,
                shippingPostal = shippingPostal,
                shippingCountry = shippingCountry,
                shippingCostPoints = 0
            )
        }
    }
    
    private fun processReorderCheckout(
        firstName: String,
        lastName: String,
        email: String,
        shippingStreet: String,
        shippingCity: String,
        shippingState: String,
        shippingPostal: String,
        shippingCountry: String
    ) {
        binding.checkoutButton.isEnabled = false
        binding.checkoutButton.text = "Processing..."
        
        CoroutineScope(Dispatchers.Main).launch {
            try {
                val request = ReorderCheckoutRequest(
                    firstName = firstName,
                    lastName = lastName,
                    email = email,
                    shippingStreet = shippingStreet,
                    shippingCity = shippingCity,
                    shippingState = shippingState,
                    shippingPostal = shippingPostal,
                    shippingCountry = shippingCountry,
                    shippingCostPoints = 0
                )
                
                val response = ordersService.reorderCheckout(orderId!!, request)
                
                if (response.success) {
                    Toast.makeText(requireContext(), "Re-order placed successfully! Order #${response.orderNumber}", Toast.LENGTH_LONG).show()
                    // Refresh points display in MainActivity
                    (requireActivity() as? com.example.driverrewards.MainActivity)?.refreshPointsDisplay()
                    // Refresh profile
                    profileViewModel.refreshProfile()
                    // Navigate back
                    findNavController().navigateUp()
                } else {
                    Toast.makeText(requireContext(), response.message ?: "Failed to place re-order", Toast.LENGTH_LONG).show()
                    binding.checkoutButton.isEnabled = true
                    binding.checkoutButton.text = "Place Order"
                }
            } catch (e: Exception) {
                android.util.Log.e("CheckoutFragment", "Error processing re-order checkout: ${e.message}", e)
                Toast.makeText(requireContext(), "Error processing re-order: ${e.message}", Toast.LENGTH_LONG).show()
                binding.checkoutButton.isEnabled = true
                binding.checkoutButton.text = "Place Order"
            }
        }
    }
    
    private fun validateInputs(
        firstName: String,
        lastName: String,
        shippingStreet: String,
        shippingCity: String,
        shippingState: String,
        shippingPostal: String,
        shippingCountry: String
    ): Boolean {
        var isValid = true
        
        // Clear previous errors
        binding.firstNameLayout.error = null
        binding.lastNameLayout.error = null
        binding.shippingStreetLayout.error = null
        binding.shippingCityLayout.error = null
        binding.shippingStateLayout.error = null
        binding.shippingPostalLayout.error = null
        binding.shippingCountryLayout.error = null
        
        // Validate first name
        if (TextUtils.isEmpty(firstName)) {
            binding.firstNameLayout.error = "First name is required"
            isValid = false
        }
        
        // Validate last name
        if (TextUtils.isEmpty(lastName)) {
            binding.lastNameLayout.error = "Last name is required"
            isValid = false
        }
        
        // Validate street address
        if (TextUtils.isEmpty(shippingStreet)) {
            binding.shippingStreetLayout.error = "Street address is required"
            isValid = false
        }
        
        // Validate city
        if (TextUtils.isEmpty(shippingCity)) {
            binding.shippingCityLayout.error = "City is required"
            isValid = false
        }
        
        // Validate state
        if (TextUtils.isEmpty(shippingState)) {
            binding.shippingStateLayout.error = "State/Province is required"
            isValid = false
        }
        
        // Validate postal code
        if (TextUtils.isEmpty(shippingPostal)) {
            binding.shippingPostalLayout.error = "Postal code is required"
            isValid = false
        }
        
        // Validate country
        if (TextUtils.isEmpty(shippingCountry)) {
            binding.shippingCountryLayout.error = "Country is required"
            isValid = false
        }
        
        return isValid
    }
    
    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/CatalogFragment.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.GridLayoutManager
import androidx.recyclerview.widget.RecyclerView
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentCatalogBinding
import com.example.driverrewards.network.CatalogService

class CatalogFragment : Fragment() {

    private var _binding: FragmentCatalogBinding? = null
    private val binding get() = _binding!!
    private lateinit var catalogViewModel: CatalogViewModel
    private lateinit var catalogService: CatalogService
    private lateinit var productAdapter: ProductAdapter
    private lateinit var skeletonAdapter: SkeletonCardAdapter
    private var isLoading = false
    private var currentPage = 1
    private var hasMoreData = true
    private var currentSearchQuery: String? = null
    
    // Store current filter state
    private var currentMinPoints: Float? = null
    private var currentMaxPoints: Float? = null
    private var currentSort: String = "best_match"
    private var currentFavoritesOnly: Boolean = false

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        catalogViewModel = ViewModelProvider(requireActivity()).get(CatalogViewModel::class.java)
        catalogService = CatalogService()
        
        _binding = FragmentCatalogBinding.inflate(inflater, container, false)
        val root: View = binding.root

        // Restore filter state from ViewModel
        val filterState = catalogViewModel.getCachedFilterState()
        if (filterState.searchQuery != null || filterState.minPoints != null || filterState.maxPoints != null || 
            filterState.sort != "best_match" || filterState.favoritesOnly) {
            currentSearchQuery = filterState.searchQuery
            currentSort = filterState.sort
            currentMinPoints = filterState.minPoints
            currentMaxPoints = filterState.maxPoints
            currentFavoritesOnly = filterState.favoritesOnly
            currentPage = filterState.currentPage
            hasMoreData = filterState.hasMoreData
        }

        setupRecyclerView()
        setupSkeletonRecyclerView()
        
        // Restore scroll position after data is loaded
        binding.recyclerView.post {
            val scrollPos = catalogViewModel.getScrollPosition()
            if (scrollPos > 0 && binding.recyclerView.layoutManager != null) {
                binding.recyclerView.scrollToPosition(scrollPos)
            }
        }
        
        loadCatalogData()

        return root
    }
    
    private fun setupSkeletonRecyclerView() {
        skeletonAdapter = SkeletonCardAdapter(itemCount = 6)
        binding.skeletonRecyclerView.apply {
            layoutManager = GridLayoutManager(context, 2)
            adapter = skeletonAdapter
        }
    }
    
    private fun setupRecyclerView() {
        productAdapter = ProductAdapter(
            onItemClick = { item ->
                // Save current product itemId to ViewModel
                catalogViewModel.setCurrentProductItemId(item.id)
                // Save scroll position before navigating
                val layoutManager = binding.recyclerView.layoutManager as GridLayoutManager
                catalogViewModel.setScrollPosition(layoutManager.findLastVisibleItemPosition())
                // Navigate to product detail page
                val bundle = Bundle().apply {
                    putString("itemId", item.id)
                }
                findNavController().navigate(R.id.action_catalog_to_product_detail, bundle)
            },
            onFavoriteClick = { item ->
                // Handle favorite toggle
                toggleFavorite(item)
            }
        )

        binding.recyclerView.apply {
            layoutManager = GridLayoutManager(context, 2)
            adapter = productAdapter
            
            // Add spacing decoration that removes top/bottom padding but keeps item spacing
            val density = context.resources.displayMetrics.density
            addItemDecoration(object : RecyclerView.ItemDecoration() {
                override fun getItemOffsets(
                    outRect: android.graphics.Rect,
                    view: View,
                    parent: RecyclerView,
                    state: RecyclerView.State
                ) {
                    val position = parent.getChildAdapterPosition(view)
                    if (position == RecyclerView.NO_POSITION) return
                    
                    val layoutManager = parent.layoutManager as GridLayoutManager
                    val spanCount = layoutManager.spanCount
                    val itemCount = parent.adapter?.itemCount ?: 0
                    
                    // Calculate row and column
                    val row = position / spanCount
                    val column = position % spanCount
                    val totalRows = (itemCount + spanCount - 1) / spanCount
                    
                    // Convert dp to px
                    val spacingPx = (4 * density).toInt()
                    
                    // Horizontal spacing (between columns)
                    if (column < spanCount - 1) {
                        outRect.right = spacingPx
                    }
                    
                    // Vertical spacing (between rows) but NOT at top or bottom
                    if (row < totalRows - 1) {
                        outRect.bottom = spacingPx
                    }
                    
                    // Remove top padding from first row
                    if (row == 0) {
                        outRect.top = 0
                    }
                    
                    // Remove bottom padding from last row
                    if (row == totalRows - 1) {
                        outRect.bottom = 0
                    }
                }
            })
            
            // Add scroll listener for infinite scroll and position tracking
            addOnScrollListener(object : RecyclerView.OnScrollListener() {
                override fun onScrolled(recyclerView: RecyclerView, dx: Int, dy: Int) {
                    super.onScrolled(recyclerView, dx, dy)
                    
                    val layoutManager = recyclerView.layoutManager as GridLayoutManager
                    val totalItemCount = layoutManager.itemCount
                    val lastVisibleItem = layoutManager.findLastVisibleItemPosition()
                    
                    // Save scroll position to ViewModel
                    if (lastVisibleItem >= 0) {
                        catalogViewModel.setScrollPosition(lastVisibleItem)
                    }
                    
                    if (!isLoading && hasMoreData && lastVisibleItem >= totalItemCount - 4) {
                        loadMoreData()
                    }
                }
            })
        }
    }


    private fun setupFilters() {
        // TODO: Implement filter functionality
        // Category filters, sort options, point range filters
    }
    
    // Public method to perform search from action bar
    fun performSearch(query: String?) {
        updateDebugInfo("Search submitted: '${query ?: "empty"}'")
        currentSearchQuery = query
        currentPage = 1
        hasMoreData = true
        
        android.util.Log.d("CatalogFragment", "===== performSearch() CALLED =====")
        android.util.Log.d("CatalogFragment", "query: '$query', currentMinPoints: $currentMinPoints, currentMaxPoints: $currentMaxPoints")
        
        // Use loadCatalogDataWithFilters to maintain filter state
        loadCatalogDataWithFilters(query, currentSort, currentMinPoints, currentMaxPoints, currentFavoritesOnly, false, false, false)
    }
    
    // Public method to apply filters from action bar
    fun applyFilters(sort: String, minPoints: String?, maxPoints: String?, favoritesOnly: Boolean, availabilityAvailable: Boolean, availabilityLowStock: Boolean, availabilityUnavailable: Boolean) {
        android.util.Log.d("CatalogFragment", "===== applyFilters() CALLED =====")
        android.util.Log.d("CatalogFragment", "Input - minPoints (string): '$minPoints'")
        android.util.Log.d("CatalogFragment", "Input - maxPoints (string): '$maxPoints'")
        android.util.Log.d("CatalogFragment", "Input - sort: $sort")
        
        updateDebugInfo("Applying filters - Sort: $sort, Min: $minPoints, Max: $maxPoints, Favorites: $favoritesOnly, Available: $availabilityAvailable, LowStock: $availabilityLowStock, Unavailable: $availabilityUnavailable")
        currentPage = 1
        hasMoreData = true
        
        // Convert string values to appropriate types
        val minPointsFloat = minPoints?.toFloatOrNull()
        val maxPointsFloat = maxPoints?.toFloatOrNull()
        
        android.util.Log.d("CatalogFragment", "Converted - minPoints (float): $minPointsFloat")
        android.util.Log.d("CatalogFragment", "Converted - maxPoints (float): $maxPointsFloat")
        
        // Store current filter state
        currentMinPoints = minPointsFloat
        currentMaxPoints = maxPointsFloat
        currentSort = sort
        currentFavoritesOnly = favoritesOnly
        
        loadCatalogDataWithFilters(currentSearchQuery, sort, minPointsFloat, maxPointsFloat, favoritesOnly, availabilityAvailable, availabilityLowStock, availabilityUnavailable)
    }
    
    private fun loadCatalogDataWithFilters(searchQuery: String?, sort: String, minPoints: Float?, maxPoints: Float?, favoritesOnly: Boolean, _availabilityAvailable: Boolean, _availabilityLowStock: Boolean, _availabilityUnavailable: Boolean) {
        if (isLoading) return
        
        isLoading = true
        
        // Show skeleton loading, hide actual content
        if (currentPage == 1) {
            _binding?.skeletonRecyclerView?.visibility = View.VISIBLE
            _binding?.recyclerView?.visibility = View.GONE
        }
        
        // Update debug info
        updateDebugInfo("Loading catalog with filters... Page: $currentPage, Query: ${searchQuery ?: "none"}, Sort: $sort")
        
        catalogViewModel.loadCatalogData(
            page = currentPage,
            searchQuery = searchQuery,
            sort = sort,
            minPoints = minPoints,
            maxPoints = maxPoints,
            favoritesOnly = favoritesOnly,
            onSuccess = { items, hasMore ->
                // Hide skeleton, show actual content
                _binding?.skeletonRecyclerView?.visibility = View.GONE
                _binding?.recyclerView?.visibility = View.VISIBLE
                
                if (currentPage == 1) {
                    productAdapter.updateItems(items)
                    _binding?.debugInfo?.text = "Debug: Loaded ${items.size} items with filters. Page: $currentPage"
                } else {
                    productAdapter.addItems(items)
                    _binding?.debugInfo?.text = "Debug: Added ${items.size} more items. Total: ${productAdapter.itemCount}"
                }
                hasMoreData = hasMore
                isLoading = false
            },
            onError = { error ->
                // Hide skeleton on error
                _binding?.skeletonRecyclerView?.visibility = View.GONE
                _binding?.recyclerView?.visibility = View.VISIBLE
                _binding?.debugInfo?.text = "Debug: Error: $error"
                context?.let { ctx ->
                    Toast.makeText(ctx, "Error loading catalog: $error", Toast.LENGTH_LONG).show()
                }
                isLoading = false
            }
        )
    }

    private fun loadCatalogData(searchQuery: String? = null) {
        // Store the current search query for pagination
        if (searchQuery != null) {
            currentSearchQuery = searchQuery
        }
        
        // Use loadCatalogDataWithFilters to maintain filter state
        loadCatalogDataWithFilters(currentSearchQuery, currentSort, currentMinPoints, currentMaxPoints, currentFavoritesOnly, false, false, false)
    }

    private fun loadMoreData() {
        if (isLoading || !hasMoreData) return
        
        currentPage++
        loadCatalogDataWithFilters(currentSearchQuery, currentSort, currentMinPoints, currentMaxPoints, currentFavoritesOnly, false, false, false)
    }

    private fun toggleFavorite(item: ProductItem) {
        updateDebugInfo("Toggling favorite for item: ${item.title}")
        
        // Optimistically update UI
        productAdapter.updateFavoriteStatus(item.id, !item.isFavorite)
        
        catalogViewModel.toggleFavorite(
            itemId = item.id,
            isCurrentlyFavorite = item.isFavorite,
            onSuccess = { isFavorite ->
                // Already updated optimistically, just update debug
                updateDebugInfo("Favorite ${if (isFavorite) "added" else "removed"} for ${item.title}")
                
                // Update product detail view model if that product is currently viewed
                val productDetailViewModel = androidx.lifecycle.ViewModelProvider(requireActivity()).get(ProductDetailViewModel::class.java)
                productDetailViewModel.product.value?.let { product ->
                    if (product.id == item.id) {
                        val updatedProduct = product.copy(is_favorite = isFavorite)
                        productDetailViewModel.updateProductFavorite(updatedProduct)
                    }
                }
            },
            onError = { error ->
                // Revert optimistic update on error
                productAdapter.updateFavoriteStatus(item.id, item.isFavorite)
                updateDebugInfo("Favorite error: $error")
                Toast.makeText(context, "Error updating favorite: $error", Toast.LENGTH_SHORT).show()
            }
        )
    }
    
    private fun updateDebugInfo(message: String) {
        _binding?.debugInfo?.text = "Debug: $message"
    }

    override fun onPause() {
        super.onPause()
        // Save scroll position when fragment is paused
        _binding?.recyclerView?.layoutManager?.let { layoutManager ->
            if (layoutManager is GridLayoutManager) {
                catalogViewModel.setScrollPosition(layoutManager.findLastVisibleItemPosition())
            }
        }
    }

    override fun onDestroyView() {
        // Stop all skeleton animations
        if (::skeletonAdapter.isInitialized) {
            skeletonAdapter.stopAllAnimations()
        }
        super.onDestroyView()
        // Save scroll position before destroying view
        _binding?.recyclerView?.layoutManager?.let { layoutManager ->
            if (layoutManager is GridLayoutManager) {
                catalogViewModel.setScrollPosition(layoutManager.findLastVisibleItemPosition())
            }
        }
        _binding = null
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/CatalogViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.example.driverrewards.network.CatalogService
import kotlinx.coroutines.launch

class CatalogViewModel : ViewModel() {

    private val catalogService = CatalogService()
    
    private val _products = MutableLiveData<List<ProductItem>>()
    val products: LiveData<List<ProductItem>> = _products
    
    private val _loading = MutableLiveData<Boolean>()
    val loading: LiveData<Boolean> = _loading
    
    private val _error = MutableLiveData<String?>()
    val error: LiveData<String?> = _error
    
    // Caching state
    private var cachedProducts: List<ProductItem> = emptyList()
    private var cachedSearchQuery: String? = null
    private var cachedSort: String = "best_match"
    private var cachedMinPoints: Float? = null
    private var cachedMaxPoints: Float? = null
    private var cachedFavoritesOnly: Boolean = false
    private var cachedPage: Int = 1
    private var cachedHasMoreData: Boolean = false
    private var isDataCached: Boolean = false
    private var scrollPosition: Int = 0
    
    // Navigation state
    private var currentProductItemId: String? = null

    fun testConnectivity(
        onSuccess: (String) -> Unit,
        onError: (String) -> Unit
    ) {
        viewModelScope.launch {
            try {
                _loading.value = true
                _error.value = null
                
                val response = catalogService.testConnectivity()
                
                if (response.success) {
                    val message = "Connectivity test successful: ${response.message}"
                    _error.value = null
                    onSuccess(message)
                } else {
                    val errorMessage = "Connectivity test failed: ${response.message}"
                    _error.value = errorMessage
                    onError(errorMessage)
                }
                
            } catch (e: Exception) {
                val errorMessage = "Connectivity test error: ${e.message ?: "Unknown error"}"
                _error.value = errorMessage
                onError(errorMessage)
            } finally {
                _loading.value = false
            }
        }
    }

    fun loadCatalogData(
        page: Int = 1,
        searchQuery: String? = null,
        sort: String = "best_match",
        categories: List<String>? = null,
        minPoints: Float? = null,
        maxPoints: Float? = null,
        favoritesOnly: Boolean = false,
        onSuccess: (List<ProductItem>, Boolean) -> Unit,
        onError: (String) -> Unit
    ) {
        android.util.Log.d("CatalogViewModel", "===== loadCatalogData() CALLED =====")
        android.util.Log.d("CatalogViewModel", "page: $page, minPoints: $minPoints, maxPoints: $maxPoints")
        
        // Check if data is cached for the same parameters (only for page 1)
        if (page == 1 && isDataCached && 
            cachedSearchQuery == searchQuery && 
            cachedSort == sort && 
            cachedMinPoints == minPoints && 
            cachedMaxPoints == maxPoints && 
            cachedFavoritesOnly == favoritesOnly) {
            android.util.Log.d("CatalogViewModel", "Using cached data")
            _products.value = cachedProducts
            onSuccess(cachedProducts, cachedHasMoreData)
            return
        }
        
        viewModelScope.launch {
            try {
                _loading.value = true
                _error.value = null
                
                val response = catalogService.getCatalogData(
                    page = page,
                    searchQuery = searchQuery,
                    sort = sort,
                    categories = categories,
                    minPoints = minPoints,
                    maxPoints = maxPoints,
                    favoritesOnly = favoritesOnly
                )
                
                if (response.success) {
                    val items = response.items.map { itemData ->
                        ProductItem(
                            id = itemData.id ?: "",
                            title = itemData.title ?: "Unknown Product",
                            points = itemData.points?.toInt() ?: 0,
                            imageUrl = itemData.image,
                            availability = itemData.availability ?: "IN_STOCK",
                            isFavorite = itemData.isFavorite ?: false,
                            isPinned = itemData.isPinned ?: false
                        )
                    }
                    
                    // Cache data only for page 1
                    if (page == 1) {
                        cachedProducts = items
                        cachedSearchQuery = searchQuery
                        cachedSort = sort
                        cachedMinPoints = minPoints
                        cachedMaxPoints = maxPoints
                        cachedFavoritesOnly = favoritesOnly
                        cachedPage = page
                        cachedHasMoreData = response.has_more
                        isDataCached = true
                    }
                    
                    _products.value = items
                    onSuccess(items, response.has_more)
                } else {
                    val errorMessage = response.message ?: "Failed to load catalog"
                    _error.value = errorMessage
                    onError(errorMessage)
                }
                
            } catch (e: Exception) {
                val errorMessage = "Network error: ${e.message ?: "Unknown error"}"
                _error.value = errorMessage
                onError(errorMessage)
            } finally {
                _loading.value = false
            }
        }
    }
    
    fun refreshCatalogData() {
        // Clear cache to force fresh fetch
        isDataCached = false
        cachedProducts = emptyList()
        cachedSearchQuery = null
        cachedSort = "best_match"
        cachedMinPoints = null
        cachedMaxPoints = null
        cachedFavoritesOnly = false
        cachedPage = 1
        cachedHasMoreData = false
    }
    
    fun getCachedProducts(): List<ProductItem> = cachedProducts
    
    fun getScrollPosition(): Int = scrollPosition
    
    fun setScrollPosition(position: Int) {
        scrollPosition = position
    }
    
    fun getCurrentProductItemId(): String? = currentProductItemId
    
    fun setCurrentProductItemId(itemId: String?) {
        currentProductItemId = itemId
    }
    
    fun getCachedFilterState(): FilterState {
        return FilterState(
            searchQuery = cachedSearchQuery,
            sort = cachedSort,
            minPoints = cachedMinPoints,
            maxPoints = cachedMaxPoints,
            favoritesOnly = cachedFavoritesOnly,
            currentPage = cachedPage,
            hasMoreData = cachedHasMoreData
        )
    }
    
    data class FilterState(
        val searchQuery: String?,
        val sort: String,
        val minPoints: Float?,
        val maxPoints: Float?,
        val favoritesOnly: Boolean,
        val currentPage: Int,
        val hasMoreData: Boolean
    )
    
    fun toggleFavorite(
        itemId: String,
        isCurrentlyFavorite: Boolean,
        onSuccess: (Boolean) -> Unit,
        onError: (String) -> Unit
    ) {
        // Optimistically update cached products immediately
        val newFavoriteState = !isCurrentlyFavorite
        _products.value?.let { products ->
            val updatedProducts = products.map { item ->
                if (item.id == itemId) {
                    item.copy(isFavorite = newFavoriteState)
                } else {
                    item
                }
            }
            _products.value = updatedProducts
            // Update cached products if cache matches
            if (isDataCached) {
                cachedProducts = updatedProducts
            }
        }
        
        viewModelScope.launch {
            try {
                val response = if (isCurrentlyFavorite) {
                    catalogService.removeFavorite(itemId)
                } else {
                    catalogService.addFavorite(itemId)
                }
                
                if (response.success) {
                    onSuccess(newFavoriteState)
                } else {
                    // Revert optimistic update on error
                    _products.value?.let { products ->
                        val revertedProducts = products.map { item ->
                            if (item.id == itemId) {
                                item.copy(isFavorite = isCurrentlyFavorite)
                            } else {
                                item
                            }
                        }
                        _products.value = revertedProducts
                        if (isDataCached) {
                            cachedProducts = revertedProducts
                        }
                    }
                    onError(response.message ?: "Failed to update favorite")
                }
                
            } catch (e: Exception) {
                // Revert optimistic update on error
                _products.value?.let { products ->
                    val revertedProducts = products.map { item ->
                        if (item.id == itemId) {
                            item.copy(isFavorite = isCurrentlyFavorite)
                        } else {
                            item
                        }
                    }
                    _products.value = revertedProducts
                    if (isDataCached) {
                        cachedProducts = revertedProducts
                    }
                }
                onError("Network error: ${e.message}")
            }
        }
    }
    
    fun updateFavoriteInCache(itemId: String, isFavorite: Boolean) {
        // Update favorite status in cached products
        _products.value?.let { products ->
            val updatedProducts = products.map { item ->
                if (item.id == itemId) {
                    item.copy(isFavorite = isFavorite)
                } else {
                    item
                }
            }
            _products.value = updatedProducts
            if (isDataCached) {
                cachedProducts = updatedProducts
            }
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/FavoriteParticleAnimation.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import android.animation.Animator
import android.animation.AnimatorListenerAdapter
import android.animation.ValueAnimator
import android.graphics.Canvas
import android.graphics.Paint
import android.view.View
import android.view.ViewGroup
import kotlin.math.cos
import kotlin.math.sin
import kotlin.random.Random

class FavoriteParticleAnimation {
    
    companion object {
        fun animateFavorite(view: View, isFavoriting: Boolean) {
            val parent = view.parent as? ViewGroup ?: return
            
            // Get view position relative to parent
            val viewBounds = android.graphics.Rect()
            view.getHitRect(viewBounds)
            
            val particleView = ParticleAnimationView(view.context, isFavoriting)
            
            // Calculate center position relative to parent
            val centerX = viewBounds.left + viewBounds.width() / 2f
            val centerY = viewBounds.top + viewBounds.height() / 2f
            
            // Add particle view to parent, positioned to match parent coordinates
            val layoutParams = ViewGroup.LayoutParams(
                ViewGroup.LayoutParams.MATCH_PARENT,
                ViewGroup.LayoutParams.MATCH_PARENT
            )
            parent.addView(particleView, layoutParams)
            particleView.setCenterPosition(centerX, centerY)
            
            // Animate particles
            val animator = ValueAnimator.ofFloat(0f, 1f)
            animator.duration = 600
            animator.addUpdateListener { animation ->
                val progress = animation.animatedValue as Float
                particleView.updateParticles(progress)
            }
            animator.addListener(object : AnimatorListenerAdapter() {
                override fun onAnimationEnd(animation: Animator) {
                    parent.removeView(particleView)
                }
            })
            animator.start()
        }
    }
    
    private class ParticleAnimationView(
        context: android.content.Context,
        private val isFavoriting: Boolean
    ) : View(context) {
        
        private val particles = mutableListOf<Particle>()
        private val paint = Paint(Paint.ANTI_ALIAS_FLAG).apply {
            style = Paint.Style.FILL
        }
        
        private var centerX: Float = 0f
        private var centerY: Float = 0f
        
        init {
            // Make view transparent and non-interactive
            setBackgroundColor(android.graphics.Color.TRANSPARENT)
            isClickable = false
            isFocusable = false
            
            // Create 15-20 particles
            repeat(18) {
                val angle = (360 / 18 * it + Random.nextInt(-10, 10)) * Math.PI / 180
                val speed = 150f + Random.nextFloat() * 100f
                val size = 4f + Random.nextFloat() * 4f
                
                particles.add(
                    Particle(
                        angle = angle,
                        speed = speed,
                        size = size,
                        startX = 0f,
                        startY = 0f
                    )
                )
            }
        }
        
        fun setCenterPosition(x: Float, y: Float) {
            centerX = x
            centerY = y
        }
        
        fun updateParticles(progress: Float) {
            particles.forEach { particle ->
                val distance = particle.speed * progress
                particle.x = centerX + cos(particle.angle).toFloat() * distance
                particle.y = centerY + sin(particle.angle).toFloat() * distance
                particle.alpha = (1f - progress) * 255f
            }
            invalidate()
        }
        
        override fun onTouchEvent(event: android.view.MotionEvent?): Boolean {
            // Don't intercept touch events - let them pass through
            return false
        }
        
        override fun onDraw(canvas: Canvas) {
            super.onDraw(canvas)
            
            particles.forEach { particle ->
                val color = if (isFavoriting) {
                    // Red/pink gradient for favoriting
                    android.graphics.Color.rgb(
                        (255 - (particle.alpha * 0.3).toInt()).coerceIn(200, 255),
                        (50 + particle.alpha * 0.2).toInt().coerceIn(50, 100),
                        (50 + particle.alpha * 0.2).toInt().coerceIn(50, 100)
                    )
                } else {
                    // Gray for unfavoriting
                    android.graphics.Color.rgb(
                        (128 - particle.alpha * 0.3).toInt().coerceIn(100, 128),
                        (128 - particle.alpha * 0.3).toInt().coerceIn(100, 128),
                        (128 - particle.alpha * 0.3).toInt().coerceIn(100, 128)
                    )
                }
                
                paint.color = color
                paint.alpha = particle.alpha.toInt()
                canvas.drawCircle(particle.x, particle.y, particle.size, paint)
            }
        }
        
        private data class Particle(
            val angle: Double,
            val speed: Float,
            val size: Float,
            var x: Float = 0f,
            var y: Float = 0f,
            var alpha: Float = 255f,
            var startX: Float,
            var startY: Float
        )
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/ProductAdapter.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.ImageView
import android.widget.TextView
import androidx.recyclerview.widget.RecyclerView
import com.bumptech.glide.Glide
import com.example.driverrewards.R

class ProductAdapter(
    private val onItemClick: (ProductItem) -> Unit,
    private val onFavoriteClick: (ProductItem) -> Unit
) : RecyclerView.Adapter<ProductAdapter.ProductViewHolder>() {

    private var items = mutableListOf<ProductItem>()

    fun updateItems(newItems: List<ProductItem>) {
        items.clear()
        items.addAll(newItems)
        notifyDataSetChanged()
    }

    fun addItems(newItems: List<ProductItem>) {
        val startPosition = items.size
        items.addAll(newItems)
        notifyItemRangeInserted(startPosition, newItems.size)
    }

    fun updateFavoriteStatus(itemId: String, isFavorite: Boolean) {
        val index = items.indexOfFirst { it.id == itemId }
        if (index != -1) {
            items[index] = items[index].copy(isFavorite = isFavorite)
            notifyItemChanged(index)
        }
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ProductViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_product_card, parent, false)
        return ProductViewHolder(view)
    }

    override fun onBindViewHolder(holder: ProductViewHolder, position: Int) {
        holder.bind(items[position])
    }

    override fun getItemCount(): Int = items.size

    inner class ProductViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        private val imageView: ImageView = itemView.findViewById(R.id.product_image)
        private val titleView: TextView = itemView.findViewById(R.id.product_title)
        private val pointsView: TextView = itemView.findViewById(R.id.product_points)
        private val favoriteButton: ImageView = itemView.findViewById(R.id.favorite_button)
        private val pinnedBadge: View = itemView.findViewById(R.id.pinned_badge)
        private val availabilityStatus: TextView = itemView.findViewById(R.id.availability_status)

        fun bind(item: ProductItem) {
            titleView.text = item.title
            pointsView.text = "${item.points} pts"

            // Load image with Glide
            if (!item.imageUrl.isNullOrEmpty()) {
                Glide.with(itemView.context)
                    .load(item.imageUrl)
                    .placeholder(R.drawable.ic_catalog) // Default placeholder
                    .error(R.drawable.ic_catalog) // Error placeholder
                    .into(imageView)
            } else {
                imageView.setImageResource(R.drawable.ic_catalog)
            }

            // Update favorite button - red when favorited, white with black outline when not
            if (item.isFavorite) {
                favoriteButton.setImageResource(R.drawable.ic_favorite_filled)
                // No tinting needed - drawable already has red fill and black outline
                favoriteButton.clearColorFilter()
                favoriteButton.imageTintList = null
            } else {
                favoriteButton.setImageResource(R.drawable.ic_favorite_border)
                // White fill with black outline - drawable already has this
                favoriteButton.clearColorFilter()
                favoriteButton.imageTintList = null
            }

            // Show/hide pinned badge
            pinnedBadge.visibility = if (item.isPinned) View.VISIBLE else View.GONE

            // Set availability status
            when (item.availability) {
                "OUT_OF_STOCK" -> {
                    availabilityStatus.text = "OUT OF STOCK"
                    availabilityStatus.setTextColor(0xFFFF4444.toInt()) // Red
                }
                "LIMITED" -> {
                    availabilityStatus.text = "LIMITED"
                    availabilityStatus.setTextColor(0xFFFF8800.toInt()) // Orange
                }
                else -> {
                    availabilityStatus.text = "IN STOCK"
                    availabilityStatus.setTextColor(0xFF00AA00.toInt()) // Green
                }
            }

            // Set click listeners
            itemView.setOnClickListener { onItemClick(item) }
            favoriteButton.setOnClickListener { 
                // Add particle animation
                FavoriteParticleAnimation.animateFavorite(favoriteButton, !item.isFavorite)
                // Add scale animation
                favoriteButton.animate()
                    .scaleX(1.3f)
                    .scaleY(1.3f)
                    .setDuration(150)
                    .withEndAction {
                        favoriteButton.animate()
                            .scaleX(1f)
                            .scaleY(1f)
                            .setDuration(150)
                            .start()
                    }
                    .start()
                onFavoriteClick(item) 
            }
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/ProductDetailFragment.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.ArrayAdapter
import android.widget.Spinner
import android.widget.TextView
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.LinearLayoutManager
import androidx.recyclerview.widget.RecyclerView
import com.bumptech.glide.Glide
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentProductDetailBinding
import com.example.driverrewards.network.ProductDetail
import com.example.driverrewards.network.RelatedProduct
import com.example.driverrewards.network.VariationDetail

class ProductDetailFragment : Fragment() {

    private var _binding: FragmentProductDetailBinding? = null
    private val binding get() = _binding!!
    private lateinit var viewModel: ProductDetailViewModel
    private lateinit var thumbnailAdapter: ThumbnailAdapter
    private lateinit var itemSpecsAdapter: ItemSpecsAdapter
    private lateinit var relatedProductsAdapter: RelatedProductAdapter

    private var lastProcessedItemId: String? = null
    private var lastProcessedVariationInfo: String? = null
    
    override fun onResume() {
        super.onResume()
        // Handle fragment reuse - check if arguments changed
        val currentItemId = arguments?.getString("itemId") ?: ""
        val currentVariationInfo = arguments?.getString("variationInfo")
        
        if (currentItemId != lastProcessedItemId || currentVariationInfo != lastProcessedVariationInfo) {
            android.util.Log.d("ProductDetailFragment", "onResume - Arguments changed, re-processing")
            android.util.Log.d("ProductDetailFragment", "Current itemId: '$currentItemId', variationInfo: '$currentVariationInfo'")
            android.util.Log.d("ProductDetailFragment", "Previous itemId: '$lastProcessedItemId', variationInfo: '$lastProcessedVariationInfo'")
            
            // Re-process variation info
            if (!currentVariationInfo.isNullOrEmpty()) {
                val variationMap = try {
                    currentVariationInfo.split("|").associate { part ->
                        val parts = part.split(":", limit = 2)
                        if (parts.size == 2) {
                            parts[0] to parts[1]
                        } else {
                            "" to ""
                        }
                    }.filter { it.key.isNotEmpty() }
                } catch (e: Exception) {
                    android.util.Log.e("ProductDetailFragment", "Error parsing variation info in onResume: ${e.message}", e)
                    emptyMap()
                }
                
                if (variationMap.isNotEmpty()) {
                    android.util.Log.d("ProductDetailFragment", "Re-storing variationMap in onResume: $variationMap")
                    pendingVariationRestore = variationMap
                    
                    // Try to restore immediately if spinners are ready
                    if (variantSpinners.isNotEmpty()) {
                        binding.root.postDelayed({
                            if (variantSpinners.isNotEmpty() && pendingVariationRestore != null) {
                                android.util.Log.d("ProductDetailFragment", "Restoring variations in onResume - spinners ready")
                                restoreVariationSelections(pendingVariationRestore!!)
                                pendingVariationRestore = null
                            }
                        }, 100)
                    }
                }
            }
            
            lastProcessedItemId = currentItemId
            lastProcessedVariationInfo = currentVariationInfo
        }
    }
    
    override fun onPause() {
        super.onPause()
        // Clear pending variation restore when navigating away to prevent stale state
        // This ensures each navigation starts fresh
        pendingVariationRestore = null
    }
    
    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        _binding = FragmentProductDetailBinding.inflate(inflater, container, false)
        val root: View = binding.root

        viewModel = ViewModelProvider(requireActivity())[ProductDetailViewModel::class.java]

        setupRecyclerViews()
        
        // Parse variation info FIRST before setting up observers (to avoid race conditions)
        val rawItemId = arguments?.getString("itemId") ?: ""
        val rawVariationInfo = arguments?.getString("variationInfo")
        
        android.util.Log.d("ProductDetailFragment", "=== onCreateView START ===")
        android.util.Log.d("ProductDetailFragment", "Raw arguments - itemId: '$rawItemId', variationInfo: '$rawVariationInfo'")
        android.util.Log.d("ProductDetailFragment", "All argument keys: ${arguments?.keySet()?.joinToString()}")
        android.util.Log.d("ProductDetailFragment", "All argument values: ${arguments?.keySet()?.associateWith { arguments?.get(it) }}")
        
        // Check if itemId contains variation info (shouldn't happen, but handle it defensively)
        val itemId: String
        val variationInfo: String?
        
        if (rawItemId.contains("::") && rawVariationInfo.isNullOrEmpty()) {
            // itemId contains variation info but variationInfo is null - extract it
            android.util.Log.w("ProductDetailFragment", "WARNING: itemId contains '::' but variationInfo is null! Extracting from itemId")
            itemId = rawItemId.substringBefore("::")
            variationInfo = rawItemId.substringAfter("::")
            android.util.Log.d("ProductDetailFragment", "Extracted - itemId: '$itemId', variationInfo: '$variationInfo'")
        } else {
            itemId = rawItemId
            variationInfo = rawVariationInfo
            android.util.Log.d("ProductDetailFragment", "Using raw arguments - itemId: '$itemId', variationInfo: '$variationInfo'")
        }
        
        android.util.Log.d("ProductDetailFragment", "Final values - itemId: '$itemId', variationInfo: '$variationInfo'")
        android.util.Log.d("ProductDetailFragment", "Previous itemId: '$lastProcessedItemId', previous variationInfo: '$lastProcessedVariationInfo'")
        
        // Check if this is a new navigation (different arguments)
        val isNewNavigation = itemId != lastProcessedItemId || variationInfo != lastProcessedVariationInfo
        if (isNewNavigation) {
            android.util.Log.d("ProductDetailFragment", "New navigation detected - clearing previous state and processing new arguments")
            // Clear previous state
            pendingVariationRestore = null
            lastProcessedItemId = itemId
            lastProcessedVariationInfo = variationInfo
        }
        
        // Parse variation info if provided (needed for both restoration and cache clearing)
        val variationMap = if (!variationInfo.isNullOrEmpty()) {
            android.util.Log.d("ProductDetailFragment", "Parsing variationInfo: '$variationInfo'")
            try {
                val parsed = variationInfo.split("|").associate { part ->
                    val parts = part.split(":", limit = 2)
                    if (parts.size == 2) {
                        parts[0] to parts[1]
                    } else {
                        "" to ""
                    }
                }.filter { it.key.isNotEmpty() }
                android.util.Log.d("ProductDetailFragment", "Parsed variationMap: $parsed")
                parsed
            } catch (e: Exception) {
                android.util.Log.e("ProductDetailFragment", "Error parsing variation info: ${e.message}", e)
                emptyMap()
            }
        } else {
            android.util.Log.d("ProductDetailFragment", "No variationInfo provided, variationMap is empty")
            emptyMap()
        }
        
        // If variation info is provided, store for restoration BEFORE observers are set up
        if (variationMap.isNotEmpty()) {
            android.util.Log.d("ProductDetailFragment", "Storing variationMap for restoration BEFORE observers: $variationMap")
            android.util.Log.d("ProductDetailFragment", "variationMap keys: ${variationMap.keys}, values: ${variationMap.values}")
            pendingVariationRestore = variationMap
        } else {
            // Clear any pending restoration if no variation info provided
            if (isNewNavigation) {
                android.util.Log.d("ProductDetailFragment", "No variation info in new navigation, clearing pendingVariationRestore")
                pendingVariationRestore = null
            }
        }
        
        // Now set up observers (variation info is already parsed)
        setupObservers()
        setupClickListeners()
        
        // Load product details
        if (itemId.isNotEmpty()) {
            // Ensure we only use the base item ID (remove any variation suffix if somehow present)
            val baseItemId = if (itemId.contains("::")) {
                val extracted = itemId.substringBefore("::")
                android.util.Log.w("ProductDetailFragment", "Warning: itemId contained '::', extracted base: '$extracted'")
                extracted
            } else {
                itemId
            }
            
            android.util.Log.d("ProductDetailFragment", "Loading product detail for baseItemId: '$baseItemId'")
            
            // If we have variation info from navigation arguments, clear any cached variant selections
            // so our navigation arguments take precedence over cached selections
            if (variationMap.isNotEmpty()) {
                android.util.Log.d("ProductDetailFragment", "=== CLEARING CACHE AND STATE ===")
                android.util.Log.d("ProductDetailFragment", "Clearing cached variant selections for baseItemId: '$baseItemId' to allow navigation arguments to take precedence")
                android.util.Log.d("ProductDetailFragment", "variationMap before clearing: $variationMap")
                viewModel.clearCachedVariantSelections(baseItemId)
                android.util.Log.d("ProductDetailFragment", "Cached selections cleared")
                // Also clear current ViewModel state to ensure clean slate
                viewModel.clearVariantSelection()
                android.util.Log.d("ProductDetailFragment", "ViewModel state cleared")
                android.util.Log.d("ProductDetailFragment", "Calling loadProductDetail with skipCachedSelections = true")
                // Load product detail but skip restoring cached selections
                viewModel.loadProductDetail(baseItemId, skipCachedSelections = true)
            } else {
                android.util.Log.d("ProductDetailFragment", "No variationMap, calling loadProductDetail normally (will restore cached selections if available)")
                // Normal load without skipping cached selections
                viewModel.loadProductDetail(baseItemId)
            }
        } else {
            Toast.makeText(requireContext(), "Invalid product ID", Toast.LENGTH_SHORT).show()
            findNavController().navigateUp()
        }

        return root
    }

    private fun setupRecyclerViews() {
        // Thumbnail adapter
        thumbnailAdapter = ThumbnailAdapter { imageUrl ->
            loadMainImage(imageUrl)
        }
        binding.thumbnailRecyclerView.layoutManager = LinearLayoutManager(requireContext(), LinearLayoutManager.HORIZONTAL, false)
        binding.thumbnailRecyclerView.adapter = thumbnailAdapter

        // Item specs adapter
        itemSpecsAdapter = ItemSpecsAdapter()
        binding.itemSpecificsRecyclerView.layoutManager = LinearLayoutManager(requireContext())
        binding.itemSpecificsRecyclerView.adapter = itemSpecsAdapter

        // Related products adapter
        relatedProductsAdapter = RelatedProductAdapter { relatedProduct ->
            navigateToProductDetail(relatedProduct.id ?: "")
        }
        binding.relatedProductsRecyclerView.layoutManager = LinearLayoutManager(requireContext(), LinearLayoutManager.HORIZONTAL, false)
        binding.relatedProductsRecyclerView.adapter = relatedProductsAdapter
    }

    private fun setupObservers() {
        viewModel.product.observe(viewLifecycleOwner) { product ->
            product?.let {
                android.util.Log.d("ProductDetailFragment", "=== PRODUCT OBSERVER FIRED ===")
                android.util.Log.d("ProductDetailFragment", "Product loaded - id: '${it.id}', title: '${it.title}'")
                android.util.Log.d("ProductDetailFragment", "pendingVariationRestore: $pendingVariationRestore")
                android.util.Log.d("ProductDetailFragment", "variantSpinners size: ${variantSpinners.size}, keys: ${variantSpinners.keys}")
                android.util.Log.d("ProductDetailFragment", "ViewModel variantSelections: ${viewModel.variantSelections.value}")
                android.util.Log.d("ProductDetailFragment", "ViewModel selectedVariation: ${viewModel.selectedVariation.value?.variants}")
                displayProduct(it)
                
                // Try to restore variations after displayProduct sets up the spinners
                // This handles cases where pendingVariationRestore was set before product loaded
                // setupVariants is called from displayProduct, which will also try to restore
                // But if setupVariants hasn't run yet, wait a bit and try again
                if (pendingVariationRestore != null) {
                    android.util.Log.d("ProductDetailFragment", "Pending variation restore detected in observer, attempting restoration")
                    // Try immediate restoration if spinners are ready
                    if (variantSpinners.isNotEmpty()) {
                        android.util.Log.d("ProductDetailFragment", "Spinners already ready, restoring immediately")
                        binding.root.post {
                            if (variantSpinners.isNotEmpty() && pendingVariationRestore != null) {
                                restoreVariationSelections(pendingVariationRestore!!)
                                pendingVariationRestore = null
                            }
                        }
                    } else {
                        // Spinners not ready yet, wait for setupVariants
                        binding.root.postDelayed({
                            if (variantSpinners.isNotEmpty() && pendingVariationRestore != null) {
                                android.util.Log.d("ProductDetailFragment", "Restoring variations after displayProduct from setupObservers (delayed): $pendingVariationRestore")
                                restoreVariationSelections(pendingVariationRestore!!)
                                pendingVariationRestore = null
                            } else if (pendingVariationRestore != null) {
                                android.util.Log.w("ProductDetailFragment", "Variation restoration failed - spinners still not ready after delay")
                            }
                        }, 300) // Increased delay to ensure setupVariants has completed
                    }
                } else {
                    android.util.Log.d("ProductDetailFragment", "No pending variation restore in observer")
                }
                // Update favorite button state
                val isFavorite = it.is_favorite ?: false
                binding.favoriteButton.text = if (isFavorite) "Remove from Favorites" else "Add to Favorites"
                if (isFavorite) {
                    binding.favoriteButton.setIconResource(R.drawable.ic_favorite_filled)
                    binding.favoriteButton.iconTint = android.content.res.ColorStateList.valueOf(0xFFFF4444.toInt())
                } else {
                    binding.favoriteButton.setIconResource(R.drawable.ic_favorite_border)
                    binding.favoriteButton.iconTint = android.content.res.ColorStateList.valueOf(0xFF808080.toInt())
                }
            }
        }

        viewModel.relatedProducts.observe(viewLifecycleOwner) { products ->
            if (products.isNotEmpty()) {
                binding.relatedProductsLabel.visibility = View.VISIBLE
                binding.relatedProductsRecyclerView.visibility = View.VISIBLE
                relatedProductsAdapter.updateItems(products)
            }
        }

        viewModel.loading.observe(viewLifecycleOwner) { isLoading ->
            updateLoadingState(isLoading)
        }

        viewModel.error.observe(viewLifecycleOwner) { error ->
            error?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_LONG).show()
            }
        }

        viewModel.selectedVariation.observe(viewLifecycleOwner) { variation ->
            variation?.let {
                updateDisplayForVariation(it)
            } ?: run {
                // Reset to base product
                viewModel.product.value?.let { product ->
                    updateDisplayForBaseProduct(product)
                }
            }
        }
    }

    private fun setupClickListeners() {
        binding.favoriteButton.setOnClickListener {
            viewModel.product.value?.let { product ->
                val itemId = product.id ?: return@let
                val isFavorite = product.is_favorite ?: false
                
                // Add particle animation
                FavoriteParticleAnimation.animateFavorite(binding.favoriteButton, !isFavorite)
                
                // Add scale animation
                binding.favoriteButton.animate()
                    .scaleX(1.2f)
                    .scaleY(1.2f)
                    .setDuration(150)
                    .withEndAction {
                        binding.favoriteButton.animate()
                            .scaleX(1f)
                            .scaleY(1f)
                            .setDuration(150)
                            .start()
                    }
                    .start()
                
                // Add haptic feedback
                binding.favoriteButton.performHapticFeedback(android.view.HapticFeedbackConstants.LONG_PRESS)
                
                // Update catalog view model when toggling favorite
                val catalogViewModel = androidx.lifecycle.ViewModelProvider(requireActivity()).get(CatalogViewModel::class.java)
                viewModel.toggleFavorite(itemId, isFavorite) { newFavoriteState ->
                    // Sync with catalog view model
                    catalogViewModel.updateFavoriteInCache(itemId, newFavoriteState)
                }
            }
        }

        binding.addToCartButton.setOnClickListener {
            viewModel.product.value?.let { product ->
                val itemId = product.id ?: return@let
                val title = product.title ?: "Unknown Product"
                val imageUrl = product.image ?: ""
                val itemUrl = product.url ?: ""
                val points = product.points?.toInt() ?: 0
                
                // Check if product has variations that require selection
                val hasVariations = !product.variation_details.isNullOrEmpty()
                val cartViewModel = androidx.lifecycle.ViewModelProvider(requireActivity()).get(com.example.driverrewards.ui.cart.CartViewModel::class.java)
                
                if (hasVariations) {
                    val selectedVariation = viewModel.selectedVariation.value
                    if (selectedVariation == null) {
                        Toast.makeText(requireContext(), "Please select a variation before adding to cart", Toast.LENGTH_SHORT).show()
                        return@let
                    }
                    
                    // Build variation ID string for unique cart item
                    // Sort entries by key to ensure consistent ordering for duplicate detection
                    val variantSelections = viewModel.variantSelections.value ?: emptyMap()
                    val variationId = variantSelections.entries
                        .sortedBy { it.key }  // Sort by key to ensure consistent order
                        .joinToString("|") { "${it.key}:${it.value}" }
                    val uniqueItemId = "${itemId}::${variationId}"
                    android.util.Log.d("ProductDetailFragment", "Adding to cart - uniqueItemId: '$uniqueItemId'")
                    
                    val finalPoints = selectedVariation.price?.let { 
                        // Variation price is in dollars, convert to points (multiply by 100, default rate)
                        // Then round to nearest 10 points (matching backend price_to_points behavior)
                        val rawPoints = it * 100.0
                        (kotlin.math.round(rawPoints / 10.0) * 10.0).toInt()
                    } ?: points
                    val variationImage = selectedVariation.image ?: imageUrl
                    
                    // Get CartViewModel and add to cart with variation
                    cartViewModel.addToCart(uniqueItemId, title, variationImage, itemUrl, finalPoints, 1)
                } else {
                    // No variations, add as normal
                    if (points <= 0) {
                        Toast.makeText(requireContext(), "Invalid product points", Toast.LENGTH_SHORT).show()
                        return@let
                    }
                    
                    // Get CartViewModel and add to cart
                    cartViewModel.addToCart(itemId, title, imageUrl, itemUrl, points, 1)
                }
                
                // Observe success (shared for both paths)
                cartViewModel.addToCartSuccess.observe(viewLifecycleOwner) { success ->
                    if (success == true) {
                        Toast.makeText(requireContext(), "Added to cart!", Toast.LENGTH_SHORT).show()
                        cartViewModel.clearAddToCartSuccess()
                    }
                }
                
                // Observe errors (shared for both paths)
                cartViewModel.errorMessage.observe(viewLifecycleOwner) { error ->
                    error?.let {
                        if (it.contains("cart", ignoreCase = true)) {
                            Toast.makeText(requireContext(), it, Toast.LENGTH_SHORT).show()
                            cartViewModel.clearError()
                        }
                    }
                }
            }
        }
    }

    private fun displayProduct(product: ProductDetail) {
        // Ensure skeleton is hidden when product is displayed
        binding.skeletonImage.visibility = View.GONE
        binding.skeletonDetailsRow1.visibility = View.GONE
        binding.skeletonDetailsRow2.visibility = View.GONE
        binding.skeletonDetailsRow3.visibility = View.GONE
        
        // Show content elements
        binding.productTitle.visibility = View.VISIBLE
        binding.productPoints.visibility = View.VISIBLE
        
        // Title
        binding.productTitle.text = product.title ?: "Unknown Product"

        // Subtitle
        product.subtitle?.let {
            binding.productSubtitle.text = it
            binding.productSubtitle.visibility = View.VISIBLE
        } ?: run {
            binding.productSubtitle.visibility = View.GONE
        }

        // Points
        binding.productPoints.text = product.display_points ?: "${product.points?.toInt() ?: 0} pts"

        // Brand
        product.brand?.let {
            binding.productBrand.text = "Brand: $it"
            binding.productBrand.visibility = View.VISIBLE
        } ?: run {
            binding.productBrand.visibility = View.GONE
        }

        // Condition
        product.condition?.let {
            binding.productCondition.text = "Condition: $it"
            binding.productCondition.visibility = View.VISIBLE
        } ?: run {
            binding.productCondition.visibility = View.GONE
        }

        // Description
        product.subtitle?.let {
            binding.descriptionLabel.visibility = View.VISIBLE
            binding.productDescription.text = it
            binding.productDescription.visibility = View.VISIBLE
        } ?: run {
            binding.descriptionLabel.visibility = View.GONE
            binding.productDescription.visibility = View.GONE
        }

        // Main image
        loadMainImage(product.image)

        // Thumbnail gallery
        val allImages = mutableListOf<String>()
        product.image?.let { allImages.add(it) }
        product.additional_images?.let { allImages.addAll(it) }
        if (allImages.size > 1) {
            binding.thumbnailRecyclerView.visibility = View.VISIBLE
            thumbnailAdapter.updateItems(allImages.take(6)) // Limit to 6 thumbnails
        } else {
            binding.thumbnailRecyclerView.visibility = View.GONE
        }

        // Availability badges
        updateAvailabilityBadges(product)

        // Item specifics
        product.item_specifics?.let { specs ->
            if (specs.isNotEmpty()) {
                binding.itemSpecificsLabel.visibility = View.VISIBLE
                binding.itemSpecificsRecyclerView.visibility = View.VISIBLE
                itemSpecsAdapter.updateItems(specs)
            }
        } ?: run {
            binding.itemSpecificsLabel.visibility = View.GONE
            binding.itemSpecificsRecyclerView.visibility = View.GONE
        }

        // Variants
        setupVariants(product)

        // Favorite button with proper color tinting - show it when product is loaded
        binding.favoriteButton.visibility = View.VISIBLE
        val isFavorite = product.is_favorite ?: false
        binding.favoriteButton.text = if (isFavorite) "Remove from Favorites" else "Add to Favorites"
        if (isFavorite) {
            binding.favoriteButton.setIconResource(R.drawable.ic_favorite_filled)
            binding.favoriteButton.iconTint = android.content.res.ColorStateList.valueOf(0xFFFF4444.toInt())
        } else {
            binding.favoriteButton.setIconResource(R.drawable.ic_favorite_border)
            binding.favoriteButton.iconTint = android.content.res.ColorStateList.valueOf(0xFF808080.toInt())
        }

        // Add to cart button visibility
        val points = product.points ?: 0.0
        binding.addToCartButton.visibility = if (points > 0) View.VISIBLE else View.GONE
        
        // Show main image
        binding.mainProductImage.visibility = View.VISIBLE
    }
    
    private fun updateLoadingState(isLoading: Boolean) {
        if (isLoading) {
            // Show skeleton placeholders
            binding.skeletonImage.visibility = View.VISIBLE
            binding.skeletonDetailsRow1.visibility = View.VISIBLE
            binding.skeletonDetailsRow2.visibility = View.VISIBLE
            binding.skeletonDetailsRow3.visibility = View.VISIBLE
            
            // Hide actual content
            binding.mainProductImage.visibility = View.GONE
            binding.productTitle.visibility = View.GONE
            binding.productSubtitle.visibility = View.GONE
            binding.productPoints.visibility = View.GONE
            binding.favoriteButton.visibility = View.GONE
            binding.addToCartButton.visibility = View.GONE
            
            // ShimmerView handles its own animation automatically
        } else {
            // Hide skeleton placeholders
            binding.skeletonImage.visibility = View.GONE
            binding.skeletonDetailsRow1.visibility = View.GONE
            binding.skeletonDetailsRow2.visibility = View.GONE
            binding.skeletonDetailsRow3.visibility = View.GONE
        }
    }

    private var variantSpinners = mutableMapOf<String, Spinner>()
    private var pendingVariationRestore: Map<String, String>? = null
    
    private fun setupVariants(product: ProductDetail) {
        android.util.Log.d("ProductDetailFragment", "=== setupVariants START ===")
        val variantsContainer = binding.variantsContainer
        variantsContainer.removeAllViews()
        variantSpinners.clear()
        android.util.Log.d("ProductDetailFragment", "Cleared variantSpinners, now empty")

        val variants = product.variants ?: run {
            android.util.Log.d("ProductDetailFragment", "Product has no variants, hiding container")
            binding.variantsContainer.visibility = View.GONE
            return
        }
        
        android.util.Log.d("ProductDetailFragment", "Product variants: ${variants.keys}")
        
        if (variants.isEmpty()) {
            android.util.Log.d("ProductDetailFragment", "Variants map is empty, hiding container")
            binding.variantsContainer.visibility = View.GONE
            return
        }

        // Filter variants that have more than one option
        val multiOptionVariants = variants.filter { it.value.size > 1 }
        android.util.Log.d("ProductDetailFragment", "Multi-option variants: ${multiOptionVariants.keys}, options: ${multiOptionVariants.mapValues { it.value.size }}")
        
        if (multiOptionVariants.isEmpty()) {
            android.util.Log.d("ProductDetailFragment", "No multi-option variants, hiding container")
            binding.variantsContainer.visibility = View.GONE
            return
        }

        binding.variantsContainer.visibility = View.VISIBLE
        android.util.Log.d("ProductDetailFragment", "Creating spinners for: ${multiOptionVariants.keys}")

        multiOptionVariants.forEach { (variantType, options) ->
            android.util.Log.d("ProductDetailFragment", "Creating spinner for variantType: '$variantType' with options: $options")
            val label = TextView(requireContext()).apply {
                text = "$variantType: *"
                textSize = 14f
                setPadding(0, 8, 0, 4)
            }
            variantsContainer.addView(label)

            val spinner = Spinner(requireContext()).apply {
                val adapter = ArrayAdapter(requireContext(), android.R.layout.simple_spinner_item, mutableListOf("Choose $variantType").apply { addAll(options) })
                adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item)
                this.adapter = adapter

                onItemSelectedListener = object : android.widget.AdapterView.OnItemSelectedListener {
                    override fun onItemSelected(parent: android.widget.AdapterView<*>?, view: View?, position: Int, id: Long) {
                        if (position > 0) {
                            val selectedValue = options[position - 1]
                            viewModel.selectVariant(variantType, selectedValue)
                        } else {
                            viewModel.selectVariant(variantType, "")
                        }
                    }

                    override fun onNothingSelected(parent: android.widget.AdapterView<*>?) {}
                }
            }
            variantsContainer.addView(spinner)
            variantSpinners[variantType] = spinner
            android.util.Log.d("ProductDetailFragment", "Spinner created and added for '$variantType', total spinners: ${variantSpinners.size}")
        }
        
        android.util.Log.d("ProductDetailFragment", "All spinners created. Total: ${variantSpinners.size}, types: ${variantSpinners.keys}")
        android.util.Log.d("ProductDetailFragment", "pendingVariationRestore: $pendingVariationRestore")
        
        // If there's a pending variation restore, do it now that spinners are created
        pendingVariationRestore?.let { variationMap ->
            android.util.Log.d("ProductDetailFragment", "=== RESTORING VARIATIONS IN setupVariants ===")
            android.util.Log.d("ProductDetailFragment", "Restoring variations after setupVariants (spinners created): $variationMap")
            android.util.Log.d("ProductDetailFragment", "Available spinner types: ${variantSpinners.keys}")
            android.util.Log.d("ProductDetailFragment", "Variation map keys: ${variationMap.keys}")
            // Small delay to ensure spinners are fully initialized
            binding.root.postDelayed({
                if (variantSpinners.isNotEmpty() && pendingVariationRestore != null) {
                    android.util.Log.d("ProductDetailFragment", "Executing variation restoration in setupVariants (postDelayed)")
                    restoreVariationSelections(pendingVariationRestore!!)
                    pendingVariationRestore = null
                } else {
                    android.util.Log.w("ProductDetailFragment", "Variation restoration in setupVariants failed - spinners or variationMap not ready")
                }
            }, 50) // Small delay to ensure spinners are fully initialized
        } ?: run {
            // No pending variation restore - auto-select default variation from item_specifics
            // This applies when opening from catalog/favorites (not from cart)
            android.util.Log.d("ProductDetailFragment", "No pending variation restore - checking for default variation from item_specifics")
            product.item_specifics?.let { itemSpecs ->
                android.util.Log.d("ProductDetailFragment", "Product has item_specifics: $itemSpecs")
                // Build a map of default values from item_specifics for variant types
                val defaultVariationMap = mutableMapOf<String, String>()
                variantSpinners.keys.forEach { variantType ->
                    val defaultValue = itemSpecs[variantType]
                    if (!defaultValue.isNullOrEmpty()) {
                        android.util.Log.d("ProductDetailFragment", "Found default value for '$variantType': '$defaultValue'")
                        defaultVariationMap[variantType] = defaultValue
                    } else {
                        // Try case-insensitive match
                        val caseInsensitiveMatch = itemSpecs.entries.find { 
                            it.key.trim().equals(variantType.trim(), ignoreCase = true) 
                        }
                        caseInsensitiveMatch?.let {
                            android.util.Log.d("ProductDetailFragment", "Found case-insensitive default value for '$variantType': '${it.value}'")
                            defaultVariationMap[variantType] = it.value
                        }
                    }
                }
                
                if (defaultVariationMap.isNotEmpty()) {
                    android.util.Log.d("ProductDetailFragment", "=== AUTO-SELECTING DEFAULT VARIATION ===")
                    android.util.Log.d("ProductDetailFragment", "Default variation map: $defaultVariationMap")
                    // Small delay to ensure spinners are fully initialized
                    binding.root.postDelayed({
                        if (variantSpinners.isNotEmpty()) {
                            android.util.Log.d("ProductDetailFragment", "Executing default variation selection")
                            restoreVariationSelections(defaultVariationMap)
                        }
                    }, 50)
                } else {
                    android.util.Log.d("ProductDetailFragment", "No default variation found in item_specifics for variant types: ${variantSpinners.keys}")
                }
            } ?: run {
                android.util.Log.d("ProductDetailFragment", "Product has no item_specifics, cannot auto-select default variation")
            }
        }
    }
    
    private fun restoreVariationSelections(variationMap: Map<String, String>) {
        android.util.Log.d("ProductDetailFragment", "=== restoreVariationSelections START ===")
        android.util.Log.d("ProductDetailFragment", "restoreVariationSelections called with: $variationMap")
        android.util.Log.d("ProductDetailFragment", "Available spinners: ${variantSpinners.keys}")
        android.util.Log.d("ProductDetailFragment", "Variation map keys: ${variationMap.keys}")
        android.util.Log.d("ProductDetailFragment", "Variation map entries: ${variationMap.entries.map { "${it.key} -> ${it.value}" }}")
        
        if (variantSpinners.isEmpty()) {
            android.util.Log.w("ProductDetailFragment", "No spinners available yet, storing variationMap for later")
            pendingVariationRestore = variationMap
            return
        }
        
        var restoredCount = 0
        variantSpinners.forEach { (variantType, spinner) ->
            android.util.Log.d("ProductDetailFragment", "--- Processing variantType: '$variantType' ---")
            // Try to find matching key in variationMap (handle case/whitespace differences)
            val directMatch = variationMap[variantType]
            val caseInsensitiveMatch = variationMap.entries.find { 
                it.key.trim().equals(variantType.trim(), ignoreCase = true) 
            }?.value
            
            val selectedValue = directMatch ?: caseInsensitiveMatch
            
            android.util.Log.d("ProductDetailFragment", "Direct match for '$variantType': '$directMatch'")
            android.util.Log.d("ProductDetailFragment", "Case-insensitive match: '$caseInsensitiveMatch'")
            android.util.Log.d("ProductDetailFragment", "Final selectedValue: '$selectedValue'")
            
            if (!selectedValue.isNullOrEmpty()) {
                val adapter = spinner.adapter as? ArrayAdapter<*> ?: run {
                    android.util.Log.w("ProductDetailFragment", "Spinner adapter is null for $variantType")
                    return@forEach
                }
                android.util.Log.d("ProductDetailFragment", "Spinner adapter has ${adapter.count} items for $variantType")
                android.util.Log.d("ProductDetailFragment", "All adapter items: ${(0 until adapter.count).map { adapter.getItem(it)?.toString() }}")
                
                // Normalize the selected value for comparison (trim whitespace)
                val normalizedSelected = selectedValue.trim()
                android.util.Log.d("ProductDetailFragment", "Normalized selected value: '$normalizedSelected'")
                
                // Find the index of the selected value (skip first item which is "Choose X")
                var found = false
                for (i in 1 until adapter.count) {
                    val item = adapter.getItem(i)
                    val itemString = item?.toString()?.trim()
                    android.util.Log.d("ProductDetailFragment", "Checking item at index $i: '$itemString' vs selected: '$normalizedSelected'")
                    android.util.Log.d("ProductDetailFragment", "  Exact match: ${itemString == normalizedSelected}")
                    android.util.Log.d("ProductDetailFragment", "  Case-insensitive match: ${itemString?.equals(normalizedSelected, ignoreCase = true)}")
                    android.util.Log.d("ProductDetailFragment", "  Contains check (selected contains item): ${normalizedSelected.contains(itemString ?: "", ignoreCase = true)}")
                    android.util.Log.d("ProductDetailFragment", "  Contains check (item contains selected): ${itemString?.contains(normalizedSelected, ignoreCase = true)}")
                    
                    // Try exact match first
                    if (itemString == normalizedSelected) {
                        android.util.Log.d("ProductDetailFragment", "✓✓✓ Found EXACT match at index $i for $variantType = '$normalizedSelected' ✓✓✓")
                        spinner.setSelection(i, false) // false to prevent triggering listener during restore
                        android.util.Log.d("ProductDetailFragment", "Spinner selection set to index $i")
                        // Manually trigger the selection to update the ViewModel with the original value from adapter
                        val valueToSet = itemString ?: normalizedSelected
                        android.util.Log.d("ProductDetailFragment", "Calling viewModel.selectVariant('$variantType', '$valueToSet')")
                        viewModel.selectVariant(variantType, valueToSet)
                        android.util.Log.d("ProductDetailFragment", "ViewModel selectVariant called")
                        restoredCount++
                        found = true
                        break
                    }
                    // Try case-insensitive match
                    else if (itemString?.equals(normalizedSelected, ignoreCase = true) == true) {
                        android.util.Log.d("ProductDetailFragment", "✓✓✓ Found CASE-INSENSITIVE match at index $i for $variantType ✓✓✓")
                        spinner.setSelection(i, false)
                        val valueToSet = itemString ?: normalizedSelected
                        android.util.Log.d("ProductDetailFragment", "Calling viewModel.selectVariant('$variantType', '$valueToSet')")
                        viewModel.selectVariant(variantType, valueToSet)
                        restoredCount++
                        found = true
                        break
                    }
                    // Try partial match - check if normalizedSelected contains the itemString or vice versa
                    else if (!itemString.isNullOrEmpty()) {
                        // Check if selected value contains this option (for comma-separated values)
                        if (normalizedSelected.contains(itemString, ignoreCase = true)) {
                            android.util.Log.d("ProductDetailFragment", "✓✓✓ Found PARTIAL match (selected contains option) at index $i for $variantType ✓✓✓")
                            spinner.setSelection(i, false)
                            android.util.Log.d("ProductDetailFragment", "Calling viewModel.selectVariant('$variantType', '$itemString')")
                            viewModel.selectVariant(variantType, itemString)
                            restoredCount++
                            found = true
                            break
                        }
                        // Check if option contains selected value (for cases where stored value is subset)
                        else if (itemString.contains(normalizedSelected, ignoreCase = true)) {
                            android.util.Log.d("ProductDetailFragment", "✓✓✓ Found PARTIAL match (option contains selected) at index $i for $variantType ✓✓✓")
                            spinner.setSelection(i, false)
                            android.util.Log.d("ProductDetailFragment", "Calling viewModel.selectVariant('$variantType', '$itemString')")
                            viewModel.selectVariant(variantType, itemString)
                            restoredCount++
                            found = true
                            break
                        }
                    }
                }
                
                if (!found) {
                    android.util.Log.w("ProductDetailFragment", "✗✗✗ Could not find matching value '$normalizedSelected' for variantType '$variantType' in spinner ✗✗✗")
                    android.util.Log.w("ProductDetailFragment", "Available spinner options: ${(1 until adapter.count).map { adapter.getItem(it)?.toString() }}")
                } else {
                    android.util.Log.d("ProductDetailFragment", "✓ Successfully restored variantType '$variantType'")
                }
            } else {
                android.util.Log.d("ProductDetailFragment", "No selected value for variantType '$variantType' in variation map")
            }
        }
        android.util.Log.d("ProductDetailFragment", "=== restoreVariationSelections END ===")
        android.util.Log.d("ProductDetailFragment", "Restored $restoredCount out of ${variationMap.size} variations")
        android.util.Log.d("ProductDetailFragment", "Final ViewModel variantSelections: ${viewModel.variantSelections.value}")
        android.util.Log.d("ProductDetailFragment", "Final ViewModel selectedVariation: ${viewModel.selectedVariation.value?.variants}")
    }

    private fun updateAvailabilityBadges(product: ProductDetail) {
        binding.lowStockBadge.visibility = View.GONE
        binding.outOfStockBadge.visibility = View.GONE
        binding.availableBadge.visibility = View.GONE

        when {
            product.no_stock == true -> {
                binding.outOfStockBadge.visibility = View.VISIBLE
            }
            product.low_stock == true -> {
                binding.lowStockBadge.visibility = View.VISIBLE
                product.stock_qty?.let {
                    binding.lowStockBadge.text = "Low stock ($it)"
                }
            }
            product.available == true -> {
                binding.availableBadge.visibility = View.VISIBLE
            }
        }
    }

    private fun updateDisplayForVariation(variation: VariationDetail) {
        // Update image
        variation.image?.let {
            loadMainImage(it)
        }

        // Update thumbnail gallery
        val allImages = mutableListOf<String>()
        variation.image?.let { allImages.add(it) }
        variation.additional_images?.let { allImages.addAll(it) }
        if (allImages.size > 1) {
            binding.thumbnailRecyclerView.visibility = View.VISIBLE
            thumbnailAdapter.updateItems(allImages.take(6))
        }

        // Update price/points - need to convert price to points
        variation.price?.let { price ->
            // Convert price to points and round to nearest 10
            val rawPoints = price * 100.0
            val estimatedPoints = (kotlin.math.round(rawPoints / 10.0) * 10.0).toInt()
            binding.productPoints.text = "$estimatedPoints pts"
        }

        // Update availability badges
        when {
            variation.no_stock == true -> {
                binding.lowStockBadge.visibility = View.GONE
                binding.outOfStockBadge.visibility = View.VISIBLE
                binding.availableBadge.visibility = View.GONE
            }
            variation.low_stock == true -> {
                binding.lowStockBadge.visibility = View.VISIBLE
                binding.outOfStockBadge.visibility = View.GONE
                binding.availableBadge.visibility = View.GONE
                variation.stock_qty?.let {
                    binding.lowStockBadge.text = "Low stock ($it)"
                }
            }
            variation.available == true -> {
                binding.lowStockBadge.visibility = View.GONE
                binding.outOfStockBadge.visibility = View.GONE
                binding.availableBadge.visibility = View.VISIBLE
            }
        }
        
        // Update item specifics with variation-specific values
        viewModel.product.value?.let { baseProduct ->
            val baseSpecs = baseProduct.item_specifics ?: emptyMap()
            val variationVariants = variation.variants ?: emptyMap()
            
            // Merge variation variants into base specs, overriding matching keys
            val updatedSpecs = baseSpecs.toMutableMap()
            variationVariants.forEach { (key, value) ->
                updatedSpecs[key] = value
            }
            
            // Update the item specifics table
            if (updatedSpecs.isNotEmpty()) {
                binding.itemSpecificsLabel.visibility = View.VISIBLE
                binding.itemSpecificsRecyclerView.visibility = View.VISIBLE
                itemSpecsAdapter.updateItems(updatedSpecs)
            } else {
                binding.itemSpecificsLabel.visibility = View.GONE
                binding.itemSpecificsRecyclerView.visibility = View.GONE
            }
        }
    }

    private fun updateDisplayForBaseProduct(product: ProductDetail) {
        loadMainImage(product.image)
        product.image?.let { mainImage ->
            val allImages = mutableListOf(mainImage)
            product.additional_images?.let { allImages.addAll(it) }
            if (allImages.size > 1) {
                thumbnailAdapter.updateItems(allImages.take(6))
            }
        }
        binding.productPoints.text = product.display_points ?: "${product.points?.toInt() ?: 0} pts"
        updateAvailabilityBadges(product)
        
        // Reset item specifics to base product specs
        product.item_specifics?.let { specs ->
            if (specs.isNotEmpty()) {
                binding.itemSpecificsLabel.visibility = View.VISIBLE
                binding.itemSpecificsRecyclerView.visibility = View.VISIBLE
                itemSpecsAdapter.updateItems(specs)
            } else {
                binding.itemSpecificsLabel.visibility = View.GONE
                binding.itemSpecificsRecyclerView.visibility = View.GONE
            }
        } ?: run {
            binding.itemSpecificsLabel.visibility = View.GONE
            binding.itemSpecificsRecyclerView.visibility = View.GONE
        }
    }

    private fun loadMainImage(imageUrl: String?) {
        if (!imageUrl.isNullOrEmpty()) {
            Glide.with(requireContext())
                .load(imageUrl)
                .placeholder(R.drawable.ic_catalog)
                .error(R.drawable.ic_catalog)
                .into(binding.mainProductImage)
        } else {
            binding.mainProductImage.setImageResource(R.drawable.ic_catalog)
        }
    }

    private fun navigateToProductDetail(itemId: String) {
        if (itemId.isNotEmpty()) {
            val bundle = Bundle().apply {
                putString("itemId", itemId)
            }
            findNavController().navigate(R.id.action_product_detail_to_product_detail, bundle)
        }
    }

    override fun onDestroyView() {
        // ShimmerView handles its own cleanup
        super.onDestroyView()
        _binding = null
    }
}

// Thumbnail adapter for image gallery
class ThumbnailAdapter(
    private val onThumbnailClick: (String) -> Unit
) : RecyclerView.Adapter<ThumbnailAdapter.ThumbnailViewHolder>() {

    private var items = mutableListOf<String>()

    fun updateItems(newItems: List<String>) {
        items.clear()
        items.addAll(newItems)
        notifyDataSetChanged()
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ThumbnailViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_thumbnail, parent, false)
        return ThumbnailViewHolder(view)
    }

    override fun onBindViewHolder(holder: ThumbnailViewHolder, position: Int) {
        holder.bind(items[position])
    }

    override fun getItemCount(): Int = items.size

    inner class ThumbnailViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        private val imageView: android.widget.ImageView = itemView.findViewById(R.id.thumbnail_image)

        fun bind(imageUrl: String) {
            Glide.with(itemView.context)
                .load(imageUrl)
                .placeholder(R.drawable.ic_catalog)
                .error(R.drawable.ic_catalog)
                .centerCrop()
                .into(imageView)

            itemView.setOnClickListener {
                onThumbnailClick(imageUrl)
            }
        }
    }
}

// Item specs adapter for product details table
class ItemSpecsAdapter : RecyclerView.Adapter<ItemSpecsAdapter.ItemSpecViewHolder>() {

    private var items = mutableListOf<Pair<String, String>>()

    fun updateItems(specs: Map<String, String>) {
        items.clear()
        items.addAll(specs.map { (key, value) -> Pair(key, value) })
        notifyDataSetChanged()
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ItemSpecViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_spec_row, parent, false)
        return ItemSpecViewHolder(view)
    }

    override fun onBindViewHolder(holder: ItemSpecViewHolder, position: Int) {
        holder.bind(items[position])
    }

    override fun getItemCount(): Int = items.size

    inner class ItemSpecViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        private val keyView: TextView = itemView.findViewById(R.id.spec_key)
        private val valueView: TextView = itemView.findViewById(R.id.spec_value)

        fun bind(spec: Pair<String, String>) {
            keyView.text = spec.first
            valueView.text = spec.second
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/ProductDetailViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.example.driverrewards.network.CatalogService
import com.example.driverrewards.network.ProductDetail
import com.example.driverrewards.network.RelatedProduct
import com.example.driverrewards.network.VariationDetail
import kotlinx.coroutines.launch

class ProductDetailViewModel : ViewModel() {
    
    private val catalogService = CatalogService()
    
    private val _product = MutableLiveData<ProductDetail?>()
    val product: LiveData<ProductDetail?> = _product
    
    private val _relatedProducts = MutableLiveData<List<RelatedProduct>>()
    val relatedProducts: LiveData<List<RelatedProduct>> = _relatedProducts
    
    private val _loading = MutableLiveData<Boolean>()
    val loading: LiveData<Boolean> = _loading
    
    private val _error = MutableLiveData<String?>()
    val error: LiveData<String?> = _error
    
    private val _selectedVariation = MutableLiveData<VariationDetail?>()
    val selectedVariation: LiveData<VariationDetail?> = _selectedVariation
    
    private val _variantSelections = MutableLiveData<Map<String, String>>()
    val variantSelections: LiveData<Map<String, String>> = _variantSelections
    
    // Caching for product details
    private val productCache = mutableMapOf<String, ProductDetail>()
    private val relatedProductsCache = mutableMapOf<String, List<RelatedProduct>>()
    private val variantSelectionsCache = mutableMapOf<String, Map<String, String>>()
    private var currentItemId: String? = null
    
    init {
        _variantSelections.value = emptyMap()
        _selectedVariation.value = null
    }
    
    fun loadProductDetail(itemId: String, skipCachedSelections: Boolean = false) {
        android.util.Log.d("ProductDetailViewModel", "=== loadProductDetail START ===")
        android.util.Log.d("ProductDetailViewModel", "itemId: '$itemId', skipCachedSelections: $skipCachedSelections")
        
        // Check if we're switching to a different product
        val isSwitchingProduct = currentItemId != null && currentItemId != itemId
        android.util.Log.d("ProductDetailViewModel", "isSwitchingProduct: $isSwitchingProduct, currentItemId: '$currentItemId'")
        
        // If switching to a different product, clear old data immediately
        if (isSwitchingProduct) {
            android.util.Log.d("ProductDetailViewModel", "Switching product - clearing old data")
            _product.value = null
            _relatedProducts.value = emptyList()
            _selectedVariation.value = null
            _variantSelections.value = emptyMap()
        }
        
        currentItemId = itemId
        
        // Check if product is cached
        val cachedProduct = productCache[itemId]
        val cachedRelated = relatedProductsCache[itemId]
        val cachedSelections = variantSelectionsCache[itemId]
        
        android.util.Log.d("ProductDetailViewModel", "Cache check - cachedProduct: ${cachedProduct != null}, cachedSelections: $cachedSelections")
        
        if (cachedProduct != null) {
            android.util.Log.d("ProductDetailViewModel", "Product is cached, loading from cache")
            // Use cached data - load immediately after clearing old data
            _product.value = cachedProduct
            _relatedProducts.value = cachedRelated ?: emptyList()
            // Only restore variant selections if not explicitly skipping (i.e., when we have navigation args)
            if (!skipCachedSelections) {
                android.util.Log.d("ProductDetailViewModel", "Not skipping cached selections, restoring: $cachedSelections")
                cachedSelections?.let {
                    android.util.Log.d("ProductDetailViewModel", "Restoring cached selections: $it")
                    _variantSelections.value = it
                    findMatchingVariation(it)
                } ?: run {
                    android.util.Log.d("ProductDetailViewModel", "No cached selections to restore")
                }
            } else {
                android.util.Log.d("ProductDetailViewModel", "Skipping cached selections - clearing state")
                // Clear any existing selections when skipping cached selections
                _variantSelections.value = emptyMap()
                _selectedVariation.value = null
                android.util.Log.d("ProductDetailViewModel", "State cleared - _variantSelections is now empty, _selectedVariation is null")
            }
            _loading.value = false
            android.util.Log.d("ProductDetailViewModel", "Returning early (cached product loaded)")
            return
        }
        
        android.util.Log.d("ProductDetailViewModel", "Product not cached, loading from network")
        
        viewModelScope.launch {
            try {
                _loading.value = true
                _error.value = null
                
                val response = catalogService.getProductDetail(itemId)
                
                if (response.success && response.product != null) {
                    // Cache the product data
                    productCache[itemId] = response.product
                    relatedProductsCache[itemId] = response.related_items ?: emptyList()
                    
                    _product.value = response.product
                    _relatedProducts.value = response.related_items ?: emptyList()
                } else {
                    _error.value = response.message ?: "Failed to load product details"
                }
            } catch (e: Exception) {
                _error.value = "Error loading product: ${e.message ?: "Unknown error"}"
            } finally {
                _loading.value = false
            }
        }
    }
    
    fun toggleFavorite(itemId: String, isCurrentlyFavorite: Boolean, onFavoriteToggled: ((Boolean) -> Unit)? = null) {
        // Optimistically update UI immediately
        _product.value?.let { product ->
            val updatedProduct = product.copy(is_favorite = !isCurrentlyFavorite)
            _product.value = updatedProduct
            // Update cache immediately
            productCache[itemId] = updatedProduct
        }
        
        viewModelScope.launch {
            try {
                val response = if (isCurrentlyFavorite) {
                    catalogService.removeFavorite(itemId)
                } else {
                    catalogService.addFavorite(itemId)
                }
                
                if (response.success) {
                    // Notify callback
                    onFavoriteToggled?.invoke(!isCurrentlyFavorite)
                } else {
                    // Revert on error
                    _product.value?.let { product ->
                        val revertedProduct = product.copy(is_favorite = isCurrentlyFavorite)
                        _product.value = revertedProduct
                        productCache[itemId] = revertedProduct
                    }
                    _error.value = response.message ?: "Failed to update favorite"
                    onFavoriteToggled?.invoke(isCurrentlyFavorite)
                }
            } catch (e: Exception) {
                // Revert on error
                _product.value?.let { product ->
                    val revertedProduct = product.copy(is_favorite = isCurrentlyFavorite)
                    _product.value = revertedProduct
                    productCache[itemId] = revertedProduct
                }
                _error.value = "Error updating favorite: ${e.message ?: "Unknown error"}"
                onFavoriteToggled?.invoke(isCurrentlyFavorite)
            }
        }
    }
    
    fun selectVariant(variantType: String, value: String) {
        val currentSelections = _variantSelections.value?.toMutableMap() ?: mutableMapOf()
        if (value.isNotEmpty()) {
            currentSelections[variantType] = value
        } else {
            currentSelections.remove(variantType)
        }
        _variantSelections.value = currentSelections
        
        // Cache variant selections
        currentItemId?.let { itemId ->
            variantSelectionsCache[itemId] = currentSelections.toMap()
        }
        
        // Find matching variation
        findMatchingVariation(currentSelections)
    }
    
    private fun findMatchingVariation(selections: Map<String, String>) {
        val product = _product.value ?: return
        val variationDetails = product.variation_details ?: return
        
        if (selections.isEmpty()) {
            _selectedVariation.value = null
            return
        }
        
        // Find variation that matches all selected attributes
        for (variation in variationDetails) {
            val variantMap = variation.variants ?: continue
            var matches = true
            
            for ((key, value) in selections) {
                if (variantMap[key] != value) {
                    matches = false
                    break
                }
            }
            
            if (matches) {
                _selectedVariation.value = variation
                return
            }
        }
        
        // No exact match found
        _selectedVariation.value = null
    }
    
    fun clearVariantSelection() {
        _variantSelections.value = emptyMap()
        _selectedVariation.value = null
    }
    
    fun clearCachedVariantSelections(itemId: String) {
        variantSelectionsCache.remove(itemId)
    }
    
    fun updateProductFavorite(product: ProductDetail) {
        _product.value = product
        // Update cache
        product.id?.let { itemId ->
            productCache[itemId] = product
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/ProductItem.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

data class ProductItem(
    val id: String,
    val title: String,
    val points: Int,
    val imageUrl: String?,
    val availability: String,
    val isFavorite: Boolean,
    val isPinned: Boolean
)

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/RelatedProductAdapter.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.ImageView
import android.widget.TextView
import androidx.recyclerview.widget.RecyclerView
import com.bumptech.glide.Glide
import com.example.driverrewards.R
import com.example.driverrewards.network.RelatedProduct

class RelatedProductAdapter(
    private val onItemClick: (RelatedProduct) -> Unit
) : RecyclerView.Adapter<RelatedProductAdapter.RelatedProductViewHolder>() {

    private var items = mutableListOf<RelatedProduct>()

    fun updateItems(newItems: List<RelatedProduct>) {
        items.clear()
        items.addAll(newItems)
        notifyDataSetChanged()
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): RelatedProductViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_related_product_card, parent, false)
        return RelatedProductViewHolder(view)
    }

    override fun onBindViewHolder(holder: RelatedProductViewHolder, position: Int) {
        holder.bind(items[position])
    }

    override fun getItemCount(): Int = items.size

    inner class RelatedProductViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        private val imageView: ImageView = itemView.findViewById(R.id.product_image)
        private val titleView: TextView = itemView.findViewById(R.id.product_title)
        private val pointsView: TextView = itemView.findViewById(R.id.product_points)
        private val availabilityBadge: TextView = itemView.findViewById(R.id.availability_badge)

        fun bind(item: RelatedProduct) {
            titleView.text = item.title ?: "Unknown Product"
            pointsView.text = "${item.points?.toInt() ?: 0} pts"

            // Load image with Glide
            if (!item.image.isNullOrEmpty()) {
                Glide.with(itemView.context)
                    .load(item.image)
                    .placeholder(R.drawable.ic_catalog)
                    .error(R.drawable.ic_catalog)
                    .into(imageView)
            } else {
                imageView.setImageResource(R.drawable.ic_catalog)
            }

            // Set availability badge
            when {
                item.no_stock == true -> {
                    availabilityBadge.text = "OUT OF STOCK"
                    availabilityBadge.setTextColor(0xFFFF4444.toInt())
                    availabilityBadge.visibility = View.VISIBLE
                }
                item.low_stock == true -> {
                    val stockQty = item.stock_qty
                    availabilityBadge.text = if (stockQty != null) "LOW STOCK ($stockQty)" else "LOW STOCK"
                    availabilityBadge.setTextColor(0xFFFF8800.toInt())
                    availabilityBadge.visibility = View.VISIBLE
                }
                else -> {
                    availabilityBadge.visibility = View.GONE
                }
            }

            // Set click listener
            itemView.setOnClickListener { onItemClick(item) }
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/ShimmerView.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import android.animation.ValueAnimator
import android.content.Context
import android.graphics.*
import android.util.AttributeSet
import android.view.View
import android.view.animation.LinearInterpolator

class ShimmerView @JvmOverloads constructor(
    context: Context,
    attrs: AttributeSet? = null,
    defStyleAttr: Int = 0
) : View(context, attrs, defStyleAttr) {

    private val paint = Paint(Paint.ANTI_ALIAS_FLAG)
    private val gradientMatrix = Matrix()
    private var shimmerGradient: LinearGradient? = null
    private var animator: ValueAnimator? = null
    private var gradientWidth = 0f

    init {
        paint.shader = null
    }

    override fun onSizeChanged(w: Int, h: Int, oldw: Int, oldh: Int) {
        super.onSizeChanged(w, h, oldw, oldh)
        if (w > 0 && h > 0) {
            setupGradient(w, h)
            startShimmer()
        }
    }

    private fun setupGradient(width: Int, height: Int) {
        // Create a gradient that's wider than the view for smooth animation
        gradientWidth = width * 1.5f
        
        // Create a more liquid-like gradient with smoother transitions
        // The gradient is defined in local coordinates, then translated via matrix
        shimmerGradient = LinearGradient(
            0f, 0f, gradientWidth * 2f, 0f,
            intArrayOf(
                0x00BDBDBD.toInt(),  // Fully transparent dark gray
                0x40BDBDBD.toInt(),  // Semi-transparent dark gray
                0xFFE8E8E8.toInt(),  // Bright light gray (highlight)
                0xFFE0E0E0.toInt(),  // Light gray
                0xFFE8E8E8.toInt(),  // Bright light gray (highlight)
                0x40BDBDBD.toInt(),  // Semi-transparent dark gray
                0x00BDBDBD.toInt()   // Fully transparent dark gray
            ),
            floatArrayOf(0f, 0.2f, 0.4f, 0.5f, 0.6f, 0.8f, 1f),
            Shader.TileMode.CLAMP
        )
        
        paint.shader = shimmerGradient
    }

    private fun startShimmer() {
        stopShimmer()
        
        val viewWidth = width.toFloat()
        animator = ValueAnimator.ofFloat(-gradientWidth, viewWidth + gradientWidth).apply {
            duration = 1500  // Faster animation for more liquid feel
            repeatCount = ValueAnimator.INFINITE
            interpolator = LinearInterpolator()
            
            addUpdateListener { animation ->
                val translateX = animation.animatedValue as Float
                gradientMatrix.reset()
                gradientMatrix.setTranslate(translateX, 0f)
                shimmerGradient?.setLocalMatrix(gradientMatrix)
                invalidate()
            }
            
            start()
        }
    }

    private fun stopShimmer() {
        animator?.cancel()
        animator = null
    }

    override fun onDraw(canvas: Canvas) {
        super.onDraw(canvas)
        canvas.drawRect(0f, 0f, width.toFloat(), height.toFloat(), paint)
    }

    override fun onAttachedToWindow() {
        super.onAttachedToWindow()
        if (width > 0 && height > 0) {
            startShimmer()
        }
    }

    override fun onDetachedFromWindow() {
        super.onDetachedFromWindow()
        stopShimmer()
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/catalog/SkeletonCardAdapter.kt =====

```kotlin
package com.example.driverrewards.ui.catalog

import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import androidx.recyclerview.widget.RecyclerView
import com.example.driverrewards.R

class SkeletonCardAdapter(private val itemCount: Int = 6) : RecyclerView.Adapter<SkeletonCardAdapter.SkeletonViewHolder>() {
    
    class SkeletonViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        val cardView: View = itemView
    }
    
    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): SkeletonViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_skeleton_product_card, parent, false)
        return SkeletonViewHolder(view)
    }
    
    override fun onBindViewHolder(holder: SkeletonViewHolder, position: Int) {
        // ShimmerView handles its own animation, no need to do anything here
    }
    
    override fun getItemCount(): Int = itemCount
    
    fun stopAllAnimations() {
        // ShimmerView handles its own lifecycle, no manual cleanup needed
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/dashboard/DashboardFragment.kt =====

```kotlin
package com.example.driverrewards.ui.dashboard

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.TextView
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import com.example.driverrewards.databinding.FragmentDashboardBinding

class DashboardFragment : Fragment() {

    private var _binding: FragmentDashboardBinding? = null

    // This property is only valid between onCreateView and
    // onDestroyView.
    private val binding get() = _binding!!

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        val dashboardViewModel =
            ViewModelProvider(this).get(DashboardViewModel::class.java)

        _binding = FragmentDashboardBinding.inflate(inflater, container, false)
        val root: View = binding.root

        val textView: TextView = binding.textDashboard
        dashboardViewModel.text.observe(viewLifecycleOwner) {
            textView.text = it
        }
        return root
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}
```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/dashboard/DashboardViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.dashboard

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel

class DashboardViewModel : ViewModel() {

    private val _text = MutableLiveData<String>().apply {
        value = "This is dashboard Fragment"
    }
    val text: LiveData<String> = _text
}
```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/favorites/FavoritesFragment.kt =====

```kotlin
package com.example.driverrewards.ui.favorites

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.GridLayoutManager
import androidx.recyclerview.widget.RecyclerView
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentFavoritesBinding
import com.example.driverrewards.ui.catalog.CatalogViewModel
import com.example.driverrewards.ui.catalog.ProductAdapter
import com.example.driverrewards.ui.catalog.FavoriteParticleAnimation
import com.example.driverrewards.ui.catalog.SkeletonCardAdapter

class FavoritesFragment : Fragment() {

    private var _binding: FragmentFavoritesBinding? = null
    private val binding get() = _binding!!
    private lateinit var favoritesViewModel: FavoritesViewModel
    private lateinit var catalogViewModel: CatalogViewModel
    private lateinit var productAdapter: ProductAdapter
    private lateinit var skeletonAdapter: SkeletonCardAdapter
    private var isLoading = false
    private var currentPage = 1
    private var hasMoreData = true

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        favoritesViewModel = ViewModelProvider(requireActivity()).get(FavoritesViewModel::class.java)
        catalogViewModel = ViewModelProvider(requireActivity()).get(CatalogViewModel::class.java)
        
        _binding = FragmentFavoritesBinding.inflate(inflater, container, false)
        val root: View = binding.root

        setupRecyclerView()
        setupSkeletonRecyclerView()
        
        // Restore scroll position after data is loaded
        binding.recyclerView.post {
            val scrollPos = favoritesViewModel.getScrollPosition()
            if (scrollPos > 0 && binding.recyclerView.layoutManager != null) {
                binding.recyclerView.scrollToPosition(scrollPos)
            }
        }
        
        loadFavoritesData()

        return root
    }
    
    private fun setupSkeletonRecyclerView() {
        skeletonAdapter = SkeletonCardAdapter(itemCount = 6)
        binding.skeletonRecyclerView.apply {
            layoutManager = GridLayoutManager(context, 2)
            adapter = skeletonAdapter
        }
    }
    
    private fun setupRecyclerView() {
        productAdapter = ProductAdapter(
            onItemClick = { item ->
                // Save current product itemId to ViewModel
                catalogViewModel.setCurrentProductItemId(item.id)
                // Save scroll position before navigating
                val layoutManager = binding.recyclerView.layoutManager as GridLayoutManager
                favoritesViewModel.setScrollPosition(layoutManager.findLastVisibleItemPosition())
                // Navigate to product detail page
                val bundle = Bundle().apply {
                    putString("itemId", item.id)
                }
                findNavController().navigate(R.id.action_favorites_to_product_detail, bundle)
            },
            onFavoriteClick = { item ->
                // Handle favorite toggle
                toggleFavorite(item)
            }
        )

        binding.recyclerView.apply {
            layoutManager = GridLayoutManager(context, 2)
            adapter = productAdapter
            
            // Add spacing decoration that removes top/bottom padding but keeps item spacing
            val density = context.resources.displayMetrics.density
            addItemDecoration(object : RecyclerView.ItemDecoration() {
                override fun getItemOffsets(
                    outRect: android.graphics.Rect,
                    view: View,
                    parent: RecyclerView,
                    state: RecyclerView.State
                ) {
                    val position = parent.getChildAdapterPosition(view)
                    if (position == RecyclerView.NO_POSITION) return
                    
                    val layoutManager = parent.layoutManager as GridLayoutManager
                    val spanCount = layoutManager.spanCount
                    val itemCount = parent.adapter?.itemCount ?: 0
                    
                    // Calculate row and column
                    val row = position / spanCount
                    val column = position % spanCount
                    val totalRows = (itemCount + spanCount - 1) / spanCount
                    
                    // Convert dp to px
                    val spacingPx = (4 * density).toInt()
                    
                    // Horizontal spacing (between columns)
                    if (column < spanCount - 1) {
                        outRect.right = spacingPx
                    }
                    
                    // Vertical spacing (between rows) but NOT at top or bottom
                    if (row < totalRows - 1) {
                        outRect.bottom = spacingPx
                    }
                    
                    // Remove top padding from first row
                    if (row == 0) {
                        outRect.top = 0
                    }
                    
                    // Remove bottom padding from last row
                    if (row == totalRows - 1) {
                        outRect.bottom = 0
                    }
                }
            })
            
            // Add scroll listener for infinite scroll and position tracking
            addOnScrollListener(object : RecyclerView.OnScrollListener() {
                override fun onScrolled(recyclerView: RecyclerView, dx: Int, dy: Int) {
                    super.onScrolled(recyclerView, dx, dy)
                    
                    val layoutManager = recyclerView.layoutManager as GridLayoutManager
                    val visibleItemCount = layoutManager.childCount
                    val totalItemCount = layoutManager.itemCount
                    val firstVisibleItemPosition = layoutManager.findFirstVisibleItemPosition()
                    
                    // Save scroll position
                    favoritesViewModel.setScrollPosition(firstVisibleItemPosition)
                    
                    // Load more if we're near the end
                    if (!isLoading && hasMoreData) {
                        if ((visibleItemCount + firstVisibleItemPosition) >= totalItemCount - 5) {
                            loadMoreData()
                        }
                    }
                }
            })
        }
    }
    
    private fun loadFavoritesData() {
        if (isLoading) return
        
        isLoading = true
        binding.emptyState.visibility = View.GONE
        
        // Show skeleton loading, hide actual content
        if (currentPage == 1) {
            _binding?.skeletonRecyclerView?.visibility = View.VISIBLE
            _binding?.recyclerView?.visibility = View.GONE
        }
        
        favoritesViewModel.loadFavorites(
            page = currentPage,
            sort = "best_match",
            onSuccess = { items, hasMore ->
                // Hide skeleton, show actual content
                _binding?.skeletonRecyclerView?.visibility = View.GONE
                _binding?.recyclerView?.visibility = View.VISIBLE
                
                if (items.isEmpty() && currentPage == 1) {
                    _binding?.emptyState?.visibility = View.VISIBLE
                } else {
                    _binding?.emptyState?.visibility = View.GONE
                }
                
                if (currentPage == 1) {
                    productAdapter.updateItems(items)
                } else {
                    productAdapter.addItems(items)
                }
                hasMoreData = hasMore
                isLoading = false
            },
            onError = { error ->
                // Hide skeleton on error
                _binding?.skeletonRecyclerView?.visibility = View.GONE
                _binding?.recyclerView?.visibility = View.VISIBLE
                context?.let { ctx ->
                    Toast.makeText(ctx, "Error loading favorites: $error", Toast.LENGTH_LONG).show()
                }
                isLoading = false
            }
        )
    }

    private fun loadMoreData() {
        if (isLoading || !hasMoreData) return
        
        currentPage++
        loadFavoritesData()
    }

    private fun toggleFavorite(item: com.example.driverrewards.ui.catalog.ProductItem) {
        // Optimistically update UI
        productAdapter.updateFavoriteStatus(item.id, !item.isFavorite)
        
        favoritesViewModel.toggleFavorite(
            itemId = item.id,
            isCurrentlyFavorite = item.isFavorite,
            onSuccess = { isFavorite ->
                // Already updated optimistically
                // If item was removed from favorites, it should disappear from list
                if (!isFavorite) {
                    // Remove item from adapter
                    val currentItems = productAdapter.itemCount
                    // Refresh the list
                    currentPage = 1
                    hasMoreData = true
                    loadFavoritesData()
                }
                
                // Update catalog view model when toggling favorite
                catalogViewModel.updateFavoriteInCache(item.id, isFavorite)
            },
            onError = { error ->
                // Revert optimistic update on error
                productAdapter.updateFavoriteStatus(item.id, item.isFavorite)
                Toast.makeText(context, "Error updating favorite: $error", Toast.LENGTH_SHORT).show()
            }
        )
    }

    override fun onPause() {
        super.onPause()
        // Save scroll position
        val layoutManager = binding.recyclerView.layoutManager as? GridLayoutManager
        layoutManager?.let {
            favoritesViewModel.setScrollPosition(it.findFirstVisibleItemPosition())
        }
    }

    override fun onDestroyView() {
        // Stop all skeleton animations
        if (::skeletonAdapter.isInitialized) {
            skeletonAdapter.stopAllAnimations()
        }
        super.onDestroyView()
        // Save scroll position
        val layoutManager = binding.recyclerView.layoutManager as? GridLayoutManager
        layoutManager?.let {
            favoritesViewModel.setScrollPosition(it.findFirstVisibleItemPosition())
        }
        _binding = null
    }
    
    override fun onResume() {
        super.onResume()
        // Refresh favorites when returning to this page to pick up changes from other pages
        favoritesViewModel.refreshFavorites()
        currentPage = 1
        hasMoreData = true
        loadFavoritesData()
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/favorites/FavoritesViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.favorites

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.example.driverrewards.network.CatalogService
import com.example.driverrewards.ui.catalog.ProductItem
import kotlinx.coroutines.launch

class FavoritesViewModel : ViewModel() {

    private val catalogService = CatalogService()
    
    private val _products = MutableLiveData<List<ProductItem>>()
    val products: LiveData<List<ProductItem>> = _products
    
    private val _loading = MutableLiveData<Boolean>()
    val loading: LiveData<Boolean> = _loading
    
    private val _error = MutableLiveData<String?>()
    val error: LiveData<String?> = _error
    
    // Caching state
    private var cachedProducts: List<ProductItem> = emptyList()
    private var cachedPage: Int = 1
    private var cachedHasMoreData: Boolean = false
    private var isDataCached: Boolean = false
    private var scrollPosition: Int = 0

    fun loadFavorites(
        page: Int = 1,
        sort: String = "best_match",
        onSuccess: (List<ProductItem>, Boolean) -> Unit,
        onError: (String) -> Unit
    ) {
        android.util.Log.d("FavoritesViewModel", "===== loadFavorites() CALLED =====")
        android.util.Log.d("FavoritesViewModel", "page: $page, sort: $sort")
        
        // Check if data is cached (only for page 1)
        if (page == 1 && isDataCached) {
            android.util.Log.d("FavoritesViewModel", "Using cached favorites data")
            _products.value = cachedProducts
            onSuccess(cachedProducts, cachedHasMoreData)
            return
        }
        
        viewModelScope.launch {
            try {
                _loading.value = true
                _error.value = null
                
                // Load favorites with favoritesOnly=true and no search query
                val response = catalogService.getCatalogData(
                    page = page,
                    pageSize = 48,
                    searchQuery = null,
                    sort = sort,
                    categories = null,
                    minPoints = null,
                    maxPoints = null,
                    favoritesOnly = true
                )
                
                if (response.success) {
                    val items = response.items.map { itemData ->
                        ProductItem(
                            id = itemData.id ?: "",
                            title = itemData.title ?: "Unknown Product",
                            points = itemData.points?.toInt() ?: 0,
                            imageUrl = itemData.image,
                            availability = itemData.availability ?: "IN_STOCK",
                            isFavorite = true, // All items in favorites are favorited
                            isPinned = itemData.isPinned ?: false
                        )
                    }
                    
                    // Cache data only for page 1
                    if (page == 1) {
                        cachedProducts = items
                        cachedPage = page
                        cachedHasMoreData = response.has_more
                        isDataCached = true
                    }
                    
                    _products.value = items
                    onSuccess(items, response.has_more)
                } else {
                    val errorMessage = response.message ?: "Failed to load favorites"
                    _error.value = errorMessage
                    onError(errorMessage)
                }
            } catch (e: Exception) {
                val errorMessage = "Error loading favorites: ${e.message ?: "Unknown error"}"
                _error.value = errorMessage
                onError(errorMessage)
            } finally {
                _loading.value = false
            }
        }
    }

    fun refreshFavorites() {
        // Clear cache to force fresh fetch
        isDataCached = false
        cachedProducts = emptyList()
        cachedPage = 1
        cachedHasMoreData = false
    }

    fun getCachedProducts(): List<ProductItem> = cachedProducts

    fun getScrollPosition(): Int = scrollPosition

    fun setScrollPosition(position: Int) {
        scrollPosition = position
    }
    
    fun updateFavoriteInCache(itemId: String, isFavorite: Boolean) {
        // Update favorite status in cached products
        _products.value?.let { products ->
            val updatedProducts = products.map { item ->
                if (item.id == itemId) {
                    item.copy(isFavorite = isFavorite)
                } else {
                    item
                }
            }
            _products.value = updatedProducts
            if (isDataCached) {
                cachedProducts = updatedProducts
            }
        }
    }
    
    fun toggleFavorite(
        itemId: String,
        isCurrentlyFavorite: Boolean,
        onSuccess: (Boolean) -> Unit,
        onError: (String) -> Unit
    ) {
        // Optimistically update cached products immediately
        val newFavoriteState = !isCurrentlyFavorite
        _products.value?.let { products ->
            val updatedProducts = products.map { item ->
                if (item.id == itemId) {
                    item.copy(isFavorite = newFavoriteState)
                } else {
                    item
                }
            }
            _products.value = updatedProducts
            // Update cached products if cache matches
            if (isDataCached) {
                cachedProducts = updatedProducts
            }
        }
        
        viewModelScope.launch {
            try {
                val response = if (isCurrentlyFavorite) {
                    catalogService.removeFavorite(itemId)
                } else {
                    catalogService.addFavorite(itemId)
                }
                
                if (response.success) {
                    // If item was removed from favorites, refresh to remove from list
                    if (isCurrentlyFavorite) {
                        refreshFavorites()
                        loadFavorites(1, "best_match", { _: List<com.example.driverrewards.ui.catalog.ProductItem>, _: Boolean -> }, { _: String -> })
                    }
                    onSuccess(newFavoriteState)
                } else {
                    // Revert optimistic update on error
                    _products.value?.let { products ->
                        val revertedProducts = products.map { item ->
                            if (item.id == itemId) {
                                item.copy(isFavorite = isCurrentlyFavorite)
                            } else {
                                item
                            }
                        }
                        _products.value = revertedProducts
                        if (isDataCached) {
                            cachedProducts = revertedProducts
                        }
                    }
                    onError(response.message ?: "Failed to update favorite")
                }
                
            } catch (e: Exception) {
                // Revert optimistic update on error
                _products.value?.let { products ->
                    val revertedProducts = products.map { item ->
                        if (item.id == itemId) {
                            item.copy(isFavorite = isCurrentlyFavorite)
                        } else {
                            item
                        }
                    }
                    _products.value = revertedProducts
                    if (isDataCached) {
                        cachedProducts = revertedProducts
                    }
                }
                onError("Network error: ${e.message}")
            }
        }
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/home/HomeFragment.kt =====

```kotlin
package com.example.driverrewards.ui.home

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.TextView
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import com.example.driverrewards.databinding.FragmentHomeBinding

class HomeFragment : Fragment() {

    private var _binding: FragmentHomeBinding? = null

    // This property is only valid between onCreateView and
    // onDestroyView.
    private val binding get() = _binding!!

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        val homeViewModel =
            ViewModelProvider(this).get(HomeViewModel::class.java)

        _binding = FragmentHomeBinding.inflate(inflater, container, false)
        val root: View = binding.root

        val textView: TextView = binding.textHome
        homeViewModel.text.observe(viewLifecycleOwner) {
            textView.text = it
        }
        return root
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}
```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/home/HomeViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.home

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel

class HomeViewModel : ViewModel() {

    private val _text = MutableLiveData<String>().apply {
        value = "Hello!"
    }
    val text: LiveData<String> = _text
}
```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/notifications/NotificationsFragment.kt =====

```kotlin
package com.example.driverrewards.ui.notifications

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.TextView
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import com.example.driverrewards.databinding.FragmentNotificationsBinding

class NotificationsFragment : Fragment() {

    private var _binding: FragmentNotificationsBinding? = null

    // This property is only valid between onCreateView and
    // onDestroyView.
    private val binding get() = _binding!!

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        val notificationsViewModel =
            ViewModelProvider(this).get(NotificationsViewModel::class.java)

        _binding = FragmentNotificationsBinding.inflate(inflater, container, false)
        val root: View = binding.root

        val textView: TextView = binding.textNotifications
        notificationsViewModel.text.observe(viewLifecycleOwner) {
            textView.text = it
        }
        return root
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}
```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/notifications/NotificationsViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.notifications

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel

class NotificationsViewModel : ViewModel() {

    private val _text = MutableLiveData<String>().apply {
        value = "This is notifications Fragment"
    }
    val text: LiveData<String> = _text
}
```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/orders/OrderDetailFragment.kt =====

```kotlin
package com.example.driverrewards.ui.orders

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.Observer
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.LinearLayoutManager
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentOrderDetailBinding
import com.example.driverrewards.network.CartItem
import com.google.android.material.dialog.MaterialAlertDialogBuilder
import java.text.SimpleDateFormat
import java.util.*

class OrderDetailFragment : Fragment() {

    private var _binding: FragmentOrderDetailBinding? = null
    private val binding get() = _binding!!
    private lateinit var ordersViewModel: OrdersViewModel
    private lateinit var orderItemsAdapter: OrderItemsAdapter
    private lateinit var cartViewModel: com.example.driverrewards.ui.cart.CartViewModel
    private var currentOrder: com.example.driverrewards.network.OrderData? = null

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        ordersViewModel = ViewModelProvider(requireActivity())[OrdersViewModel::class.java]
        cartViewModel = ViewModelProvider(requireActivity())[com.example.driverrewards.ui.cart.CartViewModel::class.java]
        _binding = FragmentOrderDetailBinding.inflate(inflater, container, false)

        val orderId = arguments?.getString("orderId") ?: ""
        if (orderId.isEmpty()) {
            Toast.makeText(requireContext(), "Invalid order ID", Toast.LENGTH_SHORT).show()
            findNavController().navigateUp()
            return binding.root
        }

        setupRecyclerView()
        setupObservers()
        setupClickListeners()
        loadOrderDetail(orderId)

        return binding.root
    }
    
    private fun setupClickListeners() {
        binding.reorderButton.setOnClickListener {
            currentOrder?.let { order ->
                reorderItems(order)
            }
        }
        
        binding.addAllToCartButton.setOnClickListener {
            currentOrder?.let { order ->
                addAllToCart(order)
            }
        }
    }

    private fun setupRecyclerView() {
        orderItemsAdapter = OrderItemsAdapter(
            items = emptyList(),
            onItemClick = { orderItem ->
                handleOrderItemClick(orderItem)
            }
        )
        binding.orderItemsRecycler.layoutManager = LinearLayoutManager(requireContext())
        binding.orderItemsRecycler.adapter = orderItemsAdapter
    }
    
    private fun handleOrderItemClick(orderItem: com.example.driverrewards.network.OrderItem) {
        val externalItemId = orderItem.externalItemId ?: orderItem.title ?: ""
        if (externalItemId.isEmpty()) {
            Toast.makeText(requireContext(), "Unable to open product details", Toast.LENGTH_SHORT).show()
            return
        }
        
        // Extract base item ID (before ::) and variation info
        val baseItemId = if (externalItemId.contains("::")) {
            externalItemId.substringBefore("::")
        } else {
            externalItemId
        }
        
        // Get variation info if present
        val variationInfo = if (externalItemId.contains("::")) {
            externalItemId.substringAfter("::")
        } else {
            // Also check if variationInfo is stored separately in the order item
            orderItem.variationInfo
        }
        
        android.util.Log.d("OrderDetailFragment", "Navigating to product detail")
        android.util.Log.d("OrderDetailFragment", "  ExternalItemId: $externalItemId")
        android.util.Log.d("OrderDetailFragment", "  BaseItemId: $baseItemId")
        android.util.Log.d("OrderDetailFragment", "  VariationInfo: $variationInfo")
        
        // Navigate to product detail with variation info
        val bundle = Bundle().apply {
            putString("itemId", baseItemId)
            variationInfo?.let {
                android.util.Log.d("OrderDetailFragment", "  Adding variationInfo to bundle: $it")
                putString("variationInfo", it)
            }
        }
        
        try {
            findNavController().navigate(R.id.action_order_detail_to_product_detail, bundle)
        } catch (e: Exception) {
            android.util.Log.e("OrderDetailFragment", "Error navigating to product detail: ${e.message}", e)
            Toast.makeText(requireContext(), "Error opening product details", Toast.LENGTH_SHORT).show()
        }
    }

    private fun setupObservers() {
        ordersViewModel.isLoading.observe(viewLifecycleOwner, Observer { isLoading ->
            binding.progressBar.visibility = if (isLoading) View.VISIBLE else View.GONE
        })

        ordersViewModel.errorMessage.observe(viewLifecycleOwner, Observer { error ->
            error?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_SHORT).show()
            }
        })
        
        ordersViewModel.refundSuccess.observe(viewLifecycleOwner, Observer { success ->
            if (success == true) {
                // Refresh points display in MainActivity
                (requireActivity() as? com.example.driverrewards.MainActivity)?.refreshPointsDisplay()
                try {
                    val profileViewModel = androidx.lifecycle.ViewModelProvider(requireActivity())[com.example.driverrewards.ui.profile.ProfileViewModel::class.java]
                    profileViewModel.refreshProfile()
                } catch (e: Exception) {
                    // ProfileViewModel might not be available, that's okay
                }
            }
        })
        
        ordersViewModel.cancelSuccess.observe(viewLifecycleOwner, Observer { success ->
            if (success == true) {
                // Refresh points display in MainActivity
                (requireActivity() as? com.example.driverrewards.MainActivity)?.refreshPointsDisplay()
                try {
                    val profileViewModel = androidx.lifecycle.ViewModelProvider(requireActivity())[com.example.driverrewards.ui.profile.ProfileViewModel::class.java]
                    profileViewModel.refreshProfile()
                } catch (e: Exception) {
                    // ProfileViewModel might not be available, that's okay
                }
            }
        })
    }

    private fun loadOrderDetail(orderId: String) {
        ordersViewModel.getOrderDetail(orderId,
            onSuccess = { order ->
                displayOrder(order)
            },
            onError = { error ->
                Toast.makeText(requireContext(), error, Toast.LENGTH_SHORT).show()
                findNavController().navigateUp()
            }
        )
    }

    private fun displayOrder(order: com.example.driverrewards.network.OrderData) {
        // Store current order for re-order functionality
        currentOrder = order
        
        binding.orderNumber.text = "Order #${order.orderNumber ?: "Unknown"}"
        
        // Status badge
        val status = order.status ?: "unknown"
        binding.orderStatus.text = status.replaceFirstChar { it.uppercase() }
        when (status.lowercase()) {
            "completed" -> {
                binding.orderStatus.setBackgroundColor(0xFFE3F2FD.toInt())
                binding.orderStatus.setTextColor(0xFF1976D2.toInt())
            }
            "pending" -> {
                binding.orderStatus.setBackgroundColor(0xFFFFF9C4.toInt())
                binding.orderStatus.setTextColor(0xFFF57F17.toInt())
            }
            "refunded", "cancelled" -> {
                binding.orderStatus.setBackgroundColor(0xFFFFEBEE.toInt())
                binding.orderStatus.setTextColor(0xFFC62828.toInt())
            }
            else -> {
                binding.orderStatus.setBackgroundColor(0xFFF5F5F5.toInt())
                binding.orderStatus.setTextColor(0xFF757575.toInt())
            }
        }

        // Date
        try {
            if (order.createdAt != null) {
                val inputFormat = SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.getDefault())
                val outputFormat = SimpleDateFormat("MMM dd, yyyy 'at' h:mm a", Locale.getDefault())
                val date = inputFormat.parse(order.createdAt)
                binding.orderDate.text = "Date: ${date?.let { outputFormat.format(it) } ?: order.createdAt}"
            } else {
                binding.orderDate.text = "Date: Unknown"
            }
        } catch (e: Exception) {
            binding.orderDate.text = "Date: ${order.createdAt ?: "Unknown"}"
        }

        binding.orderTotal.text = "Total: ${order.totalPoints} pts"

        // Order items - update adapter with new items (callback is already set in setupRecyclerView)
        orderItemsAdapter.updateItems(order.orderItems)

        // Cancel/Refund buttons
        when (status.lowercase()) {
            "pending" -> {
                binding.cancelButton.visibility = View.VISIBLE
                binding.refundButton.visibility = View.GONE
                binding.cancelButton.setOnClickListener {
                    showCancelDialog(order.orderId ?: "")
                }
            }
            "completed" -> {
                binding.cancelButton.visibility = View.GONE
                if (order.canRefund) {
                    binding.refundButton.visibility = View.VISIBLE
                    binding.refundButton.setOnClickListener {
                        showRefundDialog(order.orderId ?: "")
                    }
                } else {
                    binding.refundButton.visibility = View.GONE
                }
            }
            else -> {
                binding.cancelButton.visibility = View.GONE
                binding.refundButton.visibility = View.GONE
            }
        }
    }

    private fun showCancelDialog(orderId: String) {
        MaterialAlertDialogBuilder(requireContext())
            .setTitle("Cancel Order")
            .setMessage("Are you sure you want to cancel this order? Points will be returned to your account.")
            .setPositiveButton("Cancel Order") { _, _ ->
                ordersViewModel.cancelOrder(orderId)
                // Refresh points display after cancel
                (requireActivity() as? com.example.driverrewards.MainActivity)?.refreshPointsDisplay()
                try {
                    val profileViewModel = androidx.lifecycle.ViewModelProvider(requireActivity())[com.example.driverrewards.ui.profile.ProfileViewModel::class.java]
                    profileViewModel.refreshProfile()
                } catch (e: Exception) {
                    // ProfileViewModel might not be available, that's okay
                }
                findNavController().navigateUp()
            }
            .setNegativeButton("Keep Order", null)
            .show()
    }

    private fun showRefundDialog(orderId: String) {
        MaterialAlertDialogBuilder(requireContext())
            .setTitle("Refund Order")
            .setMessage("Are you sure you want to refund this order? Points will be returned to your account.")
            .setPositiveButton("Refund") { _, _ ->
                ordersViewModel.refundOrder(orderId)
                // Refresh points display after refund
                (requireActivity() as? com.example.driverrewards.MainActivity)?.refreshPointsDisplay()
                try {
                    val profileViewModel = androidx.lifecycle.ViewModelProvider(requireActivity())[com.example.driverrewards.ui.profile.ProfileViewModel::class.java]
                    profileViewModel.refreshProfile()
                } catch (e: Exception) {
                    // ProfileViewModel might not be available, that's okay
                }
                findNavController().navigateUp()
            }
            .setNegativeButton("Cancel", null)
            .show()
    }
    
    private fun reorderItems(order: com.example.driverrewards.network.OrderData) {
        if (order.orderItems.isEmpty()) {
            Toast.makeText(requireContext(), "No items to re-order", Toast.LENGTH_SHORT).show()
            return
        }
        
        // Navigate directly to checkout with orderId (no cart operations)
        val orderId = order.orderId
        if (orderId.isNullOrEmpty()) {
            Toast.makeText(requireContext(), "Invalid order ID", Toast.LENGTH_SHORT).show()
            return
        }
        
        // Calculate item count
        val itemCount = order.orderItems.sumOf { it.quantity }
        
        // Navigate to checkout with orderId and order totals
        val bundle = Bundle().apply {
            putString("orderId", orderId)
            putInt("totalPoints", order.totalPoints)
            putInt("itemCount", itemCount)
        }
        
        try {
            findNavController().navigate(R.id.action_order_detail_to_checkout, bundle)
        } catch (e: Exception) {
            android.util.Log.e("OrderDetailFragment", "Error navigating to checkout: ${e.message}", e)
            Toast.makeText(requireContext(), "Error navigating to checkout", Toast.LENGTH_SHORT).show()
        }
    }
    
    private fun addAllToCart(order: com.example.driverrewards.network.OrderData) {
        if (order.orderItems.isEmpty()) {
            Toast.makeText(requireContext(), "No items to add", Toast.LENGTH_SHORT).show()
            return
        }
        
        // Show loading state
        binding.addAllToCartButton.isEnabled = false
        binding.addAllToCartButton.text = "Adding items..."
        
        // Add items directly without clearing cart or navigating
        addOrderItemsToCart(order.orderItems, navigateToCheckout = false)
    }
    
    private fun addOrderItemsToCart(items: List<com.example.driverrewards.network.OrderItem>, navigateToCheckout: Boolean = false) {
        if (items.isEmpty()) {
            // Restore button states
            binding.reorderButton.isEnabled = true
            binding.reorderButton.text = "Re-order"
            binding.addAllToCartButton.isEnabled = true
            binding.addAllToCartButton.text = "Add all to cart"
            
            // Navigate to checkout only if requested (for re-order)
            if (navigateToCheckout) {
                navigateToCheckout()
            } else {
                Toast.makeText(requireContext(), "Items added to cart", Toast.LENGTH_SHORT).show()
            }
            return
        }
        
        val item = items[0]
        val remainingItems = items.drop(1)
        
        // Use externalItemId, or construct from title if not available
        val itemId = item.externalItemId ?: item.title ?: ""
        if (itemId.isEmpty()) {
            // Skip this item and continue with remaining
            addOrderItemsToCart(remainingItems)
            return
        }
        
        // Add item to cart
        cartViewModel.addToCart(
            itemId = itemId,
            title = item.title ?: "Unknown Item",
            imageUrl = "", // Not available in order item, will use placeholder
            itemUrl = "", // Not available in order item
            points = item.unitPoints,
            quantity = item.quantity
        )
        
        // Wait for add to cart to complete
        cartViewModel.addToCartSuccess.observe(viewLifecycleOwner, object : androidx.lifecycle.Observer<Boolean?> {
            override fun onChanged(success: Boolean?) {
                if (success != null) {
                    cartViewModel.addToCartSuccess.removeObserver(this)
                    if (success == true) {
                        // Successfully added, continue with next item
                        cartViewModel.clearAddToCartSuccess()
                        addOrderItemsToCart(remainingItems, navigateToCheckout)
                    } else {
                        // Failed to add this item, but continue with others
                        addOrderItemsToCart(remainingItems, navigateToCheckout)
                    }
                }
            }
        })
    }
    
    private fun navigateToCheckout() {
        // Wait a moment for cart to finish updating, then navigate
        binding.root.postDelayed({
            try {
                val totalPoints = cartViewModel.totalPoints.value ?: 0
                val itemCount = cartViewModel.itemCount.value ?: 0
                
                val bundle = Bundle().apply {
                    putInt("totalPoints", totalPoints)
                    putInt("itemCount", itemCount)
                }
                
                // Navigate to checkout
                findNavController().navigate(R.id.action_order_detail_to_checkout, bundle)
            } catch (e: Exception) {
                android.util.Log.e("OrderDetailFragment", "Error navigating to checkout: ${e.message}", e)
                // Try navigation without bundle
                try {
                    findNavController().navigate(R.id.action_order_detail_to_checkout)
                } catch (e2: Exception) {
                    Toast.makeText(requireContext(), "Error navigating to checkout", Toast.LENGTH_SHORT).show()
                }
            } finally {
                binding.reorderButton.isEnabled = true
                binding.reorderButton.text = "Re-order"
            }
        }, 500)
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/orders/OrderItemsAdapter.kt =====

```kotlin
package com.example.driverrewards.ui.orders

import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.TextView
import androidx.recyclerview.widget.RecyclerView
import com.example.driverrewards.R
import com.example.driverrewards.network.OrderItem

class OrderItemsAdapter(
    private var items: List<OrderItem>,
    private val onItemClick: ((OrderItem) -> Unit)? = null
) : RecyclerView.Adapter<OrderItemsAdapter.ViewHolder>() {

    class ViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        val itemTitle: TextView = itemView.findViewById(R.id.item_title)
        val variationDetails: TextView = itemView.findViewById(R.id.variation_details)
        val itemPoints: TextView = itemView.findViewById(R.id.item_points)
        val itemQuantity: TextView = itemView.findViewById(R.id.item_quantity)
        val itemLineTotal: TextView = itemView.findViewById(R.id.item_line_total)
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_order_detail, parent, false)
        return ViewHolder(view)
    }

    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        val item = items[position]
        
        holder.itemTitle.text = item.title ?: "Unknown Item"
        
        // Display variation details if present
        if (!item.variationInfo.isNullOrEmpty()) {
            val variationMap = try {
                item.variationInfo.split("|").associate { part ->
                    val parts = part.split(":", limit = 2)
                    if (parts.size == 2) {
                        parts[0] to parts[1]
                    } else {
                        "" to ""
                    }
                }.filter { it.key.isNotEmpty() }
            } catch (e: Exception) {
                emptyMap()
            }
            
            if (variationMap.isNotEmpty()) {
                val variationText = variationMap.entries.joinToString(", ") { "${it.key}: ${it.value}" }
                holder.variationDetails.text = variationText
                holder.variationDetails.visibility = View.VISIBLE
            } else {
                holder.variationDetails.visibility = View.GONE
            }
        } else {
            holder.variationDetails.visibility = View.GONE
        }
        
        holder.itemPoints.text = "${item.unitPoints} pts each"
        holder.itemQuantity.text = item.quantity.toString()
        holder.itemLineTotal.text = "Total: ${item.lineTotalPoints} pts"
        
        // Make card clickable
        holder.itemView.setOnClickListener {
            onItemClick?.invoke(item)
        }
        holder.itemView.isClickable = true
        holder.itemView.isFocusable = true
    }

    override fun getItemCount() = items.size

    fun updateItems(newItems: List<OrderItem>) {
        items = newItems
        notifyDataSetChanged()
    }
    
    fun updateItems(newItems: List<OrderItem>, onItemClick: ((OrderItem) -> Unit)?) {
        items = newItems
        // Note: Can't change callback after creation, but if items change we can use the existing one
        notifyDataSetChanged()
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/orders/OrdersAdapter.kt =====

```kotlin
package com.example.driverrewards.ui.orders

import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.TextView
import androidx.recyclerview.widget.RecyclerView
import com.example.driverrewards.R
import com.example.driverrewards.network.OrderData
import java.text.SimpleDateFormat
import java.util.*

class OrdersAdapter(
    private val orders: List<OrderData>,
    private val onRefundClick: (String) -> Unit,
    private val onViewDetailsClick: (String) -> Unit
) : RecyclerView.Adapter<OrdersAdapter.ViewHolder>() {

    private val dateFormat = SimpleDateFormat("MMM dd, yyyy", Locale.getDefault())

    class ViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        val orderNumber: TextView = itemView.findViewById(R.id.order_number)
        val orderDate: TextView = itemView.findViewById(R.id.order_date)
        val orderStatus: TextView = itemView.findViewById(R.id.order_status)
        val totalPoints: TextView = itemView.findViewById(R.id.total_points)
        val itemCount: TextView = itemView.findViewById(R.id.item_count)
        val refundButton: com.google.android.material.button.MaterialButton = itemView.findViewById(R.id.refund_button)
        val viewDetailsButton: com.google.android.material.button.MaterialButton = itemView.findViewById(R.id.view_details_button)
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_order, parent, false)
        return ViewHolder(view)
    }

    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        val order = orders[position]
        
        holder.orderNumber.text = order.orderNumber ?: "Unknown Order"
        
        // Format date
        try {
            if (order.createdAt != null) {
                val date = SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.getDefault()).parse(order.createdAt)
                holder.orderDate.text = date?.let { dateFormat.format(it) } ?: order.createdAt
            } else {
                holder.orderDate.text = "Unknown date"
            }
        } catch (e: Exception) {
            holder.orderDate.text = order.createdAt ?: "Unknown date"
        }
        
        // Status badge
        val status = order.status ?: "unknown"
        holder.orderStatus.text = status.replaceFirstChar { it.uppercase() }
        when (status.lowercase()) {
            "completed" -> {
                holder.orderStatus.setBackgroundColor(0xFFE3F2FD.toInt())
                holder.orderStatus.setTextColor(0xFF1976D2.toInt())
            }
            "pending" -> {
                holder.orderStatus.setBackgroundColor(0xFFFFF9C4.toInt())
                holder.orderStatus.setTextColor(0xFFF57F17.toInt())
            }
            "refunded", "cancelled" -> {
                holder.orderStatus.setBackgroundColor(0xFFFFEBEE.toInt())
                holder.orderStatus.setTextColor(0xFFC62828.toInt())
            }
            else -> {
                holder.orderStatus.setBackgroundColor(0xFFF5F5F5.toInt())
                holder.orderStatus.setTextColor(0xFF757575.toInt())
            }
        }
        
        holder.totalPoints.text = "${order.totalPoints} pts"
        holder.itemCount.text = "${order.orderItems.size} item(s)"
        
        // Refund/Cancel button visibility
        when (status.lowercase()) {
            "pending" -> {
                holder.refundButton.visibility = View.VISIBLE
                holder.refundButton.text = "Cancel"
                holder.refundButton.setOnClickListener {
                    onRefundClick(order.orderId ?: "") // Reuse for cancel
                }
            }
            "completed" -> {
                if (order.canRefund) {
                    holder.refundButton.visibility = View.VISIBLE
                    holder.refundButton.text = "Refund"
                    holder.refundButton.setOnClickListener {
                        onRefundClick(order.orderId ?: "")
                    }
                } else {
                    holder.refundButton.visibility = View.GONE
                }
            }
            else -> {
                holder.refundButton.visibility = View.GONE
            }
        }
        
        holder.viewDetailsButton.setOnClickListener {
            onViewDetailsClick(order.orderId ?: "")
        }
    }

    override fun getItemCount() = orders.size
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/orders/OrdersFragment.kt =====

```kotlin
package com.example.driverrewards.ui.orders

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.Observer
import androidx.navigation.fragment.findNavController
import androidx.recyclerview.widget.LinearLayoutManager
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentOrdersBinding
import com.google.android.material.dialog.MaterialAlertDialogBuilder

class OrdersFragment : Fragment() {

    private var _binding: FragmentOrdersBinding? = null
    private val binding get() = _binding!!
    private lateinit var ordersViewModel: OrdersViewModel
    private lateinit var ordersAdapter: OrdersAdapter

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        ordersViewModel = ViewModelProvider(requireActivity())[OrdersViewModel::class.java]
        _binding = FragmentOrdersBinding.inflate(inflater, container, false)

        setupRecyclerView()
        setupObservers()
        setupSwipeRefresh()

        // Load orders
        ordersViewModel.loadOrders(refresh = true)

        return binding.root
    }

    private fun setupRecyclerView() {
        ordersAdapter = OrdersAdapter(
            orders = emptyList(),
            onRefundClick = { orderId ->
                // Check order status to determine if it's cancel or refund
                val order = ordersViewModel.orders.value?.find { it.orderId == orderId }
                if (order?.status?.lowercase() == "pending") {
                    showCancelDialog(orderId)
                } else {
                    showRefundDialog(orderId)
                }
            },
            onViewDetailsClick = { orderId ->
                // Navigate to order details
                val bundle = Bundle().apply {
                    putString("orderId", orderId)
                }
                findNavController().navigate(R.id.action_orders_to_order_detail, bundle)
            }
        )
        
        val layoutManager = LinearLayoutManager(requireContext())
        binding.recyclerView.layoutManager = layoutManager
        binding.recyclerView.adapter = ordersAdapter
        
        // Load more when scrolling
        binding.recyclerView.addOnScrollListener(object : androidx.recyclerview.widget.RecyclerView.OnScrollListener() {
            override fun onScrolled(recyclerView: androidx.recyclerview.widget.RecyclerView, dx: Int, dy: Int) {
                super.onScrolled(recyclerView, dx, dy)
                val totalItemCount = layoutManager.itemCount
                val lastVisibleItem = layoutManager.findLastVisibleItemPosition()
                
                if (lastVisibleItem >= totalItemCount - 5) {
                    ordersViewModel.loadMoreOrders()
                }
            }
        })
    }

    private fun setupObservers() {
        ordersViewModel.orders.observe(viewLifecycleOwner, Observer { orders ->
            ordersAdapter = OrdersAdapter(
                orders = orders,
                onRefundClick = { orderId ->
                    // Check order status to determine if it's cancel or refund
                    val order = orders.find { it.orderId == orderId }
                    if (order?.status?.lowercase() == "pending") {
                        showCancelDialog(orderId)
                    } else {
                        showRefundDialog(orderId)
                    }
                },
                onViewDetailsClick = { orderId ->
                    // Navigate to order details
                    val bundle = Bundle().apply {
                        putString("orderId", orderId)
                    }
                    findNavController().navigate(R.id.action_orders_to_order_detail, bundle)
                }
            )
            binding.recyclerView.adapter = ordersAdapter
            
            // Show/hide empty message
            if (orders.isEmpty()) {
                binding.emptyOrdersMessage.visibility = View.VISIBLE
                binding.recyclerView.visibility = View.GONE
            } else {
                binding.emptyOrdersMessage.visibility = View.GONE
                binding.recyclerView.visibility = View.VISIBLE
            }
        })

        ordersViewModel.isLoading.observe(viewLifecycleOwner, Observer { isLoading ->
            binding.progressBar.visibility = if (isLoading) View.VISIBLE else View.GONE
            // Stop swipe refresh when loading completes
            if (!isLoading) {
                binding.swipeRefresh.isRefreshing = false
            }
        })

        ordersViewModel.isLoadingMore.observe(viewLifecycleOwner, Observer { isLoadingMore ->
            binding.loadingMore.visibility = if (isLoadingMore) View.VISIBLE else View.GONE
        })

        ordersViewModel.errorMessage.observe(viewLifecycleOwner, Observer { error ->
            error?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_SHORT).show()
            }
        })

        ordersViewModel.refundSuccess.observe(viewLifecycleOwner, Observer { success ->
            if (success == true) {
                Toast.makeText(requireContext(), "Order refunded successfully", Toast.LENGTH_SHORT).show()
                // Refresh points display in MainActivity
                (requireActivity() as? com.example.driverrewards.MainActivity)?.refreshPointsDisplay()
                // Refresh profile if using ProfileViewModel
                try {
                    val profileViewModel = androidx.lifecycle.ViewModelProvider(requireActivity())[com.example.driverrewards.ui.profile.ProfileViewModel::class.java]
                    profileViewModel.refreshProfile()
                } catch (e: Exception) {
                    // ProfileViewModel might not be available, that's okay
                }
            }
        })
        
        ordersViewModel.cancelSuccess.observe(viewLifecycleOwner, Observer { success ->
            if (success == true) {
                Toast.makeText(requireContext(), "Order cancelled successfully", Toast.LENGTH_SHORT).show()
                // Refresh points display in MainActivity
                (requireActivity() as? com.example.driverrewards.MainActivity)?.refreshPointsDisplay()
                // Refresh profile if using ProfileViewModel
                try {
                    val profileViewModel = androidx.lifecycle.ViewModelProvider(requireActivity())[com.example.driverrewards.ui.profile.ProfileViewModel::class.java]
                    profileViewModel.refreshProfile()
                } catch (e: Exception) {
                    // ProfileViewModel might not be available, that's okay
                }
            }
        })
    }

    private fun setupSwipeRefresh() {
        binding.swipeRefresh.setOnRefreshListener {
            ordersViewModel.refreshOrders()
        }
    }

    private fun showRefundDialog(orderId: String) {
        MaterialAlertDialogBuilder(requireContext())
            .setTitle("Refund Order")
            .setMessage("Are you sure you want to refund this order? Points will be returned to your account.")
            .setPositiveButton("Refund") { _, _ ->
                ordersViewModel.refundOrder(orderId)
            }
            .setNegativeButton("Cancel", null)
            .show()
    }
    
    private fun showCancelDialog(orderId: String) {
        MaterialAlertDialogBuilder(requireContext())
            .setTitle("Cancel Order")
            .setMessage("Are you sure you want to cancel this order? Points will be returned to your account.")
            .setPositiveButton("Cancel Order") { _, _ ->
                ordersViewModel.cancelOrder(orderId)
            }
            .setNegativeButton("Keep Order", null)
            .show()
    }

    override fun onResume() {
        super.onResume()
        ordersViewModel.refreshOrders()
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/orders/OrdersViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.orders

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.example.driverrewards.network.OrdersService
import com.example.driverrewards.network.OrderData
import kotlinx.coroutines.launch

class OrdersViewModel : ViewModel() {

    private val ordersService = OrdersService()
    
    private val _orders = MutableLiveData<List<OrderData>>()
    val orders: LiveData<List<OrderData>> = _orders
    
    private val _isLoading = MutableLiveData<Boolean>(false)
    val isLoading: LiveData<Boolean> = _isLoading
    
    private val _isLoadingMore = MutableLiveData<Boolean>(false)
    val isLoadingMore: LiveData<Boolean> = _isLoadingMore
    
    private val _hasMore = MutableLiveData<Boolean>(false)
    val hasMore: LiveData<Boolean> = _hasMore
    
    private val _errorMessage = MutableLiveData<String?>()
    val errorMessage: LiveData<String?> = _errorMessage
    
    private val _refundSuccess = MutableLiveData<Boolean>()
    val refundSuccess: LiveData<Boolean> = _refundSuccess
    
    private val _cancelSuccess = MutableLiveData<Boolean>()
    val cancelSuccess: LiveData<Boolean> = _cancelSuccess
    
    private var currentPage = 1
    private val pageSize = 20
    
    fun loadOrders(refresh: Boolean = false) {
        viewModelScope.launch {
            try {
                if (refresh) {
                    currentPage = 1
                    _orders.value = emptyList()
                }
                
                _isLoading.value = true
                _errorMessage.value = null
                
                val response = ordersService.getOrders(currentPage, pageSize)
                
                if (response.success) {
                    val currentOrders = _orders.value?.toMutableList() ?: mutableListOf()
                    if (refresh) {
                        currentOrders.clear()
                    }
                    currentOrders.addAll(response.orders)
                    _orders.value = currentOrders
                    _hasMore.value = response.hasMore
                    currentPage++
                } else {
                    _errorMessage.value = response.message ?: "Failed to load orders"
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error loading orders: ${e.message}"
            } finally {
                _isLoading.value = false
            }
        }
    }
    
    fun loadMoreOrders() {
        if (_isLoadingMore.value == true || _hasMore.value == false) {
            return
        }
        
        viewModelScope.launch {
            try {
                _isLoadingMore.value = true
                
                val response = ordersService.getOrders(currentPage, pageSize)
                
                if (response.success) {
                    val currentOrders = _orders.value?.toMutableList() ?: mutableListOf()
                    currentOrders.addAll(response.orders)
                    _orders.value = currentOrders
                    _hasMore.value = response.hasMore
                    currentPage++
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error loading more orders: ${e.message}"
            } finally {
                _isLoadingMore.value = false
            }
        }
    }
    
    fun getOrderDetail(orderId: String, onSuccess: (OrderData) -> Unit, onError: (String) -> Unit) {
        viewModelScope.launch {
            try {
                val response = ordersService.getOrderDetail(orderId)
                
                if (response.success && response.order != null) {
                    onSuccess(response.order)
                } else {
                    onError(response.message ?: "Failed to load order details")
                }
            } catch (e: Exception) {
                onError("Error loading order details: ${e.message}")
            }
        }
    }
    
    fun refundOrder(orderId: String) {
        viewModelScope.launch {
            try {
                _errorMessage.value = null
                
                val response = ordersService.refundOrder(orderId)
                
                if (response.success) {
                    _refundSuccess.value = true
                    // Reload orders to get updated status
                    loadOrders(refresh = true)
                } else {
                    _errorMessage.value = response.message ?: "Failed to refund order"
                    _refundSuccess.value = false
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error refunding order: ${e.message}"
                _refundSuccess.value = false
            }
        }
    }
    
    fun cancelOrder(orderId: String) {
        viewModelScope.launch {
            try {
                _errorMessage.value = null
                
                val response = ordersService.cancelOrder(orderId)
                
                if (response.success) {
                    _cancelSuccess.value = true
                    // Reload orders to get updated status
                    loadOrders(refresh = true)
                } else {
                    _errorMessage.value = response.message ?: "Failed to cancel order"
                    _cancelSuccess.value = false
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error cancelling order: ${e.message}"
                _cancelSuccess.value = false
            }
        }
    }
    
    fun refreshOrders() {
        loadOrders(refresh = true)
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/points/PointsDetailFragment.kt =====

```kotlin
package com.example.driverrewards.ui.points

import android.os.Bundle
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.lifecycle.Observer
import androidx.recyclerview.widget.LinearLayoutManager
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentPointsDetailBinding
import com.github.mikephil.charting.charts.LineChart
import com.github.mikephil.charting.charts.BarChart
import com.github.mikephil.charting.charts.PieChart
import com.github.mikephil.charting.charts.CombinedChart
import com.github.mikephil.charting.components.XAxis
import com.github.mikephil.charting.components.YAxis
import com.github.mikephil.charting.data.Entry
import com.github.mikephil.charting.data.LineData
import com.github.mikephil.charting.data.LineDataSet
import com.github.mikephil.charting.data.BarData
import com.github.mikephil.charting.data.BarDataSet
import com.github.mikephil.charting.data.BarEntry
import com.github.mikephil.charting.data.PieData
import com.github.mikephil.charting.data.PieDataSet
import com.github.mikephil.charting.data.PieEntry
import com.github.mikephil.charting.data.CombinedData
import com.github.mikephil.charting.formatter.ValueFormatter
import com.github.mikephil.charting.formatter.IndexAxisValueFormatter
import android.graphics.Color
import com.google.android.material.tabs.TabLayout
import java.text.SimpleDateFormat
import java.util.*

class PointsDetailFragment : Fragment() {

    private var _binding: FragmentPointsDetailBinding? = null
    private val binding get() = _binding!!
    private lateinit var viewModel: PointsViewModel
    private lateinit var historyAdapter: PointsTransactionAdapter
    private var currentPeriod = "30d"
    private var currentGranularity = "day"
    private var currentGraphType = "balance" // balance, earned_spent, reason, frequency, cumulative, combined
    private var currentReasonType = "all" // all, positive, negative
    private var customStartDate: String? = null
    private var customEndDate: String? = null

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        viewModel = ViewModelProvider(requireActivity())[PointsViewModel::class.java]
        _binding = FragmentPointsDetailBinding.inflate(inflater, container, false)

        // Restore state if available
        savedInstanceState?.let {
            currentPeriod = it.getString("currentPeriod", "30d")
            currentGranularity = it.getString("currentGranularity", "day")
            currentGraphType = it.getString("currentGraphType", "balance")
            customStartDate = it.getString("customStartDate")
            customEndDate = it.getString("customEndDate")
            isSettingsExpanded = it.getBoolean("isSettingsExpanded", false)
        }

        setupRecyclerView()
        setupTabLayout()
        setupObservers()
        setupClickListeners()
        loadData()
        
        // Restore UI state
        restoreUIState()

        return binding.root
    }
    
    override fun onSaveInstanceState(outState: Bundle) {
        super.onSaveInstanceState(outState)
        outState.putString("currentPeriod", currentPeriod)
        outState.putString("currentGranularity", currentGranularity)
        outState.putString("currentGraphType", currentGraphType)
        outState.putString("customStartDate", customStartDate)
        outState.putString("customEndDate", customEndDate)
        outState.putBoolean("isSettingsExpanded", isSettingsExpanded)
        
        // Save settings preferences
        val prefs = requireContext().getSharedPreferences("points_graph_prefs", android.content.Context.MODE_PRIVATE)
        prefs.edit().apply {
            putString("graphType", currentGraphType)
            putString("reasonType", currentReasonType)
            putBoolean("smoothLines", binding.smoothLines.isChecked)
            putBoolean("showGridLines", binding.showGridLines.isChecked)
            putBoolean("showDataPoints", binding.showDataPoints.isChecked)
            putBoolean("showLegend", binding.showLegend.isChecked)
            putBoolean("enableAnimation", binding.enableAnimation.isChecked)
            putBoolean("autoYAxis", binding.autoYAxis.isChecked)
            putBoolean("filterEarnedOnly", binding.filterEarnedOnly.isChecked)
            putBoolean("filterSpentOnly", binding.filterSpentOnly.isChecked)
            putFloat("minDelta", binding.minDeltaSlider.value)
            apply()
        }
    }
    
    private fun restoreUIState() {
        val prefs = requireContext().getSharedPreferences("points_graph_prefs", android.content.Context.MODE_PRIVATE)
        
        // Restore graph type
        val savedGraphType = prefs.getString("graphType", "balance")
        if (savedGraphType != null && savedGraphType != currentGraphType) {
            currentGraphType = savedGraphType
            switchGraphType(savedGraphType)
        }
        
        // Restore reason type
        currentReasonType = prefs.getString("reasonType", "all") ?: "all"
        
        // Restore settings
        binding.smoothLines.isChecked = prefs.getBoolean("smoothLines", true)
        binding.showGridLines.isChecked = prefs.getBoolean("showGridLines", true)
        binding.showDataPoints.isChecked = prefs.getBoolean("showDataPoints", false)
        binding.showLegend.isChecked = prefs.getBoolean("showLegend", false)
        binding.enableAnimation.isChecked = prefs.getBoolean("enableAnimation", true)
        binding.autoYAxis.isChecked = prefs.getBoolean("autoYAxis", true)
        binding.filterEarnedOnly.isChecked = prefs.getBoolean("filterEarnedOnly", false)
        binding.filterSpentOnly.isChecked = prefs.getBoolean("filterSpentOnly", false)
        binding.minDeltaSlider.value = prefs.getFloat("minDelta", 0f)
        
        // Restore settings panel state
        if (isSettingsExpanded) {
            binding.settingsContent.visibility = View.VISIBLE
            binding.settingsExpandIcon.rotation = 180f
        }
        
        // Restore date range display
        if (customStartDate != null && customEndDate != null) {
            try {
                val startFormat = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault())
                val endFormat = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault())
                val startDate = startFormat.parse(customStartDate)
                val endDate = endFormat.parse(customEndDate)
                val displayFormat = SimpleDateFormat("MMM d, yyyy", Locale.getDefault())
                binding.dateRangeDisplay.text = "${displayFormat.format(startDate)} - ${displayFormat.format(endDate)}"
                binding.dateRangeContainer.visibility = View.VISIBLE
            } catch (e: Exception) {
                // Ignore parsing errors
            }
        } else {
            binding.dateRangeDisplay.text = when (currentPeriod) {
                "7d" -> "Last 7 days"
                "30d" -> "Last 30 days"
                "90d" -> "Last 90 days"
                "1y" -> "Last year"
                "all" -> "All time"
                else -> "Auto"
            }
        }
        
        // Apply filters to ViewModel
        viewModel.setFilters(
            showEarnedOnly = binding.filterEarnedOnly.isChecked,
            showSpentOnly = binding.filterSpentOnly.isChecked,
            minDelta = binding.minDeltaSlider.value.toInt()
        )
    }

    private fun setupRecyclerView() {
        historyAdapter = PointsTransactionAdapter(emptyList()) { transaction ->
            // Handle transaction click - could navigate to order detail if transaction_id is present
            transaction.transactionId?.let { transactionId ->
                // Navigate to order detail if needed
                android.util.Log.d("PointsDetailFragment", "Transaction clicked: $transactionId")
            }
        }
        binding.historyRecycler.layoutManager = LinearLayoutManager(requireContext())
        binding.historyRecycler.adapter = historyAdapter
    }

    private fun setupTabLayout() {
        binding.tabLayout.addOnTabSelectedListener(object : TabLayout.OnTabSelectedListener {
            override fun onTabSelected(tab: TabLayout.Tab?) {
                when (tab?.position) {
                    0 -> showHistoryTab()
                    1 -> showGraphTab()
                    2 -> showInfoTab()
                }
            }

            override fun onTabUnselected(tab: TabLayout.Tab?) {}
            override fun onTabReselected(tab: TabLayout.Tab?) {}
        })
        // Default to history tab
        showHistoryTab()
    }

    private fun showHistoryTab() {
        binding.historyTab.visibility = View.VISIBLE
        binding.graphTab.visibility = View.GONE
        binding.infoTab.visibility = View.GONE
    }

    private fun showGraphTab() {
        binding.historyTab.visibility = View.GONE
        binding.graphTab.visibility = View.VISIBLE
        binding.infoTab.visibility = View.GONE
        // Load graph data if not already loaded
        if (viewModel.graphData.value.isNullOrEmpty()) {
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
        } else {
            updateChart()
        }
    }

    private fun showInfoTab() {
        binding.historyTab.visibility = View.GONE
        binding.graphTab.visibility = View.GONE
        binding.infoTab.visibility = View.VISIBLE
    }

    private fun setupObservers() {
        viewModel.pointsDetails.observe(viewLifecycleOwner) { details ->
            details?.let {
                if (it.success) {
                    binding.currentBalance.text = it.currentBalance.toString()
                    binding.dollarValue.text = "≈ $${String.format("%.2f", it.dollarValue)}"
                    binding.conversionRate.text = "1 point = $${String.format("%.2f", it.conversionRate)}"
                    
                    // Update info tab with conversion info
                    val conversionInfo = "Your current conversion rate is $${String.format("%.2f", it.conversionRate)} per point. " +
                            "This rate may vary by sponsor. Your current balance of ${it.currentBalance} points " +
                            "is worth approximately $${String.format("%.2f", it.dollarValue)}."
                    binding.conversionInfo.text = conversionInfo
                }
            }
        }

        viewModel.pointsHistory.observe(viewLifecycleOwner) { history ->
            if (history.isNotEmpty()) {
                historyAdapter.updateTransactions(history)
                binding.emptyHistory.visibility = View.GONE
                binding.historyRecycler.visibility = View.VISIBLE
            } else {
                binding.emptyHistory.visibility = View.VISIBLE
                binding.historyRecycler.visibility = View.GONE
            }
            // Update charts that depend on history data
            if (currentGraphType in listOf("earned_spent", "reason", "frequency", "cumulative", "combined")) {
                updateChart()
            }
        }

        viewModel.graphData.observe(viewLifecycleOwner) { data ->
            if (data.isNotEmpty()) {
                updateChart()
            } else {
                // Handle empty state for charts that depend on graphData
                if (currentGraphType == "balance" || currentGraphType == "cumulative" || currentGraphType == "combined") {
                    binding.emptyGraph.visibility = View.VISIBLE
                    binding.emptyGraph.text = "No graph data available"
                    binding.chartContainer.visibility = View.VISIBLE
                }
            }
        }

        viewModel.isLoading.observe(viewLifecycleOwner) { isLoading ->
            binding.progressBar.visibility = if (isLoading) View.VISIBLE else View.GONE
        }

        viewModel.errorMessage.observe(viewLifecycleOwner) { errorMessage ->
            errorMessage?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_LONG).show()
                viewModel.clearError()
            }
        }
    }

    private fun setupClickListeners() {
        binding.refreshButton.setOnClickListener {
            loadData()
        }

        // Period buttons - ButtonGroup handles selection automatically
        binding.period7d.setOnClickListener {
            currentPeriod = "7d"
            customStartDate = null
            customEndDate = null
            binding.dateRangeContainer.visibility = View.GONE
            binding.dateRangeDisplay.text = "Last 7 days"
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
            viewModel.loadPointsHistory() // Reload history for filtered charts
            updateChart() // Update chart to refresh title
        }
        binding.period30d.setOnClickListener {
            currentPeriod = "30d"
            customStartDate = null
            customEndDate = null
            binding.dateRangeContainer.visibility = View.GONE
            binding.dateRangeDisplay.text = "Last 30 days"
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
            viewModel.loadPointsHistory()
            updateChart() // Update chart to refresh title
        }
        binding.period90d.setOnClickListener {
            currentPeriod = "90d"
            customStartDate = null
            customEndDate = null
            binding.dateRangeContainer.visibility = View.GONE
            binding.dateRangeDisplay.text = "Last 90 days"
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
            viewModel.loadPointsHistory()
            updateChart() // Update chart to refresh title
        }
        binding.period1y.setOnClickListener {
            currentPeriod = "1y"
            customStartDate = null
            customEndDate = null
            binding.dateRangeContainer.visibility = View.GONE
            binding.dateRangeDisplay.text = "Last year"
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
            viewModel.loadPointsHistory()
            updateChart() // Update chart to refresh title
        }
        binding.periodAll.setOnClickListener {
            currentPeriod = "all"
            customStartDate = null
            customEndDate = null
            binding.dateRangeContainer.visibility = View.GONE
            binding.dateRangeDisplay.text = "All time"
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
            viewModel.loadPointsHistory()
            updateChart() // Update chart to refresh title
        }
        
        // Custom date range button
        binding.customDateRangeButton.setOnClickListener {
            showDateRangePicker()
        }
        
        // Set initial checked button programmatically
        binding.period30d.isChecked = true
        binding.dateRangeDisplay.text = "Last 30 days"
        
        // Granularity buttons
        binding.granularityDay.setOnClickListener {
            currentGranularity = "day"
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
        }
        binding.granularityWeek.setOnClickListener {
            currentGranularity = "week"
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
        }
        binding.granularityMonth.setOnClickListener {
            currentGranularity = "month"
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
        }
        
        // Set initial granularity button
        binding.granularityDay.isChecked = true
        
        // Graph type buttons
        binding.graphTypeBalance.setOnClickListener {
            switchGraphType("balance")
        }
        binding.graphTypeEarnedSpent.setOnClickListener {
            switchGraphType("earned_spent")
        }
        binding.graphTypeReason.setOnClickListener {
            switchGraphType("reason")
        }
        binding.graphTypeFrequency.setOnClickListener {
            switchGraphType("frequency")
        }
        binding.graphTypeCumulative.setOnClickListener {
            switchGraphType("cumulative")
        }
        binding.graphTypeCombined.setOnClickListener {
            switchGraphType("combined")
        }
        
        // Set initial graph type
        binding.graphTypeBalance.isChecked = true
        
        // Reason type buttons
        binding.reasonTypeAll.setOnClickListener {
            currentReasonType = "all"
            if (currentGraphType == "reason") {
                updateReasonChart() // Will update title
            }
        }
        binding.reasonTypePositive.setOnClickListener {
            currentReasonType = "positive"
            if (currentGraphType == "reason") {
                updateReasonChart() // Will update title
            }
        }
        binding.reasonTypeNegative.setOnClickListener {
            currentReasonType = "negative"
            if (currentGraphType == "reason") {
                updateReasonChart() // Will update title
            }
        }
        binding.reasonTypeOrders.setOnClickListener {
            currentReasonType = "orders"
            if (currentGraphType == "reason") {
                updateReasonChart() // Will update title
            }
        }
        binding.reasonTypeAll.isChecked = true
        
        // Settings panel toggle
        binding.settingsHeader.setOnClickListener {
            toggleSettingsPanel()
        }
        
        // Setup settings controls
        setupSettingsControls()
    }
    
    private var isSettingsExpanded = false
    
    private fun toggleSettingsPanel() {
        isSettingsExpanded = !isSettingsExpanded
        binding.settingsContent.visibility = if (isSettingsExpanded) View.VISIBLE else View.GONE
        
        // Rotate icon
        val rotation = if (isSettingsExpanded) 180f else 0f
        binding.settingsExpandIcon.animate()
            .rotation(rotation)
            .setDuration(200)
            .start()
    }
    
    private fun setupSettingsControls() {
        val handler = android.os.Handler(android.os.Looper.getMainLooper())
        
        // Smoothing toggle
        binding.smoothLines.setOnCheckedChangeListener { _, _ ->
            updateChart()
        }
        
        // Y-axis auto toggle
        binding.autoYAxis.setOnCheckedChangeListener { _, isChecked ->
            binding.yAxisMinSlider.isEnabled = !isChecked
            binding.yAxisMaxSlider.isEnabled = !isChecked
            if (isChecked) {
                updateChart() // Reset to auto
            }
        }
        
        // Y-axis sliders
        binding.yAxisMinSlider.addOnChangeListener { _, _, _ ->
            if (!binding.autoYAxis.isChecked) {
                handler.postDelayed({
                    updateChart()
                }, 200)
            }
        }
        
        binding.yAxisMaxSlider.addOnChangeListener { _, _, _ ->
            if (!binding.autoYAxis.isChecked) {
                handler.postDelayed({
                    updateChart()
                }, 200)
            }
        }
        
        // Display settings
        binding.showGridLines.setOnCheckedChangeListener { _, _ ->
            updateChart()
        }
        
        binding.showDataPoints.setOnCheckedChangeListener { _, _ ->
            updateChart()
        }
        
        binding.showLegend.setOnCheckedChangeListener { _, _ ->
            updateChart()
        }
        
        binding.enableAnimation.setOnCheckedChangeListener { _, _ ->
            updateChart()
        }
        
        // Data filters
        binding.filterEarnedOnly.setOnCheckedChangeListener { _, isChecked ->
            if (isChecked) {
                binding.filterSpentOnly.isChecked = false
            }
            viewModel.setFilters(
                showEarnedOnly = isChecked,
                showSpentOnly = binding.filterSpentOnly.isChecked,
                minDelta = binding.minDeltaSlider.value.toInt()
            )
            updateChart()
        }
        
        binding.filterSpentOnly.setOnCheckedChangeListener { _, isChecked ->
            if (isChecked) {
                binding.filterEarnedOnly.isChecked = false
            }
            viewModel.setFilters(
                showEarnedOnly = binding.filterEarnedOnly.isChecked,
                showSpentOnly = isChecked,
                minDelta = binding.minDeltaSlider.value.toInt()
            )
            updateChart()
        }
        
        // Min delta slider
        binding.minDeltaSlider.addOnChangeListener { _, value, _ ->
            binding.minDeltaValue.text = "${value.toInt()} pts"
            viewModel.setFilters(
                showEarnedOnly = binding.filterEarnedOnly.isChecked,
                showSpentOnly = binding.filterSpentOnly.isChecked,
                minDelta = value.toInt()
            )
            handler.postDelayed({
                updateChart()
            }, 200)
        }
    }
    
    private fun showDateRangePicker() {
        // Use Material DatePicker for date range selection
        val today = java.util.Calendar.getInstance()
        val startCalendar = java.util.Calendar.getInstance()
        startCalendar.add(java.util.Calendar.DAY_OF_MONTH, -30)
        
        val datePicker = com.google.android.material.datepicker.MaterialDatePicker.Builder.dateRangePicker()
            .setTitleText("Select Date Range")
            .setSelection(
                androidx.core.util.Pair(
                    startCalendar.timeInMillis,
                    today.timeInMillis
                )
            )
            .build()
        
        datePicker.addOnPositiveButtonClickListener { selection ->
            val startDate = selection.first
            val endDate = selection.second
            
            val startFormat = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault())
            val endFormat = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault())
            
            customStartDate = startFormat.format(Date(startDate))
            customEndDate = endFormat.format(Date(endDate))
            
            val displayFormat = SimpleDateFormat("MMM d, yyyy", Locale.getDefault())
            binding.dateRangeDisplay.text = "${displayFormat.format(Date(startDate))} - ${displayFormat.format(Date(endDate))}"
            binding.dateRangeContainer.visibility = View.VISIBLE
            currentPeriod = "custom"
            
            // Update graph and history with custom dates
            viewModel.loadPointsHistory(customStartDate, customEndDate)
            viewModel.loadPointsGraph(currentPeriod, currentGranularity)
        }
        
        datePicker.show(parentFragmentManager, "DATE_RANGE_PICKER")
    }
    
    private fun switchGraphType(graphType: String) {
        currentGraphType = graphType
        
        // Hide all charts
        binding.pointsChartLine.visibility = View.GONE
        binding.pointsChartBar.visibility = View.GONE
        binding.pointsChartPie.visibility = View.GONE
        binding.pointsChartArea.visibility = View.GONE
        binding.pointsChartCombined.visibility = View.GONE
        
        // Show/hide granularity selector based on graph type
        // Pie chart (reason) doesn't need granularity
        binding.granularityGroup.visibility = if (graphType == "reason") View.GONE else View.VISIBLE
        binding.reasonTypeGroup.visibility = if (graphType == "reason") View.VISIBLE else View.GONE
        binding.legendLabel.visibility = if (graphType == "reason") View.VISIBLE else View.GONE
        
        // Show appropriate chart and update
        when (graphType) {
            "balance" -> {
                binding.pointsChartLine.visibility = View.VISIBLE
                updateBalanceChart()
            }
            "earned_spent" -> {
                binding.pointsChartBar.visibility = View.VISIBLE
                updateEarnedSpentChart()
            }
            "reason" -> {
                binding.pointsChartPie.visibility = View.VISIBLE
                binding.reasonTypeGroup.visibility = View.VISIBLE
                updateReasonChart()
            }
            "frequency" -> {
                binding.pointsChartBar.visibility = View.VISIBLE
                updateFrequencyChart()
            }
            "cumulative" -> {
                binding.pointsChartArea.visibility = View.VISIBLE
                updateCumulativeChart()
            }
            "combined" -> {
                binding.pointsChartCombined.visibility = View.VISIBLE
                updateCombinedChart()
            }
        }
    }


    private fun loadData() {
        viewModel.loadPointsDetails()
        viewModel.loadPointsHistory()
        viewModel.loadPointsGraph(currentPeriod, currentGranularity)
    }

    private fun updateChart() {
        when (currentGraphType) {
            "balance" -> updateBalanceChart()
            "earned_spent" -> updateEarnedSpentChart()
            "reason" -> updateReasonChart()
            "frequency" -> updateFrequencyChart()
            "cumulative" -> updateCumulativeChart()
            "combined" -> updateCombinedChart()
        }
    }
    
    private fun updateBalanceChart() {
        // Update title first, regardless of data availability
        val periodText = when (currentPeriod) {
            "7d" -> "Last 7 Days"
            "30d" -> "Last 30 Days"
            "90d" -> "Last 90 Days"
            "1y" -> "Last Year"
            else -> "All Time"
        }
        binding.chartTitle.text = "Points Balance Over Time ($periodText)"
        
        val dataPoints = viewModel.graphData.value ?: run {
            binding.pointsChartLine.visibility = View.GONE
            binding.emptyGraph.visibility = View.VISIBLE
            binding.emptyGraph.text = "No graph data available"
            return
        }
        
        val chart = binding.pointsChartLine
        
        if (dataPoints.isEmpty()) {
            chart.visibility = View.GONE
            binding.emptyGraph.visibility = View.VISIBLE
            binding.emptyGraph.text = "No graph data available"
            return
        }
        
        chart.visibility = View.VISIBLE
        binding.emptyGraph.visibility = View.GONE
        val balanceEntries = mutableListOf<Entry>()
        val deltaEntries = mutableListOf<BarEntry>()

        // Parse dates and create entries
        val dateFormat = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault())
        dataPoints.forEachIndexed { index, point ->
            try {
                val date = dateFormat.parse(point.date)
                val xValue = date?.time?.toFloat() ?: index.toFloat()
                balanceEntries.add(Entry(xValue, point.balance.toFloat()))
                // Delta bars for dual-axis (optional overlay)
                deltaEntries.add(BarEntry(index.toFloat(), point.delta.toFloat()))
            } catch (e: Exception) {
                balanceEntries.add(Entry(index.toFloat(), point.balance.toFloat()))
                deltaEntries.add(BarEntry(index.toFloat(), point.delta.toFloat()))
            }
        }

        if (balanceEntries.isEmpty()) return

        val balanceDataSet = LineDataSet(balanceEntries, "Points Balance")
        // Get primary color from theme
        val typedValue = android.util.TypedValue()
        requireContext().theme.resolveAttribute(android.R.attr.colorPrimary, typedValue, true)
        val primaryColor = typedValue.data
        balanceDataSet.color = primaryColor
        balanceDataSet.valueTextColor = requireContext().getColor(android.R.color.black)
        balanceDataSet.lineWidth = 2f
        balanceDataSet.setCircleColor(primaryColor)
        balanceDataSet.circleRadius = if (binding.showDataPoints.isChecked) 4f else 0f
        balanceDataSet.setDrawValues(false)
        balanceDataSet.axisDependency = YAxis.AxisDependency.LEFT
        
        // Apply smoothing based on toggle
        if (binding.smoothLines.isChecked) {
            balanceDataSet.mode = LineDataSet.Mode.CUBIC_BEZIER
        } else {
            balanceDataSet.mode = LineDataSet.Mode.LINEAR
        }

        val lineData = LineData(balanceDataSet)
        chart.data = lineData

        // Configure X-axis
        val xAxis = chart.xAxis
        xAxis.position = XAxis.XAxisPosition.BOTTOM
        xAxis.setDrawGridLines(false)
        xAxis.labelRotationAngle = -45f
        xAxis.valueFormatter = object : ValueFormatter() {
            override fun getFormattedValue(value: Float): String {
                try {
                    val date = Date(value.toLong())
                    val format = when (currentPeriod) {
                        "7d" -> SimpleDateFormat("MMM d", Locale.getDefault())
                        "30d" -> SimpleDateFormat("MMM d", Locale.getDefault())
                        "90d" -> SimpleDateFormat("MMM d", Locale.getDefault())
                        "1y" -> SimpleDateFormat("MMM", Locale.getDefault())
                        else -> SimpleDateFormat("MMM yyyy", Locale.getDefault())
                    }
                    return format.format(date)
                } catch (e: Exception) {
                    return ""
                }
            }
        }

        // Configure Y-axis (left - balance)
        val leftYAxis = chart.axisLeft
        leftYAxis.setDrawGridLines(binding.showGridLines.isChecked)
        if (binding.autoYAxis.isChecked) {
            leftYAxis.axisMinimum = 0f
            leftYAxis.resetAxisMinimum()
            leftYAxis.resetAxisMaximum()
        } else {
            leftYAxis.axisMinimum = binding.yAxisMinSlider.value
            leftYAxis.axisMaximum = binding.yAxisMaxSlider.value
        }
        
        // Format Y-axis with thousands separator
        leftYAxis.valueFormatter = object : ValueFormatter() {
            override fun getFormattedValue(value: Float): String {
                return String.format(Locale.getDefault(), "%,.0f", value)
            }
        }
        leftYAxis.textColor = primaryColor

        // Right Y-axis for delta (optional - can be enabled if needed)
        val rightYAxis = chart.axisRight
        rightYAxis.isEnabled = false

        chart.description.isEnabled = false
        chart.legend.isEnabled = binding.showLegend.isChecked
        
        // Apply animation setting
        if (binding.enableAnimation.isChecked) {
            chart.animateX(500)
        } else {
            chart.invalidate()
        }
        chart.setTouchEnabled(true)
        chart.setDragEnabled(true)
        chart.setScaleEnabled(true)
        chart.setPinchZoom(true)
        
        // Enable marker for tooltips - using default implementation
        chart.setMarker(null) // Will use default marker
        chart.invalidate()
    }
    
    private fun updateEarnedSpentChart() {
        val earnedSpentData = viewModel.getEarnedSpentData(currentGranularity)
        
        val chart = binding.pointsChartBar
        
        // Update title regardless of data availability
        val periodText = when (currentPeriod) {
            "7d" -> "Last 7 Days"
            "30d" -> "Last 30 Days"
            "90d" -> "Last 90 Days"
            "1y" -> "Last Year"
            else -> "All Time"
        }
        val granularityText = when (currentGranularity) {
            "week" -> "Weekly"
            "month" -> "Monthly"
            else -> "Daily"
        }
        binding.chartTitle.text = "Earned vs Spent Points ($periodText - $granularityText)"
        
        if (earnedSpentData.isEmpty()) {
            chart.visibility = View.GONE
            binding.emptyGraph.visibility = View.VISIBLE
            binding.emptyGraph.text = "No earned/spent data available"
            return
        }
        
        chart.visibility = View.VISIBLE
        binding.emptyGraph.visibility = View.GONE
        val earnedEntries = mutableListOf<BarEntry>()
        val spentEntries = mutableListOf<BarEntry>()
        val labels = mutableListOf<String>()

        val dateFormat = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault())
        earnedSpentData.forEachIndexed { index, data ->
            earnedEntries.add(BarEntry(index.toFloat(), data.earned.toFloat()))
            spentEntries.add(BarEntry(index.toFloat(), data.spent.toFloat()))
            
            try {
                val date = dateFormat.parse(data.date)
                val labelFormat = when (currentGranularity) {
                    "week" -> SimpleDateFormat("MMM d", Locale.getDefault())
                    "month" -> SimpleDateFormat("MMM", Locale.getDefault())
                    else -> SimpleDateFormat("MMM d", Locale.getDefault())
                }
                labels.add(date?.let { labelFormat.format(it) } ?: data.date)
            } catch (e: Exception) {
                labels.add(data.date)
            }
        }

        val earnedDataSet = BarDataSet(earnedEntries, "Earned")
        earnedDataSet.color = Color.parseColor("#4CAF50")
        earnedDataSet.valueTextColor = Color.BLACK
        earnedDataSet.setDrawValues(false)

        val spentDataSet = BarDataSet(spentEntries, "Spent")
        spentDataSet.color = Color.parseColor("#F44336")
        spentDataSet.valueTextColor = Color.BLACK
        spentDataSet.setDrawValues(false)

        val barData = BarData(earnedDataSet, spentDataSet)
        barData.barWidth = 0.4f
        chart.data = barData

        // Configure X-axis
        val xAxis = chart.xAxis
        xAxis.position = XAxis.XAxisPosition.BOTTOM
        xAxis.setDrawGridLines(false)
        xAxis.valueFormatter = IndexAxisValueFormatter(labels)
        xAxis.labelRotationAngle = -45f
        xAxis.granularity = 1f

        // Configure Y-axis
        val leftYAxis = chart.axisLeft
        leftYAxis.setDrawGridLines(binding.showGridLines.isChecked)
        leftYAxis.axisMinimum = 0f
        leftYAxis.valueFormatter = object : ValueFormatter() {
            override fun getFormattedValue(value: Float): String {
                return String.format(Locale.getDefault(), "%,.0f", value)
            }
        }

        chart.axisRight.isEnabled = false
        chart.description.isEnabled = false
        chart.legend.isEnabled = binding.showLegend.isChecked
        
        if (binding.enableAnimation.isChecked) {
            chart.animateY(500)
        } else {
            chart.invalidate()
        }
        chart.setTouchEnabled(true)
        chart.setDragEnabled(true)
        chart.setScaleEnabled(true)
        chart.setPinchZoom(true)
        chart.invalidate()
    }
    
    private fun updateReasonChart() {
        val reasonData = when (currentReasonType) {
            "positive" -> viewModel.getPositiveReasonBreakdown()
            "negative" -> viewModel.getNegativeReasonBreakdown()
            "orders" -> viewModel.getOrderBreakdown()
            else -> viewModel.getReasonBreakdown()
        }
        
        val chart = binding.pointsChartPie
        
        // Update title regardless of data availability
        binding.chartTitle.text = when (currentReasonType) {
            "positive" -> "Positive Point Reasons"
            "negative" -> "Negative Point Reasons"
            "orders" -> "Order Transactions"
            else -> "Point Transaction Reasons"
        }
        
        if (reasonData.isEmpty()) {
            // Show empty state in chart container
            chart.visibility = View.GONE
            binding.emptyGraph.visibility = View.VISIBLE
            binding.emptyGraph.text = when (currentReasonType) {
                "positive" -> "No positive point transactions available"
                "negative" -> "No negative point transactions available"
                "orders" -> "No order-related transactions available"
                else -> "No transaction data available"
            }
            binding.chartContainer.visibility = View.VISIBLE
            return
        }

        // Show chart and hide empty state
        chart.visibility = View.VISIBLE
        binding.emptyGraph.visibility = View.GONE
        binding.chartContainer.visibility = View.VISIBLE
        
        val entries = mutableListOf<PieEntry>()
        
        // Create color array for pie segments
        val colors = mutableListOf<Int>()
        
        // Special colors for orders chart
        val orderColorPalette = if (currentReasonType == "orders") {
            listOf(
                Color.parseColor("#F44336"), // Red for Order Purchases (spent)
                Color.parseColor("#4CAF50"), // Green for Refunds (earned back)
                Color.parseColor("#2196F3")  // Blue for Cancellations (earned back)
            )
        } else {
            listOf(
                Color.parseColor("#4CAF50"), // Green
                Color.parseColor("#2196F3"), // Blue
                Color.parseColor("#FF9800"), // Orange
                Color.parseColor("#9C27B0"), // Purple
                Color.parseColor("#F44336"), // Red
                Color.parseColor("#00BCD4"), // Cyan
                Color.parseColor("#FFC107"), // Amber
                Color.parseColor("#795548"), // Brown
                Color.parseColor("#607D8B"), // Blue Grey
                Color.parseColor("#E91E63"), // Pink
                Color.parseColor("#9E9E9E")  // Grey for Others
            )
        }
        
        reasonData.forEachIndexed { index, reason ->
            entries.add(PieEntry(reason.points.toFloat(), reason.reason))
            colors.add(orderColorPalette[index % orderColorPalette.size])
        }

        val dataSet = PieDataSet(entries, "")
        dataSet.colors = colors
        dataSet.valueTextColor = Color.BLACK
        dataSet.valueTextSize = 12f
        dataSet.setDrawValues(true)
        
        // Format values to show points and percentage
        dataSet.valueFormatter = object : ValueFormatter() {
            override fun getFormattedValue(value: Float): String {
                val total = reasonData.sumOf { it.points }.toFloat()
                if (total == 0f) return "0 pts\n(0%)"
                val percentage = (value / total * 100).toInt()
                return "${value.toInt()} pts\n($percentage%)"
            }
        }

        val pieData = PieData(dataSet)
        chart.data = pieData

        chart.description.isEnabled = false
        chart.legend.isEnabled = true
        // Configure legend to display vertically
        chart.legend.verticalAlignment = com.github.mikephil.charting.components.Legend.LegendVerticalAlignment.BOTTOM
        chart.legend.horizontalAlignment = com.github.mikephil.charting.components.Legend.LegendHorizontalAlignment.CENTER
        chart.legend.orientation = com.github.mikephil.charting.components.Legend.LegendOrientation.VERTICAL
        chart.legend.setDrawInside(false)
        chart.legend.xEntrySpace = 10f
        chart.legend.yEntrySpace = 5f
        chart.legend.formSize = 12f
        chart.legend.textSize = 12f
        chart.setEntryLabelColor(Color.BLACK)
        chart.setEntryLabelTextSize(10f)
        chart.setUsePercentValues(false)
        chart.setTouchEnabled(true)
        chart.setRotationEnabled(true)
        chart.setHoleColor(Color.TRANSPARENT)
        chart.setTransparentCircleAlpha(0)
        chart.animateY(500)
        chart.invalidate()
    }
    
    private fun updateFrequencyChart() {
        val frequencyData = viewModel.getTransactionFrequency(currentGranularity)
        
        val chart = binding.pointsChartBar
        
        // Update title regardless of data availability
        val periodText = when (currentPeriod) {
            "7d" -> "Last 7 Days"
            "30d" -> "Last 30 Days"
            "90d" -> "Last 90 Days"
            "1y" -> "Last Year"
            else -> "All Time"
        }
        val granularityText = when (currentGranularity) {
            "week" -> "Weekly"
            "month" -> "Monthly"
            else -> "Daily"
        }
        binding.chartTitle.text = "Transaction Frequency ($periodText - $granularityText)"
        
        if (frequencyData.isEmpty()) {
            chart.visibility = View.GONE
            binding.emptyGraph.visibility = View.VISIBLE
            binding.emptyGraph.text = "No transaction frequency data available"
            return
        }
        
        chart.visibility = View.VISIBLE
        binding.emptyGraph.visibility = View.GONE
        val entries = mutableListOf<BarEntry>()
        val labels = mutableListOf<String>()

        val dateFormat = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault())
        frequencyData.forEachIndexed { index, data ->
            entries.add(BarEntry(index.toFloat(), data.count.toFloat()))
            
            try {
                val date = dateFormat.parse(data.date)
                val labelFormat = when (currentGranularity) {
                    "week" -> SimpleDateFormat("MMM d", Locale.getDefault())
                    "month" -> SimpleDateFormat("MMM", Locale.getDefault())
                    else -> SimpleDateFormat("MMM d", Locale.getDefault())
                }
                labels.add(date?.let { labelFormat.format(it) } ?: data.date)
            } catch (e: Exception) {
                labels.add(data.date)
            }
        }

        val dataSet = BarDataSet(entries, "Transactions")
        val typedValue = android.util.TypedValue()
        requireContext().theme.resolveAttribute(android.R.attr.colorPrimary, typedValue, true)
        val primaryColor = typedValue.data
        dataSet.color = primaryColor
        dataSet.valueTextColor = Color.BLACK
        dataSet.setDrawValues(true)
        dataSet.valueTextSize = 10f

        val barData = BarData(dataSet)
        barData.barWidth = 0.6f
        chart.data = barData

        // Configure X-axis
        val xAxis = chart.xAxis
        xAxis.position = XAxis.XAxisPosition.BOTTOM
        xAxis.setDrawGridLines(false)
        xAxis.valueFormatter = IndexAxisValueFormatter(labels)
        xAxis.labelRotationAngle = -45f
        xAxis.granularity = 1f

        // Configure Y-axis
        val leftYAxis = chart.axisLeft
        leftYAxis.setDrawGridLines(true)
        leftYAxis.axisMinimum = 0f
        leftYAxis.granularity = 1f

        chart.axisRight.isEnabled = false
        chart.description.isEnabled = false
        chart.legend.isEnabled = false
        chart.setTouchEnabled(true)
        chart.setDragEnabled(true)
        chart.setScaleEnabled(true)
        chart.setPinchZoom(true)
        chart.animateY(500)
        chart.invalidate()
    }
    
    private fun updateCumulativeChart() {
        val cumulativeData = viewModel.getCumulativeData()
        
        val chart = binding.pointsChartArea
        
        // Update title regardless of data availability
        val periodText = when (currentPeriod) {
            "7d" -> "Last 7 Days"
            "30d" -> "Last 30 Days"
            "90d" -> "Last 90 Days"
            "1y" -> "Last Year"
            else -> "All Time"
        }
        binding.chartTitle.text = "Cumulative Earned and Spent ($periodText)"
        
        if (cumulativeData.isEmpty()) {
            chart.visibility = View.GONE
            binding.emptyGraph.visibility = View.VISIBLE
            binding.emptyGraph.text = "No cumulative data available"
            return
        }
        
        chart.visibility = View.VISIBLE
        binding.emptyGraph.visibility = View.GONE
        val earnedEntries = mutableListOf<Entry>()
        val spentEntries = mutableListOf<Entry>()

        val dateFormat = SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.getDefault())
        cumulativeData.forEachIndexed { index, data ->
            try {
                val date = dateFormat.parse(data.date)
                val xValue = date?.time?.toFloat() ?: index.toFloat()
                earnedEntries.add(Entry(xValue, data.cumulativeEarned.toFloat()))
                spentEntries.add(Entry(xValue, data.cumulativeSpent.toFloat()))
            } catch (e: Exception) {
                earnedEntries.add(Entry(index.toFloat(), data.cumulativeEarned.toFloat()))
                spentEntries.add(Entry(index.toFloat(), data.cumulativeSpent.toFloat()))
            }
        }

        val earnedDataSet = LineDataSet(earnedEntries, "Cumulative Earned")
        earnedDataSet.color = Color.parseColor("#4CAF50")
        earnedDataSet.valueTextColor = Color.BLACK
        earnedDataSet.lineWidth = 2f
        earnedDataSet.setDrawValues(false)
        earnedDataSet.setDrawCircles(false)
        earnedDataSet.setDrawFilled(true)
        earnedDataSet.fillColor = Color.parseColor("#4CAF50")
        earnedDataSet.fillAlpha = 100

        val spentDataSet = LineDataSet(spentEntries, "Cumulative Spent")
        spentDataSet.color = Color.parseColor("#F44336")
        spentDataSet.valueTextColor = Color.BLACK
        spentDataSet.lineWidth = 2f
        spentDataSet.setDrawValues(false)
        spentDataSet.setDrawCircles(false)
        spentDataSet.setDrawFilled(true)
        spentDataSet.fillColor = Color.parseColor("#F44336")
        spentDataSet.fillAlpha = 100

        val lineData = LineData(earnedDataSet, spentDataSet)
        chart.data = lineData

        // Configure X-axis
        val xAxis = chart.xAxis
        xAxis.position = XAxis.XAxisPosition.BOTTOM
        xAxis.setDrawGridLines(false)
        xAxis.valueFormatter = object : ValueFormatter() {
            override fun getFormattedValue(value: Float): String {
                try {
                    val date = Date(value.toLong())
                    val format = SimpleDateFormat("MMM d", Locale.getDefault())
                    return format.format(date)
                } catch (e: Exception) {
                    return ""
                }
            }
        }

        // Configure Y-axis
        val yAxis = chart.axisLeft
        yAxis.setDrawGridLines(binding.showGridLines.isChecked)
        yAxis.axisMinimum = 0f
        yAxis.valueFormatter = object : ValueFormatter() {
            override fun getFormattedValue(value: Float): String {
                return String.format(Locale.getDefault(), "%,.0f", value)
            }
        }

        chart.axisRight.isEnabled = false
        chart.description.isEnabled = false
        chart.legend.isEnabled = binding.showLegend.isChecked
        
        chart.setTouchEnabled(true)
        chart.setDragEnabled(true)
        chart.setScaleEnabled(true)
        chart.setPinchZoom(true)
        
        if (binding.enableAnimation.isChecked) {
            chart.animateY(500)
        } else {
            chart.invalidate()
        }
    }
    
    private fun updateCombinedChart() {
        // Update title first, regardless of data availability
        val periodText = when (currentPeriod) {
            "7d" -> "Last 7 Days"
            "30d" -> "Last 30 Days"
            "90d" -> "Last 90 Days"
            "1y" -> "Last Year"
            else -> "All Time"
        }
        val granularityText = when (currentGranularity) {
            "week" -> "Weekly"
            "month" -> "Monthly"
            else -> "Daily"
        }
        binding.chartTitle.text = "Balance with Earned/Spent ($periodText - $granularityText)"
        
        val graphData = viewModel.graphData.value ?: run {
            binding.pointsChartCombined.visibility = View.GONE
            binding.emptyGraph.visibility = View.VISIBLE
            binding.emptyGraph.text = "No combined chart data available"
            return
        }
        val earnedSpentData = viewModel.getEarnedSpentData(currentGranularity)
        
        val chart = binding.pointsChartCombined
        
        if (graphData.isEmpty() || earnedSpentData.isEmpty()) {
            chart.visibility = View.GONE
            binding.emptyGraph.visibility = View.VISIBLE
            binding.emptyGraph.text = "No combined chart data available"
            return
        }
        
        chart.visibility = View.VISIBLE
        binding.emptyGraph.visibility = View.GONE
        
        // Balance line data
        val balanceEntries = mutableListOf<Entry>()
        val dateFormat = SimpleDateFormat("yyyy-MM-dd", Locale.getDefault())
        graphData.forEachIndexed { index, point ->
            try {
                val date = dateFormat.parse(point.date)
                val xValue = date?.time?.toFloat() ?: index.toFloat()
                balanceEntries.add(Entry(xValue, point.balance.toFloat()))
            } catch (e: Exception) {
                balanceEntries.add(Entry(index.toFloat(), point.balance.toFloat()))
            }
        }

        // Earned/Spent bar data
        val earnedEntries = mutableListOf<BarEntry>()
        val spentEntries = mutableListOf<BarEntry>()
        val labels = mutableListOf<String>()
        
        earnedSpentData.forEachIndexed { index, data ->
            earnedEntries.add(BarEntry(index.toFloat(), data.earned.toFloat()))
            spentEntries.add(BarEntry(index.toFloat(), data.spent.toFloat()))
            
            try {
                val date = dateFormat.parse(data.date)
                val labelFormat = when (currentGranularity) {
                    "week" -> SimpleDateFormat("MMM d", Locale.getDefault())
                    "month" -> SimpleDateFormat("MMM", Locale.getDefault())
                    else -> SimpleDateFormat("MMM d", Locale.getDefault())
                }
                labels.add(date?.let { labelFormat.format(it) } ?: data.date)
            } catch (e: Exception) {
                labels.add(data.date)
            }
        }

        // Create line data set for balance
        val balanceDataSet = LineDataSet(balanceEntries, "Balance")
        val typedValue = android.util.TypedValue()
        requireContext().theme.resolveAttribute(android.R.attr.colorPrimary, typedValue, true)
        val primaryColor = typedValue.data
        balanceDataSet.color = primaryColor
        balanceDataSet.valueTextColor = Color.BLACK
        balanceDataSet.lineWidth = 3f
        balanceDataSet.setCircleColor(primaryColor)
        balanceDataSet.circleRadius = 4f
        balanceDataSet.setDrawValues(false)
        balanceDataSet.mode = LineDataSet.Mode.CUBIC_BEZIER
        balanceDataSet.axisDependency = YAxis.AxisDependency.LEFT

        // Create bar data sets for earned/spent
        val earnedBarDataSet = BarDataSet(earnedEntries, "Earned")
        earnedBarDataSet.color = Color.parseColor("#4CAF50")
        earnedBarDataSet.valueTextColor = Color.BLACK
        earnedBarDataSet.setDrawValues(false)
        earnedBarDataSet.axisDependency = YAxis.AxisDependency.RIGHT

        val spentBarDataSet = BarDataSet(spentEntries, "Spent")
        spentBarDataSet.color = Color.parseColor("#F44336")
        spentBarDataSet.valueTextColor = Color.BLACK
        spentBarDataSet.setDrawValues(false)
        spentBarDataSet.axisDependency = YAxis.AxisDependency.RIGHT

        val barData = BarData(earnedBarDataSet, spentBarDataSet)
        barData.barWidth = 0.4f

        val lineData = LineData(balanceDataSet)

        val combinedData = CombinedData()
        combinedData.setData(barData)
        combinedData.setData(lineData)
        
        chart.data = combinedData

        // Configure axes
        val xAxis = chart.xAxis
        xAxis.position = XAxis.XAxisPosition.BOTTOM
        xAxis.setDrawGridLines(false)
        xAxis.valueFormatter = IndexAxisValueFormatter(labels)
        xAxis.labelRotationAngle = -45f
        xAxis.granularity = 1f

        val leftYAxis = chart.axisLeft
        leftYAxis.setDrawGridLines(true)
        leftYAxis.axisMinimum = 0f
        leftYAxis.textColor = primaryColor

        val rightYAxis = chart.axisRight
        rightYAxis.isEnabled = true
        rightYAxis.setDrawGridLines(false)
        rightYAxis.axisMinimum = 0f
        rightYAxis.textColor = Color.parseColor("#4CAF50")

        chart.description.isEnabled = false
        chart.legend.isEnabled = binding.showLegend.isChecked
        chart.setTouchEnabled(true)
        chart.setDragEnabled(true)
        chart.setScaleEnabled(true)
        chart.setPinchZoom(true)
        
        if (binding.enableAnimation.isChecked) {
            chart.animateY(500)
        } else {
            chart.invalidate()
        }
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/points/PointsTransactionAdapter.kt =====

```kotlin
package com.example.driverrewards.ui.points

import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.TextView
import androidx.recyclerview.widget.RecyclerView
import com.example.driverrewards.R
import com.example.driverrewards.network.PointsTransaction
import java.text.SimpleDateFormat
import java.util.*

class PointsTransactionAdapter(
    private var transactions: List<PointsTransaction>,
    private val onItemClick: ((PointsTransaction) -> Unit)? = null
) : RecyclerView.Adapter<PointsTransactionAdapter.ViewHolder>() {

    inner class ViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
        val transactionDate: TextView = itemView.findViewById(R.id.transaction_date)
        val transactionReason: TextView = itemView.findViewById(R.id.transaction_reason)
        val deltaPoints: TextView = itemView.findViewById(R.id.delta_points)
        val balanceAfter: TextView = itemView.findViewById(R.id.balance_after)
    }

    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): ViewHolder {
        val view = LayoutInflater.from(parent.context)
            .inflate(R.layout.item_points_transaction, parent, false)
        return ViewHolder(view)
    }

    override fun onBindViewHolder(holder: ViewHolder, position: Int) {
        val transaction = transactions[position]

        // Format date
        transaction.createdAt?.let { dateStr ->
            try {
                val inputFormat = SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.getDefault())
                val outputFormat = SimpleDateFormat("MMM d, yyyy h:mm a", Locale.getDefault())
                val date = inputFormat.parse(dateStr)
                holder.transactionDate.text = date?.let { outputFormat.format(it) } ?: dateStr
            } catch (e: Exception) {
                // Try alternative format
                try {
                    val inputFormat = SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSS", Locale.getDefault())
                    val outputFormat = SimpleDateFormat("MMM d, yyyy h:mm a", Locale.getDefault())
                    val date = inputFormat.parse(dateStr)
                    holder.transactionDate.text = date?.let { outputFormat.format(it) } ?: dateStr
                } catch (e2: Exception) {
                    holder.transactionDate.text = dateStr
                }
            }
        } ?: run {
            holder.transactionDate.text = "Unknown date"
        }

        // Set reason
        holder.transactionReason.text = transaction.reason.ifEmpty { "Transaction" }

        // Set delta points with color
        val delta = transaction.deltaPoints
        if (delta >= 0) {
            holder.deltaPoints.text = "+${delta}"
            holder.deltaPoints.setTextColor(holder.itemView.context.getColor(android.R.color.holo_green_dark))
        } else {
            holder.deltaPoints.text = delta.toString()
            holder.deltaPoints.setTextColor(holder.itemView.context.getColor(android.R.color.holo_red_dark))
        }

        // Set balance after
        holder.balanceAfter.text = "Balance: ${transaction.balanceAfter} pts"

        // Set click listener
        onItemClick?.let { click ->
            holder.itemView.setOnClickListener {
                click(transaction)
            }
        }
    }

    override fun getItemCount(): Int = transactions.size

    fun updateTransactions(newTransactions: List<PointsTransaction>) {
        transactions = newTransactions
        notifyDataSetChanged()
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/points/PointsViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.points

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.example.driverrewards.network.PointsService
import com.example.driverrewards.network.PointsDetailsResponse
import com.example.driverrewards.network.PointsTransaction
import com.example.driverrewards.network.PointsGraphDataPoint
import kotlinx.coroutines.launch
import kotlin.math.abs

class PointsViewModel : ViewModel() {

    private val pointsService = PointsService()
    
    private val _pointsDetails = MutableLiveData<PointsDetailsResponse?>()
    val pointsDetails: LiveData<PointsDetailsResponse?> = _pointsDetails
    
    private val _pointsHistory = MutableLiveData<List<PointsTransaction>>()
    val pointsHistory: LiveData<List<PointsTransaction>> = _pointsHistory
    
    private val _graphData = MutableLiveData<List<PointsGraphDataPoint>>()
    val graphData: LiveData<List<PointsGraphDataPoint>> = _graphData
    
    private val _isLoading = MutableLiveData<Boolean>(false)
    val isLoading: LiveData<Boolean> = _isLoading
    
    private val _errorMessage = MutableLiveData<String?>()
    val errorMessage: LiveData<String?> = _errorMessage
    
    private val _totalCount = MutableLiveData<Int>(0)
    val totalCount: LiveData<Int> = _totalCount
    
    // Filter state
    private var _showEarnedOnly = false
    private var _showSpentOnly = false
    private var _minDelta = 0

    fun loadPointsDetails() {
        viewModelScope.launch {
            try {
                _isLoading.value = true
                _errorMessage.value = null
                
                val response = pointsService.getPointsDetails()
                
                if (response.success) {
                    _pointsDetails.value = response
                } else {
                    _errorMessage.value = response.message ?: "Failed to load points details"
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error loading points details: ${e.message}"
            } finally {
                _isLoading.value = false
            }
        }
    }

    fun loadPointsHistory(startDate: String? = null, endDate: String? = null) {
        viewModelScope.launch {
            try {
                _isLoading.value = true
                _errorMessage.value = null
                
                val response = pointsService.getPointsHistory(
                    startDate = startDate,
                    endDate = endDate,
                    limit = 100,
                    sort = "desc"
                )
                
                if (response.success) {
                    _pointsHistory.value = response.transactions
                    _totalCount.value = response.totalCount
                } else {
                    _errorMessage.value = response.message ?: "Failed to load points history"
                    _pointsHistory.value = emptyList()
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error loading points history: ${e.message}"
                _pointsHistory.value = emptyList()
            } finally {
                _isLoading.value = false
            }
        }
    }

    fun loadPointsGraph(period: String = "30d", granularity: String = "day") {
        viewModelScope.launch {
            try {
                _isLoading.value = true
                _errorMessage.value = null
                
                val response = pointsService.getPointsGraph(period, granularity)
                
                if (response.success) {
                    _graphData.value = response.dataPoints
                } else {
                    _errorMessage.value = response.message ?: "Failed to load graph data"
                    _graphData.value = emptyList()
                }
            } catch (e: Exception) {
                _errorMessage.value = "Error loading graph data: ${e.message}"
                _graphData.value = emptyList()
            } finally {
                _isLoading.value = false
            }
        }
    }

    fun refreshAll() {
        loadPointsDetails()
        loadPointsHistory()
        loadPointsGraph()
    }

    fun clearError() {
        _errorMessage.value = null
    }
    
    // Data aggregation methods for different graph types
    
    data class EarnedSpentData(
        val date: String,
        val earned: Int,
        val spent: Int
    )
    
    data class ReasonBreakdown(
        val reason: String,
        val points: Int,
        val count: Int
    )
    
    data class FrequencyData(
        val date: String,
        val count: Int
    )
    
    data class CumulativeData(
        val date: String,
        val cumulativeEarned: Int,
        val cumulativeSpent: Int
    )
    
    /**
     * Set filter preferences
     */
    fun setFilters(showEarnedOnly: Boolean = false, showSpentOnly: Boolean = false, minDelta: Int = 0) {
        _showEarnedOnly = showEarnedOnly
        _showSpentOnly = showSpentOnly
        _minDelta = minDelta
    }
    
    /**
     * Get filtered history
     */
    private fun getFilteredHistory(): List<PointsTransaction> {
        val history = _pointsHistory.value ?: return emptyList()
        return history.filter { transaction ->
            // Min delta filter
            if (abs(transaction.deltaPoints) < _minDelta) return@filter false
            
            // Earned/Spent filter
            when {
                _showEarnedOnly && transaction.deltaPoints <= 0 -> return@filter false
                _showSpentOnly && transaction.deltaPoints >= 0 -> return@filter false
                else -> true
            }
        }
    }
    
    /**
     * Aggregate earned vs spent points by period
     */
    fun getEarnedSpentData(granularity: String = "day"): List<EarnedSpentData> {
        val history = getFilteredHistory()
        if (history.isEmpty()) return emptyList()
        
        // Group transactions by date period
        val grouped = mutableMapOf<String, Pair<Int, Int>>() // date -> (earned, spent)
        
        history.forEach { transaction ->
            val dateStr = transaction.createdAt ?: return@forEach
            val periodKey = getPeriodKey(dateStr, granularity)
            
            val current = grouped.getOrDefault(periodKey, Pair(0, 0))
            if (transaction.deltaPoints > 0) {
                grouped[periodKey] = Pair(current.first + transaction.deltaPoints, current.second)
            } else if (transaction.deltaPoints < 0) {
                grouped[periodKey] = Pair(current.first, current.second + abs(transaction.deltaPoints))
            }
        }
        
        return grouped.entries.sortedBy { it.key }.map {
            EarnedSpentData(it.key, it.value.first, it.value.second)
        }
    }
    
    /**
     * Group reason into category based on actual reason strings from the app
     * Order matters - more specific matches first to avoid false positives
     */
    private fun groupReason(reason: String?): String {
        val reasonLower = reason?.lowercase() ?: return "Unknown"
        
        // First, check for refunds and cancellations BEFORE orders (to avoid grouping them together)
        if (reasonLower.contains("refund") || reasonLower.contains("return")) {
            return "Refunds"
        }
        if (reasonLower.contains("cancel") || reasonLower.contains("cancelled")) {
            return "Cancellations"
        }
        
        // Check for Points Payment (orders) - this is the actual reason name used in the app
        if (reasonLower.contains("points payment") || reasonLower.contains("point payment") || 
            reasonLower.contains("payment") && (reasonLower.contains("point") || reasonLower.contains("points"))) {
            return "Order Purchases"
        }
        
        // Exact matches for adding points (positive reasons) - from screenshot
        when {
            reasonLower.contains("safety bonus") || (reasonLower.contains("safety") && reasonLower.contains("no incidents")) -> return "Safety Bonus (No Incidents)"
            reasonLower.contains("on-time delivery streak") -> return "On-Time Delivery Streak"
            reasonLower.contains("positive customer feedback") -> return "Positive Customer Feedback"
            reasonLower.contains("monthly performance bonus") -> return "Monthly Performance Bonus"
            reasonLower.contains("training completed") -> return "Training Completed"
            reasonLower.contains("referral bonus") || (reasonLower.contains("referral") && reasonLower.contains("driver hired")) -> return "Referral Bonus (Driver Hired)"
            reasonLower.contains("holiday bonus") -> return "Holiday Bonus"
            reasonLower.contains("extra shift") || reasonLower.contains("route coverage") -> return "Extra Shift/Route Coverage"
            reasonLower.contains("fuel efficiency target met") -> return "Fuel Efficiency Target Met"
            reasonLower.contains("special project completion") -> return "Special Project Completion"
            reasonLower.contains("attendance milestone") -> return "Attendance Milestone"
        }
        
        // Exact matches for deducting points (negative reasons) - from screenshot
        when {
            reasonLower.contains("order purchases") && reasonLower.contains("catalog") -> return "Order Purchases"
            reasonLower.contains("shipping cost") || reasonLower.contains("shipping costs") -> return "Shipping Costs"
            reasonLower.contains("late delivery") -> return "Late Delivery"
            reasonLower.contains("missed pickup") -> return "Missed Pickup"
            reasonLower.contains("customer complaint") -> return "Customer Complaint"
            reasonLower.contains("safety violation") && reasonLower.contains("minor") -> return "Safety Violation (Minor)"
            reasonLower.contains("safety violation") && reasonLower.contains("major") -> return "Safety Violation (Major)"
            reasonLower.contains("equipment misuse") || (reasonLower.contains("equipment") && reasonLower.contains("damage")) -> return "Equipment Misuse/Damage"
            reasonLower.contains("policy non-compliance") -> return "Policy Non-Compliance"
            reasonLower.contains("no-show") || (reasonLower.contains("unapproved") && reasonLower.contains("absence")) -> return "No-Show/Unapproved Absence"
            reasonLower.contains("excessive idling") || reasonLower.contains("fuel waste") -> return "Excessive Idling/Fuel Waste"
            reasonLower.contains("paperwork error") || (reasonLower.contains("paperwork") && reasonLower.contains("missing")) -> return "Paperwork Error/Missing Docs"
            reasonLower.contains("uniform") || reasonLower.contains("branding issue") -> return "Uniform/Branding Issue"
        }
        
        // Fallback categories for variations (only if not already matched above)
        when {
            reasonLower.contains("points payment") || reasonLower.contains("point payment") -> return "Order Purchases"
            reasonLower.contains("order") && reasonLower.contains("purchase") -> return "Order Purchases"
            reasonLower.contains("order") && reasonLower.contains("catalog") -> return "Order Purchases"
            reasonLower.contains("safety") && reasonLower.contains("bonus") -> return "Safety Bonus (No Incidents)"
            reasonLower.contains("safety") && reasonLower.contains("violation") -> return "Safety Violation"
            reasonLower.contains("delivery") && reasonLower.contains("on-time") -> return "On-Time Delivery Streak"
            reasonLower.contains("delivery") && !reasonLower.contains("late") -> return "Delivery"
            reasonLower.contains("customer") && reasonLower.contains("feedback") -> return "Positive Customer Feedback"
            reasonLower.contains("customer") && reasonLower.contains("complaint") -> return "Customer Complaint"
            reasonLower.contains("performance") && reasonLower.contains("bonus") -> return "Monthly Performance Bonus"
            reasonLower.contains("training") -> return "Training Completed"
            reasonLower.contains("referral") -> return "Referral Bonus (Driver Hired)"
            reasonLower.contains("shipping") -> return "Shipping Costs"
            reasonLower.contains("attendance") && reasonLower.contains("milestone") -> return "Attendance Milestone"
            reasonLower.contains("attendance") -> return "Attendance"
            reasonLower.contains("equipment") -> return "Equipment Misuse/Damage"
            reasonLower.contains("policy") -> return "Policy Non-Compliance"
            reasonLower.contains("fuel") && reasonLower.contains("efficiency") -> return "Fuel Efficiency Target Met"
            reasonLower.contains("fuel") || reasonLower.contains("idling") -> return "Excessive Idling/Fuel Waste"
            reasonLower.contains("paperwork") || reasonLower.contains("document") -> return "Paperwork Error/Missing Docs"
            reasonLower.contains("uniform") || reasonLower.contains("branding") -> return "Uniform/Branding Issue"
            reasonLower.contains("holiday") -> return "Holiday Bonus"
            reasonLower.contains("extra") || reasonLower.contains("shift") || reasonLower.contains("route") -> return "Extra Shift/Route Coverage"
            reasonLower.contains("project") -> return "Special Project Completion"
        }
        
        return reason // Return original if no match
    }
    
    /**
     * Get breakdown of points by transaction reason (grouped), excluding orders/refunds/cancellations
     */
    fun getReasonBreakdown(): List<ReasonBreakdown> {
        val history = getFilteredHistory()
        if (history.isEmpty()) return emptyList()
        
        val grouped = mutableMapOf<String, Pair<Int, Int>>() // category -> (points, count)
        
        history.forEach { transaction ->
            val category = groupReason(transaction.reason)
            // Exclude order-related categories
            if (!isOrderRelated(category)) {
                val current = grouped.getOrDefault(category, Pair(0, 0))
                grouped[category] = Pair(current.first + abs(transaction.deltaPoints), current.second + 1)
            }
        }
        
        // Sort by points descending, take top 10, group rest as "Others"
        val sorted = grouped.entries.sortedByDescending { it.value.first }
        val topReasons = sorted.take(10)
        val others = sorted.drop(10)
        
        val result = mutableListOf<ReasonBreakdown>()
        result.addAll(topReasons.map { 
            ReasonBreakdown(it.key, it.value.first, it.value.second) 
        })
        
        if (others.isNotEmpty()) {
            val othersPoints = others.sumOf { it.value.first }
            val othersCount = others.sumOf { it.value.second }
            result.add(ReasonBreakdown("Others", othersPoints, othersCount))
        }
        
        return result
    }
    
    /**
     * Check if reason is order-related (orders, refunds, cancellations)
     */
    private fun isOrderRelated(category: String): Boolean {
        return category == "Order Purchases" || category == "Refunds" || category == "Cancellations"
    }
    
    /**
     * Get breakdown of positive reasons (earned points), excluding orders/refunds/cancellations
     */
    fun getPositiveReasonBreakdown(): List<ReasonBreakdown> {
        val history = getFilteredHistory()
        if (history.isEmpty()) return emptyList()
        
        val grouped = mutableMapOf<String, Pair<Int, Int>>()
        
        history.filter { it.deltaPoints > 0 }.forEach { transaction ->
            val category = groupReason(transaction.reason)
            // Exclude order-related categories
            if (!isOrderRelated(category)) {
                val current = grouped.getOrDefault(category, Pair(0, 0))
                grouped[category] = Pair(current.first + transaction.deltaPoints, current.second + 1)
            }
        }
        
        val sorted = grouped.entries.sortedByDescending { it.value.first }
        return sorted.map { 
            ReasonBreakdown(it.key, it.value.first, it.value.second) 
        }
    }
    
    /**
     * Get breakdown of negative reasons (spent points), excluding orders/refunds/cancellations
     */
    fun getNegativeReasonBreakdown(): List<ReasonBreakdown> {
        val history = getFilteredHistory()
        if (history.isEmpty()) return emptyList()
        
        val grouped = mutableMapOf<String, Pair<Int, Int>>()
        
        history.filter { it.deltaPoints < 0 }.forEach { transaction ->
            val category = groupReason(transaction.reason)
            // Exclude order-related categories
            if (!isOrderRelated(category)) {
                val current = grouped.getOrDefault(category, Pair(0, 0))
                grouped[category] = Pair(current.first + abs(transaction.deltaPoints), current.second + 1)
            }
        }
        
        val sorted = grouped.entries.sortedByDescending { it.value.first }
        return sorted.map { 
            ReasonBreakdown(it.key, it.value.first, it.value.second) 
        }
    }
    
    /**
     * Get breakdown of order-related transactions (orders spent, refunds earned, cancellations earned)
     */
    fun getOrderBreakdown(): List<ReasonBreakdown> {
        val history = getFilteredHistory()
        if (history.isEmpty()) return emptyList()
        
        var ordersSpent = 0
        var refundsEarned = 0
        var cancellationsEarned = 0
        var ordersCount = 0
        var refundsCount = 0
        var cancellationsCount = 0
        
        history.forEach { transaction ->
            val category = groupReason(transaction.reason)
            when (category) {
                "Order Purchases" -> {
                    // Orders are negative (spent)
                    if (transaction.deltaPoints < 0) {
                        ordersSpent += abs(transaction.deltaPoints)
                        ordersCount++
                    }
                }
                "Refunds" -> {
                    // Refunds are positive (earned back)
                    if (transaction.deltaPoints > 0) {
                        refundsEarned += transaction.deltaPoints
                        refundsCount++
                    }
                }
                "Cancellations" -> {
                    // Cancellations are positive (earned back)
                    if (transaction.deltaPoints > 0) {
                        cancellationsEarned += transaction.deltaPoints
                        cancellationsCount++
                    }
                }
            }
        }
        
        val result = mutableListOf<ReasonBreakdown>()
        if (ordersSpent > 0) {
            result.add(ReasonBreakdown("Order Purchases", ordersSpent, ordersCount))
        }
        if (refundsEarned > 0) {
            result.add(ReasonBreakdown("Refunds", refundsEarned, refundsCount))
        }
        if (cancellationsEarned > 0) {
            result.add(ReasonBreakdown("Cancellations", cancellationsEarned, cancellationsCount))
        }
        
        return result.sortedByDescending { it.points }
    }
    
    /**
     * Get transaction frequency per period
     */
    fun getTransactionFrequency(granularity: String = "day"): List<FrequencyData> {
        val history = getFilteredHistory()
        if (history.isEmpty()) return emptyList()
        
        val grouped = mutableMapOf<String, Int>() // date -> count
        
        history.forEach { transaction ->
            val dateStr = transaction.createdAt ?: return@forEach
            val periodKey = getPeriodKey(dateStr, granularity)
            grouped[periodKey] = grouped.getOrDefault(periodKey, 0) + 1
        }
        
        return grouped.entries.sortedBy { it.key }.map {
            FrequencyData(it.key, it.value)
        }
    }
    
    /**
     * Get cumulative earned and spent over time
     */
    fun getCumulativeData(): List<CumulativeData> {
        val history = getFilteredHistory()
        if (history.isEmpty()) return emptyList()
        
        // Sort by date
        val sorted = history.sortedBy { it.createdAt ?: "" }
        
        var cumulativeEarned = 0
        var cumulativeSpent = 0
        val result = mutableListOf<CumulativeData>()
        
        sorted.forEach { transaction ->
            val dateStr = transaction.createdAt ?: return@forEach
            if (transaction.deltaPoints > 0) {
                cumulativeEarned += transaction.deltaPoints
            } else if (transaction.deltaPoints < 0) {
                cumulativeSpent += abs(transaction.deltaPoints)
            }
            result.add(CumulativeData(dateStr, cumulativeEarned, cumulativeSpent))
        }
        
        return result
    }
    
    /**
     * Helper to get period key from date string based on granularity
     */
    private fun getPeriodKey(dateStr: String, granularity: String): String {
        try {
            val inputFormat = java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", java.util.Locale.getDefault())
            val date = inputFormat.parse(dateStr) ?: return dateStr
            
            return when (granularity) {
                "week" -> {
                    val calendar = java.util.Calendar.getInstance()
                    calendar.time = date
                    val weekOfYear = calendar.get(java.util.Calendar.WEEK_OF_YEAR)
                    val year = calendar.get(java.util.Calendar.YEAR)
                    "$year-W$weekOfYear"
                }
                "month" -> {
                    val outputFormat = java.text.SimpleDateFormat("yyyy-MM", java.util.Locale.getDefault())
                    outputFormat.format(date)
                }
                else -> { // "day"
                    val outputFormat = java.text.SimpleDateFormat("yyyy-MM-dd", java.util.Locale.getDefault())
                    outputFormat.format(date)
                }
            }
        } catch (e: Exception) {
            return dateStr.substring(0, 10) // Fallback to first 10 chars (date part)
        }
    }
}



```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/profile/ChangePasswordDialog.kt =====

```kotlin
package com.example.driverrewards.ui.profile

import android.app.Dialog
import android.content.Context
import android.os.Bundle
import android.text.TextUtils
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.DialogFragment
import com.example.driverrewards.databinding.DialogChangePasswordBinding
import com.example.driverrewards.network.AuthService
import com.example.driverrewards.network.ProfileService
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext

class ChangePasswordDialog : DialogFragment() {
    
    private var _binding: DialogChangePasswordBinding? = null
    private val binding get() = _binding!!
    
    private var onPasswordChangedListener: (() -> Unit)? = null
    
    interface OnPasswordChangedListener {
        fun onPasswordChanged()
    }
    
    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        _binding = DialogChangePasswordBinding.inflate(inflater, container, false)
        return binding.root
    }
    
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        
        setupClickListeners()
    }
    
    private fun setupClickListeners() {
        binding.cancelButton.setOnClickListener {
            dismiss()
        }
        
        binding.changePasswordButton.setOnClickListener {
            changePassword()
        }
    }
    
    private fun changePassword() {
        val currentPassword = binding.currentPasswordText.text?.toString() ?: ""
        val newPassword = binding.newPasswordText.text?.toString() ?: ""
        val confirmPassword = binding.confirmPasswordText.text?.toString() ?: ""
        
        // Validate inputs
        if (!validateInputs(currentPassword, newPassword, confirmPassword)) {
            return
        }
        
        // Show loading state
        binding.changePasswordButton.isEnabled = false
        binding.changePasswordButton.text = "Changing..."
        
        // Make API call
        CoroutineScope(Dispatchers.Main).launch {
            try {
                val result = withContext(Dispatchers.IO) {
                    ProfileService().changePassword(
                        com.example.driverrewards.network.ChangePasswordRequest(
                            currentPassword = currentPassword,
                            newPassword = newPassword
                        )
                    )
                }
                
                if (result.success) {
                    Toast.makeText(requireContext(), "Password changed successfully!", Toast.LENGTH_SHORT).show()
                    onPasswordChangedListener?.invoke()
                    dismiss()
                } else {
                    Toast.makeText(requireContext(), result.message ?: "Failed to change password", Toast.LENGTH_LONG).show()
                }
            } catch (e: Exception) {
                Toast.makeText(requireContext(), "Error: ${e.message}", Toast.LENGTH_LONG).show()
            } finally {
                // Reset button state
                binding.changePasswordButton.isEnabled = true
                binding.changePasswordButton.text = "Change Password"
            }
        }
    }
    
    private fun validateInputs(currentPassword: String, newPassword: String, confirmPassword: String): Boolean {
        var isValid = true
        
        // Clear previous errors
        binding.currentPasswordLayout.error = null
        binding.newPasswordLayout.error = null
        binding.confirmPasswordLayout.error = null
        
        // Validate current password
        if (TextUtils.isEmpty(currentPassword)) {
            binding.currentPasswordLayout.error = "Current password is required"
            isValid = false
        }
        
        // Validate new password
        if (TextUtils.isEmpty(newPassword)) {
            binding.newPasswordLayout.error = "New password is required"
            isValid = false
        } else if (newPassword.length < 8) {
            binding.newPasswordLayout.error = "Password must be at least 8 characters"
            isValid = false
        } else if (!isValidPassword(newPassword)) {
            binding.newPasswordLayout.error = "Password must contain letters and numbers"
            isValid = false
        }
        
        // Validate confirm password
        if (TextUtils.isEmpty(confirmPassword)) {
            binding.confirmPasswordLayout.error = "Please confirm your new password"
            isValid = false
        } else if (newPassword != confirmPassword) {
            binding.confirmPasswordLayout.error = "Passwords do not match"
            isValid = false
        }
        
        // Check if new password is same as current
        if (currentPassword == newPassword) {
            binding.newPasswordLayout.error = "New password must be different from current password"
            isValid = false
        }
        
        return isValid
    }
    
    private fun isValidPassword(password: String): Boolean {
        // Check if password contains at least one letter and one number
        val hasLetter = password.any { it.isLetter() }
        val hasDigit = password.any { it.isDigit() }
        return hasLetter && hasDigit
    }
    
    fun setOnPasswordChangedListener(listener: () -> Unit) {
        onPasswordChangedListener = listener
    }
    
    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
    
    companion object {
        fun newInstance(): ChangePasswordDialog {
            return ChangePasswordDialog()
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/profile/ProfileDetailFragment.kt =====

```kotlin
package com.example.driverrewards.ui.profile

import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.provider.MediaStore
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.activity.result.contract.ActivityResultContracts
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.navigation.fragment.findNavController
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentProfileDetailBinding
import com.example.driverrewards.utils.SessionManager
import com.bumptech.glide.Glide
import androidx.lifecycle.lifecycleScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext
import java.io.File
import java.io.FileOutputStream
import java.io.InputStream
import java.text.SimpleDateFormat
import java.util.*

class ProfileDetailFragment : Fragment() {

    private var _binding: FragmentProfileDetailBinding? = null
    private val binding get() = _binding!!
    private lateinit var sessionManager: SessionManager
    private lateinit var profileViewModel: ProfileViewModel
    private lateinit var profileService: com.example.driverrewards.network.ProfileService
    
    // Image picker launcher
    private val imagePickerLauncher = registerForActivityResult(
        ActivityResultContracts.StartActivityForResult()
    ) { result ->
        if (result.resultCode == android.app.Activity.RESULT_OK) {
            result.data?.data?.let { uri ->
                handleImageSelection(uri)
            }
        }
    }

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        try {
            android.util.Log.d("ProfileDetailFragment", "Creating view")
            _binding = FragmentProfileDetailBinding.inflate(inflater, container, false)
            val root: View = binding.root
            android.util.Log.d("ProfileDetailFragment", "Binding created successfully")

            sessionManager = SessionManager(requireContext())
            profileViewModel = ViewModelProvider(requireActivity())[ProfileViewModel::class.java]
            profileService = com.example.driverrewards.network.ProfileService()
            android.util.Log.d("ProfileDetailFragment", "SessionManager and ViewModel created")
            
            // Setup observers
            setupObservers()
            
            // Setup click listeners
            setupClickListeners()
            
            // Setup profile image click listener
            setupProfileImageClickListener()
            
            // Load profile data
            profileViewModel.loadProfile()
            android.util.Log.d("ProfileDetailFragment", "View created successfully")

            return root
        } catch (e: Exception) {
            android.util.Log.e("ProfileDetailFragment", "Error creating view: ${e.message}", e)
            e.printStackTrace()
            throw e
        }
    }

    private fun setupObservers() {
        profileViewModel.profileData.observe(viewLifecycleOwner) { profileData ->
            profileData?.let {
                displayUserInfo(it)
            }
        }
        
        profileViewModel.isLoading.observe(viewLifecycleOwner) { isLoading ->
            binding.progressBar.visibility = if (isLoading) View.VISIBLE else View.GONE
        }
        
        profileViewModel.errorMessage.observe(viewLifecycleOwner) { errorMessage ->
            errorMessage?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_LONG).show()
            }
        }
    }

    private fun setupClickListeners() {
        // Make points balance clickable to navigate to points detail
        binding.pointsBalanceText.setOnClickListener {
            findNavController().navigate(R.id.action_profile_detail_to_points_detail)
        }
        
        // Also make the summary card clickable (the entire card area around points)
        binding.summaryCard.setOnClickListener {
            findNavController().navigate(R.id.action_profile_detail_to_points_detail)
        }
    }
    
    private fun setupProfileImageClickListener() {
        binding.profileImageView.setOnClickListener {
            openImagePicker()
        }
    }
    
    private fun openImagePicker() {
        val intent = Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI).apply {
            type = "image/*"
            putExtra(Intent.EXTRA_MIME_TYPES, arrayOf("image/jpeg", "image/jpg", "image/png", "image/webp", "image/x-icon", "image/ico"))
        }
        imagePickerLauncher.launch(intent)
    }
    
    private fun handleImageSelection(uri: Uri) {
        viewLifecycleOwner.lifecycleScope.launch(Dispatchers.IO) {
            try {
                // Create a temporary file to store the image
                val inputStream: InputStream? = requireContext().contentResolver.openInputStream(uri)
                val tempFile = File.createTempFile("profile_image", ".tmp", requireContext().cacheDir)
                inputStream?.use { input ->
                    FileOutputStream(tempFile).use { output ->
                        input.copyTo(output)
                    }
                }
                
                // Check file extension
                val fileName = getFileName(uri) ?: "image.jpg"
                val extension = fileName.substringAfterLast('.', "").lowercase()
                val allowedExtensions = setOf("jpg", "jpeg", "png", "webp", "ico")
                
                if (extension !in allowedExtensions) {
                    withContext(Dispatchers.Main) {
                        Toast.makeText(
                            requireContext(),
                            "Invalid file type. Please select JPG, JPEG, PNG, WEBP, or ICO image.",
                            Toast.LENGTH_LONG
                        ).show()
                    }
                    tempFile.delete()
                    return@launch
                }
                
                // Rename temp file with proper extension
                val finalFile = File(tempFile.parent, "profile_image.$extension")
                tempFile.renameTo(finalFile)
                
                // Upload the image
                withContext(Dispatchers.Main) {
                    binding.progressBar.visibility = View.VISIBLE
                }
                
                val response = profileService.uploadProfilePicture(finalFile)
                
                withContext(Dispatchers.Main) {
                    binding.progressBar.visibility = View.GONE
                    
                    if (response.success) {
                        Toast.makeText(
                            requireContext(),
                            response.message ?: "Profile picture updated successfully",
                            Toast.LENGTH_SHORT
                        ).show()
                        
                        // Refresh profile data to show new image
                        profileViewModel.refreshProfile()
                    } else {
                        Toast.makeText(
                            requireContext(),
                            response.message ?: "Failed to upload profile picture",
                            Toast.LENGTH_LONG
                        ).show()
                    }
                }
                
                // Clean up temp file
                finalFile.delete()
                
            } catch (e: Exception) {
                withContext(Dispatchers.Main) {
                    binding.progressBar.visibility = View.GONE
                    Toast.makeText(
                        requireContext(),
                        "Error processing image: ${e.message}",
                        Toast.LENGTH_LONG
                    ).show()
                }
            }
        }
    }
    
    private fun getFileName(uri: Uri): String? {
        var result: String? = null
        if (uri.scheme == "content") {
            requireContext().contentResolver.query(uri, null, null, null, null)?.use { cursor ->
                if (cursor.moveToFirst()) {
                    val nameIndex = cursor.getColumnIndex(MediaStore.Images.Media.DISPLAY_NAME)
                    if (nameIndex >= 0) {
                        result = cursor.getString(nameIndex)
                    }
                }
            }
        }
        if (result == null) {
            result = uri.path?.let {
                val cut = it.lastIndexOf('/')
                if (cut != -1) {
                    it.substring(cut + 1)
                } else {
                    it
                }
            }
        }
        return result
    }

    private fun displayUserInfo(profileData: com.example.driverrewards.network.ProfileData) {
        try {
            android.util.Log.d("ProfileDetailFragment", "Starting to display user info")
            android.util.Log.d("ProfileDetailFragment", "Age: ${profileData.age} (type: ${profileData.age?.javaClass?.simpleName})")
            android.util.Log.d("ProfileDetailFragment", "Gender: \"${profileData.gender}\" (type: ${profileData.gender?.javaClass?.simpleName})")
            binding.apply {
                // Load profile picture
                profileData.profileImageURL?.let { imageUrl ->
                    Glide.with(requireContext())
                        .load(imageUrl)
                        .circleCrop()
                        .placeholder(android.R.drawable.ic_menu_report_image)
                        .error(android.R.drawable.ic_menu_report_image)
                        .into(profileImageView)
                } ?: run {
                    // If no profile image URL, set a default placeholder
                    profileImageView.setImageResource(android.R.drawable.ic_menu_report_image)
                }
                
                // Display basic account information
                emailText.setText(profileData.email)
                usernameText.setText(profileData.username)
                accountIdText.setText(profileData.accountId)
                driverIdText.setText(profileData.driverId)
                
                // Display age
                profileData.age?.let { age ->
                    ageText.setText(age.toString())
                } ?: run {
                    ageText.setText("Not provided")
                }
                
                // Display gender
                profileData.gender?.let { gender ->
                    val genderDisplayText = when (gender.uppercase()) {
                        "M" -> "Male"
                        "F" -> "Female"
                        "O" -> "Other"
                        else -> gender
                    }
                    genderText.setText(genderDisplayText)
                } ?: run {
                    genderText.setText("Not provided")
                }
                
                // Display driver name
                val displayName = profileData.wholeName ?: 
                    "${profileData.firstName ?: ""} ${profileData.lastName ?: ""}".trim().takeIf { it.isNotBlank() } ?: 
                    profileData.username
                driverNameText.text = displayName
                
                // Display points balance
                pointsBalanceText.text = profileData.pointsBalance.toString()
                
                // Display member since date
                profileData.memberSince?.let { memberSince ->
                    try {
                        val inputFormat = SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.getDefault())
                        val outputFormat = SimpleDateFormat("MMM dd, yyyy", Locale.getDefault())
                        val date = inputFormat.parse(memberSince)
                        memberSinceText.text = outputFormat.format(date!!)
                    } catch (e: Exception) {
                        memberSinceText.text = memberSince.substring(0, 10)
                    }
                } ?: run {
                    memberSinceText.text = "Unknown"
                }
                
                // Display shipping address
                shippingAddressText.setText(profileData.shippingAddress ?: "Not provided")
                
                // Display license information if available
                if (profileData.licenseNumber != null) {
                    licenseNumberText.setText(profileData.licenseNumber)
                    licenseNumberLabel.visibility = View.VISIBLE
                    licenseNumberText.visibility = View.VISIBLE
                } else {
                    licenseNumberLabel.visibility = View.GONE
                    licenseNumberText.visibility = View.GONE
                }
                
                if (profileData.licenseIssueDate != null) {
                    licenseIssueDateText.setText(profileData.licenseIssueDate)
                    licenseIssueDateLabel.visibility = View.VISIBLE
                    licenseIssueDateText.visibility = View.VISIBLE
                } else {
                    licenseIssueDateLabel.visibility = View.GONE
                    licenseIssueDateText.visibility = View.GONE
                }
                
                if (profileData.licenseExpirationDate != null) {
                    licenseExpirationDateText.setText(profileData.licenseExpirationDate)
                    licenseExpirationDateLabel.visibility = View.VISIBLE
                    licenseExpirationDateText.visibility = View.VISIBLE
                } else {
                    licenseExpirationDateLabel.visibility = View.GONE
                    licenseExpirationDateText.visibility = View.GONE
                }
                
                // Display sponsor company name
                if (profileData.sponsorCompany != null) {
                    sponsorCompanyText.setText(profileData.sponsorCompany)
                    sponsorCompanyLabel.visibility = View.VISIBLE
                    sponsorCompanyText.visibility = View.VISIBLE
                } else {
                    sponsorCompanyLabel.visibility = View.GONE
                    sponsorCompanyText.visibility = View.GONE
                }
                
                android.util.Log.d("ProfileDetailFragment", "User info displayed successfully")
            }
        } catch (e: Exception) {
            android.util.Log.e("ProfileDetailFragment", "Error displaying user info: ${e.message}", e)
            e.printStackTrace()
        }
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/profile/ProfileFragment.kt =====

```kotlin
package com.example.driverrewards.ui.profile

import android.content.Context
import android.content.Intent
import android.net.Uri
import android.os.Bundle
import android.provider.MediaStore
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.TextView
import android.widget.Toast
import androidx.activity.result.contract.ActivityResultContracts
import androidx.appcompat.app.AppCompatDelegate
import androidx.fragment.app.Fragment
import androidx.lifecycle.ViewModelProvider
import androidx.navigation.fragment.findNavController
import com.example.driverrewards.R
import com.example.driverrewards.databinding.FragmentProfileBinding
import com.example.driverrewards.network.AuthService
import com.example.driverrewards.utils.SessionManager
import com.bumptech.glide.Glide
import androidx.lifecycle.lifecycleScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext
import java.io.File
import java.io.FileOutputStream
import java.io.InputStream
import java.text.SimpleDateFormat
import java.util.*

class ProfileFragment : Fragment() {

    private var _binding: FragmentProfileBinding? = null
    private val binding get() = _binding!!
    private lateinit var sessionManager: SessionManager
    private lateinit var profileViewModel: ProfileViewModel
    private lateinit var authService: AuthService
    private lateinit var profileService: com.example.driverrewards.network.ProfileService
    
    // Image picker launcher
    private val imagePickerLauncher = registerForActivityResult(
        ActivityResultContracts.StartActivityForResult()
    ) { result ->
        if (result.resultCode == android.app.Activity.RESULT_OK) {
            result.data?.data?.let { uri ->
                handleImageSelection(uri)
            }
        }
    }

    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        _binding = FragmentProfileBinding.inflate(inflater, container, false)
        val root: View = binding.root

        sessionManager = SessionManager(requireContext())
        profileViewModel = ViewModelProvider(requireActivity())[ProfileViewModel::class.java]
        authService = AuthService()
        profileService = com.example.driverrewards.network.ProfileService()
        
        // Setup observers
        setupObservers()
        
        // Setup profile image click listener
        setupProfileImageClickListener()
        
        // Setup dark mode switch
        setupDarkModeSwitch()
        
        // Setup MFA switch
        setupMfaSwitch()
        
        // Setup profile card click listener
        setupProfileCardClickListener()
        
        // Setup account actions
        setupAccountActions()
        
        // Load profile data
        profileViewModel.loadProfile()

        return root
    }
    
    private fun setupObservers() {
        profileViewModel.profileData.observe(viewLifecycleOwner) { profileData ->
            profileData?.let {
                updateProfileSummary(it)
            }
        }
        
        profileViewModel.isLoading.observe(viewLifecycleOwner) { isLoading ->
            binding.progressBar.visibility = if (isLoading) View.VISIBLE else View.GONE
        }
        
        profileViewModel.errorMessage.observe(viewLifecycleOwner) { errorMessage ->
            errorMessage?.let {
                Toast.makeText(requireContext(), it, Toast.LENGTH_LONG).show()
                
                // If session expired, log out and navigate to login
                if (it.contains("Session expired", ignoreCase = true) || 
                    it.contains("Not authenticated", ignoreCase = true)) {
                    // Clear session and navigate to login
                    sessionManager.logout()
                    requireActivity().finish()
                }
            }
        }
    }
    
    private fun setupProfileImageClickListener() {
        binding.profileImageView.setOnClickListener {
            openImagePicker()
        }
    }
    
    private fun openImagePicker() {
        val intent = Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI).apply {
            type = "image/*"
            putExtra(Intent.EXTRA_MIME_TYPES, arrayOf("image/jpeg", "image/jpg", "image/png", "image/webp", "image/x-icon", "image/ico"))
        }
        imagePickerLauncher.launch(intent)
    }
    
    private fun handleImageSelection(uri: Uri) {
        viewLifecycleOwner.lifecycleScope.launch(Dispatchers.IO) {
            try {
                // Create a temporary file to store the image
                val inputStream: InputStream? = requireContext().contentResolver.openInputStream(uri)
                val tempFile = File.createTempFile("profile_image", ".tmp", requireContext().cacheDir)
                inputStream?.use { input ->
                    FileOutputStream(tempFile).use { output ->
                        input.copyTo(output)
                    }
                }
                
                // Check file extension
                val fileName = getFileName(uri) ?: "image.jpg"
                val extension = fileName.substringAfterLast('.', "").lowercase()
                val allowedExtensions = setOf("jpg", "jpeg", "png", "webp", "ico")
                
                if (extension !in allowedExtensions) {
                    withContext(Dispatchers.Main) {
                        Toast.makeText(
                            requireContext(),
                            "Invalid file type. Please select JPG, JPEG, PNG, WEBP, or ICO image.",
                            Toast.LENGTH_LONG
                        ).show()
                    }
                    tempFile.delete()
                    return@launch
                }
                
                // Rename temp file with proper extension
                val finalFile = File(tempFile.parent, "profile_image.$extension")
                tempFile.renameTo(finalFile)
                
                // Upload the image
                withContext(Dispatchers.Main) {
                    binding.progressBar.visibility = View.VISIBLE
                }
                
                val response = profileService.uploadProfilePicture(finalFile)
                
                withContext(Dispatchers.Main) {
                    binding.progressBar.visibility = View.GONE
                    
                    if (response.success) {
                        Toast.makeText(
                            requireContext(),
                            response.message ?: "Profile picture updated successfully",
                            Toast.LENGTH_SHORT
                        ).show()
                        
                        // Refresh profile data to show new image
                        profileViewModel.refreshProfile()
                    } else {
                        Toast.makeText(
                            requireContext(),
                            response.message ?: "Failed to upload profile picture",
                            Toast.LENGTH_LONG
                        ).show()
                    }
                }
                
                // Clean up temp file
                finalFile.delete()
                
            } catch (e: Exception) {
                withContext(Dispatchers.Main) {
                    binding.progressBar.visibility = View.GONE
                    Toast.makeText(
                        requireContext(),
                        "Error processing image: ${e.message}",
                        Toast.LENGTH_LONG
                    ).show()
                }
            }
        }
    }
    
    private fun getFileName(uri: Uri): String? {
        var result: String? = null
        if (uri.scheme == "content") {
            requireContext().contentResolver.query(uri, null, null, null, null)?.use { cursor ->
                if (cursor.moveToFirst()) {
                    val nameIndex = cursor.getColumnIndex(MediaStore.Images.Media.DISPLAY_NAME)
                    if (nameIndex >= 0) {
                        result = cursor.getString(nameIndex)
                    }
                }
            }
        }
        if (result == null) {
            result = uri.path?.let {
                val cut = it.lastIndexOf('/')
                if (cut != -1) {
                    it.substring(cut + 1)
                } else {
                    it
                }
            }
        }
        return result
    }
    
    private fun updateProfileSummary(profileData: com.example.driverrewards.network.ProfileData) {
        // Load profile picture
        profileData.profileImageURL?.let { imageUrl ->
            Glide.with(requireContext())
                .load(imageUrl)
                .circleCrop()
                .placeholder(android.R.drawable.ic_menu_report_image)
                .error(android.R.drawable.ic_menu_report_image)
                .into(binding.profileImageView)
        } ?: run {
            // If no profile image URL, set a default placeholder
            binding.profileImageView.setImageResource(android.R.drawable.ic_menu_report_image)
        }
        
        // Update driver name
        val displayName = profileData.wholeName ?: 
            "${profileData.firstName ?: ""} ${profileData.lastName ?: ""}".trim().takeIf { it.isNotBlank() } ?: 
            profileData.username
        binding.driverNameText.text = displayName
        
        // Update points balance (large and prominent)
        binding.pointsBalanceText.text = profileData.pointsBalance.toString()
        
        // Update member since date
        profileData.memberSince?.let { memberSince ->
            try {
                val inputFormat = SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss", Locale.getDefault())
                val outputFormat = SimpleDateFormat("MMM yyyy", Locale.getDefault())
                val date = inputFormat.parse(memberSince)
                binding.memberSinceText.text = "Member since ${outputFormat.format(date!!)}"
            } catch (e: Exception) {
                binding.memberSinceText.text = "Member since ${memberSince.substring(0, 7)}"
            }
        } ?: run {
            binding.memberSinceText.text = "Member since unknown"
        }
        
        // Update sponsor company if available
        profileData.sponsorCompany?.let { sponsor ->
            binding.sponsorCompanyText.text = "Sponsored by $sponsor"
            binding.sponsorCompanyText.visibility = View.VISIBLE
        } ?: run {
            binding.sponsorCompanyText.visibility = View.GONE
        }
    }
    
    private fun setupProfileCardClickListener() {
        binding.profileCard.setOnClickListener {
            try {
                android.util.Log.d("ProfileFragment", "Profile card clicked, attempting navigation")
                findNavController().navigate(R.id.navigation_profile_detail)
                android.util.Log.d("ProfileFragment", "Navigation successful")
            } catch (e: Exception) {
                // Log the error for debugging
                android.util.Log.e("ProfileFragment", "Navigation error: ${e.message}", e)
                e.printStackTrace()
            }
        }
        
        // Add click listener to points balance text
        binding.pointsBalanceText.setOnClickListener {
            try {
                android.util.Log.d("ProfileFragment", "Points balance clicked, navigating to points detail")
                findNavController().navigate(R.id.action_profile_to_points_detail)
            } catch (e: Exception) {
                android.util.Log.e("ProfileFragment", "Error navigating to points detail: ${e.message}", e)
            }
        }
    }
    
    private fun setupDarkModeSwitch() {
        // Set initial state
        binding.darkModeSwitch.isChecked = sessionManager.isDarkModeEnabled()
        
        // Handle switch changes
        binding.darkModeSwitch.setOnCheckedChangeListener { _, isChecked ->
            sessionManager.setDarkMode(isChecked)
            applyDarkMode(isChecked)
        }
    }
    
    private fun setupMfaSwitch() {
        // Remove any existing listener first to prevent triggering during setup
        binding.mfaSwitch.setOnCheckedChangeListener(null)
        
        // Load current MFA status
        viewLifecycleOwner.lifecycleScope.launch(Dispatchers.IO) {
            val status = authService.getMfaStatus()
            withContext(Dispatchers.Main) {
                // Set switch state without triggering listener
                binding.mfaSwitch.setOnCheckedChangeListener(null)
                binding.mfaSwitch.isChecked = status.mfaEnabled == true
                // Now set the listener after the state is set
                binding.mfaSwitch.setOnCheckedChangeListener { _, isChecked ->
                    // Temporarily remove listener to prevent recursive calls
                    binding.mfaSwitch.setOnCheckedChangeListener(null)
                    
                    if (isChecked) {
                        showEnableMfaPasswordDialog()
                    } else {
                        showDisableMfaDialog()
                    }
                }
            }
        }
    }
    
    private fun setupAccountActions() {
        // Change password button
        binding.changePasswordButton.setOnClickListener {
            showChangePasswordDialog()
        }
        
        // Update address button
        binding.updateAddressButton.setOnClickListener {
            showUpdateAddressDialog()
        }
    }
    
    private fun showChangePasswordDialog() {
        val dialog = ChangePasswordDialog.newInstance()
        dialog.setOnPasswordChangedListener {
            // Password was changed successfully
            Toast.makeText(requireContext(), "Password updated successfully!", Toast.LENGTH_SHORT).show()
        }
        dialog.show(parentFragmentManager, "ChangePasswordDialog")
    }
    
    private fun showUpdateAddressDialog() {
        val currentAddress = profileViewModel.profileData.value?.shippingAddress
        val dialog = UpdateAddressDialog.newInstance(currentAddress)
        dialog.setOnAddressUpdatedListener {
            // Address was updated successfully, refresh profile data
            profileViewModel.refreshProfile()
            Toast.makeText(requireContext(), "Address updated successfully!", Toast.LENGTH_SHORT).show()
        }
        dialog.show(parentFragmentManager, "UpdateAddressDialog")
    }
    
    private fun applyDarkMode(isDarkMode: Boolean) {
        val mode = if (isDarkMode) {
            AppCompatDelegate.MODE_NIGHT_YES
        } else {
            AppCompatDelegate.MODE_NIGHT_NO
        }
        AppCompatDelegate.setDefaultNightMode(mode)
    }
    
    private fun showEnableMfaPasswordDialog() {
        // First check if MFA is already enabled - if so, don't show the dialog
        viewLifecycleOwner.lifecycleScope.launch(Dispatchers.IO) {
            val status = authService.getMfaStatus()
            withContext(Dispatchers.Main) {
                if (status.mfaEnabled == true) {
                    // MFA is already enabled, just reset the switch to on and re-setup listener
                    binding.mfaSwitch.setOnCheckedChangeListener(null)
                    binding.mfaSwitch.isChecked = true
                    setupMfaSwitch()
                    return@withContext
                }
                
                // MFA is not enabled, proceed with showing the dialog
                val dialogView = layoutInflater.inflate(R.layout.dialog_password_entry, null)
                val dialog = android.app.AlertDialog.Builder(requireContext())
                    .setView(dialogView)
                    .setCancelable(true)
                    .create()
                
                val titleTextView = dialogView.findViewById<android.widget.TextView>(R.id.passwordTitle)
                val descriptionTextView = dialogView.findViewById<android.widget.TextView>(R.id.passwordDescription)
                val passwordEditText = dialogView.findViewById<com.google.android.material.textfield.TextInputEditText>(R.id.passwordEditText)
                val continueButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.passwordContinueButton)
                val cancelButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.passwordCancelButton)
                val errorMessage = dialogView.findViewById<android.widget.TextView>(R.id.passwordErrorMessage)
                
                titleTextView?.text = "Enable MFA"
                descriptionTextView?.text = "Enter your password to enable two-factor authentication"
                
                continueButton?.setOnClickListener {
                    val password = passwordEditText?.text?.toString() ?: ""
                    if (password.isEmpty()) {
                        errorMessage?.text = "Password is required"
                        errorMessage?.visibility = android.view.View.VISIBLE
                        return@setOnClickListener
                    }
                    
                    dialog.dismiss()
                    showEnableMfaDialog(password)
                }
                
                cancelButton?.setOnClickListener {
                    dialog.dismiss()
                    binding.mfaSwitch.setOnCheckedChangeListener(null)
                    binding.mfaSwitch.isChecked = false
                    setupMfaSwitch()
                }
                
                dialog.show()
            }
        }
    }
    
    private fun showEnableMfaDialog(password: String) {
        viewLifecycleOwner.lifecycleScope.launch(Dispatchers.IO) {
            val response = authService.enableMfa(password)
            withContext(Dispatchers.Main) {
                if (response.success && response.qrUri != null) {
                    showEnableMfaQrDialog(response.qrUri, response.secret ?: "")
                } else {
                    Toast.makeText(requireContext(), response.message ?: "Failed to enable MFA", Toast.LENGTH_LONG).show()
                    binding.mfaSwitch.isChecked = false
                    setupMfaSwitch()
                }
            }
        }
    }
    
    private fun showEnableMfaQrDialog(qrUri: String, secret: String) {
        val dialogView = layoutInflater.inflate(R.layout.dialog_enable_mfa, null)
        val dialog = android.app.AlertDialog.Builder(requireContext())
            .setView(dialogView)
            .setCancelable(false)
            .create()
        
        val qrCodeImageView = dialogView.findViewById<android.widget.ImageView>(R.id.qrCodeImageView)
        val secretLabel = dialogView.findViewById<android.widget.TextView>(R.id.secretLabel)
        val secretTextView = dialogView.findViewById<android.widget.TextView>(R.id.secretTextView)
        val verifyCodeEditText = dialogView.findViewById<com.google.android.material.textfield.TextInputEditText>(R.id.verifyCodeEditText)
        val progressBar = dialogView.findViewById<android.widget.ProgressBar>(R.id.enableMfaProgressBar)
        val errorMessage = dialogView.findViewById<android.widget.TextView>(R.id.enableMfaErrorMessage)
        val verifyButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.enableMfaVerifyButton)
        val cancelButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.enableMfaCancelButton)
        
        val qrImageUrl = "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${android.net.Uri.encode(qrUri)}"
        Glide.with(requireContext())
            .load(qrImageUrl)
            .into(qrCodeImageView)
        
        secretLabel?.visibility = android.view.View.VISIBLE
        secretTextView?.text = secret
        secretTextView?.visibility = android.view.View.VISIBLE
        
        verifyButton?.setOnClickListener {
            val code = verifyCodeEditText?.text?.toString()?.trim() ?: ""
            if (code.isEmpty()) {
                errorMessage?.text = "Please enter the 6-digit code"
                errorMessage?.visibility = android.view.View.VISIBLE
                return@setOnClickListener
            }
            
            verifyButton.isEnabled = false
            progressBar?.visibility = android.view.View.VISIBLE
            errorMessage?.visibility = android.view.View.GONE
            
            viewLifecycleOwner.lifecycleScope.launch(Dispatchers.IO) {
                val response = authService.confirmMfa(code)
                withContext(Dispatchers.Main) {
                    progressBar?.visibility = android.view.View.GONE
                    verifyButton.isEnabled = true
                    
                    if (response.success) {
                        dialog.dismiss()
                        if (response.recoveryCodes != null && response.recoveryCodes.isNotEmpty()) {
                            showRecoveryCodesDialog(response.recoveryCodes)
                        }
                        setupMfaSwitch()
                        Toast.makeText(requireContext(), "MFA enabled successfully!", Toast.LENGTH_SHORT).show()
                    } else {
                        errorMessage?.text = response.message ?: "Invalid code. Try again."
                        errorMessage?.visibility = android.view.View.VISIBLE
                    }
                }
            }
        }
        
        cancelButton?.setOnClickListener {
            dialog.dismiss()
            binding.mfaSwitch.isChecked = false
            setupMfaSwitch()
        }
        
        dialog.show()
    }
    
    private fun showRecoveryCodesDialog(codes: List<String>) {
        val dialogView = layoutInflater.inflate(R.layout.dialog_recovery_codes, null)
        val dialog = android.app.AlertDialog.Builder(requireContext())
            .setView(dialogView)
            .setCancelable(false)
            .create()
        
        val codesTextView = dialogView.findViewById<android.widget.TextView>(R.id.recoveryCodesTextView)
        val gotItButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.recoveryCodesGotItButton)
        
        codesTextView?.text = codes.joinToString("\n")
        
        gotItButton?.setOnClickListener {
            dialog.dismiss()
        }
        
        dialog.show()
    }
    
    private fun showDisableMfaDialog() {
        val dialogView = layoutInflater.inflate(R.layout.dialog_disable_mfa, null)
        val dialog = android.app.AlertDialog.Builder(requireContext())
            .setView(dialogView)
            .setCancelable(true)
            .create()
        
        val passwordEditText = dialogView.findViewById<com.google.android.material.textfield.TextInputEditText>(R.id.disableMfaPasswordEditText)
        val progressBar = dialogView.findViewById<android.widget.ProgressBar>(R.id.disableMfaProgressBar)
        val errorMessage = dialogView.findViewById<android.widget.TextView>(R.id.disableMfaErrorMessage)
        val confirmButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.disableMfaConfirmButton)
        val cancelButton = dialogView.findViewById<com.google.android.material.button.MaterialButton>(R.id.disableMfaCancelButton)
        
        confirmButton?.setOnClickListener {
            val password = passwordEditText?.text?.toString() ?: ""
            if (password.isEmpty()) {
                errorMessage?.text = "Password is required"
                errorMessage?.visibility = android.view.View.VISIBLE
                return@setOnClickListener
            }
            
            confirmButton.isEnabled = false
            progressBar?.visibility = android.view.View.VISIBLE
            errorMessage?.visibility = android.view.View.GONE
            
            viewLifecycleOwner.lifecycleScope.launch(Dispatchers.IO) {
                val response = authService.disableMfa(password)
                withContext(Dispatchers.Main) {
                    progressBar?.visibility = android.view.View.GONE
                    confirmButton.isEnabled = true
                    
                    if (response.success) {
                        dialog.dismiss()
                        binding.mfaSwitch.isChecked = false
                        setupMfaSwitch()
                        Toast.makeText(requireContext(), "MFA disabled successfully", Toast.LENGTH_SHORT).show()
                    } else {
                        errorMessage?.text = response.message ?: "Failed to disable MFA"
                        errorMessage?.visibility = android.view.View.VISIBLE
                    }
                }
            }
        }
        
        cancelButton?.setOnClickListener {
            dialog.dismiss()
            binding.mfaSwitch.isChecked = true
            setupMfaSwitch()
        }
        
        dialog.show()
    }

    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/profile/ProfileViewModel.kt =====

```kotlin
package com.example.driverrewards.ui.profile

import androidx.lifecycle.LiveData
import androidx.lifecycle.MutableLiveData
import androidx.lifecycle.ViewModel
import androidx.lifecycle.viewModelScope
import com.example.driverrewards.network.ProfileData
import com.example.driverrewards.network.ProfileService
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext

class ProfileViewModel : ViewModel() {
    private val profileService = ProfileService()
    
    private val _profileData = MutableLiveData<ProfileData?>()
    val profileData: LiveData<ProfileData?> = _profileData
    
    private val _isLoading = MutableLiveData<Boolean>()
    val isLoading: LiveData<Boolean> = _isLoading
    
    private val _errorMessage = MutableLiveData<String?>()
    val errorMessage: LiveData<String?> = _errorMessage
    
    private var isDataCached: Boolean = false
    
    fun loadProfile() {
        // If data is already cached, skip network call
        if (isDataCached && _profileData.value != null) {
            return
        }
        
        viewModelScope.launch {
            _isLoading.value = true
            _errorMessage.value = null
            
            try {
                // Run network call on IO dispatcher (background thread)
                val response = withContext(Dispatchers.IO) {
                    profileService.getProfile()
                }
                
                if (response.success) {
                    _profileData.value = response.profile
                    isDataCached = true
                } else {
                    val message = response.message ?: "Failed to load profile"
                    _errorMessage.value = message
                    
                    // If session expired, set a special flag that the UI can handle
                    if (message.contains("Session expired", ignoreCase = true) || 
                        message.contains("Not authenticated", ignoreCase = true)) {
                        _errorMessage.value = "Session expired. Please log in again."
                    }
                }
            } catch (e: Exception) {
                _errorMessage.value = "Network error: ${e.message}"
            } finally {
                _isLoading.value = false
            }
        }
    }
    
    fun refreshProfile() {
        // Force a fresh fetch by clearing cache flag
        isDataCached = false
        loadProfile()
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/ui/profile/UpdateAddressDialog.kt =====

```kotlin
package com.example.driverrewards.ui.profile

import android.os.Bundle
import android.text.TextUtils
import android.view.LayoutInflater
import android.view.View
import android.view.ViewGroup
import android.widget.Toast
import androidx.fragment.app.DialogFragment
import com.example.driverrewards.databinding.DialogUpdateAddressBinding
import com.example.driverrewards.network.ProfileService
import com.example.driverrewards.network.UpdateProfileRequest
import kotlinx.coroutines.CoroutineScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.launch
import kotlinx.coroutines.withContext

class UpdateAddressDialog : DialogFragment() {
    
    private var _binding: DialogUpdateAddressBinding? = null
    private val binding get() = _binding!!
    
    private var onAddressUpdatedListener: (() -> Unit)? = null
    private var currentAddress: String? = null
    
    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        _binding = DialogUpdateAddressBinding.inflate(inflater, container, false)
        return binding.root
    }
    
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        
        setupClickListeners()
        populateCurrentAddress()
    }
    
    private fun setupClickListeners() {
        binding.cancelButton.setOnClickListener {
            dismiss()
        }
        
        binding.updateAddressButton.setOnClickListener {
            updateAddress()
        }
    }
    
    private fun populateCurrentAddress() {
        // Parse current address if available
        currentAddress?.let { address ->
            val parts = address.split(",").map { it.trim() }
            
            when (parts.size) {
                1 -> binding.streetText.setText(parts[0])
                2 -> {
                    binding.streetText.setText(parts[0])
                    binding.cityText.setText(parts[1])
                }
                3 -> {
                    binding.streetText.setText(parts[0])
                    binding.cityText.setText(parts[1])
                    binding.stateText.setText(parts[2])
                }
                4 -> {
                    binding.streetText.setText(parts[0])
                    binding.cityText.setText(parts[1])
                    binding.stateText.setText(parts[2])
                    binding.postalText.setText(parts[3])
                }
                5 -> {
                    binding.streetText.setText(parts[0])
                    binding.cityText.setText(parts[1])
                    binding.stateText.setText(parts[2])
                    binding.postalText.setText(parts[3])
                    binding.countryText.setText(parts[4])
                }
            }
        }
    }
    
    private fun updateAddress() {
        val street = binding.streetText.text?.toString()?.trim() ?: ""
        val city = binding.cityText.text?.toString()?.trim() ?: ""
        val state = binding.stateText.text?.toString()?.trim() ?: ""
        val postal = binding.postalText.text?.toString()?.trim() ?: ""
        val country = binding.countryText.text?.toString()?.trim() ?: ""
        
        // Validate inputs
        if (!validateInputs(street, city, state, postal, country)) {
            return
        }
        
        // Build address string
        val addressParts = mutableListOf<String>()
        if (street.isNotEmpty()) addressParts.add(street)
        if (city.isNotEmpty()) addressParts.add(city)
        if (state.isNotEmpty()) addressParts.add(state)
        if (postal.isNotEmpty()) addressParts.add(postal)
        if (country.isNotEmpty()) addressParts.add(country)
        
        val fullAddress = addressParts.joinToString(", ")
        
        // Show loading state
        binding.updateAddressButton.isEnabled = false
        binding.updateAddressButton.text = "Updating..."
        
        // Make API call
        CoroutineScope(Dispatchers.Main).launch {
            try {
                val result = withContext(Dispatchers.IO) {
                    ProfileService().updateProfile(
                        UpdateProfileRequest(
                            firstName = null,
                            lastName = null,
                            wholeName = null,
                            shippingAddress = fullAddress,
                            licenseNumber = null,
                            licenseIssueDate = null,
                            licenseExpirationDate = null
                        )
                    )
                }
                
                if (result.success) {
                    Toast.makeText(requireContext(), "Address updated successfully!", Toast.LENGTH_SHORT).show()
                    onAddressUpdatedListener?.invoke()
                    dismiss()
                } else {
                    Toast.makeText(requireContext(), result.message ?: "Failed to update address", Toast.LENGTH_LONG).show()
                }
            } catch (e: Exception) {
                Toast.makeText(requireContext(), "Error: ${e.message}", Toast.LENGTH_LONG).show()
            } finally {
                // Reset button state
                binding.updateAddressButton.isEnabled = true
                binding.updateAddressButton.text = "Update Address"
            }
        }
    }
    
    private fun validateInputs(street: String, city: String, state: String, postal: String, country: String): Boolean {
        var isValid = true
        
        // Clear previous errors
        binding.streetLayout.error = null
        binding.cityLayout.error = null
        binding.stateLayout.error = null
        binding.postalLayout.error = null
        binding.countryLayout.error = null
        
        // Validate street address (required)
        if (TextUtils.isEmpty(street)) {
            binding.streetLayout.error = "Street address is required"
            isValid = false
        }
        
        // Validate city (required)
        if (TextUtils.isEmpty(city)) {
            binding.cityLayout.error = "City is required"
            isValid = false
        }
        
        // Validate state (required)
        if (TextUtils.isEmpty(state)) {
            binding.stateLayout.error = "State/Province is required"
            isValid = false
        }
        
        // Validate postal code (required)
        if (TextUtils.isEmpty(postal)) {
            binding.postalLayout.error = "Postal code is required"
            isValid = false
        }
        
        // Country is optional, but if provided, validate it
        if (country.isNotEmpty() && country.length < 2) {
            binding.countryLayout.error = "Country name must be at least 2 characters"
            isValid = false
        }
        
        return isValid
    }
    
    fun setCurrentAddress(address: String?) {
        currentAddress = address
    }
    
    fun setOnAddressUpdatedListener(listener: () -> Unit) {
        onAddressUpdatedListener = listener
    }
    
    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
    
    companion object {
        fun newInstance(currentAddress: String? = null): UpdateAddressDialog {
            val dialog = UpdateAddressDialog()
            dialog.setCurrentAddress(currentAddress)
            return dialog
        }
    }
}

```


===== mobileApplication/app/src/main/java/com/example/driverrewards/utils/BiometricManager.kt =====

```kotlin
package com.example.driverrewards.utils

import androidx.appcompat.app.AppCompatActivity
import androidx.biometric.BiometricManager
import androidx.biometric.BiometricPrompt
import androidx.core.content.ContextCompat

class BiometricHelper(private val activity: AppCompatActivity) {
    
    fun isBiometricAvailable(): Boolean {
        val biometricManager = BiometricManager.from(activity)
        return when (biometricManager.canAuthenticate(BiometricManager.Authenticators.BIOMETRIC_WEAK)) {
            BiometricManager.BIOMETRIC_SUCCESS -> true
            BiometricManager.BIOMETRIC_ERROR_NO_HARDWARE -> false
            BiometricManager.BIOMETRIC_ERROR_HW_UNAVAILABLE -> false
            BiometricManager.BIOMETRIC_ERROR_NONE_ENROLLED -> false
            else -> false
        }
    }
    
    fun authenticate(
        title: String = "Fingerprint Authentication",
        subtitle: String = "Use your fingerprint to sign in",
        negativeButtonText: String = "Cancel",
        onSuccess: () -> Unit,
        onError: (String) -> Unit,
        onCancel: () -> Unit
    ) {
        // AppCompatActivity extends FragmentActivity, so we can pass it directly
        val executor = ContextCompat.getMainExecutor(activity)
        val biometricPrompt = BiometricPrompt(
            activity,
            executor,
            object : BiometricPrompt.AuthenticationCallback() {
                override fun onAuthenticationSucceeded(result: BiometricPrompt.AuthenticationResult) {
                    super.onAuthenticationSucceeded(result)
                    onSuccess()
                }
                
                override fun onAuthenticationError(errorCode: Int, errString: CharSequence) {
                    super.onAuthenticationError(errorCode, errString)
                    when (errorCode) {
                        BiometricPrompt.ERROR_USER_CANCELED,
                        BiometricPrompt.ERROR_NEGATIVE_BUTTON -> onCancel()
                        else -> onError(errString.toString())
                    }
                }
                
                override fun onAuthenticationFailed() {
                    super.onAuthenticationFailed()
                    onError("Authentication failed. Please try again.")
                }
            }
        )
        
        val promptInfo = BiometricPrompt.PromptInfo.Builder()
            .setTitle(title)
            .setSubtitle(subtitle)
            .setNegativeButtonText(negativeButtonText)
            .build()
        
        biometricPrompt.authenticate(promptInfo)
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/utils/CredentialManager.kt =====

```kotlin
package com.example.driverrewards.utils

import android.content.Context
import android.content.SharedPreferences
import android.security.keystore.KeyGenParameterSpec
import android.security.keystore.KeyProperties
import android.util.Base64
import java.security.KeyStore
import javax.crypto.Cipher
import javax.crypto.KeyGenerator
import javax.crypto.SecretKey
import javax.crypto.spec.GCMParameterSpec

class CredentialManager(private val context: Context) {
    
    companion object {
        private const val KEYSTORE_ALIAS = "DriverRewardsCredentials"
        private const val PREFS_NAME = "DriverRewardsCredentials"
        private const val KEY_EMAIL = "encrypted_email"
        private const val KEY_PASSWORD = "encrypted_password"
        private const val KEY_CREDENTIALS_STORED = "credentials_stored"
        private const val TRANSFORMATION = "AES/GCM/NoPadding"
        private const val ANDROID_KEYSTORE = "AndroidKeyStore"
    }
    
    private val prefs: SharedPreferences = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE)
    
    /**
     * Check if credentials are stored
     */
    fun hasStoredCredentials(): Boolean {
        return prefs.getBoolean(KEY_CREDENTIALS_STORED, false) &&
               prefs.getString(KEY_EMAIL, null) != null &&
               prefs.getString(KEY_PASSWORD, null) != null
    }
    
    /**
     * Store encrypted credentials
     */
    fun storeCredentials(email: String, password: String): Boolean {
        return try {
            val secretKey = getOrCreateSecretKey()
            val encryptedEmail = encrypt(secretKey, email)
            val encryptedPassword = encrypt(secretKey, password)
            
            if (encryptedEmail != null && encryptedPassword != null) {
                prefs.edit().apply {
                    putString(KEY_EMAIL, encryptedEmail)
                    putString(KEY_PASSWORD, encryptedPassword)
                    putBoolean(KEY_CREDENTIALS_STORED, true)
                    apply()
                }
                true
            } else {
                false
            }
        } catch (e: Exception) {
            e.printStackTrace()
            false
        }
    }
    
    /**
     * Retrieve and decrypt stored credentials
     */
    fun getStoredCredentials(): Pair<String, String>? {
        return try {
            val encryptedEmail = prefs.getString(KEY_EMAIL, null)
            val encryptedPassword = prefs.getString(KEY_PASSWORD, null)
            
            if (encryptedEmail == null || encryptedPassword == null) {
                return null
            }
            
            val secretKey = getOrCreateSecretKey()
            val email = decrypt(secretKey, encryptedEmail)
            val password = decrypt(secretKey, encryptedPassword)
            
            if (email != null && password != null) {
                Pair(email, password)
            } else {
                // Decryption failed - clear stored credentials
                clearCredentials()
                null
            }
        } catch (e: Exception) {
            e.printStackTrace()
            // If keystore access fails, clear stored credentials
            clearCredentials()
            null
        }
    }
    
    /**
     * Clear stored credentials
     */
    fun clearCredentials() {
        prefs.edit().apply {
            remove(KEY_EMAIL)
            remove(KEY_PASSWORD)
            putBoolean(KEY_CREDENTIALS_STORED, false)
            apply()
        }
    }
    
    /**
     * Get or create the secret key for encryption/decryption
     */
    private fun getOrCreateSecretKey(): SecretKey {
        val keyStore = KeyStore.getInstance(ANDROID_KEYSTORE)
        keyStore.load(null)
        
        if (keyStore.containsAlias(KEYSTORE_ALIAS)) {
            val entry = keyStore.getEntry(KEYSTORE_ALIAS, null) as? KeyStore.SecretKeyEntry
            return entry?.secretKey ?: createSecretKey()
        } else {
            return createSecretKey()
        }
    }
    
    /**
     * Create a new secret key in Android Keystore
     */
    private fun createSecretKey(): SecretKey {
        val keyGenerator = KeyGenerator.getInstance(KeyProperties.KEY_ALGORITHM_AES, ANDROID_KEYSTORE)
        val keyGenParameterSpec = KeyGenParameterSpec.Builder(
            KEYSTORE_ALIAS,
            KeyProperties.PURPOSE_ENCRYPT or KeyProperties.PURPOSE_DECRYPT
        )
            .setBlockModes(KeyProperties.BLOCK_MODE_GCM)
            .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)
            .build()
        
        keyGenerator.init(keyGenParameterSpec)
        return keyGenerator.generateKey()
    }
    
    /**
     * Encrypt data using the secret key
     */
    private fun encrypt(secretKey: SecretKey, plaintext: String): String? {
        return try {
            val cipher = Cipher.getInstance(TRANSFORMATION)
            cipher.init(Cipher.ENCRYPT_MODE, secretKey)
            val iv = cipher.iv
            val ciphertext = cipher.doFinal(plaintext.toByteArray(Charsets.UTF_8))
            
            // Combine IV and ciphertext
            val combined = ByteArray(iv.size + ciphertext.size)
            System.arraycopy(iv, 0, combined, 0, iv.size)
            System.arraycopy(ciphertext, 0, combined, iv.size, ciphertext.size)
            
            Base64.encodeToString(combined, Base64.DEFAULT)
        } catch (e: Exception) {
            e.printStackTrace()
            null
        }
    }
    
    /**
     * Decrypt data using the secret key
     */
    private fun decrypt(secretKey: SecretKey, encryptedData: String): String? {
        return try {
            val combined = Base64.decode(encryptedData, Base64.DEFAULT)
            
            // Extract IV and ciphertext
            val iv = ByteArray(12) // GCM IV is typically 12 bytes
            val ciphertext = ByteArray(combined.size - iv.size)
            System.arraycopy(combined, 0, iv, 0, iv.size)
            System.arraycopy(combined, iv.size, ciphertext, 0, ciphertext.size)
            
            val cipher = Cipher.getInstance(TRANSFORMATION)
            val spec = GCMParameterSpec(128, iv) // GCM tag length is 128 bits
            cipher.init(Cipher.DECRYPT_MODE, secretKey, spec)
            val plaintext = cipher.doFinal(ciphertext)
            
            String(plaintext, Charsets.UTF_8)
        } catch (e: Exception) {
            e.printStackTrace()
            null
        }
    }
}


```


===== mobileApplication/app/src/main/java/com/example/driverrewards/utils/SessionManager.kt =====

```kotlin
package com.example.driverrewards.utils

import android.content.Context
import android.content.SharedPreferences

class SessionManager(context: Context) {
    // Use MODE_PRIVATE but add additional persistence mechanisms
    private val prefs: SharedPreferences = context.getSharedPreferences(PREFS_NAME, Context.MODE_PRIVATE)
    
    companion object {
        private const val PREFS_NAME = "DriverRewardsSession"
        private const val KEY_IS_LOGGED_IN = "is_logged_in"
        private const val KEY_ACCOUNT_ID = "account_id"
        private const val KEY_DRIVER_ID = "driver_id"
        private const val KEY_EMAIL = "email"
        private const val KEY_USERNAME = "username"
        private const val KEY_DARK_MODE = "dark_mode"
        private const val KEY_SESSION_COOKIES = "session_cookies"
        private const val KEY_LOGIN_TIMESTAMP = "login_timestamp"
        private const val SESSION_TIMEOUT_HOURS = 24 * 7 // 7 days
    }
    
    fun saveSession(accountId: String, driverId: String, email: String, username: String) {
        prefs.edit().apply {
            putBoolean(KEY_IS_LOGGED_IN, true)
            putString(KEY_ACCOUNT_ID, accountId)
            putString(KEY_DRIVER_ID, driverId)
            putString(KEY_EMAIL, email)
            putString(KEY_USERNAME, username)
            putLong(KEY_LOGIN_TIMESTAMP, System.currentTimeMillis())
            apply()
        }
    }
    
    fun saveSessionCookies(cookies: String?) {
        if (cookies != null) {
            prefs.edit().putString(KEY_SESSION_COOKIES, cookies).commit()
        }
    }
    
    fun getSessionCookies(): String? {
        return prefs.getString(KEY_SESSION_COOKIES, null)
    }
    
    fun isLoggedIn(): Boolean {
        val isLoggedIn = prefs.getBoolean(KEY_IS_LOGGED_IN, false)
        if (!isLoggedIn) return false
        
        // Check if session has expired
        val loginTimestamp = prefs.getLong(KEY_LOGIN_TIMESTAMP, 0)
        val currentTime = System.currentTimeMillis()
        val sessionTimeoutMs = SESSION_TIMEOUT_HOURS * 60 * 60 * 1000L
        
        if (currentTime - loginTimestamp > sessionTimeoutMs) {
            // Session expired, clear it
            logout()
            return false
        }
        
        return true
    }
    
    fun getAccountId(): String? {
        return prefs.getString(KEY_ACCOUNT_ID, null)
    }
    
    fun getDriverId(): String? {
        return prefs.getString(KEY_DRIVER_ID, null)
    }
    
    fun getEmail(): String? {
        return prefs.getString(KEY_EMAIL, null)
    }
    
    fun getUsername(): String? {
        return prefs.getString(KEY_USERNAME, null)
    }
    
    fun setDarkMode(enabled: Boolean) {
        prefs.edit().putBoolean(KEY_DARK_MODE, enabled).apply()
    }
    
    fun isDarkModeEnabled(): Boolean {
        return prefs.getBoolean(KEY_DARK_MODE, false)
    }
    
    fun logout() {
        // Preserve dark mode setting during logout
        val darkModeEnabled = isDarkModeEnabled()
        prefs.edit().clear().apply()
        if (darkModeEnabled) {
            setDarkMode(true)
        }
    }
    
    fun clearSessionCookies() {
        prefs.edit().remove(KEY_SESSION_COOKIES).apply()
    }
    
    fun validateSession(): Boolean {
        // Check if session exists and hasn't expired
        if (!isLoggedIn()) {
            return false
        }
        
        // Check if we have essential session data
        val accountId = getAccountId()
        val driverId = getDriverId()
        val email = getEmail()
        val username = getUsername()
        
        if (accountId.isNullOrEmpty() || driverId.isNullOrEmpty() || 
            email.isNullOrEmpty() || username.isNullOrEmpty()) {
            logout()
            return false
        }
        
        return true
    }
    
    fun hasValidSessionData(): Boolean {
        // Check if we have the minimum required session data without expiration check
        val accountId = getAccountId()
        val driverId = getDriverId()
        val email = getEmail()
        val username = getUsername()
        
        return !accountId.isNullOrEmpty() && !driverId.isNullOrEmpty() && 
               !email.isNullOrEmpty() && !username.isNullOrEmpty()
    }
}

```


===== mobileApplication/app/src/main/res/layout/activity_login.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="32dp"
    tools:context=".LoginActivity">

    <ImageView
        android:id="@+id/appIconImageView"
        android:layout_width="120dp"
        android:layout_height="120dp"
        android:layout_marginBottom="32dp"
        android:contentDescription="@string/app_name"
        android:src="@drawable/driver_rewards_icon"
        app:layout_constraintBottom_toTopOf="@+id/loginCardView"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintVertical_chainStyle="packed" />

    <com.google.android.material.card.MaterialCardView
        android:id="@+id/loginCardView"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="32dp"
        app:cardCornerRadius="16dp"
        app:cardElevation="8dp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/appIconImageView">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="24dp">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="24dp"
                android:text="@string/app_name"
                android:textAppearance="@style/TextAppearance.Material3.HeadlineMedium"
                android:textColor="?android:attr/textColorPrimary" />

            <com.google.android.material.textfield.TextInputLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="16dp"
                android:hint="Email or Username"
                app:startIconDrawable="@drawable/ic_person">

                <com.google.android.material.textfield.TextInputEditText
                    android:id="@+id/emailEditText"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:inputType="textEmailAddress" />

            </com.google.android.material.textfield.TextInputLayout>

            <com.google.android.material.textfield.TextInputLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="24dp"
                android:hint="Password"
                app:endIconMode="password_toggle"
                app:startIconDrawable="@drawable/ic_lock">

                <com.google.android.material.textfield.TextInputEditText
                    android:id="@+id/passwordEditText"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:inputType="textPassword" />

            </com.google.android.material.textfield.TextInputLayout>

            <ProgressBar
                android:id="@+id/progressBar"
                style="?android:attr/progressBarStyle"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="16dp"
                android:visibility="gone" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/loginButton"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="8dp"
                android:text="Login"
                android:textSize="16sp" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/fingerprintButton"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:text="Sign in with Fingerprint"
                android:textSize="16sp"
                android:visibility="gone"
                app:icon="@android:drawable/ic_lock_lock"
                app:iconGravity="textStart" />

        </LinearLayout>

    </com.google.android.material.card.MaterialCardView>

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:text="Driver Rewards App"
        android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
        android:textColor="?android:attr/textColorSecondary"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/loginCardView" />

</androidx.constraintlayout.widget.ConstraintLayout>

```


===== mobileApplication/app/src/main/res/layout/activity_main.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:id="@+id/container"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <com.google.android.material.bottomnavigation.BottomNavigationView
        android:id="@+id/nav_view"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginStart="0dp"
        android:layout_marginEnd="0dp"
        android:background="?android:attr/windowBackground"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:menu="@menu/bottom_nav_menu" />

    <fragment
        android:id="@+id/nav_host_fragment_activity_main"
        android:name="androidx.navigation.fragment.NavHostFragment"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        app:defaultNavHost="true"
        app:layout_constraintBottom_toTopOf="@id/nav_view"
        app:layout_constraintLeft_toLeftOf="parent"
        app:layout_constraintRight_toRightOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        app:navGraph="@navigation/mobile_navigation" />

</androidx.constraintlayout.widget.ConstraintLayout>
```


===== mobileApplication/app/src/main/res/layout/catalog_action_bar.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="8dp">

    <!-- Filter Icon -->
    <ImageButton
        android:id="@+id/filter_button"
        android:layout_width="48dp"
        android:layout_height="48dp"
        android:layout_alignParentStart="true"
        android:layout_centerVertical="true"
        android:background="?attr/selectableItemBackgroundBorderless"
        android:src="@drawable/ic_filter"
        android:contentDescription="Filter and Sort Options"
        android:padding="12dp" />

    <!-- Search View -->
    <androidx.appcompat.widget.SearchView
        android:id="@+id/catalog_search_view"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_toEndOf="@+id/filter_button"
        android:layout_toStartOf="@+id/points_container"
        android:layout_centerVertical="true"
        android:layout_marginStart="4dp"
        android:layout_marginEnd="8dp"
        android:iconifiedByDefault="false"
        android:queryHint="Search products..." />

    <!-- Points Display Container -->
    <LinearLayout
        android:id="@+id/points_container"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_alignParentEnd="true"
        android:layout_centerVertical="true"
        android:orientation="horizontal"
        android:background="@drawable/points_container_background"
        android:paddingStart="12dp"
        android:paddingEnd="12dp"
        android:paddingTop="6dp"
        android:paddingBottom="6dp"
        android:gravity="center">

        <TextView
            android:id="@+id/catalog_points_value"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="0"
            android:textSize="14sp"
            android:textColor="@android:color/white"
            android:textStyle="bold" />

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text=" pts"
            android:textSize="12sp"
            android:textColor="@android:color/white"
            android:layout_marginStart="2dp" />

    </LinearLayout>

</RelativeLayout>

```


===== mobileApplication/app/src/main/res/layout/dialog_change_password.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical"
    android:padding="24dp">

    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center_horizontal"
        android:layout_marginBottom="24dp"
        android:text="Change Password"
        android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
        android:textColor="?android:attr/textColorPrimary" />

    <!-- Current Password -->
    <com.google.android.material.textfield.TextInputLayout
        android:id="@+id/currentPasswordLayout"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginBottom="16dp"
        android:hint="Current Password"
        app:startIconDrawable="@drawable/ic_lock"
        app:endIconMode="password_toggle"
        app:boxStrokeColor="?colorPrimary">

        <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/currentPasswordText"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="textPassword"
            android:maxLines="1" />

    </com.google.android.material.textfield.TextInputLayout>

    <!-- New Password -->
    <com.google.android.material.textfield.TextInputLayout
        android:id="@+id/newPasswordLayout"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginBottom="16dp"
        android:hint="New Password"
        app:startIconDrawable="@drawable/ic_lock"
        app:endIconMode="password_toggle"
        app:boxStrokeColor="?colorPrimary">

        <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/newPasswordText"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="textPassword"
            android:maxLines="1" />

    </com.google.android.material.textfield.TextInputLayout>

    <!-- Confirm New Password -->
    <com.google.android.material.textfield.TextInputLayout
        android:id="@+id/confirmPasswordLayout"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginBottom="24dp"
        android:hint="Confirm New Password"
        app:startIconDrawable="@drawable/ic_lock"
        app:endIconMode="password_toggle"
        app:boxStrokeColor="?colorPrimary">

        <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/confirmPasswordText"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="textPassword"
            android:maxLines="1" />

    </com.google.android.material.textfield.TextInputLayout>

    <!-- Password Requirements -->
    <TextView
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginBottom="16dp"
        android:text="Password Requirements:\n• At least 8 characters\n• Mix of letters and numbers\n• Special characters recommended"
        android:textAppearance="@style/TextAppearance.Material3.BodySmall"
        android:textColor="?android:attr/textColorSecondary" />

    <!-- Action Buttons -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:gravity="end">

        <com.google.android.material.button.MaterialButton
            android:id="@+id/cancelButton"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginEnd="8dp"
            android:text="Cancel"
            android:textSize="16sp"
            style="@style/Widget.Material3.Button.TextButton" />

        <com.google.android.material.button.MaterialButton
            android:id="@+id/changePasswordButton"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Change Password"
            android:textSize="16sp"
            style="@style/Widget.Material3.Button" />

    </LinearLayout>

</LinearLayout>

```


===== mobileApplication/app/src/main/res/layout/dialog_checkout.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:maxHeight="700dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="24dp">

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="center_horizontal"
            android:layout_marginBottom="24dp"
            android:text="Checkout"
            android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
            android:textColor="?android:attr/textColorPrimary" />

        <!-- Order Summary -->
        <androidx.cardview.widget.CardView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            app:cardCornerRadius="8dp"
            app:cardElevation="4dp">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Order Summary"
                    android:textSize="16sp"
                    android:textStyle="bold"
                    android:layout_marginBottom="12dp" />

                <TextView
                    android:id="@+id/order_items_summary"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Items: 0"
                    android:textSize="14sp"
                    android:layout_marginBottom="8dp" />

                <TextView
                    android:id="@+id/order_total_points"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Total: 0 pts"
                    android:textSize="18sp"
                    android:textStyle="bold"
                    android:textColor="?colorPrimary" />

                <TextView
                    android:id="@+id/order_driver_points"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="4dp"
                    android:text="Balance: 0 pts"
                    android:textSize="12sp" />

            </LinearLayout>

        </androidx.cardview.widget.CardView>

        <!-- Shipping Information -->
        <TextView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="Shipping Information"
            android:textSize="16sp"
            android:textStyle="bold"
            android:layout_marginBottom="16dp" />

        <!-- First Name -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/firstNameLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="First Name"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/firstNameText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPersonName"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Last Name -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/lastNameLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Last Name"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/lastNameText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPersonName"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Email -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/emailLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Email"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/emailText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textEmailAddress"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Street Address -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingStreetLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Street Address"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingStreetText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPostalAddress"
                android:maxLines="2" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- City -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingCityLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="City"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingCityText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- State -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingStateLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="State/Province"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingStateText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Postal Code -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingPostalLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Postal Code"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingPostalText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPostalAddress"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Country -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingCountryLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            android:hint="Country"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingCountryText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Terms Checkbox -->
        <com.google.android.material.checkbox.MaterialCheckBox
            android:id="@+id/termsCheckbox"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            android:text="I agree to the terms and conditions"
            android:textSize="14sp" />

        <!-- Action Buttons -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="end">

            <com.google.android.material.button.MaterialButton
                android:id="@+id/cancelButton"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginEnd="8dp"
                android:text="Cancel"
                style="@style/Widget.Material3.Button.TextButton" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/checkoutButton"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Place Order"
                style="@style/Widget.Material3.Button" />

        </LinearLayout>

    </LinearLayout>

</ScrollView>


```


===== mobileApplication/app/src/main/res/layout/dialog_disable_mfa.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:padding="24dp">

    <TextView
        android:id="@+id/disableMfaTitle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Disable Two-Factor Authentication"
        android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <TextView
        android:id="@+id/disableMfaDescription"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:text="Please enter your password to disable two-factor authentication."
        android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
        android:textAlignment="center"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/disableMfaTitle" />

    <com.google.android.material.textfield.TextInputLayout
        android:id="@+id/disableMfaPasswordLayout"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:hint="Password"
        app:endIconMode="password_toggle"
        app:startIconDrawable="@drawable/ic_lock"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/disableMfaDescription">

        <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/disableMfaPasswordEditText"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="textPassword" />
    </com.google.android.material.textfield.TextInputLayout>

    <ProgressBar
        android:id="@+id/disableMfaProgressBar"
        style="?android:attr/progressBarStyle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/disableMfaPasswordLayout" />

    <TextView
        android:id="@+id/disableMfaErrorMessage"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:textAppearance="@style/TextAppearance.Material3.BodySmall"
        android:textColor="?attr/colorError"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/disableMfaProgressBar" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/disableMfaConfirmButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:text="Disable MFA"
        android:textSize="16sp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/disableMfaErrorMessage" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/disableMfaCancelButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:text="Cancel"
        android:textSize="16sp"
        style="@style/Widget.Material3.Button.TextButton"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/disableMfaConfirmButton" />

</androidx.constraintlayout.widget.ConstraintLayout>


```


===== mobileApplication/app/src/main/res/layout/dialog_enable_mfa.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:padding="24dp">

    <TextView
        android:id="@+id/enableMfaTitle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Enable Two-Factor Authentication"
        android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <TextView
        android:id="@+id/enableMfaDescription"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:text="Scan the QR code with your authenticator app to set up two-factor authentication."
        android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
        android:textAlignment="center"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/enableMfaTitle" />

    <!-- QR Code Image View -->
    <ImageView
        android:id="@+id/qrCodeImageView"
        android:layout_width="200dp"
        android:layout_height="200dp"
        android:layout_marginTop="24dp"
        android:contentDescription="QR Code for MFA Setup"
        android:scaleType="fitCenter"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/enableMfaDescription" />

    <!-- Manual Secret Entry -->
    <TextView
        android:id="@+id/secretLabel"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:text="Or enter this code manually:"
        android:textAppearance="@style/TextAppearance.Material3.BodySmall"
        android:textAlignment="center"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/qrCodeImageView" />

    <TextView
        android:id="@+id/secretTextView"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:fontFamily="monospace"
        android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
        android:textAlignment="center"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/secretLabel" />

    <!-- Code Entry -->
    <com.google.android.material.textfield.TextInputLayout
        android:id="@+id/verifyCodeInputLayout"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:hint="Enter 6-digit code from your app"
        app:endIconMode="clear_text"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/secretTextView">

        <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/verifyCodeEditText"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="number"
            android:maxLength="6"
            android:digits="0123456789" />
    </com.google.android.material.textfield.TextInputLayout>

    <ProgressBar
        android:id="@+id/enableMfaProgressBar"
        style="?android:attr/progressBarStyle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/verifyCodeInputLayout" />

    <TextView
        android:id="@+id/enableMfaErrorMessage"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:textAppearance="@style/TextAppearance.Material3.BodySmall"
        android:textColor="?attr/colorError"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/enableMfaProgressBar" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/enableMfaVerifyButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:text="Verify &amp; Enable"
        android:textSize="16sp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/enableMfaErrorMessage" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/enableMfaCancelButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:text="Cancel"
        android:textSize="16sp"
        style="@style/Widget.Material3.Button.TextButton"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/enableMfaVerifyButton" />

</androidx.constraintlayout.widget.ConstraintLayout>


```


===== mobileApplication/app/src/main/res/layout/dialog_mfa_code.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:padding="24dp">

    <TextView
        android:id="@+id/mfaTitle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Enter MFA Code"
        android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <TextView
        android:id="@+id/mfaDescription"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:text="Enter the 6-digit code from your authenticator app.\n\nYou can also enter a recovery code if you don't have access to your authenticator."
        android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
        android:textAlignment="center"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/mfaTitle" />

    <com.google.android.material.textfield.TextInputLayout
        android:id="@+id/mfaCodeInputLayout"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:hint="MFA Code"
        app:endIconMode="clear_text"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/mfaDescription">

        <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/mfaCodeEditText"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="textNoSuggestions"
            android:maxLength="20" />
    </com.google.android.material.textfield.TextInputLayout>

    <ProgressBar
        android:id="@+id/mfaProgressBar"
        style="?android:attr/progressBarStyle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/mfaCodeInputLayout" />

    <TextView
        android:id="@+id/mfaErrorMessage"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:textAppearance="@style/TextAppearance.Material3.BodySmall"
        android:textColor="?attr/colorError"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/mfaProgressBar" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/mfaVerifyButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:text="Verify"
        android:textSize="16sp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/mfaErrorMessage" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/mfaCancelButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:text="Cancel"
        android:textSize="16sp"
        style="@style/Widget.Material3.Button.TextButton"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/mfaVerifyButton" />

</androidx.constraintlayout.widget.ConstraintLayout>


```


===== mobileApplication/app/src/main/res/layout/dialog_password_entry.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:padding="24dp">

    <TextView
        android:id="@+id/passwordTitle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Enter Password"
        android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <TextView
        android:id="@+id/passwordDescription"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:text="Please enter your password to continue."
        android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
        android:textAlignment="center"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/passwordTitle" />

    <com.google.android.material.textfield.TextInputLayout
        android:id="@+id/passwordInputLayout"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:hint="Password"
        app:endIconMode="password_toggle"
        app:startIconDrawable="@drawable/ic_lock"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/passwordDescription">

        <com.google.android.material.textfield.TextInputEditText
            android:id="@+id/passwordEditText"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:inputType="textPassword"
            android:maxLines="1" />
    </com.google.android.material.textfield.TextInputLayout>

    <TextView
        android:id="@+id/passwordErrorMessage"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:textAppearance="@style/TextAppearance.Material3.BodySmall"
        android:textColor="?attr/colorError"
        android:visibility="gone"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/passwordInputLayout" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/passwordContinueButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:text="Continue"
        android:textSize="16sp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/passwordErrorMessage" />

    <com.google.android.material.button.MaterialButton
        android:id="@+id/passwordCancelButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="8dp"
        android:text="Cancel"
        android:textSize="16sp"
        style="@style/Widget.Material3.Button.TextButton"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/passwordContinueButton" />

</androidx.constraintlayout.widget.ConstraintLayout>








```


===== mobileApplication/app/src/main/res/layout/dialog_recovery_codes.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:padding="24dp">

    <TextView
        android:id="@+id/recoveryCodesTitle"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Save Your Recovery Codes"
        android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

    <TextView
        android:id="@+id/recoveryCodesDescription"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="16dp"
        android:text="These recovery codes can be used to access your account if you lose access to your authenticator app. Save them in a safe place!"
        android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
        android:textAlignment="center"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/recoveryCodesTitle" />

    <ScrollView
        android:id="@+id/recoveryCodesScrollView"
        android:layout_width="0dp"
        android:layout_height="200dp"
        android:layout_marginTop="24dp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/recoveryCodesDescription">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="8dp">

            <TextView
                android:id="@+id/recoveryCodesTextView"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:fontFamily="monospace"
                android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                android:textAlignment="center" />

        </LinearLayout>

    </ScrollView>

    <com.google.android.material.button.MaterialButton
        android:id="@+id/recoveryCodesGotItButton"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginTop="24dp"
        android:text="Got It"
        android:textSize="16sp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/recoveryCodesScrollView" />

</androidx.constraintlayout.widget.ConstraintLayout>


```


===== mobileApplication/app/src/main/res/layout/dialog_update_address.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:maxHeight="600dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="24dp">

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="center_horizontal"
            android:layout_marginBottom="24dp"
            android:text="Update Shipping Address"
            android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
            android:textColor="?android:attr/textColorPrimary" />

        <!-- Street Address -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/streetLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Street Address"
            app:startIconDrawable="@drawable/ic_home"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/streetText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPostalAddress"
                android:maxLines="2" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- City -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/cityLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="City"
            app:startIconDrawable="@drawable/ic_home"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/cityText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- State -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/stateLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="State/Province"
            app:startIconDrawable="@drawable/ic_home"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/stateText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Postal Code -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/postalLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Postal Code"
            app:startIconDrawable="@drawable/ic_home"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/postalText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPostalAddress"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Country -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/countryLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            android:hint="Country"
            app:startIconDrawable="@drawable/ic_home"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/countryText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Action Buttons -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="end">

            <com.google.android.material.button.MaterialButton
                android:id="@+id/cancelButton"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginEnd="8dp"
                android:text="Cancel"
                style="@style/Widget.Material3.Button.TextButton" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/updateAddressButton"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Update Address"
                style="@style/Widget.Material3.Button" />

        </LinearLayout>

    </LinearLayout>

</ScrollView>

```


===== mobileApplication/app/src/main/res/layout/filter_drawer.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<FrameLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <!-- Background Overlay -->
    <View
        android:id="@+id/overlay_background"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:background="#80000000"
        android:clickable="true"
        android:focusable="true" />

    <!-- Filter Drawer -->
    <LinearLayout
        android:id="@+id/filter_content"
        android:layout_width="280dp"
        android:layout_height="match_parent"
        android:orientation="vertical"
        android:background="?attr/colorSurface"
        android:elevation="8dp">

    <!-- Header -->
    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="16dp"
        android:gravity="center_vertical"
        android:background="?attr/colorPrimary">

        <TextView
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:text="Filter &amp; Sort"
            android:textSize="18sp"
            android:textColor="@android:color/white"
            android:textStyle="bold" />

        <ImageButton
            android:id="@+id/close_filter_drawer"
            android:layout_width="32dp"
            android:layout_height="32dp"
            android:background="?attr/selectableItemBackgroundBorderless"
            android:src="@drawable/ic_close"
            android:contentDescription="Close Filter"
            android:padding="4dp" />

    </LinearLayout>

    <ScrollView
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:fillViewport="true">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="16dp">

            <!-- Favorites Only (moved to top) -->
            <CheckBox
                android:id="@+id/favorites_only"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Favorites Only"
                android:textSize="16sp"
                android:textStyle="bold"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="24dp" />

            <!-- Availability Section -->
            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Availability"
                android:textSize="16sp"
                android:textStyle="bold"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="8dp" />

            <CheckBox
                android:id="@+id/availability_available"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Available"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="4dp" />

            <CheckBox
                android:id="@+id/availability_low_stock"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Low Stock"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="4dp" />

            <CheckBox
                android:id="@+id/availability_unavailable"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Unavailable"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="24dp" />

            <!-- Sort Section -->
            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Sort By"
                android:textSize="16sp"
                android:textStyle="bold"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="8dp" />

            <RadioGroup
                android:id="@+id/sort_radio_group"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="24dp">

                <RadioButton
                    android:id="@+id/sort_best_match"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Best Match"
                    android:textColor="?attr/colorOnSurface"
                    android:checked="true"
                    android:layout_marginBottom="4dp" />

                <RadioButton
                    android:id="@+id/sort_price_low"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Price: Low to High"
                    android:textColor="?attr/colorOnSurface"
                    android:layout_marginBottom="4dp" />

                <RadioButton
                    android:id="@+id/sort_price_high"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Price: High to Low"
                    android:textColor="?attr/colorOnSurface"
                    android:layout_marginBottom="4dp" />

            </RadioGroup>

            <!-- Point Range Section -->
            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Point Range"
                android:textSize="16sp"
                android:textStyle="bold"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="8dp" />

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:layout_marginBottom="8dp">

                <EditText
                    android:id="@+id/min_points"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:layout_marginEnd="8dp"
                    android:hint="Min Points"
                    android:inputType="numberDecimal"
                    android:padding="12dp"
                    android:background="@drawable/edittext_background" />

                <EditText
                    android:id="@+id/max_points"
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:layout_marginStart="8dp"
                    android:hint="Max Points"
                    android:inputType="numberDecimal"
                    android:padding="12dp"
                    android:background="@drawable/edittext_background" />

            </LinearLayout>

            <!-- Affordable Filter Button -->
            <Button
                android:id="@+id/show_affordable"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Show Only Affordable Items"
                android:textSize="14sp"
                android:padding="12dp"
                android:layout_marginBottom="16dp"
                android:backgroundTint="?attr/colorPrimaryVariant" />

            <View
                android:layout_width="match_parent"
                android:layout_height="0dp"
                android:layout_weight="0"
                android:layout_marginBottom="8dp" />

            <!-- Categories Section -->
            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Categories"
                android:textSize="16sp"
                android:textStyle="bold"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="8dp" />

            <CheckBox
                android:id="@+id/category_electronics"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Electronics"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="4dp" />

            <CheckBox
                android:id="@+id/category_clothing"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Clothing"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="4dp" />

            <CheckBox
                android:id="@+id/category_home"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Home &amp; Garden"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="4dp" />

            <CheckBox
                android:id="@+id/category_sports"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Sports &amp; Outdoors"
                android:textColor="?attr/colorOnSurface"
                android:layout_marginBottom="24dp" />


        </LinearLayout>

    </ScrollView>

    <!-- Apply Button -->
    <Button
        android:id="@+id/apply_filters"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_margin="16dp"
        android:text="Apply Filters"
        android:textSize="16sp"
        android:textStyle="bold"
        android:backgroundTint="?attr/colorPrimary" />

    </LinearLayout>

</FrameLayout>

```


===== mobileApplication/app/src/main/res/layout/fragment_cart.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".ui.cart.CartFragment">

    <ProgressBar
        android:id="@+id/progress_bar"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        android:visibility="gone" />

    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/recycler_view"
        android:layout_width="0dp"
        android:layout_height="0dp"
        android:padding="8dp"
        app:layout_constraintBottom_toTopOf="@id/cart_summary"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent"
        tools:listitem="@layout/item_cart" />

    <androidx.cardview.widget.CardView
        android:id="@+id/cart_summary"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_margin="8dp"
        app:cardCornerRadius="8dp"
        app:cardElevation="4dp"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="16dp">

            <TextView
                android:id="@+id/total_points"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Total: 0 pts"
                android:textSize="18sp"
                android:textStyle="bold" />


            <com.google.android.material.button.MaterialButton
                android:id="@+id/checkout_button"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="16dp"
                android:text="Checkout"
                android:enabled="false" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/clear_button"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:text="Clear Cart"
                style="@style/Widget.MaterialComponents.Button.OutlinedButton" />

        </LinearLayout>

    </androidx.cardview.widget.CardView>

    <TextView
        android:id="@+id/empty_cart_message"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:text="Your cart is empty"
        android:textSize="16sp"
        android:visibility="gone"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>

```


===== mobileApplication/app/src/main/res/layout/fragment_catalog.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:fitsSystemWindows="false"
    tools:context=".ui.catalog.CatalogFragment">


    <!-- Skeleton Loading Grid -->
    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/skeleton_recycler_view"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:paddingStart="4dp"
        android:paddingEnd="4dp"
        android:clipToPadding="false"
        android:visibility="gone"
        tools:listitem="@layout/item_skeleton_product_card" />

    <!-- Product Grid -->
    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/recycler_view"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:paddingStart="4dp"
        android:paddingEnd="4dp"
        android:clipToPadding="false"
        tools:listitem="@layout/item_product_card" />

    <!-- Debug Info (for testing) -->
    <TextView
        android:id="@+id/debug_info"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_margin="8dp"
        android:text="Debug: Ready to load catalog..."
        android:textSize="10sp"
        android:textColor="@android:color/darker_gray"
        android:visibility="visible" />

</LinearLayout>
```


===== mobileApplication/app/src/main/res/layout/fragment_checkout.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<ScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="24dp"
        android:paddingBottom="100dp">

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_gravity="center_horizontal"
            android:layout_marginBottom="24dp"
            android:text="Checkout"
            android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
            android:textColor="?android:attr/textColorPrimary" />

        <!-- Order Summary -->
        <androidx.cardview.widget.CardView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            app:cardCornerRadius="8dp"
            app:cardElevation="4dp">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Order Summary"
                    android:textSize="16sp"
                    android:textStyle="bold"
                    android:layout_marginBottom="12dp" />

                <TextView
                    android:id="@+id/order_items_summary"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Items: 0"
                    android:textSize="14sp"
                    android:layout_marginBottom="8dp" />

                <TextView
                    android:id="@+id/order_total_points"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:text="Total: 0 pts"
                    android:textSize="18sp"
                    android:textStyle="bold"
                    android:textColor="?colorPrimary" />

            </LinearLayout>

        </androidx.cardview.widget.CardView>

        <!-- Shipping Information -->
        <TextView
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="Shipping Information"
            android:textSize="16sp"
            android:textStyle="bold"
            android:layout_marginBottom="16dp" />

        <!-- First Name -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/firstNameLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="First Name"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/firstNameText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPersonName"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Last Name -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/lastNameLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Last Name"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/lastNameText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPersonName"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Street Address -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingStreetLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Street Address"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingStreetText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPostalAddress"
                android:maxLines="2" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- City -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingCityLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="City"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingCityText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- State -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingStateLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="State/Province"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingStateText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Postal Code -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingPostalLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:hint="Postal Code"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingPostalText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="textPostalAddress"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Country -->
        <com.google.android.material.textfield.TextInputLayout
            android:id="@+id/shippingCountryLayout"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            android:hint="Country"
            app:boxStrokeColor="?colorPrimary">

            <com.google.android.material.textfield.TextInputEditText
                android:id="@+id/shippingCountryText"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:inputType="text"
                android:maxLines="1" />

        </com.google.android.material.textfield.TextInputLayout>

        <!-- Terms Checkbox -->
        <com.google.android.material.checkbox.MaterialCheckBox
            android:id="@+id/termsCheckbox"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            android:text="I agree to the terms and conditions"
            android:textSize="14sp" />

        <!-- Action Buttons -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="end">

            <com.google.android.material.button.MaterialButton
                android:id="@+id/cancelButton"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginEnd="8dp"
                android:text="Cancel"
                style="@style/Widget.Material3.Button.TextButton" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/checkoutButton"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Place Order"
                style="@style/Widget.Material3.Button" />

        </LinearLayout>

    </LinearLayout>

</ScrollView>


```


===== mobileApplication/app/src/main/res/layout/fragment_dashboard.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".ui.dashboard.DashboardFragment">

    <TextView
        android:id="@+id/text_dashboard"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginStart="8dp"
        android:layout_marginTop="8dp"
        android:layout_marginEnd="8dp"
        android:textAlignment="center"
        android:textSize="20sp"
        android:text="Dashboard"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```


===== mobileApplication/app/src/main/res/layout/fragment_favorites.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical"
    android:fitsSystemWindows="false"
    tools:context=".ui.favorites.FavoritesFragment">


    <!-- Skeleton Loading Grid -->
    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/skeleton_recycler_view"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:paddingStart="4dp"
        android:paddingEnd="4dp"
        android:clipToPadding="false"
        android:visibility="gone"
        tools:listitem="@layout/item_skeleton_product_card" />

    <!-- Product Grid -->
    <androidx.recyclerview.widget.RecyclerView
        android:id="@+id/recycler_view"
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="1"
        android:paddingStart="4dp"
        android:paddingEnd="4dp"
        android:clipToPadding="false"
        tools:listitem="@layout/item_product_card" />

    <!-- Empty State -->
    <LinearLayout
        android:id="@+id/empty_state"
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:orientation="vertical"
        android:gravity="center"
        android:visibility="gone"
        android:padding="32dp">

        <ImageView
            android:layout_width="96dp"
            android:layout_height="96dp"
            android:src="@drawable/ic_favorite_border"
            android:tint="@android:color/darker_gray"
            android:contentDescription="No favorites" />

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="16dp"
            android:text="No favorites yet"
            android:textSize="18sp"
            android:textStyle="bold"
            android:textColor="@android:color/darker_gray" />

        <TextView
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:text="Browse the catalog and tap the heart icon to add items to your favorites"
            android:textSize="14sp"
            android:textColor="@android:color/darker_gray"
            android:gravity="center" />
    </LinearLayout>

</LinearLayout>


```


===== mobileApplication/app/src/main/res/layout/fragment_home.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".ui.home.HomeFragment">

    <TextView
        android:id="@+id/text_home"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginStart="8dp"
        android:layout_marginTop="8dp"
        android:layout_marginEnd="8dp"
        android:textAlignment="center"
        android:textSize="20sp"
        android:text="Hello!"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```


===== mobileApplication/app/src/main/res/layout/fragment_notifications.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    tools:context=".ui.notifications.NotificationsFragment">

    <TextView
        android:id="@+id/text_notifications"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginStart="8dp"
        android:layout_marginTop="8dp"
        android:layout_marginEnd="8dp"
        android:textAlignment="center"
        android:textSize="20sp"
        android:text="Notifications"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```


===== mobileApplication/app/src/main/res/layout/fragment_order_detail.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <androidx.core.widget.NestedScrollView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        android:fillViewport="true">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="16dp"
            android:paddingBottom="100dp">

            <TextView
                android:id="@+id/order_number"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:textSize="20sp"
                android:textStyle="bold"
                android:text="Order #..." />

            <TextView
                android:id="@+id/order_status"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:padding="8dp"
                android:textSize="12sp"
                android:textStyle="bold"
                android:text="Pending" />

            <TextView
                android:id="@+id/order_date"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:textSize="14sp"
                android:textColor="#666666"
                android:text="Date: ..." />

            <TextView
                android:id="@+id/order_total"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:textSize="18sp"
                android:textStyle="bold"
                android:textColor="#1976D2"
                android:text="Total: ... pts" />

            <View
                android:layout_width="match_parent"
                android:layout_height="1dp"
                android:layout_marginTop="16dp"
                android:layout_marginBottom="16dp"
                android:background="#E0E0E0" />

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Order Items"
                android:textSize="16sp"
                android:textStyle="bold"
                android:layout_marginBottom="8dp" />

            <androidx.recyclerview.widget.RecyclerView
                android:id="@+id/order_items_recycler"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:nestedScrollingEnabled="false" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/cancel_button"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="16dp"
                android:text="Cancel Order"
                android:visibility="gone"
                style="@style/Widget.MaterialComponents.Button.OutlinedButton" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/refund_button"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:text="Refund Order"
                android:visibility="gone"
                style="@style/Widget.MaterialComponents.Button.OutlinedButton" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/add_all_to_cart_button"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="16dp"
                android:text="Add all to cart"
                android:visibility="visible"
                style="@style/Widget.MaterialComponents.Button.OutlinedButton" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/reorder_button"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:text="Re-order"
                android:visibility="visible"
                style="@style/Widget.MaterialComponents.Button" />

        </LinearLayout>

    </androidx.core.widget.NestedScrollView>

    <com.google.android.material.progressindicator.LinearProgressIndicator
        android:id="@+id/progress_bar"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_gravity="top"
        android:indeterminate="true"
        android:visibility="gone" />

</androidx.coordinatorlayout.widget.CoordinatorLayout>


```


===== mobileApplication/app/src/main/res/layout/fragment_orders.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.swiperefreshlayout.widget.SwipeRefreshLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/swipe_refresh"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent">

        <ProgressBar
            android:id="@+id/progress_bar"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            android:visibility="gone" />

        <androidx.recyclerview.widget.RecyclerView
            android:id="@+id/recycler_view"
            android:layout_width="0dp"
            android:layout_height="0dp"
            android:padding="8dp"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent"
            tools:listitem="@layout/item_order" />

        <TextView
            android:id="@+id/empty_orders_message"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="No orders found"
            android:textSize="16sp"
            android:visibility="gone"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent" />

        <ProgressBar
            android:id="@+id/loading_more"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_margin="16dp"
            android:visibility="gone"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent" />

    </androidx.constraintlayout.widget.ConstraintLayout>

</androidx.swiperefreshlayout.widget.SwipeRefreshLayout>

```


===== mobileApplication/app/src/main/res/layout/fragment_points_detail.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.coordinatorlayout.widget.CoordinatorLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <com.google.android.material.appbar.AppBarLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:theme="@style/ThemeOverlay.AppCompat.Dark.ActionBar">

        <com.google.android.material.appbar.CollapsingToolbarLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            app:layout_scrollFlags="scroll|exitUntilCollapsed">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="24dp"
                android:background="?attr/colorPrimary">

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Points Details"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineMedium"
                    android:textColor="@android:color/white" />

                <TextView
                    android:id="@+id/current_balance"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="8dp"
                    android:text="0"
                    android:textAppearance="@style/TextAppearance.Material3.DisplayLarge"
                    android:textColor="@android:color/white"
                    android:textStyle="bold" />

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="4dp"
                    android:text="pts"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                    android:textColor="@android:color/white" />

                <TextView
                    android:id="@+id/dollar_value"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="8dp"
                    android:text="≈ $0.00"
                    android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                    android:textColor="@android:color/white" />

                <TextView
                    android:id="@+id/conversion_rate"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="4dp"
                    android:text="1 point = $0.01"
                    android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
                    android:textColor="@android:color/white" />

            </LinearLayout>

        </com.google.android.material.appbar.CollapsingToolbarLayout>

    </com.google.android.material.appbar.AppBarLayout>

    <androidx.core.widget.NestedScrollView
        android:layout_width="match_parent"
        android:layout_height="match_parent"
        app:layout_behavior="@string/appbar_scrolling_view_behavior"
        android:fillViewport="true">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:paddingBottom="80dp">

            <com.google.android.material.tabs.TabLayout
                android:id="@+id/tab_layout"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:background="?attr/colorSurface"
                app:tabMode="fixed"
                app:tabGravity="fill">

                <com.google.android.material.tabs.TabItem
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="History" />

                <com.google.android.material.tabs.TabItem
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Stats" />

                <com.google.android.material.tabs.TabItem
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Info" />

            </com.google.android.material.tabs.TabLayout>

            <!-- History Tab Content -->
            <LinearLayout
                android:id="@+id/history_tab"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:visibility="visible">

                <!-- Filter Controls -->
                <LinearLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="horizontal"
                    android:padding="16dp"
                    android:gravity="center_vertical">

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/refresh_button"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="Refresh"
                        android:textSize="16sp"
                        android:minHeight="48dp"
                        android:paddingStart="24dp"
                        android:paddingEnd="24dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <View
                        android:layout_width="0dp"
                        android:layout_height="1dp"
                        android:layout_weight="1" />

                </LinearLayout>

                <androidx.recyclerview.widget.RecyclerView
                    android:id="@+id/history_recycler"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:nestedScrollingEnabled="false" />

                <TextView
                    android:id="@+id/empty_history"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_margin="32dp"
                    android:gravity="center"
                    android:text="No transaction history available"
                    android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                    android:textColor="?android:attr/textColorSecondary"
                    android:visibility="gone" />

            </LinearLayout>

            <!-- Graph Tab Content -->
            <LinearLayout
                android:id="@+id/graph_tab"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:visibility="gone"
                android:padding="16dp">

                <!-- Period Selector -->
                <com.google.android.material.button.MaterialButtonToggleGroup
                    android:id="@+id/period_group"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:orientation="horizontal"
                    app:singleSelection="true">

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/period_7d"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="7d"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/period_30d"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="30d"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/period_90d"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="90d"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/period_1y"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="1y"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/period_all"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="All"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                </com.google.android.material.button.MaterialButtonToggleGroup>

                <!-- Graph Type Selector -->
                <com.google.android.material.button.MaterialButtonToggleGroup
                    android:id="@+id/graph_type_group"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="16dp"
                    android:orientation="horizontal"
                    app:singleSelection="true">

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/graph_type_balance"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Balance"
                        android:textSize="11sp"
                        android:minHeight="48dp"
                        android:paddingStart="4dp"
                        android:paddingEnd="4dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/graph_type_earned_spent"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Earned/Spent"
                        android:textSize="11sp"
                        android:minHeight="48dp"
                        android:paddingStart="4dp"
                        android:paddingEnd="4dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/graph_type_reason"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Reason"
                        android:textSize="11sp"
                        android:minHeight="48dp"
                        android:paddingStart="4dp"
                        android:paddingEnd="4dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/graph_type_frequency"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Frequency"
                        android:textSize="11sp"
                        android:minHeight="48dp"
                        android:paddingStart="4dp"
                        android:paddingEnd="4dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/graph_type_cumulative"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Cumulative"
                        android:textSize="11sp"
                        android:minHeight="48dp"
                        android:paddingStart="4dp"
                        android:paddingEnd="4dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/graph_type_combined"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Combined"
                        android:textSize="11sp"
                        android:minHeight="48dp"
                        android:paddingStart="4dp"
                        android:paddingEnd="4dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                </com.google.android.material.button.MaterialButtonToggleGroup>

                <!-- Reason Chart Type Selector (shown only for reason chart) -->
                <com.google.android.material.button.MaterialButtonToggleGroup
                    android:id="@+id/reason_type_group"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="16dp"
                    android:orientation="horizontal"
                    android:visibility="gone"
                    app:singleSelection="true">

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/reason_type_all"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="All"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/reason_type_positive"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="+Reasons"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/reason_type_negative"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="-Reasons"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/reason_type_orders"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Orders"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                </com.google.android.material.button.MaterialButtonToggleGroup>

                <!-- Date Range Selector -->
                <LinearLayout
                    android:id="@+id/date_range_container"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="16dp"
                    android:orientation="vertical"
                    android:visibility="gone">

                    <TextView
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:text="Date Range"
                        android:textAppearance="@style/TextAppearance.Material3.TitleSmall"
                        android:textColor="?android:attr/textColorPrimary" />

                    <TextView
                        android:id="@+id/date_range_display"
                        android:layout_width="wrap_content"
                        android:layout_height="wrap_content"
                        android:layout_gravity="end"
                        android:text="Auto"
                        android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                        android:textColor="?android:attr/textColorSecondary" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/custom_date_range_button"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:layout_marginTop="8dp"
                        android:text="Select Custom Date Range"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                </LinearLayout>

                <!-- Granularity Selector (shown only for applicable chart types) -->
                <com.google.android.material.button.MaterialButtonToggleGroup
                    android:id="@+id/granularity_group"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="16dp"
                    android:orientation="horizontal"
                    app:singleSelection="true">

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/granularity_day"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Day"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/granularity_week"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Week"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                    <com.google.android.material.button.MaterialButton
                        android:id="@+id/granularity_month"
                        android:layout_width="0dp"
                        android:layout_height="wrap_content"
                        android:layout_weight="1"
                        android:text="Month"
                        android:textSize="12sp"
                        android:minHeight="48dp"
                        style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

                </com.google.android.material.button.MaterialButtonToggleGroup>

                <!-- Chart Title -->
                <TextView
                    android:id="@+id/chart_title"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="16dp"
                    android:layout_marginBottom="8dp"
                    android:text="Points Balance Over Time"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                    android:textAlignment="center"
                    android:textColor="?android:attr/textColorPrimary" />

                <!-- Chart Container - Swaps between different chart types -->
                <FrameLayout
                    android:id="@+id/chart_container"
                    android:layout_width="match_parent"
                    android:layout_height="400dp">

                    <com.github.mikephil.charting.charts.LineChart
                        android:id="@+id/points_chart_line"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:visibility="visible" />

                    <com.github.mikephil.charting.charts.BarChart
                        android:id="@+id/points_chart_bar"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:visibility="gone" />

                    <com.github.mikephil.charting.charts.PieChart
                        android:id="@+id/points_chart_pie"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:visibility="gone" />

                    <com.github.mikephil.charting.charts.LineChart
                        android:id="@+id/points_chart_area"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:visibility="gone" />

                    <com.github.mikephil.charting.charts.CombinedChart
                        android:id="@+id/points_chart_combined"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:visibility="gone" />

                    <TextView
                        android:id="@+id/empty_graph"
                        android:layout_width="match_parent"
                        android:layout_height="match_parent"
                        android:gravity="center"
                        android:text="No graph data available"
                        android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                        android:textColor="?android:attr/textColorSecondary"
                        android:visibility="gone" />

                </FrameLayout>

                <!-- Legend Label (shown only for pie charts) -->
                <TextView
                    android:id="@+id/legend_label"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="8dp"
                    android:text="Legend"
                    android:textAppearance="@style/TextAppearance.Material3.TitleMedium"
                    android:textAlignment="center"
                    android:textColor="?android:attr/textColorPrimary"
                    android:visibility="gone" />

                <!-- Settings Panel -->
                <com.google.android.material.card.MaterialCardView
                    android:id="@+id/settings_card"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="16dp"
                    app:cardCornerRadius="8dp"
                    app:cardElevation="2dp">

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="vertical"
                        android:padding="16dp">

                        <LinearLayout
                            android:id="@+id/settings_header"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:orientation="horizontal"
                            android:gravity="center_vertical"
                            android:clickable="true"
                            android:focusable="true"
                            android:foreground="?attr/selectableItemBackground"
                            android:paddingVertical="8dp">

                            <TextView
                                android:layout_width="0dp"
                                android:layout_height="wrap_content"
                                android:layout_weight="1"
                                android:text="Chart Settings"
                                android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                                android:textColor="?android:attr/textColorPrimary" />

                            <ImageView
                                android:id="@+id/settings_expand_icon"
                                android:layout_width="24dp"
                                android:layout_height="24dp"
                                android:src="@android:drawable/arrow_down_float"
                                android:contentDescription="Expand settings" />

                        </LinearLayout>

                        <LinearLayout
                            android:id="@+id/settings_content"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:orientation="vertical"
                            android:visibility="gone">

                            <!-- Display Settings -->
                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="16dp"
                                android:layout_marginBottom="8dp"
                                android:text="Display Settings"
                                android:textAppearance="@style/TextAppearance.Material3.TitleMedium"
                                android:textColor="?android:attr/textColorPrimary" />

                            <com.google.android.material.switchmaterial.SwitchMaterial
                                android:id="@+id/show_grid_lines"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:text="Show Grid Lines"
                                android:checked="true" />

                            <com.google.android.material.switchmaterial.SwitchMaterial
                                android:id="@+id/show_data_points"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:text="Show Data Points"
                                android:checked="false" />

                            <com.google.android.material.switchmaterial.SwitchMaterial
                                android:id="@+id/show_legend"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:text="Show Legend"
                                android:checked="false" />

                            <com.google.android.material.switchmaterial.SwitchMaterial
                                android:id="@+id/enable_animation"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:text="Chart Animation"
                                android:checked="true" />

                            <!-- Smoothing Toggle -->
                            <com.google.android.material.switchmaterial.SwitchMaterial
                                android:id="@+id/smooth_lines"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="16dp"
                                android:text="Smooth Line Graphs"
                                android:checked="true" />

                            <!-- Y-axis Range -->
                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="16dp"
                                android:layout_marginBottom="8dp"
                                android:text="Y-Axis Range"
                                android:textAppearance="@style/TextAppearance.Material3.TitleMedium"
                                android:textColor="?android:attr/textColorPrimary" />

                            <com.google.android.material.switchmaterial.SwitchMaterial
                                android:id="@+id/auto_y_axis"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:text="Auto Adjust"
                                android:checked="true" />

                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:text="Min Value"
                                android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                                android:textColor="?android:attr/textColorSecondary" />

                            <com.google.android.material.slider.Slider
                                android:id="@+id/y_axis_min_slider"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:valueFrom="0"
                                android:valueTo="10000"
                                android:value="0"
                                android:stepSize="100"
                                android:enabled="false" />

                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:text="Max Value"
                                android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                                android:textColor="?android:attr/textColorSecondary" />

                            <com.google.android.material.slider.Slider
                                android:id="@+id/y_axis_max_slider"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:valueFrom="0"
                                android:valueTo="100000"
                                android:value="10000"
                                android:stepSize="1000"
                                android:enabled="false" />

                            <!-- Data Filters -->
                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="16dp"
                                android:layout_marginBottom="8dp"
                                android:text="Data Filters"
                                android:textAppearance="@style/TextAppearance.Material3.TitleMedium"
                                android:textColor="?android:attr/textColorPrimary" />

                            <com.google.android.material.switchmaterial.SwitchMaterial
                                android:id="@+id/filter_earned_only"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:text="Show Only Earned Transactions"
                                android:checked="false" />

                            <com.google.android.material.switchmaterial.SwitchMaterial
                                android:id="@+id/filter_spent_only"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:text="Show Only Spent Transactions"
                                android:checked="false" />

                            <TextView
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:layout_marginTop="8dp"
                                android:text="Minimum Transaction Size"
                                android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                                android:textColor="?android:attr/textColorSecondary" />

                            <TextView
                                android:id="@+id/min_delta_value"
                                android:layout_width="wrap_content"
                                android:layout_height="wrap_content"
                                android:layout_gravity="end"
                                android:text="0 pts"
                                android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                                android:textColor="?android:attr/textColorSecondary" />

                            <com.google.android.material.slider.Slider
                                android:id="@+id/min_delta_slider"
                                android:layout_width="match_parent"
                                android:layout_height="wrap_content"
                                android:valueFrom="0"
                                android:valueTo="10000"
                                android:value="0"
                                android:stepSize="100" />

                        </LinearLayout>

                    </LinearLayout>

                </com.google.android.material.card.MaterialCardView>

            </LinearLayout>

            <!-- Info Tab Content -->
            <LinearLayout
                android:id="@+id/info_tab"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:visibility="gone"
                android:padding="16dp">

                <com.google.android.material.card.MaterialCardView
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="16dp"
                    app:cardCornerRadius="8dp"
                    app:cardElevation="2dp">

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="vertical"
                        android:padding="16dp">

                        <TextView
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="How to Earn Points"
                            android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                            android:textColor="?android:attr/textColorPrimary" />

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="• Safety bonus (no incidents)\n• On-time delivery streak\n• Positive customer feedback\n• Monthly performance bonus\n• Training completed\n• Referral bonus (driver hired)\n• Holiday bonus\n• Extra shift / route coverage\n• Fuel efficiency target met\n• Special project completion\n• Attendance milestone"
                            android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
                            android:textColor="?android:attr/textColorSecondary" />

                    </LinearLayout>

                </com.google.android.material.card.MaterialCardView>

                <com.google.android.material.card.MaterialCardView
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="16dp"
                    app:cardCornerRadius="8dp"
                    app:cardElevation="2dp">

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="vertical"
                        android:padding="16dp">

                        <TextView
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="How Points Are Deducted"
                            android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                            android:textColor="?android:attr/textColorPrimary" />

                        <TextView
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="• Order purchases from the catalog\n• Shipping costs\n• Late delivery\n• Missed pickup\n• Customer complaint\n• Safety violation (minor)\n• Safety violation (major)\n• Equipment misuse / damage\n• Policy non-compliance\n• No-show / unapproved absence\n• Excessive idling / fuel waste\n• Paperwork error / missing docs\n• Uniform/branding issue"
                            android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
                            android:textColor="?android:attr/textColorSecondary" />

                    </LinearLayout>

                </com.google.android.material.card.MaterialCardView>

                <com.google.android.material.card.MaterialCardView
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    app:cardCornerRadius="8dp"
                    app:cardElevation="2dp">

                    <LinearLayout
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:orientation="vertical"
                        android:padding="16dp">

                        <TextView
                            android:layout_width="wrap_content"
                            android:layout_height="wrap_content"
                            android:text="About Conversion Rates"
                            android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                            android:textColor="?android:attr/textColorPrimary" />

                        <TextView
                            android:id="@+id/conversion_info"
                            android:layout_width="match_parent"
                            android:layout_height="wrap_content"
                            android:layout_marginTop="8dp"
                            android:text="Conversion rates may vary by sponsor. Check your current rate above."
                            android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
                            android:textColor="?android:attr/textColorSecondary" />

                    </LinearLayout>

                </com.google.android.material.card.MaterialCardView>

            </LinearLayout>

        </LinearLayout>

    </androidx.core.widget.NestedScrollView>

    <ProgressBar
        android:id="@+id/progress_bar"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:layout_gravity="center"
        android:visibility="gone" />

</androidx.coordinatorlayout.widget.CoordinatorLayout>


```


===== mobileApplication/app/src/main/res/layout/fragment_product_detail.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.core.widget.NestedScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:fillViewport="true">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="16dp">

        <!-- Loading Skeleton Placeholders -->
        <com.example.driverrewards.ui.catalog.ShimmerView
            android:id="@+id/skeleton_image"
            android:layout_width="match_parent"
            android:layout_height="450dp"
            android:layout_marginBottom="16dp"
            android:background="@drawable/shimmer_placeholder"
            android:visibility="gone" />

        <!-- Detail Skeleton Boxes Row 1 -->
        <LinearLayout
            android:id="@+id/skeleton_details_row1"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:layout_marginBottom="12dp"
            android:visibility="gone">
            
            <com.example.driverrewards.ui.catalog.ShimmerView
                android:layout_width="0dp"
                android:layout_height="80dp"
                android:layout_weight="1"
                android:layout_marginEnd="8dp"
                android:background="@drawable/shimmer_placeholder" />
            
            <com.example.driverrewards.ui.catalog.ShimmerView
                android:layout_width="0dp"
                android:layout_height="80dp"
                android:layout_weight="1"
                android:layout_marginStart="8dp"
                android:background="@drawable/shimmer_placeholder" />
        </LinearLayout>

        <!-- Detail Skeleton Boxes Row 2 -->
        <LinearLayout
            android:id="@+id/skeleton_details_row2"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:layout_marginBottom="12dp"
            android:visibility="gone">
            
            <com.example.driverrewards.ui.catalog.ShimmerView
                android:layout_width="0dp"
                android:layout_height="60dp"
                android:layout_weight="1"
                android:layout_marginEnd="8dp"
                android:background="@drawable/shimmer_placeholder" />
            
            <com.example.driverrewards.ui.catalog.ShimmerView
                android:layout_width="0dp"
                android:layout_height="60dp"
                android:layout_weight="1"
                android:layout_marginStart="8dp"
                android:background="@drawable/shimmer_placeholder" />
        </LinearLayout>

        <!-- Detail Skeleton Boxes Row 3 (single wide box) -->
        <com.example.driverrewards.ui.catalog.ShimmerView
            android:id="@+id/skeleton_details_row3"
            android:layout_width="match_parent"
            android:layout_height="100dp"
            android:layout_marginBottom="16dp"
            android:background="@drawable/shimmer_placeholder"
            android:visibility="gone" />

        <!-- Main Product Image -->
        <ImageView
            android:id="@+id/main_product_image"
            android:layout_width="match_parent"
            android:layout_height="300dp"
            android:layout_marginBottom="16dp"
            android:scaleType="centerInside"
            android:background="#F5F5F5"
            android:visibility="gone"
            tools:src="@drawable/ic_catalog" />

        <!-- Thumbnail Gallery (Horizontal RecyclerView) -->
        <androidx.recyclerview.widget.RecyclerView
            android:id="@+id/thumbnail_recycler_view"
            android:layout_width="match_parent"
            android:layout_height="80dp"
            android:layout_marginBottom="16dp"
            android:orientation="horizontal"
            tools:listitem="@layout/item_thumbnail"
            app:layoutManager="androidx.recyclerview.widget.LinearLayoutManager"
            android:visibility="gone" />

        <!-- Product Title -->
        <TextView
            android:id="@+id/product_title"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="8dp"
            android:textSize="20sp"
            android:textStyle="bold"
            android:textColor="?android:attr/textColorPrimary"
            tools:text="Sample Product Title" />

        <!-- Product Subtitle -->
        <TextView
            android:id="@+id/product_subtitle"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:textSize="14sp"
            android:textColor="?android:attr/textColorSecondary"
            android:visibility="gone"
            tools:text="Product subtitle" />

        <!-- Points and Availability Row -->
        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            android:layout_marginBottom="8dp">

            <TextView
                android:id="@+id/product_points"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:textSize="24sp"
                android:textStyle="bold"
                android:textColor="?colorPrimary"
                tools:text="100 pts" />

            <!-- Availability Badges -->
            <TextView
                android:id="@+id/low_stock_badge"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginStart="8dp"
                android:padding="6dp"
                android:text="Low stock"
                android:textSize="12sp"
                android:textStyle="bold"
                android:background="#FFF3CD"
                android:textColor="#92400E"
                android:visibility="gone" />

            <TextView
                android:id="@+id/out_of_stock_badge"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginStart="8dp"
                android:padding="6dp"
                android:text="Out of stock"
                android:textSize="12sp"
                android:textStyle="bold"
                android:background="#F8D7DA"
                android:textColor="#721C24"
                android:visibility="gone" />

            <TextView
                android:id="@+id/available_badge"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginStart="8dp"
                android:padding="6dp"
                android:text="Available"
                android:textSize="12sp"
                android:textStyle="bold"
                android:background="#D1FAE5"
                android:textColor="#065F46"
                android:visibility="gone" />
        </LinearLayout>

        <!-- Brand -->
        <TextView
            android:id="@+id/product_brand"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:textSize="14sp"
            android:textColor="?android:attr/textColorSecondary"
            android:visibility="gone"
            tools:text="Brand: Sample Brand" />

        <!-- Condition -->
        <TextView
            android:id="@+id/product_condition"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:textSize="14sp"
            android:textColor="?android:attr/textColorSecondary"
            android:visibility="gone"
            tools:text="Condition: New" />

        <!-- Variants Section -->
        <LinearLayout
            android:id="@+id/variants_container"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:background="#F9FAFB"
            android:padding="16dp"
            android:layout_marginBottom="16dp"
            android:visibility="gone">

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Available Options"
                android:textSize="16sp"
                android:textStyle="bold"
                android:layout_marginBottom="8dp"
                android:textColor="?android:attr/textColorPrimary" />

            <TextView
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:text="Select options below. Prices may vary by selection."
                android:textSize="12sp"
                android:textColor="?android:attr/textColorSecondary"
                android:layout_marginBottom="12dp" />

            <!-- Variant dropdowns will be added dynamically here -->

        </LinearLayout>

        <!-- Description Section -->
        <TextView
            android:id="@+id/description_label"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="About This Item"
            android:textSize="16sp"
            android:textStyle="bold"
            android:layout_marginBottom="8dp"
            android:visibility="gone"
            android:textColor="?android:attr/textColorPrimary" />

        <TextView
            android:id="@+id/product_description"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:textSize="14sp"
            android:textColor="?android:attr/textColorPrimary"
            android:visibility="gone"
            tools:text="Product description goes here" />

        <!-- Item Specifics Section -->
        <TextView
            android:id="@+id/item_specifics_label"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="Product Details"
            android:textSize="16sp"
            android:textStyle="bold"
            android:layout_marginBottom="8dp"
            android:visibility="gone"
            android:textColor="?android:attr/textColorPrimary" />

        <androidx.recyclerview.widget.RecyclerView
            android:id="@+id/item_specifics_recycler_view"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:visibility="gone"
            tools:listitem="@layout/item_spec_row" />

        <!-- Action Buttons -->
        <com.google.android.material.button.MaterialButton
            android:id="@+id/add_to_cart_button"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="8dp"
            android:text="Add to Cart"
            android:textSize="16sp"
            android:visibility="gone"
            app:icon="@android:drawable/ic_menu_recent_history"
            app:iconGravity="textStart" />

        <com.google.android.material.button.MaterialButton
            android:id="@+id/favorite_button"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginBottom="16dp"
            android:text="Add to Favorites"
            android:textSize="16sp"
            android:visibility="gone"
            style="@style/Widget.Material3.Button.OutlinedButton"
            app:icon="@drawable/ic_favorite_border"
            app:iconGravity="textStart" />

        <!-- Related Products Section -->
        <TextView
            android:id="@+id/related_products_label"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:text="Related Items"
            android:textSize="18sp"
            android:textStyle="bold"
            android:layout_marginBottom="12dp"
            android:visibility="gone"
            android:textColor="?android:attr/textColorPrimary" />

        <androidx.recyclerview.widget.RecyclerView
            android:id="@+id/related_products_recycler_view"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:layout_marginBottom="16dp"
            android:visibility="gone"
            tools:listitem="@layout/item_product_card"
            app:layoutManager="androidx.recyclerview.widget.LinearLayoutManager" />

    </LinearLayout>

</androidx.core.widget.NestedScrollView>

```


===== mobileApplication/app/src/main/res/layout/fragment_profile.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="16dp"
    android:paddingBottom="80dp">

    <!-- Profile Summary Card -->
    <com.google.android.material.card.MaterialCardView
        android:id="@+id/profileCard"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginBottom="24dp"
        android:clickable="true"
        android:focusable="true"
        android:foreground="?android:attr/selectableItemBackground"
        app:cardCornerRadius="12dp"
        app:cardElevation="4dp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="20dp">

            <!-- Profile Picture -->
            <ImageView
                android:id="@+id/profileImageView"
                android:layout_width="120dp"
                android:layout_height="120dp"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="16dp"
                android:scaleType="centerCrop"
                android:contentDescription="Profile picture"
                android:background="@drawable/circle_background" />

            <!-- Driver Name -->
            <TextView
                android:id="@+id/driverNameText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="8dp"
                android:text="Driver Name"
                android:textAppearance="@style/TextAppearance.Material3.HeadlineMedium"
                android:textColor="?android:attr/textColorPrimary" />

            <!-- Points Balance (Large and Prominent) -->
            <TextView
                android:id="@+id/pointsBalanceText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="8dp"
                android:text="0"
                android:textAppearance="@style/TextAppearance.Material3.DisplaySmall"
                android:textColor="?colorPrimary"
                android:textStyle="bold" />

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="8dp"
                android:text="Points"
                android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                android:textColor="?android:attr/textColorSecondary" />

            <!-- Member Since Date -->
            <TextView
                android:id="@+id/memberSinceText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="8dp"
                android:text="Member since Jan 2024"
                android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
                android:textColor="?android:attr/textColorSecondary" />

            <!-- Sponsor Company -->
            <TextView
                android:id="@+id/sponsorCompanyText"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="8dp"
                android:text="Sponsored by Company"
                android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
                android:textColor="?colorPrimary"
                android:visibility="gone" />

            <!-- Click to view details -->
            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:text="Click to view full details"
                android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                android:textColor="?colorPrimary" />

        </LinearLayout>

    </com.google.android.material.card.MaterialCardView>

    <!-- Settings Card -->
    <com.google.android.material.card.MaterialCardView
        android:id="@+id/settingsCard"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginBottom="24dp"
        app:cardCornerRadius="12dp"
        app:cardElevation="4dp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/profileCard">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="16dp">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="16dp"
                android:text="Settings"
                android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                android:textColor="?android:attr/textColorPrimary" />

            <!-- Dark Mode Toggle -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:gravity="center_vertical"
                android:padding="8dp">

                <TextView
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:text="Dark Mode"
                    android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                    android:textColor="?android:attr/textColorPrimary" />

                <com.google.android.material.switchmaterial.SwitchMaterial
                    android:id="@+id/darkModeSwitch"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content" />

            </LinearLayout>

            <!-- MFA Toggle -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:gravity="center_vertical"
                android:padding="8dp">

                <TextView
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:text="Two-Factor Authentication"
                    android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                    android:textColor="?android:attr/textColorPrimary" />

                <com.google.android.material.switchmaterial.SwitchMaterial
                    android:id="@+id/mfaSwitch"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content" />

            </LinearLayout>

            <!-- Future Settings Placeholders -->
            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:gravity="center_vertical"
                android:padding="8dp"
                android:visibility="gone">

                <TextView
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:text="Notification Preferences"
                    android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                    android:textColor="?android:attr/textColorSecondary" />

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Future"
                    android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                    android:textColor="?android:attr/textColorSecondary" />

            </LinearLayout>

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="horizontal"
                android:gravity="center_vertical"
                android:padding="8dp"
                android:visibility="gone">

                <TextView
                    android:layout_width="0dp"
                    android:layout_height="wrap_content"
                    android:layout_weight="1"
                    android:text="Language Preferences"
                    android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                    android:textColor="?android:attr/textColorSecondary" />

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Future"
                    android:textAppearance="@style/TextAppearance.Material3.BodySmall"
                    android:textColor="?android:attr/textColorSecondary" />

            </LinearLayout>

        </LinearLayout>

    </com.google.android.material.card.MaterialCardView>

    <!-- Account Actions Card -->
    <com.google.android.material.card.MaterialCardView
        android:id="@+id/accountActionsCard"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_marginBottom="100dp"
        app:cardCornerRadius="12dp"
        app:cardElevation="4dp"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toBottomOf="@+id/settingsCard">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:padding="16dp">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_gravity="center_horizontal"
                android:layout_marginBottom="16dp"
                android:text="Account Actions"
                android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                android:textColor="?android:attr/textColorPrimary" />

            <!-- Change Password Button -->
            <com.google.android.material.button.MaterialButton
                android:id="@+id/changePasswordButton"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="8dp"
                android:text="Change Password"
                android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                app:icon="@drawable/ic_lock"
                app:iconGravity="textStart"
                style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

            <!-- Update Address Button -->
            <com.google.android.material.button.MaterialButton
                android:id="@+id/updateAddressButton"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginBottom="8dp"
                android:text="Update Shipping Address"
                android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                app:icon="@drawable/ic_home"
                app:iconGravity="textStart"
                style="@style/Widget.Material3.Button.OutlinedButton.DarkGray" />

        </LinearLayout>

    </com.google.android.material.card.MaterialCardView>

    <!-- Loading Progress Bar -->
    <ProgressBar
        android:id="@+id/progressBar"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:visibility="gone"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>

```


===== mobileApplication/app/src/main/res/layout/fragment_profile_detail.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.core.widget.NestedScrollView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:padding="16dp"
    android:paddingBottom="120dp"
    android:fillViewport="true"
    android:clipToPadding="false">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content">

        <!-- Driver Name and Points Summary -->
        <com.google.android.material.card.MaterialCardView
            android:id="@+id/summaryCard"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            android:clickable="true"
            android:focusable="true"
            android:foreground="?attr/selectableItemBackground"
            app:cardCornerRadius="12dp"
            app:cardElevation="4dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="20dp">

                <!-- Profile Picture -->
                <ImageView
                    android:id="@+id/profileImageView"
                    android:layout_width="120dp"
                    android:layout_height="120dp"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="16dp"
                    android:scaleType="centerCrop"
                    android:contentDescription="Profile picture"
                    android:background="@drawable/circle_background" />

                <TextView
                    android:id="@+id/driverNameText"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="8dp"
                    android:text="Driver Name"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineMedium"
                    android:textColor="?android:attr/textColorPrimary" />

                <TextView
                    android:id="@+id/pointsBalanceText"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="4dp"
                    android:text="0"
                    android:textAppearance="@style/TextAppearance.Material3.DisplaySmall"
                    android:textColor="?colorPrimary"
                    android:textStyle="bold"
                    android:clickable="true"
                    android:focusable="true" />

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="8dp"
                    android:text="Points"
                    android:textAppearance="@style/TextAppearance.Material3.BodyLarge"
                    android:textColor="?android:attr/textColorSecondary" />

                <TextView
                    android:id="@+id/memberSinceText"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:text="Member since Jan 2024"
                    android:textAppearance="@style/TextAppearance.Material3.BodyMedium"
                    android:textColor="?android:attr/textColorSecondary" />

            </LinearLayout>

        </com.google.android.material.card.MaterialCardView>

        <!-- Account Information -->
        <com.google.android.material.card.MaterialCardView
            android:id="@+id/accountInfoCard"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            app:cardCornerRadius="12dp"
            app:cardElevation="4dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/summaryCard">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="16dp"
                    android:text="Account Information"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                    android:textColor="?android:attr/textColorPrimary" />

                <com.google.android.material.textfield.TextInputLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="8dp"
                    android:hint="Email"
                    app:startIconDrawable="@drawable/ic_person"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/emailText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

                <com.google.android.material.textfield.TextInputLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="8dp"
                    android:hint="Username"
                    app:startIconDrawable="@drawable/ic_person"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/usernameText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

                <com.google.android.material.textfield.TextInputLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="8dp"
                    android:hint="Account ID"
                    app:startIconDrawable="@drawable/ic_person"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/accountIdText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

                <com.google.android.material.textfield.TextInputLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="8dp"
                    android:hint="Driver ID"
                    app:startIconDrawable="@drawable/ic_person"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/driverIdText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

                <com.google.android.material.textfield.TextInputLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="8dp"
                    android:hint="Age"
                    app:startIconDrawable="@drawable/ic_person"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/ageText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

                <com.google.android.material.textfield.TextInputLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:hint="Gender"
                    app:startIconDrawable="@drawable/ic_person"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/genderText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

            </LinearLayout>

        </com.google.android.material.card.MaterialCardView>

        <!-- Shipping Address -->
        <com.google.android.material.card.MaterialCardView
            android:id="@+id/shippingAddressCard"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            app:cardCornerRadius="12dp"
            app:cardElevation="4dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/accountInfoCard">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="16dp"
                    android:text="Shipping Address"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                    android:textColor="?android:attr/textColorPrimary" />

                <com.google.android.material.textfield.TextInputLayout
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:hint="Address"
                    app:startIconDrawable="@drawable/ic_home"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/shippingAddressText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

            </LinearLayout>

        </com.google.android.material.card.MaterialCardView>

        <!-- License Information -->
        <com.google.android.material.card.MaterialCardView
            android:id="@+id/licenseCard"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginBottom="24dp"
            app:cardCornerRadius="12dp"
            app:cardElevation="4dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/shippingAddressCard">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="16dp"
                    android:text="License Information"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                    android:textColor="?android:attr/textColorPrimary" />

                <com.google.android.material.textfield.TextInputLayout
                    android:id="@+id/licenseNumberLabel"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="8dp"
                    android:hint="License Number"
                    app:startIconDrawable="@drawable/ic_lock"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/licenseNumberText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

                <com.google.android.material.textfield.TextInputLayout
                    android:id="@+id/licenseIssueDateLabel"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginBottom="8dp"
                    android:hint="Issue Date"
                    app:startIconDrawable="@drawable/ic_lock"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/licenseIssueDateText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

                <com.google.android.material.textfield.TextInputLayout
                    android:id="@+id/licenseExpirationDateLabel"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:hint="Expiration Date"
                    app:startIconDrawable="@drawable/ic_lock"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/licenseExpirationDateText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

            </LinearLayout>

        </com.google.android.material.card.MaterialCardView>

        <!-- Sponsor Information -->
        <com.google.android.material.card.MaterialCardView
            android:id="@+id/sponsorCard"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginBottom="150dp"
            app:cardCornerRadius="12dp"
            app:cardElevation="4dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/licenseCard">

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:padding="16dp">

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_gravity="center_horizontal"
                    android:layout_marginBottom="16dp"
                    android:text="Sponsor Information"
                    android:textAppearance="@style/TextAppearance.Material3.HeadlineSmall"
                    android:textColor="?android:attr/textColorPrimary" />

                <com.google.android.material.textfield.TextInputLayout
                    android:id="@+id/sponsorCompanyLabel"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:hint="Sponsor Company"
                    app:startIconDrawable="@drawable/ic_person"
                    app:boxStrokeColor="@android:color/transparent">

                    <com.google.android.material.textfield.TextInputEditText
                        android:id="@+id/sponsorCompanyText"
                        android:layout_width="match_parent"
                        android:layout_height="wrap_content"
                        android:enabled="false"
                        android:textColor="?android:attr/textColorPrimary" />

                </com.google.android.material.textfield.TextInputLayout>

            </LinearLayout>

        </com.google.android.material.card.MaterialCardView>

        <!-- Bottom Spacer to ensure content is above navigation bar -->
        <View
            android:layout_width="match_parent"
            android:layout_height="100dp"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toBottomOf="@+id/sponsorCard" />

        <!-- Loading Progress Bar -->
        <ProgressBar
            android:id="@+id/progressBar"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:visibility="gone"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintEnd_toEndOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintTop_toTopOf="parent" />

    </androidx.constraintlayout.widget.ConstraintLayout>

</androidx.core.widget.NestedScrollView>

```


===== mobileApplication/app/src/main/res/layout/item_cart.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_margin="8dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="4dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="12dp">

        <ImageView
            android:id="@+id/item_image"
            android:layout_width="80dp"
            android:layout_height="80dp"
            android:scaleType="centerCrop"
            android:background="#F5F5F5" />

        <LinearLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:layout_marginStart="12dp"
            android:orientation="vertical">

            <TextView
                android:id="@+id/item_title"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:textSize="14sp"
                android:textStyle="bold"
                android:maxLines="2"
                android:ellipsize="end" />

            <TextView
                android:id="@+id/variation_details"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="2dp"
                android:textSize="11sp"
                android:textColor="#888888"
                android:visibility="gone" />

            <TextView
                android:id="@+id/points_per_unit"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                android:textSize="12sp"
                android:textColor="#666666" />

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:orientation="horizontal"
                android:gravity="center_vertical">

                <TextView
                    android:id="@+id/quantity_label"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Qty: "
                    android:textSize="12sp" />

                <ImageButton
                    android:id="@+id/quantity_decrease"
                    android:layout_width="32dp"
                    android:layout_height="32dp"
                    android:background="?attr/colorPrimary"
                    android:src="@drawable/ic_minus"
                    android:contentDescription="Decrease quantity"
                    android:padding="6dp"
                    android:scaleType="fitCenter" />

                <TextView
                    android:id="@+id/quantity"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginStart="8dp"
                    android:layout_marginEnd="8dp"
                    android:text="1"
                    android:textSize="14sp"
                    android:minWidth="40dp"
                    android:gravity="center" />

                <ImageButton
                    android:id="@+id/quantity_increase"
                    android:layout_width="32dp"
                    android:layout_height="32dp"
                    android:background="?attr/colorPrimary"
                    android:src="@drawable/ic_plus"
                    android:contentDescription="Increase quantity"
                    android:padding="6dp"
                    android:scaleType="fitCenter" />

            </LinearLayout>

            <TextView
                android:id="@+id/line_total"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                android:textSize="14sp"
                android:textStyle="bold"
                android:textColor="#1976D2" />

        </LinearLayout>

        <ImageButton
            android:id="@+id/remove_button"
            android:layout_width="40dp"
            android:layout_height="40dp"
            android:layout_gravity="center_vertical"
            android:background="@drawable/bg_delete_button"
            android:src="@drawable/ic_delete"
            android:contentDescription="Remove item"
            android:padding="8dp"
            android:scaleType="fitCenter" />

    </LinearLayout>

</androidx.cardview.widget.CardView>


```


===== mobileApplication/app/src/main/res/layout/item_order.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_margin="8dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="4dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="16dp">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical">

            <LinearLayout
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:orientation="vertical">

                <TextView
                    android:id="@+id/order_number"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:textSize="16sp"
                    android:textStyle="bold" />

                <TextView
                    android:id="@+id/order_date"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="4dp"
                    android:textSize="12sp"
                    android:textColor="#666666" />

            </LinearLayout>

            <TextView
                android:id="@+id/order_status"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Completed"
                android:textSize="12sp"
                android:textStyle="bold"
                android:background="#E3F2FD"
                android:textColor="#1976D2"
                android:padding="6dp"
                android:backgroundTint="#E3F2FD" />

        </LinearLayout>

        <TextView
            android:id="@+id/total_points"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:textSize="18sp"
            android:textStyle="bold"
            android:textColor="#1976D2" />

        <TextView
            android:id="@+id/item_count"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="4dp"
            android:textSize="12sp"
            android:textColor="#666666" />

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_marginTop="12dp"
            android:orientation="horizontal">

            <com.google.android.material.button.MaterialButton
                android:id="@+id/refund_button"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="Refund"
                style="@style/Widget.MaterialComponents.Button.OutlinedButton"
                android:visibility="gone" />

            <com.google.android.material.button.MaterialButton
                android:id="@+id/view_details_button"
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:layout_marginStart="8dp"
                android:text="View Details"
                style="@style/Widget.MaterialComponents.Button.TextButton" />

        </LinearLayout>

    </LinearLayout>

</androidx.cardview.widget.CardView>


```


===== mobileApplication/app/src/main/res/layout/item_order_detail.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_margin="8dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="4dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:padding="12dp">

        <LinearLayout
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:orientation="vertical">

            <TextView
                android:id="@+id/item_title"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:textSize="14sp"
                android:textStyle="bold"
                android:maxLines="2"
                android:ellipsize="end" />

            <TextView
                android:id="@+id/variation_details"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="2dp"
                android:textSize="11sp"
                android:textColor="#888888"
                android:visibility="gone" />

            <TextView
                android:id="@+id/item_points"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                android:textSize="12sp"
                android:textColor="#666666"
                android:text="... pts each" />

            <LinearLayout
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="8dp"
                android:orientation="horizontal"
                android:gravity="center_vertical">

                <TextView
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:text="Quantity: "
                    android:textSize="12sp" />

                <TextView
                    android:id="@+id/item_quantity"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:textSize="14sp"
                    android:textStyle="bold"
                    android:text="1" />

            </LinearLayout>

            <TextView
                android:id="@+id/item_line_total"
                android:layout_width="match_parent"
                android:layout_height="wrap_content"
                android:layout_marginTop="4dp"
                android:textSize="16sp"
                android:textStyle="bold"
                android:textColor="#1976D2"
                android:text="Total: ... pts" />

        </LinearLayout>

    </LinearLayout>

</androidx.cardview.widget.CardView>


```


===== mobileApplication/app/src/main/res/layout/item_points_transaction.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<com.google.android.material.card.MaterialCardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_marginStart="16dp"
    android:layout_marginEnd="16dp"
    android:layout_marginTop="8dp"
    android:layout_marginBottom="8dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="2dp">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="16dp">

        <LinearLayout
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:gravity="center_vertical">

            <LinearLayout
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:orientation="vertical">

                <TextView
                    android:id="@+id/transaction_date"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:textSize="14sp"
                    android:textColor="?android:attr/textColorSecondary"
                    android:text="Jan 1, 2024 10:30 AM" />

                <TextView
                    android:id="@+id/transaction_reason"
                    android:layout_width="match_parent"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="4dp"
                    android:textSize="16sp"
                    android:textStyle="bold"
                    android:textColor="?android:attr/textColorPrimary"
                    android:maxLines="2"
                    android:ellipsize="end"
                    android:text="Transaction reason" />

            </LinearLayout>

            <LinearLayout
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:orientation="vertical"
                android:gravity="end">

                <TextView
                    android:id="@+id/delta_points"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:textSize="18sp"
                    android:textStyle="bold"
                    android:text="+1000"
                    android:textColor="#4CAF50" />

                <TextView
                    android:id="@+id/balance_after"
                    android:layout_width="wrap_content"
                    android:layout_height="wrap_content"
                    android:layout_marginTop="4dp"
                    android:textSize="12sp"
                    android:textColor="?android:attr/textColorSecondary"
                    android:text="Balance: 5000 pts" />

            </LinearLayout>

        </LinearLayout>

    </LinearLayout>

</com.google.android.material.card.MaterialCardView>



```


===== mobileApplication/app/src/main/res/layout/item_product_card.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_marginStart="4dp"
    android:layout_marginEnd="4dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="4dp">

    <RelativeLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="8dp">

        <!-- Product Image -->
        <ImageView
            android:id="@+id/product_image"
            android:layout_width="match_parent"
            android:layout_height="120dp"
            android:layout_alignParentTop="true"
            android:layout_centerHorizontal="true"
            android:scaleType="centerCrop"
            android:background="#F5F5F5" />

        <!-- Pinned Badge -->
        <LinearLayout
            android:id="@+id/pinned_badge"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_alignParentTop="true"
            android:layout_alignParentEnd="true"
            android:layout_margin="4dp"
            android:background="@drawable/pinned_badge_background"
            android:padding="4dp"
            android:gravity="center"
            android:visibility="gone">

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="PINNED"
                android:textSize="8sp"
                android:textColor="@android:color/white"
                android:textStyle="bold" />

        </LinearLayout>

        <!-- Favorite Button -->
        <ImageView
            android:id="@+id/favorite_button"
            android:layout_width="28dp"
            android:layout_height="28dp"
            android:layout_alignParentTop="true"
            android:layout_alignParentStart="true"
            android:layout_margin="8dp"
            android:src="@drawable/ic_favorite_border"
            android:background="@android:color/transparent" />

        <!-- Product Title -->
        <TextView
            android:id="@+id/product_title"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_below="@id/product_image"
            android:layout_marginTop="8dp"
            android:layout_marginEnd="8dp"
            android:textSize="12sp"
            android:textColor="@android:color/black"
            android:maxLines="2"
            android:ellipsize="end" />

        <!-- Points -->
        <TextView
            android:id="@+id/product_points"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_below="@id/product_title"
            android:layout_marginTop="4dp"
            android:textSize="14sp"
            android:textColor="@android:color/holo_blue_dark"
            android:textStyle="bold" />

        <!-- Availability Status -->
        <TextView
            android:id="@+id/availability_status"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_below="@id/product_title"
            android:layout_alignParentEnd="true"
            android:layout_marginTop="4dp"
            android:textSize="10sp"
            android:textColor="@android:color/holo_orange_dark"
            android:textStyle="bold" />

    </RelativeLayout>

</androidx.cardview.widget.CardView>

```


===== mobileApplication/app/src/main/res/layout/item_related_product_card.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="160dp"
    android:layout_height="wrap_content"
    android:layout_margin="8dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="4dp">

    <RelativeLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="8dp">

        <!-- Product Image -->
        <ImageView
            android:id="@+id/product_image"
            android:layout_width="match_parent"
            android:layout_height="120dp"
            android:layout_alignParentTop="true"
            android:scaleType="centerCrop"
            android:background="#F5F5F5" />

        <!-- Availability Badge -->
        <TextView
            android:id="@+id/availability_badge"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_alignParentTop="true"
            android:layout_alignParentStart="true"
            android:layout_margin="4dp"
            android:padding="4dp"
            android:textSize="8sp"
            android:textStyle="bold"
            android:background="#80FFFFFF"
            android:visibility="gone" />

        <!-- Product Title -->
        <TextView
            android:id="@+id/product_title"
            android:layout_width="match_parent"
            android:layout_height="wrap_content"
            android:layout_below="@id/product_image"
            android:layout_marginTop="8dp"
            android:textSize="11sp"
            android:textColor="@android:color/black"
            android:maxLines="2"
            android:ellipsize="end" />

        <!-- Points -->
        <TextView
            android:id="@+id/product_points"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_below="@id/product_title"
            android:layout_marginTop="4dp"
            android:textSize="13sp"
            android:textColor="@android:color/holo_blue_dark"
            android:textStyle="bold" />

    </RelativeLayout>

</androidx.cardview.widget.CardView>

```


===== mobileApplication/app/src/main/res/layout/item_skeleton_product_card.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<com.google.android.material.card.MaterialCardView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_margin="4dp"
    app:cardCornerRadius="12dp"
    app:cardElevation="2dp"
    app:cardBackgroundColor="#F5F5F5">

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:orientation="vertical"
        android:padding="8dp">

        <!-- Image placeholder -->
        <com.example.driverrewards.ui.catalog.ShimmerView
            android:id="@+id/skeleton_image"
            android:layout_width="match_parent"
            android:layout_height="150dp"
            android:layout_marginBottom="8dp"
            android:background="@drawable/shimmer_card_placeholder" />

        <!-- Title placeholder -->
        <com.example.driverrewards.ui.catalog.ShimmerView
            android:id="@+id/skeleton_title"
            android:layout_width="match_parent"
            android:layout_height="16dp"
            android:layout_marginBottom="6dp"
            android:background="@drawable/shimmer_card_placeholder" />

        <!-- Points placeholder -->
        <com.example.driverrewards.ui.catalog.ShimmerView
            android:id="@+id/skeleton_points"
            android:layout_width="80dp"
            android:layout_height="20dp"
            android:background="@drawable/shimmer_card_placeholder" />

    </LinearLayout>

</com.google.android.material.card.MaterialCardView>


```


===== mobileApplication/app/src/main/res/layout/item_spec_row.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="horizontal"
    android:padding="12dp"
    android:background="?android:attr/selectableItemBackground">

    <TextView
        android:id="@+id/spec_key"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_weight="1"
        android:textSize="14sp"
        android:textColor="?android:attr/textColorSecondary"
        android:textStyle="normal"
        tools:text="Brand" />

    <TextView
        android:id="@+id/spec_value"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:layout_weight="1"
        android:textSize="14sp"
        android:textColor="?android:attr/textColorPrimary"
        android:textStyle="normal"
        android:textAlignment="textEnd"
        tools:text="Sample Brand Name" />

</LinearLayout>

```


===== mobileApplication/app/src/main/res/layout/item_thumbnail.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<ImageView xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/thumbnail_image"
    android:layout_width="70dp"
    android:layout_height="70dp"
    android:layout_margin="4dp"
    android:scaleType="centerCrop"
    android:background="#E5E7EB"
    android:padding="2dp"
    tools:src="@drawable/ic_catalog" />

```


===== mobileApplication/app/src/main/res/layout/points_display.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:padding="8dp">

    <LinearLayout
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:orientation="horizontal"
        android:gravity="center_vertical"
        android:layout_alignParentEnd="true"
        android:layout_centerVertical="true">

        <LinearLayout
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:orientation="horizontal"
            android:background="@drawable/points_container_background"
            android:paddingStart="12dp"
            android:paddingEnd="12dp"
            android:paddingTop="6dp"
            android:paddingBottom="6dp"
            android:gravity="center">

            <TextView
                android:id="@+id/points_value"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="0"
                android:textSize="14sp"
                android:textColor="@android:color/white"
                android:textStyle="bold" />

            <TextView
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text=" pts"
                android:textSize="12sp"
                android:textColor="@android:color/white"
                android:layout_marginStart="2dp" />

        </LinearLayout>

    </LinearLayout>

</RelativeLayout>

```


===== mobileApplication/app/src/main/res/menu/bottom_nav_menu.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<menu xmlns:android="http://schemas.android.com/apk/res/android">

    <item
        android:id="@+id/navigation_catalog"
        android:icon="@drawable/ic_catalog"
        android:title="@string/title_catalog" />

    <item
        android:id="@+id/navigation_favorites"
        android:icon="@drawable/ic_favorite_filled"
        android:title="@string/title_favorites" />

    <item
        android:id="@+id/navigation_cart"
        android:icon="@drawable/ic_cart"
        android:title="@string/title_cart" />

    <item
        android:id="@+id/navigation_orders"
        android:icon="@drawable/ic_orders"
        android:title="@string/title_orders" />

    <item
        android:id="@+id/navigation_profile"
        android:icon="@drawable/ic_person"
        android:title="@string/title_profile" />

</menu>
```


===== mobileApplication/app/src/main/res/menu/top_menu.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<menu xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto">

    <item
        android:id="@+id/action_search"
        android:title="Search"
        android:icon="@drawable/ic_search"
        app:actionViewClass="androidx.appcompat.widget.SearchView"
        app:showAsAction="always|collapseActionView" />

    <item
        android:id="@+id/action_logout"
        android:title="Logout"
        android:icon="@drawable/ic_logout"
        app:showAsAction="ifRoom" />

</menu>

```


===== mobileApplication/app/src/main/res/navigation/mobile_navigation.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<navigation xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/mobile_navigation"
    app:startDestination="@+id/navigation_catalog">

    <fragment
        android:id="@+id/navigation_catalog"
        android:name="com.example.driverrewards.ui.catalog.CatalogFragment"
        android:label="@string/title_catalog"
        tools:layout="@layout/fragment_catalog">
        
        <action
            android:id="@+id/action_catalog_to_product_detail"
            app:destination="@id/navigation_product_detail" />
    </fragment>
    
    <fragment
        android:id="@+id/navigation_favorites"
        android:name="com.example.driverrewards.ui.favorites.FavoritesFragment"
        android:label="@string/title_favorites"
        tools:layout="@layout/fragment_favorites">
        
        <action
            android:id="@+id/action_favorites_to_product_detail"
            app:destination="@id/navigation_product_detail" />
    </fragment>
    
    <fragment
        android:id="@+id/navigation_product_detail"
        android:name="com.example.driverrewards.ui.catalog.ProductDetailFragment"
        android:label="Product Details"
        tools:layout="@layout/fragment_product_detail">
        
        <argument
            android:name="itemId"
            app:argType="string" />
        
        <argument
            android:name="variationInfo"
            app:argType="string"
            android:defaultValue="@null" />
        
        <action
            android:id="@+id/action_product_detail_to_product_detail"
            app:destination="@id/navigation_product_detail" />
    </fragment>

    <fragment
        android:id="@+id/navigation_cart"
        android:name="com.example.driverrewards.ui.cart.CartFragment"
        android:label="@string/title_cart"
        tools:layout="@layout/fragment_cart">
        
        <action
            android:id="@+id/action_cart_to_product_detail"
            app:destination="@id/navigation_product_detail"
            app:popUpTo="@id/navigation_cart"
            app:popUpToInclusive="false" />
        
        <action
            android:id="@+id/action_cart_to_checkout"
            app:destination="@id/navigation_checkout" />
    </fragment>

    <fragment
        android:id="@+id/navigation_orders"
        android:name="com.example.driverrewards.ui.orders.OrdersFragment"
        android:label="@string/title_orders"
        tools:layout="@layout/fragment_orders">
        
        <action
            android:id="@+id/action_orders_to_order_detail"
            app:destination="@id/navigation_order_detail" />
    </fragment>

    <fragment
        android:id="@+id/navigation_order_detail"
        android:name="com.example.driverrewards.ui.orders.OrderDetailFragment"
        android:label="Order Details"
        tools:layout="@layout/fragment_order_detail">
        
        <argument
            android:name="orderId"
            app:argType="string" />
        
        <action
            android:id="@+id/action_order_detail_to_checkout"
            app:destination="@id/navigation_checkout" />
        
        <action
            android:id="@+id/action_order_detail_to_product_detail"
            app:destination="@id/navigation_product_detail" />
    </fragment>

    <fragment
        android:id="@+id/navigation_checkout"
        android:name="com.example.driverrewards.ui.cart.CheckoutFragment"
        android:label="Checkout"
        tools:layout="@layout/fragment_checkout">
        
        <argument
            android:name="totalPoints"
            app:argType="integer"
            android:defaultValue="0" />
        
        <argument
            android:name="itemCount"
            app:argType="integer"
            android:defaultValue="0" />
        
        <argument
            android:name="orderId"
            app:argType="string"
            android:defaultValue="@null" />
    </fragment>

    <fragment
        android:id="@+id/navigation_profile"
        android:name="com.example.driverrewards.ui.profile.ProfileFragment"
        android:label="@string/title_profile"
        tools:layout="@layout/fragment_profile">
        
        <action
            android:id="@+id/action_profile_to_profile_detail"
            app:destination="@id/navigation_profile_detail" />
        
        <action
            android:id="@+id/action_profile_to_points_detail"
            app:destination="@id/navigation_points_detail" />
    </fragment>

    <fragment
        android:id="@+id/navigation_profile_detail"
        android:name="com.example.driverrewards.ui.profile.ProfileDetailFragment"
        android:label="Driver Profile"
        tools:layout="@layout/fragment_profile_detail">
        
        <action
            android:id="@+id/action_profile_detail_to_profile"
            app:destination="@id/navigation_profile"
            app:popUpTo="@id/navigation_profile"
            app:popUpToInclusive="false" />
        
        <action
            android:id="@+id/action_profile_detail_to_points_detail"
            app:destination="@id/navigation_points_detail" />
    </fragment>

    <fragment
        android:id="@+id/navigation_points_detail"
        android:name="com.example.driverrewards.ui.points.PointsDetailFragment"
        android:label="Points Details"
        tools:layout="@layout/fragment_points_detail">
    </fragment>

</navigation>
```


===== mobileApplication/app/src/main/res/xml/backup_rules.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?><!--
   Sample backup rules file; uncomment and customize as necessary.
   See https://developer.android.com/guide/topics/data/autobackup
   for details.
   Note: This file is ignored for devices older that API 31
   See https://developer.android.com/about/versions/12/backup-restore
-->
<full-backup-content>
    <!--
   <include domain="sharedpref" path="."/>
   <exclude domain="sharedpref" path="device.xml"/>
-->
</full-backup-content>
```


===== mobileApplication/app/src/main/res/xml/data_extraction_rules.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?><!--
   Sample data extraction rules file; uncomment and customize as necessary.
   See https://developer.android.com/about/versions/12/backup-restore#xml-changes
   for details.
-->
<data-extraction-rules>
    <cloud-backup>
        <!-- TODO: Use <include> and <exclude> to control what is backed up.
        <include .../>
        <exclude .../>
        -->
    </cloud-backup>
    <!--
    <device-transfer>
        <include .../>
        <exclude .../>
    </device-transfer>
    -->
</data-extraction-rules>
```


===== mobileApplication/app/src/main/res/values/colors.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<resources>
    <color name="purple_200">#FFBB86FC</color>
    <color name="purple_500">#FF6200EE</color>
    <color name="purple_700">#FF3700B3</color>
    <color name="teal_200">#FF03DAC5</color>
    <color name="teal_700">#FF018786</color>
    <color name="black">#FF000000</color>
    <color name="white">#FFFFFFFF</color>
    
    <!-- Dark Green Theme Colors -->
    <color name="dark_green_200">#FF81C784</color>
    <color name="dark_green_500">#FF2E7D32</color>
    <color name="dark_green_700">#FF1B5E20</color>
    <color name="dark_green_900">#FF0D3B0D</color>
    
    <!-- Dark Mode Colors -->
    <color name="dark_gray">#FF2C2C2C</color>
    <color name="dark_gray_light">#FF3C3C3C</color>
    
    <!-- Button Outline Colors -->
    <color name="button_outline_dark_gray">#FF424242</color>
    <color name="button_selected_green">#334CAF50</color>
</resources>
```


===== mobileApplication/app/src/main/res/values/dimens.xml =====

```xml
<resources>
    <!-- Default screen margins, per the Android Design guidelines. -->
    <dimen name="activity_horizontal_margin">16dp</dimen>
    <dimen name="activity_vertical_margin">16dp</dimen>
</resources>
```


===== mobileApplication/app/src/main/res/values/strings.xml =====

```xml
<resources>
    <string name="app_name">Rewards</string>
    <string name="title_activity_main">MainActivity</string>
    <string name="title_catalog">Catalog</string>
    <string name="title_favorites">Favorites</string>
    <string name="title_cart">Cart</string>
    <string name="title_orders">Orders</string>
    <string name="title_profile">Profile</string>
</resources>
```


===== mobileApplication/app/src/main/res/values/themes.xml =====

```xml
<resources xmlns:tools="http://schemas.android.com/tools">
    <!-- Base application theme. -->
    <style name="Theme.DriverRewards" parent="Theme.MaterialComponents.DayNight.DarkActionBar">
        <!-- Primary brand color. -->
        <item name="colorPrimary">@color/dark_green_500</item>
        <item name="colorPrimaryVariant">@color/dark_green_700</item>
        <item name="colorOnPrimary">@color/white</item>
        <!-- Secondary brand color. -->
        <item name="colorSecondary">@color/teal_200</item>
        <item name="colorSecondaryVariant">@color/teal_700</item>
        <item name="colorOnSecondary">@color/black</item>
        <!-- Status bar color. -->
        <item name="android:statusBarColor">?attr/colorPrimaryVariant</item>
        <!-- Customize your theme here. -->
    </style>
    
    <!-- Custom Outlined Button Style with Dark Gray -->
    <style name="Widget.Material3.Button.OutlinedButton.DarkGray" parent="Widget.Material3.Button.OutlinedButton">
        <item name="strokeColor">@color/button_outline_dark_gray</item>
        <item name="strokeWidth">1dp</item>
        <item name="backgroundTint">@color/button_selected_background</item>
        <item name="android:textColor">?android:attr/textColorPrimary</item>
    </style>
</resources>
```


===== mobileApplication/app/src/main/res/drawable/bg_delete_button.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="oval">
    <solid android:color="#FF4444" />
    <size
        android:width="40dp"
        android:height="40dp" />
</shape>


```


===== mobileApplication/app/src/main/res/drawable/circle_background.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="oval">
    <solid android:color="?attr/colorSurfaceVariant" />
</shape>


```


===== mobileApplication/app/src/main/res/drawable/edittext_background.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">
    <solid android:color="@android:color/white" />
    <stroke
        android:width="1dp"
        android:color="#CCCCCC" />
    <corners android:radius="4dp" />
</shape>

```


===== mobileApplication/app/src/main/res/drawable/ic_cart.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M7,18c-1.1,0 -2,0.9 -2,2s0.9,2 2,2 2,-0.9 2,-2 -0.9,-2 -2,-2zM1,2v2h2l3.6,7.59 -1.35,2.45c-0.16,0.28 -0.25,0.61 -0.25,0.96 0,1.1 0.9,2 2,2h12v-2L7.42,15c-0.14,0 -0.25,-0.11 -0.25,-0.25l0.03,-0.12L8.1,13h7.45c0.75,0 1.41,-0.41 1.75,-1.03L21.7,4H5.21l-0.94,-2L1,2zM17,18c-1.1,0 -2,0.9 -2,2s0.9,2 2,2 2,-0.9 2,-2 -0.9,-2 -2,-2z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_catalog.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M19,3L5,3c-1.1,0 -2,0.9 -2,2v14c0,1.1 0.9,2 2,2h14c1.1,0 2,-0.9 2,-2L21,5c0,-1.1 -0.9,-2 -2,-2zM19,19L5,19L5,5h14v14zM17,12L7,12v-2h10v2zM17,16L7,16v-2h10v2zM17,8L7,8L7,6h10v2z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_close.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M19,6.41L17.59,5 12,10.59 6.41,5 5,6.41 10.59,12 5,17.59 6.41,19 12,13.41 17.59,19 19,17.59 13.41,12z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_dashboard_black_24dp.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M3,13h8L11,3 3,3v10zM3,21h8v-6L3,15v6zM13,21h8L21,11h-8v10zM13,3v6h8L21,3h-8z"/>
</vector>
```


===== mobileApplication/app/src/main/res/drawable/ic_delete.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24">
    <path
        android:fillColor="@android:color/white"
        android:pathData="M6,19c0,1.1 0.9,2 2,2h8c1.1,0 2,-0.9 2,-2V7H6v12zM19,4h-3.5l-1,-1h-5l-1,1H5v2h14V4z"/>
</vector>


```


===== mobileApplication/app/src/main/res/drawable/ic_favorite_border.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24">
  <path
      android:fillColor="@android:color/white"
      android:strokeWidth="1.8"
      android:strokeColor="@android:color/black"
      android:pathData="M12.1,18.55l-0.1,0.1 -0.1,-0.1C7.14,14.24 4,11.39 4,8.5 4,6.5 5.5,5 7.5,5c1.54,0 3.04,0.99 3.57,2.36h1.87C13.46,5.99 14.96,5 16.5,5c2,0 3.5,1.5 3.5,3.5 0,2.89 -3.14,5.74 -7.9,10.05z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_favorite_filled.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24">
  <path
      android:fillColor="#FF4444"
      android:strokeWidth="1.8"
      android:strokeColor="@android:color/black"
      android:pathData="M12,21.35l-1.45,-1.32C5.4,15.36 2,12.28 2,8.5 2,5.42 4.42,3 7.5,3c1.74,0 3.41,0.81 4.5,2.09C13.09,3.81 14.76,3 16.5,3 19.58,3 22,5.42 22,8.5c0,3.78 -3.4,6.86 -8.55,11.54L12,21.35z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_filter.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M10,18h4v-2h-4v2zM3,6v2h18V6H3zM6,13h12v-2H6V13z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_fingerprint.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorPrimary">
    <path
        android:fillColor="@android:color/white"
        android:pathData="M17.81,4.47c-0.08,0 -0.16,-0.02 -0.23,-0.06C15.66,3.42 14,3 12.01,3c-1.98,0 -3.86,0.47 -5.57,1.41 -0.08,0.05 -0.15,0.05 -0.23,0.06 -0.07,0 -0.14,-0.01 -0.21,-0.04 -0.07,-0.03 -0.13,-0.08 -0.17,-0.14 -0.04,-0.06 -0.07,-0.13 -0.07,-0.2 0,-0.08 0.03,-0.15 0.08,-0.21 0.05,-0.07 0.12,-0.12 0.2,-0.15C7.45,2.09 9.66,1.5 12.01,1.5c2.34,0 4.52,0.59 6.36,1.73 0.08,0.03 0.15,0.08 0.2,0.15 0.05,0.06 0.08,0.14 0.08,0.21 0,0.07 -0.03,0.14 -0.07,0.2 -0.04,0.06 -0.1,0.11 -0.17,0.14C18.01,4.46 17.91,4.47 17.81,4.47zM12,11c-1.1,0 -2,0.9 -2,2 0,1.1 0.9,2 2,2s2,-0.9 2,-2c0,-1.1 -0.9,-2 -2,-2zM6,13c0,-3.31 2.69,-6 6,-6s6,2.69 6,6c0,2.22 -1.21,4.15 -3,5.19L15,20c0,0.55 -0.45,1 -1,1h-4c-0.55,0 -1,-0.45 -1,-1v-1.81C7.21,17.15 6,15.22 6,13zM12,5c-4.42,0 -8,3.58 -8,8 0,2.85 1.58,5.33 3.9,6.64L8,21c0,1.1 0.9,2 2,2h4c1.1,0 2,-0.9 2,-2v-1.36c2.32,-1.31 3.9,-3.79 3.9,-6.64 0,-4.42 -3.58,-8 -8,-8z"/>
</vector>


```


===== mobileApplication/app/src/main/res/drawable/ic_home.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M10,20v-6h4v6h5v-8h3L12,3 2,12h3v8z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_home_black_24dp.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M10,20v-6h4v6h5v-8h3L12,3 2,12h3v8z"/>
</vector>
```


===== mobileApplication/app/src/main/res/drawable/ic_lock.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
    <path
        android:fillColor="@android:color/white"
        android:pathData="M18,8h-1L17,6c0,-2.76 -2.24,-5 -5,-5S7,3.24 7,6v2L6,8c-1.1,0 -2,0.9 -2,2v10c0,1.1 0.9,2 2,2h12c1.1,0 2,-0.9 2,-2L20,10c0,-1.1 -0.9,-2 -2,-2zM12,17c-1.1,0 -2,-0.9 -2,-2s0.9,-2 2,-2 2,0.9 2,2 -0.9,2 -2,2zM15.1,8L8.9,8L8.9,6c0,-1.71 1.39,-3.1 3.1,-3.1 1.71,0 3.1,1.39 3.1,3.1v2z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_logout.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
    <path
        android:fillColor="@android:color/white"
        android:pathData="M17,7l-1.41,1.41L18.17,11H8v2h10.17l-2.58,2.58L17,17l5,-5zM4,5h8V3H4C2.9,3 2,3.9 2,5v14c0,1.1 0.9,2 2,2h8v-2H4V5z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_minus.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24">
    <path
        android:fillColor="@android:color/white"
        android:pathData="M19,13H5v-2h14V13z"/>
</vector>


```


===== mobileApplication/app/src/main/res/drawable/ic_notifications_black_24dp.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M12,22c1.1,0 2,-0.9 2,-2h-4c0,1.1 0.89,2 2,2zM18,16v-5c0,-3.07 -1.64,-5.64 -4.5,-6.32L13.5,4c0,-0.83 -0.67,-1.5 -1.5,-1.5s-1.5,0.67 -1.5,1.5v0.68C7.63,5.36 6,7.92 6,11v5l-2,2v1h16v-1l-2,-2z"/>
</vector>
```


===== mobileApplication/app/src/main/res/drawable/ic_orders.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M14,2L6,2c-1.1,0 -1.99,0.9 -1.99,2L4,20c0,1.1 0.89,2 2,2h12c1.1,0 2,-0.9 2,-2L20,8l-6,-6zM16,18L8,18v-2h8v2zM16,14L8,14v-2h8v2zM13,9L13,3.5L18.5,9L13,9z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_person.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
    <path
        android:fillColor="@android:color/white"
        android:pathData="M12,12c2.21,0 4,-1.79 4,-4s-1.79,-4 -4,-4 -4,1.79 -4,4 1.79,4 4,4zM12,14c-2.67,0 -8,1.34 -8,4v2h16v-2c0,-2.66 -5.33,-4 -8,-4z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/ic_plus.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24">
    <path
        android:fillColor="@android:color/white"
        android:pathData="M19,13h-6v6h-2v-6H5v-2h6V5h2v6h6V13z"/>
</vector>


```


===== mobileApplication/app/src/main/res/drawable/ic_search.xml =====

```xml
<vector xmlns:android="http://schemas.android.com/apk/res/android"
    android:width="24dp"
    android:height="24dp"
    android:viewportWidth="24"
    android:viewportHeight="24"
    android:tint="?attr/colorOnSurface">
  <path
      android:fillColor="@android:color/white"
      android:pathData="M15.5,14h-0.79l-0.28,-0.27C15.41,12.59 16,11.11 16,9.5 16,5.91 13.09,3 9.5,3S3,5.91 3,9.5 5.91,16 9.5,16c1.61,0 3.09,-0.59 4.23,-1.57l0.27,0.28v0.79l5,4.99L20.49,19l-4.99,-5zM9.5,14C7.01,14 5,11.99 5,9.5S7.01,5 9.5,5 14,7.01 14,9.5 11.99,14 9.5,14z"/>
</vector>

```


===== mobileApplication/app/src/main/res/drawable/pinned_badge_background.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">
    <solid android:color="#FF6B35" /> <!-- Orange color -->
    <corners android:radius="4dp" />
</shape>

```


===== mobileApplication/app/src/main/res/drawable/points_container_background.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">
    
    <solid android:color="#4CAF50" />
    
    <corners android:radius="16dp" />
    
    <stroke
        android:width="1dp"
        android:color="#388E3C" />
        
</shape>

```


===== mobileApplication/app/src/main/res/drawable/shimmer_animation.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<animation-list xmlns:android="http://schemas.android.com/apk/res/android"
    android:oneshot="false">
    <item
        android:duration="1000">
        <shape android:shape="rectangle">
            <gradient
                android:angle="0"
                android:startColor="#E0E0E0"
                android:centerColor="#F5F5F5"
                android:endColor="#E0E0E0"
                android:type="linear" />
        </shape>
    </item>
    <item
        android:duration="1000">
        <shape android:shape="rectangle">
            <gradient
                android:angle="0"
                android:startColor="#F5F5F5"
                android:centerColor="#E0E0E0"
                android:endColor="#F5F5F5"
                android:type="linear" />
        </shape>
    </item>
</animation-list>


```


===== mobileApplication/app/src/main/res/drawable/shimmer_background.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">
    <gradient
        android:angle="0"
        android:startColor="#E0E0E0"
        android:centerColor="#F5F5F5"
        android:endColor="#E0E0E0"
        android:type="linear" />
</shape>


```


===== mobileApplication/app/src/main/res/drawable/shimmer_card_placeholder.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<layer-list xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- Base gray background - darker with rounded corners for cards -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#BDBDBD" />
            <corners android:radius="12dp" />
        </shape>
    </item>
    <!-- Shimmer gradient overlay -->
    <item>
        <shape android:shape="rectangle">
            <gradient
                android:angle="0"
                android:startColor="#BDBDBD"
                android:centerColor="#E0E0E0"
                android:endColor="#BDBDBD"
                android:type="linear" />
            <corners android:radius="12dp" />
        </shape>
    </item>
</layer-list>


```


===== mobileApplication/app/src/main/res/drawable/shimmer_gradient.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android"
    android:shape="rectangle">
    <gradient
        android:angle="45"
        android:startColor="#E0E0E0"
        android:centerColor="#F5F5F5"
        android:endColor="#E0E0E0"
        android:type="linear" />
</shape>


```


===== mobileApplication/app/src/main/res/drawable/shimmer_placeholder.xml =====

```xml
<?xml version="1.0" encoding="utf-8"?>
<layer-list xmlns:android="http://schemas.android.com/apk/res/android">
    <!-- Base gray background - darker with rounded corners -->
    <item>
        <shape android:shape="rectangle">
            <solid android:color="#BDBDBD" />
            <corners android:radius="8dp" />
        </shape>
    </item>
    <!-- Shimmer gradient overlay -->
    <item>
        <shape android:shape="rectangle">
            <gradient
                android:angle="0"
                android:startColor="#BDBDBD"
                android:centerColor="#E0E0E0"
                android:endColor="#BDBDBD"
                android:type="linear" />
            <corners android:radius="8dp" />
        </shape>
    </item>
</layer-list>


```


===== mobileApplication/build.gradle.kts =====

```kotlin
// Top-level build file where you can add configuration options common to all sub-projects/modules.
plugins {
    alias(libs.plugins.android.application) apply false
    alias(libs.plugins.kotlin.android) apply false
}
```


===== mobileApplication/app/build.gradle.kts =====

```kotlin
plugins {
    alias(libs.plugins.android.application)
    alias(libs.plugins.kotlin.android)
}

android {
    namespace = "com.example.driverrewards"
    compileSdk = 35

    defaultConfig {
        applicationId = "com.example.driverrewards"
        minSdk = 34
        targetSdk = 35
        versionCode = 1
        versionName = "1.0"

        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }

    buildTypes {
        debug {
            isDebuggable = true
            isMinifyEnabled = false
        }
        release {
            isDebuggable = false
            isMinifyEnabled = false
            proguardFiles(
                getDefaultProguardFile("proguard-android-optimize.txt"),
                "proguard-rules.pro"
            )
            signingConfig = signingConfigs.getByName("debug")
        }
    }
    compileOptions {
        sourceCompatibility = JavaVersion.VERSION_11
        targetCompatibility = JavaVersion.VERSION_11
    }
    kotlinOptions {
        jvmTarget = "11"
    }
    buildFeatures {
        viewBinding = true
    }
    
    lint {
        abortOnError = false
    }
}

dependencies {

    implementation(libs.androidx.core.ktx)
    implementation(libs.androidx.appcompat)
    implementation(libs.material)
    implementation(libs.androidx.constraintlayout)
    implementation(libs.androidx.lifecycle.livedata.ktx)
    implementation(libs.androidx.lifecycle.viewmodel.ktx)
    implementation(libs.androidx.navigation.fragment.ktx)
    implementation(libs.androidx.navigation.ui.ktx)
    implementation("androidx.swiperefreshlayout:swiperefreshlayout:1.1.0")
    
    // HTTP client for API calls
    implementation("com.squareup.okhttp3:okhttp:4.12.0")
    implementation("com.squareup.okhttp3:logging-interceptor:4.12.0")
    
    // JSON parsing
    implementation("com.google.code.gson:gson:2.10.1")
    
    // SharedPreferences for session management
    implementation("androidx.preference:preference-ktx:1.2.1")
    
    // Image loading library
    implementation("com.github.bumptech.glide:glide:4.16.0")
    
    // Chart library for points graph
    implementation("com.github.PhilJay:MPAndroidChart:v3.1.0")
    
    // Biometric authentication
    implementation("androidx.biometric:biometric:1.1.0")
    
    testImplementation(libs.junit)
    androidTestImplementation(libs.androidx.junit)
    androidTestImplementation(libs.androidx.espresso.core)
}
```


===== mobileApplication/settings.gradle.kts =====

```kotlin
pluginManagement {
    repositories {
        google {
            content {
                includeGroupByRegex("com\\.android.*")
                includeGroupByRegex("com\\.google.*")
                includeGroupByRegex("androidx.*")
            }
        }
        mavenCentral()
        gradlePluginPortal()
    }
}
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)
    repositories {
        google()
        mavenCentral()
        maven { url = uri("https://jitpack.io") }
    }
}

rootProject.name = "DriverRewards"
include(":app")
 
```


===== mobileApplication/gradle/libs.versions.toml =====

```toml
[versions]
agp = "8.8.0"
kotlin = "1.9.24"
coreKtx = "1.15.0"
junit = "4.13.2"
junitVersion = "1.2.1"
espressoCore = "3.6.1"
appcompat = "1.6.1"
material = "1.10.0"
constraintlayout = "2.1.4"
lifecycleLivedataKtx = "2.8.7"
lifecycleViewmodelKtx = "2.8.7"
navigationFragmentKtx = "2.6.0"
navigationUiKtx = "2.6.0"

[libraries]
androidx-core-ktx = { group = "androidx.core", name = "core-ktx", version.ref = "coreKtx" }
junit = { group = "junit", name = "junit", version.ref = "junit" }
androidx-junit = { group = "androidx.test.ext", name = "junit", version.ref = "junitVersion" }
androidx-espresso-core = { group = "androidx.test.espresso", name = "espresso-core", version.ref = "espressoCore" }
androidx-appcompat = { group = "androidx.appcompat", name = "appcompat", version.ref = "appcompat" }
material = { group = "com.google.android.material", name = "material", version.ref = "material" }
androidx-constraintlayout = { group = "androidx.constraintlayout", name = "constraintlayout", version.ref = "constraintlayout" }
androidx-lifecycle-livedata-ktx = { group = "androidx.lifecycle", name = "lifecycle-livedata-ktx", version.ref = "lifecycleLivedataKtx" }
androidx-lifecycle-viewmodel-ktx = { group = "androidx.lifecycle", name = "lifecycle-viewmodel-ktx", version.ref = "lifecycleViewmodelKtx" }
androidx-navigation-fragment-ktx = { group = "androidx.navigation", name = "navigation-fragment-ktx", version.ref = "navigationFragmentKtx" }
androidx-navigation-ui-ktx = { group = "androidx.navigation", name = "navigation-ui-ktx", version.ref = "navigationUiKtx" }

[plugins]
android-application = { id = "com.android.application", version.ref = "agp" }
kotlin-android = { id = "org.jetbrains.kotlin.android", version.ref = "kotlin" }


```
